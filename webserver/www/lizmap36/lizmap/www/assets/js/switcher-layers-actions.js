!function(){var e=null,a={};lizMap.events.on({uicreated:function(){if("themes"in lizMap.config){var t=lizMap.config.themes,l='<div id="theme-selector" class="btn-group" role="group">';for(var i in l+='<button class="btn btn-mini dropdown-toggle" data-toggle="dropdown" type="button" title="'+lizDict["switcherLayersActions.themeSelector.title"]+'" href="#"><i class="icon-none qgis_sprite mActionShowAllLayers"></i><span class="caret"></span></button>',l+='<ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu">',t)l+='<li class="theme"><a href="#">'+i+"</a></li>";l+="</ul>",l+="</div>",$("#switcher-layers-actions").prepend(l),$("#theme-selector").on("click",".theme",(function(){$("#theme-selector .theme").removeClass("selected"),$(this).addClass("selected");var e=$(this).text();if(e in lizMap.config.themes){var a=lizMap.config.themes[e];if($("#switcher-layers .liz-layer a.expander ~ button.checked").each((function(){$(this).hasClass("disabled")?$(this).removeClass("partial").removeClass("checked"):$(this).click()})),"layers"in a)for(var t in a.layers){var l=lizMap.getLayerConfigById(t);if(l){var i=l[0],s=i,n=l[1];"typename"in n&&(s=n.typename);var r=$("#switcher-layers #layer-"+n.cleanname+" a.expander ~ button");if(r.hasClass("disabled")?r.removeClass("partial").addClass("checked"):r.click(),"style"in a.layers[t]){var c=a.layers[t].style,o=lizMap.map.getLayersByName(lizMap.cleanName(i));if(0==o.length)continue;var p=o[0];p&&p.params&&(p.params.STYLES=c,p.redraw(!0),lizMap.events.triggerEvent("layerstylechanged",{featureType:s}))}}}lizMap.events.triggerEvent("mapthemechanged",{name:e,config:a})}})),lizMap.events.triggerEvent("mapthemesadded",{themes:t}),"activateFirstMapTheme"in lizMap.config.options&&"True"==lizMap.config.options.activateFirstMapTheme&&$("#theme-selector li.theme:nth-child(1)").click()}e=lizMap.getVectorLayerFeatureTypes(),$("#switcher-layers-actions .btn, #get-baselayer-metadata").tooltip({placement:"bottom"}),$("#layers-unfold-all").click((function(){return $("#switcher table.tree tr.collapsed:not(.liz-layer.disabled) a.expander").click(),!1})),$("#layers-fold-all").click((function(){return $("#switcher table.tree").collapseAll(),!1})),$("#get-baselayer-metadata").click((function(){if($("#hide-sub-dock").click(),!lizMap.map.baseLayer)return!1;var e=lizMap.map.baseLayer.name;return!!e&&(lizMap.events.triggerEvent("lizmapswitcheritemselected",{name:e,type:"baselayer",selected:!0}),!1)})),$("#content").on("click","button.layerActionZoom",(function(){var e=$(this).val();if(!e)return!1;var a=lizMap.config.layers[e];"baselayer"==a.type&&lizMap.map.zoomToMaxExtent();var t=lizMap.map.getProjection();if("EPSG:900913"==t&&(t="EPSG:3857"),!("bbox"in a)||!(t in a.bbox))return console.log("The layer bbox information has not been found in config"),console.log(a),!1;var l=a.bbox[t].bbox,i=new OpenLayers.Bounds(l[0],l[1],l[2],l[3]);return OpenLayers.Projection.defaults[t]&&OpenLayers.Projection.defaults[t].yx&&(i=new OpenLayers.Bounds(l[1],l[0],l[3],l[2])),lizMap.map.zoomToExtent(i),!1})),$("#content").on("change","select.styleLayer",(function(){var e=$(this).val(),a=$(this).parent().find("input.styleLayer"),t=a.val(),l=a.hasClass("baselayer");if(!t)return!1;var i=null;(i=l?lizMap.map.baseLayer:lizMap.map.getLayersByName(lizMap.cleanName(t))[0])&&i.params&&(i.params.STYLES=e,i.redraw(!0),lizMap.events.triggerEvent("layerstylechanged",{featureType:t}))})),$("#content").on("click","a.btn-opacity-layer",(function(){var e=$(this).text(),t=parseInt(e)/100,l=$(this).parent().find("input.opacityLayer"),i=l.val(),s=l.hasClass("baselayer");if(!i)return!1;var n=null;return(n=s?lizMap.map.baseLayer:lizMap.map.getLayersByName(lizMap.cleanName(i))[0])&&n.params&&(n.setOpacity(t),a[i]=t,$("a.btn-opacity-layer").removeClass("active"),$("a.btn-opacity-layer."+100*t).addClass("active")),$("#switcher").click(),!1})),$("#content").on("click","button.exportLayer",(function(){var e=$(this).val(),a=$(this).parent().find("select.exportLayer").val();return lizMap.exportVectorLayer(e,a),!1})),$("#layerActionUnfilter").click((function(){var e=lizMap.lizmapLayerFilterActive;return!!e&&(lizMap.events.triggerEvent("layerfeatureremovefilter",{featureType:e}),lizMap.lizmapLayerFilterActive=null,$(this).hide(),!1)})),lizMap.events.on({dockclosed:function(e){"switcher"==e.id&&$("#hide-sub-dock").click()},lizmapbaselayerchanged:function(e){if($("#sub-dock").is(":visible")){var a=$("#hide-sub-dock").val();0!=$("#switcher-baselayer-select").find('option[value="'+a+'"]').length&&a!=$("#switcher-baselayer-select").val()&&lizMap.events.triggerEvent("lizmapswitcheritemselected",{name:e.layer.name,type:"baselayer",selected:!0})}}})},lizmapswitcheritemselected:function(t){var l=t.name,i=t.type,s=t.selected,n={};if("baselayer"==i)(r=lizMap.getLayerNameByCleanName(lizMap.cleanName(l)))&&(l=r);else{var r;if(!(r=lizMap.getLayerNameByCleanName(lizMap.cleanName(l))))return!1;l=r,n=lizMap.config.layers[r]}var c=l;s||(c=""),$("#switcher-layers-actions button").val(c);var o=!s||!("bbox"in n);$("button.layerActionZoom").attr("disable",o).toggleClass("disabled",o),function(t,l){var i;l?(i=function(t){var l="",i={title:t,type:"layer",abstract:null,link:null,styles:null,isBaselayer:!1};if(t in lizMap.config.layers){var s=lizMap.config.layers[t];i.title=s.title,i.type=s.type,s.abstract&&(i.abstract=s.abstract),s.link&&(i.link=s.link),s.styles&&s.styles.length>1&&(i.styles=s.styles)}if(lizMap.map.baseLayer&&lizMap.map.baseLayer.name==t&&(i.type="layer",i.isBaselayer=!0),i){if(s=lizMap.config.layers[t],l+='<div class="sub-metadata">',l+="<h3>",l+='    <span class="title">',l+='        <span class="icon"></span>',l+='        <span class="text">'+lizDict["layer.metadata.title"]+"</span>",l+="    </span>",l+="</h3>",l+='<div class="menu-content">',l+='    <dl class="dl-vertical" style="font-size:0.8em;">',l+="        <dt>"+lizDict["layer.metadata.layer.name"]+"</dt>",l+="        <dd>"+i.title+"</dd>",l+="        <dt>"+lizDict["layer.metadata.layer.type"]+"</dt>",l+="        <dd>"+lizDict["layer.metadata.layer.type."+i.type]+"</dd>",l+="        <dt>"+lizDict["layer.metadata.zoomToExtent.title"]+"</dt>",l+='<dd><button class="btn btn-mini layerActionZoom" title="'+lizDict["layer.metadata.zoomToExtent.title"]+'" value="'+t+'"><i class="icon-zoom-in"></i></button></dd>',"layer"==i.type){var n="";if(i.isBaselayer&&(n="baselayer"),i.styles){var r="",c=lizMap.map.getLayersByName(lizMap.cleanName(t))[0];for(var o in c&&"STYLES"in c.params&&(r=c.params.STYLES),v="",i.styles)v+=(o=i.styles[o])==r?'<option value="'+o+'" selected>'+o+"</option>":'<option value="'+o+'">'+o+"</option>";""!=v&&(l+="        <dt>"+lizDict["layer.metadata.style.title"]+"</dt>",l+="<dd>",l+='<input type="hidden" class="styleLayer '+n+'" value="'+t+'">',l+='<select class="styleLayer '+n+'">',l+=v,l+="</select>",l+="</dd>")}l+="        <dt>"+lizDict["layer.metadata.opacity.title"]+"</dt>",l+="<dd>";var p=1;t in a&&(p=a[t]),l+='<input type="hidden" class="opacityLayer '+n+'" value="'+t+'">';var d=lizMap.config.options.layersOpacities;void 0===d&&(d=[.2,.4,.6,.8,1]);for(var y=0,m=d.length;y<m;y++){var u="";p==d[y]&&(u="active"),l+='<a href="#" class="btn btn-mini btn-opacity-layer '+u+" "+100*d[y]+'">'+100*d[y]+"</a>"}if(l+="</dd>","exportLayers"in lizMap.config.options&&"True"==lizMap.config.options.exportLayers&&null!=e&&0!=e.length){var b=lizMap.getVectorLayerResultFormat(),v="";for(const e of b)v+='<option value="'+e+'">'+e+"</option>";""!=v&&null!=s.typename&&(l+="        <dt>"+lizDict["layer.metadata.export.title"]+"</dt>",l+="<dd>",l+='<select class="exportLayer '+n+'">',l+=v,l+="</select>",l+='<button class="btn btn-mini exportLayer '+n+'" title="'+lizDict["layer.metadata.export.title"]+'" value="'+t+'"><i class="icon-download"></i></button>',l+="</dd>")}}i.abstract&&(l+="        <dt>"+lizDict["layer.metadata.layer.abstract"]+"</dt>",l+="        <dd>"+i.abstract+"</dd>"),l+="    </dl>",i.link&&(l+='    <button class="btn link layer-info" name="link" title="'+lizDict["layer.metadata.layer.info.see"]+'" value="'+i.link+'">'+lizDict["layer.metadata.layer.info.see"]+"</button>"),l+="</div>",l+="</div>",l+='<button id="hide-sub-dock" class="btn btn-mini pull-right" name="close" title="'+lizDict["generic.btn.close.title"]+'" value="'+t+'">'+lizDict["generic.btn.close.title"]+"</button>"}return l}(t),$("#sub-dock").html(i),$("#sub-dock a.btn-opacity-layer").each((function(){var e=$(this).text(),a=parseInt(e)/100-.3;$(this).css("background-color","rgba(0,0,0,"+a+")"),$(this).css("background-image","none"),$(this).css("text-shadow","none"),parseInt(e)>60&&$(this).css("color","lightgrey")})),$("div.sub-metadata button.link").click((function(){var e=$(this);if(e.hasClass("disabled"))return!1;var a=e.val();/^(\/)?media\//.test(a)&&(a=OpenLayers.Util.urlAppend(lizUrls.media,OpenLayers.Util.getParameterString(lizUrls.params))+"&path=/"+a),window.open(a)})),$("#hide-sub-dock").click((function(){var e=$(this).val(),a=lizMap.config.layers[e],t="baselayer";"type"in a&&(t=a.type),lizMap.events.triggerEvent("lizmapswitcheritemselected",{name:e,type:t,selected:!1}),$("#switcher tr.selected").removeClass("selected")})),"none"!=$("#sub-dock").css("display")||$("#sub-dock").show()):$("#sub-dock").hide().html("")}(l,s)}})}();
//# sourceMappingURL=switcher-layers-actions.js.map