/*! For license information please see lizmap.js.LICENSE.txt */
(()=>{var t={582:function(t){t.exports=function(){"use strict";function t(t,s,n,r,o){!function t(i,s,n,r,o){for(;r>n;){if(r-n>600){var a=r-n+1,h=s-n+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(h-a/2<0?-1:1);t(i,s,Math.max(n,Math.floor(s-h*c/a+u)),Math.min(r,Math.floor(s+(a-h)*c/a+u)),o)}var d=i[s],g=n,p=r;for(e(i,n,s),o(i[r],d)>0&&e(i,n,r);g<p;){for(e(i,g,p),g++,p--;o(i[g],d)<0;)g++;for(;o(i[p],d)>0;)p--}0===o(i[n],d)?e(i,n,p):e(i,++p,r),p<=s&&(n=p+1),s<=p&&(r=p-1)}}(t,s,n||0,r||t.length-1,o||i)}function e(t,e,i){var s=t[e];t[e]=t[i],t[i]=s}function i(t,e){return t<e?-1:t>e?1:0}var s=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(t,e,i){if(!i)return e.indexOf(t);for(var s=0;s<e.length;s++)if(i(t,e[s]))return s;return-1}function r(t,e){o(t,0,t.children.length,e,t)}function o(t,e,i,s,n){n||(n=p(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var r=e;r<i;r++){var o=t.children[r];a(n,t.leaf?s(o):o)}return n}function a(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function h(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function g(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _(e,i,s,n,r){for(var o=[i,s];o.length;)if(!((s=o.pop())-(i=o.pop())<=n)){var a=i+Math.ceil((s-i)/n/2)*n;t(e,a,i,s,r),o.push(i,a,a,s)}}return s.prototype.all=function(){return this._all(this.data,[])},s.prototype.search=function(t){var e=this.data,i=[];if(!g(t,e))return i;for(var s=this.toBBox,n=[];e;){for(var r=0;r<e.children.length;r++){var o=e.children[r],a=e.leaf?s(o):o;g(t,a)&&(e.leaf?i.push(o):d(t,a)?this._all(o,i):n.push(o))}e=n.pop()}return i},s.prototype.collides=function(t){var e=this.data;if(!g(t,e))return!1;for(var i=[];e;){for(var s=0;s<e.children.length;s++){var n=e.children[s],r=e.leaf?this.toBBox(n):n;if(g(t,r)){if(e.leaf||d(t,r))return!0;i.push(n)}}e=i.pop()}return!1},s.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var s=this.data;this.data=i,i=s}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},s.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},s.prototype.clear=function(){return this.data=p([]),this},s.prototype.remove=function(t,e){if(!t)return this;for(var i,s,r,o=this.data,a=this.toBBox(t),h=[],l=[];o||h.length;){if(o||(o=h.pop(),s=h[h.length-1],i=l.pop(),r=!0),o.leaf){var c=n(t,o.children,e);if(-1!==c)return o.children.splice(c,1),h.push(o),this._condense(h),this}r||o.leaf||!d(o,a)?s?(i++,o=s.children[i],r=!1):o=null:(h.push(o),l.push(i),i=0,s=o,o=o.children[0])}return this},s.prototype.toBBox=function(t){return t},s.prototype.compareMinX=function(t,e){return t.minX-e.minX},s.prototype.compareMinY=function(t,e){return t.minY-e.minY},s.prototype.toJSON=function(){return this.data},s.prototype.fromJSON=function(t){return this.data=t,this},s.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},s.prototype._build=function(t,e,i,s){var n,o=i-e+1,a=this._maxEntries;if(o<=a)return r(n=p(t.slice(e,i+1)),this.toBBox),n;s||(s=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,s-1))),(n=p([])).leaf=!1,n.height=s;var h=Math.ceil(o/a),l=h*Math.ceil(Math.sqrt(a));_(t,e,i,l,this.compareMinX);for(var c=e;c<=i;c+=l){var u=Math.min(c+l-1,i);_(t,c,u,h,this.compareMinY);for(var d=c;d<=u;d+=h){var g=Math.min(d+h-1,u);n.children.push(this._build(t,d,g,s-1))}}return r(n,this.toBBox),n},s.prototype._chooseSubtree=function(t,e,i,s){for(;s.push(e),!e.leaf&&s.length-1!==i;){for(var n=1/0,r=1/0,o=void 0,a=0;a<e.children.length;a++){var h=e.children[a],l=c(h),u=(d=t,g=h,(Math.max(g.maxX,d.maxX)-Math.min(g.minX,d.minX))*(Math.max(g.maxY,d.maxY)-Math.min(g.minY,d.minY))-l);u<r?(r=u,n=l<n?l:n,o=h):u===r&&l<n&&(n=l,o=h)}e=o||e.children[0]}var d,g;return e},s.prototype._insert=function(t,e,i){var s=i?t:this.toBBox(t),n=[],r=this._chooseSubtree(s,this.data,e,n);for(r.children.push(t),a(r,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)},s.prototype._split=function(t,e){var i=t[e],s=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,s);var o=this._chooseSplitIndex(i,n,s),a=p(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,r(i,this.toBBox),r(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},s.prototype._splitRoot=function(t,e){this.data=p([t,e]),this.data.height=t.height+1,this.data.leaf=!1,r(this.data,this.toBBox)},s.prototype._chooseSplitIndex=function(t,e,i){for(var s,n,r,a,h,l,u,d=1/0,g=1/0,p=e;p<=i-e;p++){var _=o(t,0,p,this.toBBox),f=o(t,p,i,this.toBBox),m=(n=_,r=f,void 0,void 0,void 0,void 0,a=Math.max(n.minX,r.minX),h=Math.max(n.minY,r.minY),l=Math.min(n.maxX,r.maxX),u=Math.min(n.maxY,r.maxY),Math.max(0,l-a)*Math.max(0,u-h)),y=c(_)+c(f);m<d?(d=m,s=p,g=y<g?y:g):m===d&&y<g&&(g=y,s=p)}return s||i-e},s.prototype._chooseSplitAxis=function(t,e,i){var s=t.leaf?this.compareMinX:h,n=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,i,s)<this._allDistMargin(t,e,i,n)&&t.children.sort(s)},s.prototype._allDistMargin=function(t,e,i,s){t.children.sort(s);for(var n=this.toBBox,r=o(t,0,e,n),h=o(t,i-e,i,n),l=u(r)+u(h),c=e;c<i-e;c++){var d=t.children[c];a(r,t.leaf?n(d):d),l+=u(r)}for(var g=i-e-1;g>=e;g--){var p=t.children[g];a(h,t.leaf?n(p):p),l+=u(h)}return l},s.prototype._adjustParentBBoxes=function(t,e,i){for(var s=i;s>=0;s--)a(e[s],t)},s.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():r(t[e],this.toBBox)},s}()},854:function(t,e,i){t.exports=function(){"use strict";var t=function(t){var e=t.id,i=t.viewBox,s=t.content;this.id=e,this.viewBox=i,this.content=s};t.prototype.stringify=function(){return this.content},t.prototype.toString=function(){return this.stringify()},t.prototype.destroy=function(){var t=this;["id","viewBox","content"].forEach((function(e){return delete t[e]}))};function e(t,e){return t(e={exports:{}},e.exports),e.exports}"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self&&self;var s=e((function(t,e){t.exports=function(){function t(t){return t&&"object"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)&&"[object Date]"!==Object.prototype.toString.call(t)}function e(t){return Array.isArray(t)?[]:{}}function i(i,s){return s&&!0===s.clone&&t(i)?r(e(i),i,s):i}function s(e,s,n){var o=e.slice();return s.forEach((function(s,a){void 0===o[a]?o[a]=i(s,n):t(s)?o[a]=r(e[a],s,n):-1===e.indexOf(s)&&o.push(i(s,n))})),o}function n(e,s,n){var o={};return t(e)&&Object.keys(e).forEach((function(t){o[t]=i(e[t],n)})),Object.keys(s).forEach((function(a){t(s[a])&&e[a]?o[a]=r(e[a],s[a],n):o[a]=i(s[a],n)})),o}function r(t,e,r){var o=Array.isArray(e),a=(r||{arrayMerge:s}).arrayMerge||s;return o?Array.isArray(t)?a(t,e,r):i(e,r):n(t,e,r)}return r.all=function(t,e){if(!Array.isArray(t)||t.length<2)throw new Error("first argument should be an array with at least two elements");return t.reduce((function(t,i){return r(t,i,e)}))},r}()})),n=e((function(t,e){e.default={svg:{name:"xmlns",uri:"http://www.w3.org/2000/svg"},xlink:{name:"xmlns:xlink",uri:"http://www.w3.org/1999/xlink"}},t.exports=e.default})),r=n.svg,o=n.xlink,a={};a[r.name]=r.uri,a[o.name]=o.uri;var h=function(t,e){return void 0===t&&(t=""),"<svg "+function(t){return Object.keys(t).map((function(e){return e+'="'+t[e].toString().replace(/"/g,"&quot;")+'"'})).join(" ")}(s(a,e||{}))+">"+t+"</svg>"},l=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={isMounted:{}};return i.isMounted.get=function(){return!!this.node},e.createFromExistingNode=function(t){return new e({id:t.getAttribute("id"),viewBox:t.getAttribute("viewBox"),content:t.outerHTML})},e.prototype.destroy=function(){this.isMounted&&this.unmount(),t.prototype.destroy.call(this)},e.prototype.mount=function(t){if(this.isMounted)return this.node;var e="string"==typeof t?document.querySelector(t):t,i=this.render();return this.node=i,e.appendChild(i),i},e.prototype.render=function(){var t=this.stringify();return function(t){var e=!!document.importNode,i=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;return e?document.importNode(i,!0):i}(h(t)).childNodes[0]},e.prototype.unmount=function(){this.node.parentNode.removeChild(this.node)},Object.defineProperties(e.prototype,i),e}(t);return l}()},348:function(t,e,i){t.exports=function(){"use strict";function t(t,e){return t(e={exports:{}},e.exports),e.exports}"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self&&self;var e=t((function(t,e){t.exports=function(){function t(t){return t&&"object"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)&&"[object Date]"!==Object.prototype.toString.call(t)}function e(t){return Array.isArray(t)?[]:{}}function i(i,s){return s&&!0===s.clone&&t(i)?r(e(i),i,s):i}function s(e,s,n){var o=e.slice();return s.forEach((function(s,a){void 0===o[a]?o[a]=i(s,n):t(s)?o[a]=r(e[a],s,n):-1===e.indexOf(s)&&o.push(i(s,n))})),o}function n(e,s,n){var o={};return t(e)&&Object.keys(e).forEach((function(t){o[t]=i(e[t],n)})),Object.keys(s).forEach((function(a){t(s[a])&&e[a]?o[a]=r(e[a],s[a],n):o[a]=i(s[a],n)})),o}function r(t,e,r){var o=Array.isArray(e),a=(r||{arrayMerge:s}).arrayMerge||s;return o?Array.isArray(t)?a(t,e,r):i(e,r):n(t,e,r)}return r.all=function(t,e){if(!Array.isArray(t)||t.length<2)throw new Error("first argument should be an array with at least two elements");return t.reduce((function(t,i){return r(t,i,e)}))},r}()}));var s=t((function(t,e){e.default={svg:{name:"xmlns",uri:"http://www.w3.org/2000/svg"},xlink:{name:"xmlns:xlink",uri:"http://www.w3.org/1999/xlink"}},t.exports=e.default})),n=s.svg,r=s.xlink,o={};o[n.name]=n.uri,o[r.name]=r.uri;var a,h=function(t,i){return void 0===t&&(t=""),"<svg "+function(t){return Object.keys(t).map((function(e){return e+'="'+t[e].toString().replace(/"/g,"&quot;")+'"'})).join(" ")}(e(o,i||{}))+">"+t+"</svg>"},l=s.svg,c=s.xlink,u={attrs:(a={style:["position: absolute","width: 0","height: 0"].join("; "),"aria-hidden":"true"},a[l.name]=l.uri,a[c.name]=c.uri,a)},d=function(t){this.config=e(u,t||{}),this.symbols=[]};d.prototype.add=function(t){var e=this.symbols,i=this.find(t.id);return i?(e[e.indexOf(i)]=t,!1):(e.push(t),!0)},d.prototype.remove=function(t){var e=this.symbols,i=this.find(t);return!!i&&(e.splice(e.indexOf(i),1),i.destroy(),!0)},d.prototype.find=function(t){return this.symbols.filter((function(e){return e.id===t}))[0]||null},d.prototype.has=function(t){return null!==this.find(t)},d.prototype.stringify=function(){var t=this.config.attrs,e=this.symbols.map((function(t){return t.stringify()})).join("");return h(e,t)},d.prototype.toString=function(){return this.stringify()},d.prototype.destroy=function(){this.symbols.forEach((function(t){return t.destroy()}))};var g=function(t){var e=t.id,i=t.viewBox,s=t.content;this.id=e,this.viewBox=i,this.content=s};g.prototype.stringify=function(){return this.content},g.prototype.toString=function(){return this.stringify()},g.prototype.destroy=function(){var t=this;["id","viewBox","content"].forEach((function(e){return delete t[e]}))};var p=function(t){var e=!!document.importNode,i=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;return e?document.importNode(i,!0):i},_=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={isMounted:{}};return i.isMounted.get=function(){return!!this.node},e.createFromExistingNode=function(t){return new e({id:t.getAttribute("id"),viewBox:t.getAttribute("viewBox"),content:t.outerHTML})},e.prototype.destroy=function(){this.isMounted&&this.unmount(),t.prototype.destroy.call(this)},e.prototype.mount=function(t){if(this.isMounted)return this.node;var e="string"==typeof t?document.querySelector(t):t,i=this.render();return this.node=i,e.appendChild(i),i},e.prototype.render=function(){var t=this.stringify();return p(h(t)).childNodes[0]},e.prototype.unmount=function(){this.node.parentNode.removeChild(this.node)},Object.defineProperties(e.prototype,i),e}(g),f={autoConfigure:!0,mountTo:"body",syncUrlsWithBaseTag:!1,listenLocationChangeEvent:!0,locationChangeEvent:"locationChange",locationChangeAngularEmitter:!1,usagesToUpdate:"use[*|href]",moveGradientsOutsideSymbol:!1},m=function(t){return Array.prototype.slice.call(t,0)},y={isChrome:function(){return/chrome/i.test(navigator.userAgent)},isFirefox:function(){return/firefox/i.test(navigator.userAgent)},isIE:function(){return/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)},isEdge:function(){return/edge/i.test(navigator.userAgent)}},x=function(t){var e=[];return m(t.querySelectorAll("style")).forEach((function(t){t.textContent+="",e.push(t)})),e},v=function(t){return(t||window.location.href).split("#")[0]},w=function(t){angular.module("ng").run(["$rootScope",function(e){e.$on("$locationChangeSuccess",(function(e,i,s){var n,r,o;n=t,r={oldUrl:s,newUrl:i},(o=document.createEvent("CustomEvent")).initCustomEvent(n,!1,!1,r),window.dispatchEvent(o)}))}])},M=function(t,e){return void 0===e&&(e="linearGradient, radialGradient, pattern, mask, clipPath"),m(t.querySelectorAll("symbol")).forEach((function(t){m(t.querySelectorAll(e)).forEach((function(e){t.parentNode.insertBefore(e,t)}))})),t};var E=s.xlink.uri,C="xlink:href",S=/[{}|\\\^\[\]`"<>]/g;function b(t){return t.replace(S,(function(t){return"%"+t[0].charCodeAt(0).toString(16).toUpperCase()}))}var I,L=["clipPath","colorProfile","src","cursor","fill","filter","marker","markerStart","markerMid","markerEnd","mask","stroke","style"],T=L.map((function(t){return"["+t+"]"})).join(","),N=function(t,e,i,s){var n,r,o=b(i),a=b(s);(n=t.querySelectorAll(T),r=function(t){var e=t.localName,i=t.value;return-1!==L.indexOf(e)&&-1!==i.indexOf("url("+o)},m(n).reduce((function(t,e){if(!e.attributes)return t;var i=m(e.attributes),s=r?i.filter(r):i;return t.concat(s)}),[])).forEach((function(t){return t.value=t.value.replace(new RegExp(o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),a)})),function(t,e,i){m(t).forEach((function(t){var s=t.getAttribute(C);if(s&&0===s.indexOf(e)){var n=s.replace(e,i);t.setAttributeNS(E,C,n)}}))}(e,o,a)},R={MOUNT:"mount",SYMBOL_MOUNT:"symbol_mount"},P=function(t){function i(i){var s=this;void 0===i&&(i={}),t.call(this,e(f,i));var n,r=(n=n||Object.create(null),{on:function(t,e){(n[t]||(n[t]=[])).push(e)},off:function(t,e){n[t]&&n[t].splice(n[t].indexOf(e)>>>0,1)},emit:function(t,e){(n[t]||[]).map((function(t){t(e)})),(n["*"]||[]).map((function(i){i(t,e)}))}});this._emitter=r,this.node=null;var o=this.config;if(o.autoConfigure&&this._autoConfigure(i),o.syncUrlsWithBaseTag){var a=document.getElementsByTagName("base")[0].getAttribute("href");r.on(R.MOUNT,(function(){return s.updateUrls("#",a)}))}var h=this._handleLocationChange.bind(this);this._handleLocationChange=h,o.listenLocationChangeEvent&&window.addEventListener(o.locationChangeEvent,h),o.locationChangeAngularEmitter&&w(o.locationChangeEvent),r.on(R.MOUNT,(function(t){o.moveGradientsOutsideSymbol&&M(t)})),r.on(R.SYMBOL_MOUNT,(function(t){o.moveGradientsOutsideSymbol&&M(t.parentNode),(y.isIE()||y.isEdge())&&x(t)}))}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var s={isMounted:{}};return s.isMounted.get=function(){return!!this.node},i.prototype._autoConfigure=function(t){var e=this.config;void 0===t.syncUrlsWithBaseTag&&(e.syncUrlsWithBaseTag=void 0!==document.getElementsByTagName("base")[0]),void 0===t.locationChangeAngularEmitter&&(e.locationChangeAngularEmitter=void 0!==window.angular),void 0===t.moveGradientsOutsideSymbol&&(e.moveGradientsOutsideSymbol=y.isFirefox())},i.prototype._handleLocationChange=function(t){var e=t.detail,i=e.oldUrl,s=e.newUrl;this.updateUrls(i,s)},i.prototype.add=function(e){var i=t.prototype.add.call(this,e);return this.isMounted&&i&&(e.mount(this.node),this._emitter.emit(R.SYMBOL_MOUNT,e.node)),i},i.prototype.attach=function(t){var e=this,i=this;if(i.isMounted)return i.node;var s="string"==typeof t?document.querySelector(t):t;return i.node=s,this.symbols.forEach((function(t){t.mount(i.node),e._emitter.emit(R.SYMBOL_MOUNT,t.node)})),m(s.querySelectorAll("symbol")).forEach((function(t){var e=_.createFromExistingNode(t);e.node=t,i.add(e)})),this._emitter.emit(R.MOUNT,s),s},i.prototype.destroy=function(){var t=this,e=t.config,i=t.symbols,s=t._emitter;i.forEach((function(t){return t.destroy()})),s.off("*"),window.removeEventListener(e.locationChangeEvent,this._handleLocationChange),this.isMounted&&this.unmount()},i.prototype.mount=function(t,e){void 0===t&&(t=this.config.mountTo),void 0===e&&(e=!1);var i=this;if(i.isMounted)return i.node;var s="string"==typeof t?document.querySelector(t):t,n=i.render();return this.node=n,e&&s.childNodes[0]?s.insertBefore(n,s.childNodes[0]):s.appendChild(n),this._emitter.emit(R.MOUNT,n),n},i.prototype.render=function(){return p(this.stringify())},i.prototype.unmount=function(){this.node.parentNode.removeChild(this.node)},i.prototype.updateUrls=function(t,e){if(!this.isMounted)return!1;var i=document.querySelectorAll(this.config.usagesToUpdate);return N(this.node,i,v(t)+"#",v(e)+"#"),!0},Object.defineProperties(i.prototype,s),i}(d),O=t((function(t){var e;e=function(){var t,e=[],i=document,s=i.documentElement.doScroll,n="DOMContentLoaded",r=(s?/^loaded|^c/:/^loaded|^i|^c/).test(i.readyState);return r||i.addEventListener(n,t=function(){for(i.removeEventListener(n,t),r=1;t=e.shift();)t()}),function(t){r?setTimeout(t,0):e.push(t)}},t.exports=e()})),A="__SVG_SPRITE_NODE__",F="__SVG_SPRITE__";window[F]?I=window[F]:(I=new P({attrs:{id:A,"aria-hidden":"true"}}),window[F]=I);var D=function(){var t=document.getElementById(A);t?I.attach(t):I.mount(document.body,!0)};return document.body?D():O(D),I}()}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s].call(r.exports,r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},e="propertychange",s=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function n(t,e){return t>e?1:t<e?-1:0}function r(t,e,i){const s=t.length;if(t[0]<=e)return 0;if(e<=t[s-1])return s-1;let n;if(i>0){for(n=1;n<s;++n)if(t[n]<e)return n-1}else if(i<0){for(n=1;n<s;++n)if(t[n]<=e)return n}else for(n=1;n<s;++n){if(t[n]==e)return n;if(t[n]<e)return"function"==typeof i?i(e,t[n-1],t[n])>0?n-1:n:t[n-1]-e<e-t[n]?n-1:n}return s-1}function o(t,e,i){for(;e<i;){const s=t[e];t[e]=t[i],t[i]=s,++e,--i}}function a(t,e){const i=Array.isArray(e)?e:[e],s=i.length;for(let e=0;e<s;e++)t[t.length]=i[e]}function h(t,e){const i=t.length;if(i!==e.length)return!1;for(let s=0;s<i;s++)if(t[s]!==e[s])return!1;return!0}function l(){return!0}function c(){return!1}function u(){}function d(t){for(const e in t)delete t[e]}function g(t){let e;for(e in t)return!1;return!e}const p=class extends s{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),s=i[t]||(i[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(e){const i="string"==typeof e,s=i?e:e.type,n=this.listeners_&&this.listeners_[s];if(!n)return;const r=i?new t(e):e;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});let h;s in o||(o[s]=0,a[s]=0),++o[s];for(let t=0,e=n.length;t<e;++t)if(h="handleEvent"in n[t]?n[t].handleEvent(r):n[t].call(this,r),!1===h||r.propagationStopped){h=!1;break}if(0==--o[s]){let t=a[s];for(delete a[s];t--;)this.removeEventListener(s,u);delete o[s]}return h}disposeInternal(){this.listeners_&&d(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(t,e){const i=this.listeners_&&this.listeners_[t];if(i){const s=i.indexOf(e);-1!==s&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[s]=u,++this.pendingRemovals_[t]):(i.splice(s,1),0===i.length&&delete this.listeners_[t]))}}},_={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function f(t,e,i,s,n){if(s&&s!==t&&(i=i.bind(s)),n){const s=i;i=function(){t.removeEventListener(e,i),s.apply(this,arguments)}}const r={target:t,type:e,listener:i};return t.addEventListener(e,i),r}function m(t,e,i,s){return f(t,e,i,s,!0)}function y(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),d(t))}class x extends p{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(_.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,s=new Array(i);for(let n=0;n<i;++n)s[n]=f(this,t[n],e);return s}return f(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const s=t.length;i=new Array(s);for(let n=0;n<s;++n)i[n]=m(this,t[n],e)}else i=m(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)!function(t){if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)y(t[e]);else y(t)}(i);else if(Array.isArray(t))for(let i=0,s=t.length;i<s;++i)this.removeEventListener(t[i],e);else this.removeEventListener(t,e)}}x.prototype.on,x.prototype.once,x.prototype.un;const v=x;function w(){throw new Error("Unimplemented abstract method.")}let M=0;function E(t){return t.ol_uid||(t.ol_uid=String(++M))}class C extends t{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}const S=class extends v{constructor(t){super(),this.on,this.once,this.un,E(this),this.values_=null,void 0!==t&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,i){let s;s=`change:${t}`,this.hasListener(s)&&this.dispatchEvent(new C(s,t,i)),s=e,this.hasListener(s)&&this.dispatchEvent(new C(s,t,i))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const s=this.values_||(this.values_={});if(i)s[t]=e;else{const i=s[t];s[t]=e,i!==e&&this.notify(t,i)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],g(this.values_)&&(this.values_=null),e||this.notify(t,i)}}},b={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection",69:"`width` or `height` cannot be provided together with `scale`"};class I extends Error{constructor(t){const e=b[t];super(e),this.code=t,this.name="AssertionError",this.message=e}}const L=I,T="add",N="remove",R="length";class P extends t{constructor(t,e,i){super(t),this.element=e,this.index=i}}const O=class extends S{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let t=0,e=this.array_.length;t<e;++t)this.assertUnique_(this.array_[t],t);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,s=e.length;i<s;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(R)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new P(T,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,s=e.length;i<s;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new P(N,e,t)),e}setAt(t,e){if(t>=this.getLength())return void this.insertAt(t,e);if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const i=this.array_[t];this.array_[t]=e,this.dispatchEvent(new P(N,i,t)),this.dispatchEvent(new P(T,e,t))}updateLength_(){this.set(R,this.array_.length)}assertUnique_(t,e){for(let i=0,s=this.array_.length;i<s;++i)if(this.array_[i]===t&&i!==e)throw new L(58)}},A="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",F=A.includes("firefox"),D=(A.includes("safari")&&!A.includes("chrom")&&(A.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(A)),A.includes("webkit")&&!A.includes("edge")),k=A.includes("macintosh"),G="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,z="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,B="undefined"!=typeof Image&&Image.prototype.decode,j=function(){let t=!1;try{const e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(t){}return t}();function q(t,e){if(!t)throw new L(e)}function U(t,e){const i=e[0],s=e[1];return e[0]=t[0]*i+t[2]*s+t[4],e[1]=t[1]*i+t[3]*s+t[5],e}function Y(t,e,i,s,n,r,o,a){const h=Math.sin(r),l=Math.cos(r);return t[0]=s*l,t[1]=n*h,t[2]=-s*h,t[3]=n*l,t[4]=o*s*l-a*s*h+e,t[5]=o*n*h+a*n*l+i,t}function V(t,e){const i=(s=e)[0]*s[3]-s[1]*s[2];var s;q(0!==i,32);const n=e[0],r=e[1],o=e[2],a=e[3],h=e[4],l=e[5];return t[0]=a/i,t[1]=-r/i,t[2]=-o/i,t[3]=n/i,t[4]=(o*l-a*h)/i,t[5]=-(n*l-r*h)/i,t}let X;function W(t){const e="matrix("+t.join(", ")+")";if(z)return e;const i=X||(X=document.createElement("div"));return i.style.transform=e,i.style.transform}new Array(6);const H={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function K(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0,s=t.length;i<s;++i)ct(e,t[i]);return e}function Z(t,e,i){return i?(i[0]=t[0]-e,i[1]=t[1]-e,i[2]=t[2]+e,i[3]=t[3]+e,i):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function J(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function Q(t,e,i){let s,n;return s=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0,n=i<t[1]?t[1]-i:t[3]<i?i-t[3]:0,s*s+n*n}function tt(t,e){return it(t,e[0],e[1])}function et(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function it(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]}function st(t,e){const i=t[0],s=t[1],n=t[2],r=t[3],o=e[0],a=e[1];let h=H.UNKNOWN;return o<i?h|=H.LEFT:o>n&&(h|=H.RIGHT),a<s?h|=H.BELOW:a>r&&(h|=H.ABOVE),h===H.UNKNOWN&&(h=H.INTERSECTING),h}function nt(t,e,i,s,n){return n?(n[0]=t,n[1]=e,n[2]=i,n[3]=s,n):[t,e,i,s]}function rt(t){return nt(1/0,1/0,-1/0,-1/0,t)}function ot(t,e){const i=t[0],s=t[1];return nt(i,s,i,s,e)}function at(t,e,i,s,n){return ut(rt(n),t,e,i,s)}function ht(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function lt(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function ct(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function ut(t,e,i,s,n){for(;i<s;i+=n)dt(t,e[i],e[i+1]);return t}function dt(t,e,i){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],i),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],i)}function gt(t,e){let i;return i=e(pt(t)),i||(i=e(_t(t)),i||(i=e(wt(t)),i||(i=e(vt(t)),i||!1)))}function pt(t){return[t[0],t[1]]}function _t(t){return[t[2],t[1]]}function ft(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function mt(t,e,i,s,n){const[r,o,a,h,l,c,u,d]=function(t,e,i,s){const n=e*s[0]/2,r=e*s[1]/2,o=Math.cos(i),a=Math.sin(i),h=n*o,l=n*a,c=r*o,u=r*a,d=t[0],g=t[1];return[d-h+u,g-l-c,d-h-u,g-l+c,d+h-u,g+l+c,d+h+u,g+l-c,d-h+u,g-l-c]}(t,e,i,s);return nt(Math.min(r,a,l,u),Math.min(o,h,c,d),Math.max(r,a,l,u),Math.max(o,h,c,d),n)}function yt(t){return t[3]-t[1]}function xt(t,e,i){const s=i||[1/0,1/0,-1/0,-1/0];return Et(t,e)?(t[0]>e[0]?s[0]=t[0]:s[0]=e[0],t[1]>e[1]?s[1]=t[1]:s[1]=e[1],t[2]<e[2]?s[2]=t[2]:s[2]=e[2],t[3]<e[3]?s[3]=t[3]:s[3]=e[3]):rt(s),s}function vt(t){return[t[0],t[3]]}function wt(t){return[t[2],t[3]]}function Mt(t){return t[2]-t[0]}function Et(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function Ct(t){return t[2]<t[0]||t[3]<t[1]}function St(t,e){const i=e.getExtent(),s=ft(t);if(e.canWrapX()&&(s[0]<i[0]||s[0]>=i[2])){const e=Mt(i),n=Math.floor((s[0]-i[0])/e)*e;t[0]-=n,t[2]-=n}return t}function bt(t,e,i){return Math.min(Math.max(t,e),i)}function It(t,e,i,s,n,r){const o=n-i,a=r-s;if(0!==o||0!==a){const h=((t-i)*o+(e-s)*a)/(o*o+a*a);h>1?(i=n,s=r):h>0&&(i+=o*h,s+=a*h)}return Lt(t,e,i,s)}function Lt(t,e,i,s){const n=i-t,r=s-e;return n*n+r*r}function Tt(t){return 180*t/Math.PI}function Nt(t){return t*Math.PI/180}function Rt(t,e){const i=t%e;return i*e<0?i+e:i}function Pt(t,e,i){return t+i*(e-t)}function Ot(t,e){const i=Math.pow(10,e);return Math.round(t*i)/i}function At(t,e){return Math.round(Ot(t,e))}function Ft(t,e){return Math.floor(Ot(t,e))}function Dt(t,e){return Math.ceil(Ot(t,e))}const kt=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Gt=/^([a-z]*)$|^hsla?\(.*\)$/i;function zt(t){return"string"==typeof t?t:Ut(t)}const Bt=function(){const t={};let e=0;return function(i){let s;if(t.hasOwnProperty(i))s=t[i];else{if(e>=1024){let i=0;for(const s in t)0==(3&i++)&&(delete t[s],--e)}s=function(t){let e,i,s,n,r;if(Gt.exec(t)&&(t=function(t){const e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}return""}(t)),kt.exec(t)){const o=t.length-1;let a;a=o<=4?1:2;const h=4===o||8===o;e=parseInt(t.substr(1+0*a,a),16),i=parseInt(t.substr(1+1*a,a),16),s=parseInt(t.substr(1+2*a,a),16),n=h?parseInt(t.substr(1+3*a,a),16):255,1==a&&(e=(e<<4)+e,i=(i<<4)+i,s=(s<<4)+s,h&&(n=(n<<4)+n)),r=[e,i,s,n/255]}else t.startsWith("rgba(")?(r=t.slice(5,-1).split(",").map(Number),qt(r)):t.startsWith("rgb(")?(r=t.slice(4,-1).split(",").map(Number),r.push(1),qt(r)):q(!1,14);return r}(i),t[i]=s,++e}return s}}();function jt(t){return Array.isArray(t)?t:Bt(t)}function qt(t){return t[0]=bt(t[0]+.5|0,0,255),t[1]=bt(t[1]+.5|0,0,255),t[2]=bt(t[2]+.5|0,0,255),t[3]=bt(t[3],0,1),t}function Ut(t){let e=t[0];e!=(0|e)&&(e=e+.5|0);let i=t[1];i!=(0|i)&&(i=i+.5|0);let s=t[2];return s!=(0|s)&&(s=s+.5|0),"rgba("+e+","+i+","+s+","+(void 0===t[3]?1:Math.round(100*t[3])/100)+")"}function Yt(t,e,i){return e+":"+t+":"+(i?zt(i):"null")}const Vt=new class{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];0!=(3&t++)||i.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,i){const s=Yt(t,e,i);return s in this.cache_?this.cache_[s]:null}set(t,e,i,s){const n=Yt(t,e,i);this.cache_[n]=s,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}},Xt="opacity",Wt="visible",$t="extent",Ht="zIndex",Kt="maxResolution",Zt="minResolution",Jt="maxZoom",Qt="minZoom",te="source",ee=class extends S{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);"object"==typeof t.properties&&(delete e.properties,Object.assign(e,t.properties)),e[Xt]=void 0!==t.opacity?t.opacity:1,q("number"==typeof e[Xt],64),e[Wt]=void 0===t.visible||t.visible,e[Ht]=t.zIndex,e[Kt]=void 0!==t.maxResolution?t.maxResolution:1/0,e[Zt]=void 0!==t.minResolution?t.minResolution:0,e[Qt]=void 0!==t.minZoom?t.minZoom:-1/0,e[Jt]=void 0!==t.maxZoom?t.maxZoom:1/0,this.className_=void 0!==e.className?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:void 0===t||t},i=this.getZIndex();return e.opacity=bt(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==i||e.managed?i:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return w()}getLayerStatesArray(t){return w()}getExtent(){return this.get($t)}getMaxResolution(){return this.get(Kt)}getMinResolution(){return this.get(Zt)}getMinZoom(){return this.get(Qt)}getMaxZoom(){return this.get(Jt)}getOpacity(){return this.get(Xt)}getSourceState(){return w()}getVisible(){return this.get(Wt)}getZIndex(){return this.get(Ht)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set($t,t)}setMaxResolution(t){this.set(Kt,t)}setMinResolution(t){this.set(Zt,t)}setMaxZoom(t){this.set(Jt,t)}setMinZoom(t){this.set(Qt,t)}setOpacity(t){q("number"==typeof t,64),this.set(Xt,t)}setVisible(t){this.set(Wt,t)}setZIndex(t){this.set(Ht,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},ie="precompose",se="rendercomplete";function ne(t,e){if(!t.visible)return!1;const i=e.resolution;if(i<t.minResolution||i>=t.maxResolution)return!1;const s=e.zoom;return s>t.minZoom&&s<=t.maxZoom}const re=class extends ee{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(te,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return(t=t||[]).push(this),t}getLayerStatesArray(t){return(t=t||[]).push(this.getLayerState()),t}getSource(){return this.get(te)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),this.sourceReady_||"ready"!==this.getSource().getState()||(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(y(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=f(t,_.CHANGE,this.handleSourceChange_,this),"ready"===t.getState()&&(this.sourceReady_=!0,setTimeout((()=>{this.dispatchEvent("sourceready")}),0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}render(t,e){const i=this.getRenderer();if(i.prepareFrame(t))return this.rendered=!0,i.renderFrame(t,e)}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set("map",t)}getMapInternal(){return this.get("map")}setMap(t){this.mapPrecomposeKey_&&(y(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(y(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=f(t,ie,(function(t){const e=t.frameState.layerStatesArray,i=this.getLayerState(!1);q(!e.some((function(t){return t.layer===i.layer})),67),e.push(i)}),this),this.mapRenderKey_=f(this,_.CHANGE,t.render,t),this.changed())}setSource(t){this.set(te,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};function oe(t,e){const i=t[0],s=t[1],n=e[0],r=e[1],o=n[0],a=n[1],h=r[0],l=r[1],c=h-o,u=l-a,d=0===c&&0===u?0:(c*(i-o)+u*(s-a))/(c*c+u*u||0);let g,p;return d<=0?(g=o,p=a):d>=1?(g=h,p=l):(g=o+d*c,p=a+d*u),[g,p]}function ae(t,e){let i=!0;for(let s=t.length-1;s>=0;--s)if(t[s]!=e[s]){i=!1;break}return i}function he(t,e){const i=Math.cos(e),s=Math.sin(e),n=t[0]*i-t[1]*s,r=t[1]*i+t[0]*s;return t[0]=n,t[1]=r,t}function le(t,e){const i=t[0]-e[0],s=t[1]-e[1];return i*i+s*s}function ce(t,e){return Math.sqrt(le(t,e))}function ue(t,e){if(e.canWrapX()){const i=Mt(e.getExtent()),s=de(t,e,i);s&&(t[0]-=s*i)}return t}function de(t,e,i){const s=e.getExtent();let n=0;return e.canWrapX()&&(t[0]<s[0]||t[0]>s[2])&&(i=i||Mt(s),n=Math.floor((t[0]-s[0])/i)),n}function ge(t,e){Vt.expire()}const pe=class extends s{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){w()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,s=t.pixelToCoordinateTransform;Y(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),V(s,i)}forEachFeatureAtCoordinate(t,e,i,s,n,r,o,a){let h;const l=e.viewState;function c(t,e,i,s){return n.call(r,e,t?i:null,s)}const u=l.projection,d=ue(t.slice(),u),g=[[0,0]];if(u.canWrapX()&&s){const t=Mt(u.getExtent());g.push([-t,0],[t,0])}const p=e.layerStatesArray,_=p.length,f=[],m=[];for(let s=0;s<g.length;s++)for(let n=_-1;n>=0;--n){const r=p[n],u=r.layer;if(u.hasRenderer()&&ne(r,l)&&o.call(a,u)){const n=u.getRenderer(),o=u.getSource();if(n&&o){const a=o.getWrapX()?d:t,l=c.bind(null,r.managed);m[0]=a[0]+g[s][0],m[1]=a[1]+g[s][1],h=n.forEachFeatureAtCoordinate(m,e,i,l,f)}if(h)return h}}if(0===f.length)return;const y=1/f.length;return f.forEach(((t,e)=>t.distanceSq+=e*y)),f.sort(((t,e)=>t.distanceSq-e.distanceSq)),f.some((t=>h=t.callback(t.feature,t.layer,t.geometry))),h}hasFeatureAtCoordinate(t,e,i,s,n,r){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,s,l,this,n,r)}getMap(){return this.map_}renderFrame(t){w()}scheduleExpireIconCache(t){Vt.canExpireCache()&&t.postRenderFunctions.push(ge)}},_e=class extends t{constructor(t,e,i,s){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=s}},fe="ol-hidden",me="ol-unselectable",ye="ol-control",xe="ol-collapsed",ve=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),we=["style","variant","weight","size","lineHeight","family"],Me=function(t){const e=t.match(ve);if(!e)return null;const i={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let t=0,s=we.length;t<s;++t){const s=e[t+1];void 0!==s&&(i[we[t]]=s)}return i.families=i.family.split(/,\s?/),i};function Ee(t,e,i,s){let n;return n=i&&i.length?i.shift():z?new OffscreenCanvas(t||300,e||300):document.createElement("canvas"),t&&(n.width=t),e&&(n.height=e),n.getContext("2d",s)}function Ce(t){const e=t.canvas;e.width=1,e.height=1,t.clearRect(0,0,1,1)}function Se(t){let e=t.offsetWidth;const i=getComputedStyle(t);return e+=parseInt(i.marginLeft,10)+parseInt(i.marginRight,10),e}function be(t){let e=t.offsetHeight;const i=getComputedStyle(t);return e+=parseInt(i.marginTop,10)+parseInt(i.marginBottom,10),e}function Ie(t,e){const i=e.parentNode;i&&i.replaceChild(t,e)}function Le(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}function Te(t){for(;t.lastChild;)t.removeChild(t.lastChild)}const Ne="10px sans-serif",Re="#000",Pe="round",Oe=[],Ae="round",Fe="#000",De="center",ke="middle",Ge=[0,0,0,0],ze=new S;let Be,je=null;const qe={},Ue=function(){const t=100,e="32px ",i=["monospace","serif"],s=i.length,n="wmytzilWMYTZIL@#/&?$%10";let r,o;function a(t,r,a){let h=!0;for(let l=0;l<s;++l){const s=i[l];if(o=Xe(t+" "+r+" "+e+s,n),a!=s){const i=Xe(t+" "+r+" "+e+a+","+s,n);h=h&&i!=o}}return!!h}function h(){let e=!0;const i=ze.getKeys();for(let s=0,n=i.length;s<n;++s){const n=i[s];ze.get(n)<t&&(a.apply(this,n.split("\n"))?(d(qe),je=null,Be=void 0,ze.set(n,t)):(ze.set(n,ze.get(n)+1,!0),e=!1))}e&&(clearInterval(r),r=void 0)}return function(e){const i=Me(e);if(!i)return;const s=i.families;for(let e=0,n=s.length;e<n;++e){const n=s[e],o=i.style+"\n"+i.weight+"\n"+n;void 0===ze.get(o)&&(ze.set(o,t,!0),a(i.style,i.weight,n)||(ze.set(o,0,!0),void 0===r&&(r=setInterval(h,32))))}}}(),Ye=function(){let t;return function(e){let i=qe[e];if(null==i){if(z){const t=Me(e),s=Ve(e,"Žg");i=(isNaN(Number(t.lineHeight))?1.2:Number(t.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else t||(t=document.createElement("div"),t.innerHTML="M",t.style.minHeight="0",t.style.maxHeight="none",t.style.height="auto",t.style.padding="0",t.style.border="none",t.style.position="absolute",t.style.display="block",t.style.left="-99999px"),t.style.font=e,document.body.appendChild(t),i=t.offsetHeight,document.body.removeChild(t);qe[e]=i}return i}}();function Ve(t,e){return je||(je=Ee(1,1)),t!=Be&&(je.font=t,Be=je.font),je.measureText(e)}function Xe(t,e){return Ve(t,e).width}function We(t,e,i){if(e in i)return i[e];const s=e.split("\n").reduce(((e,i)=>Math.max(e,Xe(t,i))),0);return i[e]=s,s}const $e=class extends pe{constructor(t){super(t),this.fontChangeListenerKey_=f(ze,e,t.redrawText.bind(t)),this.element_=document.createElement("div");const i=this.element_.style;i.position="absolute",i.width="100%",i.height="100%",i.zIndex="0",this.element_.className=me+" ol-layers";const s=t.getViewport();s.insertBefore(this.element_,s.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const s=new _e(t,void 0,e);i.dispatchEvent(s)}}disposeInternal(){y(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(t),this.dispatchRenderEvent(ie,t);const e=t.layerStatesArray.sort((function(t,e){return t.zIndex-e.zIndex})),i=t.viewState;this.children_.length=0;const s=[];let n=null;for(let r=0,o=e.length;r<o;++r){const o=e[r];t.layerIndex=r;const a=o.layer,h=a.getSourceState();if(!ne(o,i)||"ready"!=h&&"undefined"!=h){a.unrender();continue}const l=a.render(t,n);l&&(l!==n&&(this.children_.push(l),n=l),"getDeclutter"in a&&s.push(a))}for(let e=s.length-1;e>=0;--e)s[e].renderDeclutter(t);!function(t,e){const i=t.childNodes;for(let s=0;;++s){const n=i[s],r=e[s];if(!n&&!r)break;n!==r&&(n?r?t.insertBefore(r,n):(t.removeChild(n),--s):t.appendChild(r))}}(this.element_,this.children_),this.dispatchRenderEvent("postcompose",t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}};class He extends t{constructor(t,e){super(t),this.layer=e}}const Ke="layers";class Ze extends ee{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Ke,this.handleLayersChanged_),i?Array.isArray(i)?i=new O(i.slice(),{unique:!0}):q("function"==typeof i.getArray,43):i=new O(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(y),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(f(t,T,this.handleLayersAdd_,this),f(t,N,this.handleLayersRemove_,this));for(const t in this.listenerKeys_)this.listenerKeys_[t].forEach(y);d(this.listenerKeys_);const e=t.getArray();for(let t=0,i=e.length;t<i;t++){const i=e[t];this.registerLayerListeners_(i),this.dispatchEvent(new He("addlayer",i))}this.changed()}registerLayerListeners_(t){const i=[f(t,e,this.handleLayerChange_,this),f(t,_.CHANGE,this.handleLayerChange_,this)];t instanceof Ze&&i.push(f(t,"addlayer",this.handleLayerGroupAdd_,this),f(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[E(t)]=i}handleLayerGroupAdd_(t){this.dispatchEvent(new He("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new He("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new He("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=E(e);this.listenerKeys_[i].forEach(y),delete this.listenerKeys_[i],this.dispatchEvent(new He("removelayer",e)),this.changed()}getLayers(){return this.get(Ke)}setLayers(t){const e=this.getLayers();if(e){const t=e.getArray();for(let e=0,i=t.length;e<i;++e)this.dispatchEvent(new He("removelayer",t[e]))}this.set(Ke,t)}getLayersArray(t){return t=void 0!==t?t:[],this.getLayers().forEach((function(e){e.getLayersArray(t)})),t}getLayerStatesArray(t){const e=void 0!==t?t:[],i=e.length;this.getLayers().forEach((function(t){t.getLayerStatesArray(e)}));const s=this.getLayerState();let n=s.zIndex;t||void 0!==s.zIndex||(n=0);for(let t=i,r=e.length;t<r;t++){const i=e[t];i.opacity*=s.opacity,i.visible=i.visible&&s.visible,i.maxResolution=Math.min(i.maxResolution,s.maxResolution),i.minResolution=Math.max(i.minResolution,s.minResolution),i.minZoom=Math.max(i.minZoom,s.minZoom),i.maxZoom=Math.min(i.maxZoom,s.maxZoom),void 0!==s.extent&&(void 0!==i.extent?i.extent=xt(i.extent,s.extent):i.extent=s.extent),void 0===i.zIndex&&(i.zIndex=n)}return e}getSourceState(){return"ready"}}const Je=Ze,Qe=class extends t{constructor(t,e,i){super(t),this.map=e,this.frameState=void 0!==i?i:null}},ti=class extends Qe{constructor(t,e,i,s,n,r){super(t,e,n),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==s&&s,this.activePointers=r}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},ei={SINGLECLICK:"singleclick",CLICK:_.CLICK,DBLCLICK:_.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},ii="pointerdown",si=class extends p{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===e?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=f(i,ii,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=f(i,"pointermove",this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(_.TOUCHMOVE,this.boundHandleTouchMove_,!!j&&{passive:!1})}emulateClick_(t){let e=new ti(ei.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new ti(ei.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout((()=>{this.clickTimeoutId_=void 0;const e=new ti(ei.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}),250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==ei.POINTERUP||e.type==ei.POINTERCANCEL){delete this.trackedTouches_[i];for(const t in this.trackedTouches_)if(this.trackedTouches_[t].target!==e.target){delete this.trackedTouches_[t];break}}else e.type!=ei.POINTERDOWN&&e.type!=ei.POINTERMOVE||(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new ti(ei.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(y),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return 0===t.button}handlePointerDown_(t){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(t);const e=new ti(ei.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.down_={};for(const e in t){const i=t[e];this.down_[e]="function"==typeof i?u:i}if(0===this.dragListenerKeys_.length){const t=this.map_.getOwnerDocument();this.dragListenerKeys_.push(f(t,ei.POINTERMOVE,this.handlePointerMove_,this),f(t,ei.POINTERUP,this.handlePointerUp_,this),f(this.element_,ei.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==t&&this.dragListenerKeys_.push(f(this.element_.getRootNode(),ei.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new ti(ei.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new ti(ei.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;e&&!e.defaultPrevented||"boolean"==typeof t.cancelable&&!0!==t.cancelable||t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(y(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(_.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(y(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(y),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},ni="postrender",ri="loadstart",oi="loadend",ai="layergroup",hi="size",li="target",ci="view",ui=1/0,di=class{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,d(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const s=this.keyFunction_(i);return delete this.queuedElements_[s],i}enqueue(t){q(!(this.keyFunction_(t)in this.queuedElements_),31);const e=this.priorityFunction_(t);return e!=ui&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(t){return 2*t+1}getRightChildIndex_(t){return 2*t+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return 0===this.elements_.length}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,s=e.length,n=e[t],r=i[t],o=t;for(;t<s>>1;){const n=this.getLeftChildIndex_(t),r=this.getRightChildIndex_(t),o=r<s&&i[r]<i[n]?r:n;e[t]=e[o],i[t]=i[o],t=o}e[t]=n,i[t]=r,this.siftDown_(o,t)}siftDown_(t,e){const i=this.elements_,s=this.priorities_,n=i[e],r=s[e];for(;e>t;){const t=this.getParentIndex_(e);if(!(s[t]>r))break;i[e]=i[t],s[e]=s[t],e=t}i[e]=n,s[e]=r}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let s=0;const n=e.length;let r,o,a;for(o=0;o<n;++o)r=e[o],a=t(r),a==ui?delete this.queuedElements_[this.keyFunction_(r)]:(i[s]=a,e[s++]=r);e.length=s,i.length=s,this.heapify_()}},gi=class extends di{constructor(t,e){super((function(e){return t.apply(null,e)}),(function(t){return t[0].getKey()})),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(_.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(2===i||3===i||4===i){3!==i&&e.removeEventListener(_.CHANGE,this.boundHandleTileChange_);const t=e.getKey();t in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[t],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i,s,n,r=0;for(;this.tilesLoading_<t&&r<e&&this.getCount()>0;)s=this.dequeue()[0],n=s.getKey(),i=s.getState(),0!==i||n in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[n]=!0,++this.tilesLoading_,++r,s.load())}},pi={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},_i={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937},fi=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||_i[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},mi=6378137,yi=Math.PI*mi,xi=[-yi,-yi,yi,yi],vi=[-180,-85,180,85],wi=mi*Math.log(Math.tan(Math.PI/2));class Mi extends fi{constructor(t){super({code:t,units:"m",extent:xi,global:!0,worldExtent:vi,getPointResolution:function(t,e){return t/Math.cosh(e[1]/mi)}})}}const Ei=[new Mi("EPSG:3857"),new Mi("EPSG:102100"),new Mi("EPSG:102113"),new Mi("EPSG:900913"),new Mi("http://www.opengis.net/def/crs/EPSG/0/3857"),new Mi("http://www.opengis.net/gml/srs/epsg.xml#3857")];const Ci=[-180,-90,180,90],Si=6378137*Math.PI/180;class bi extends fi{constructor(t,e){super({code:t,units:"degrees",extent:Ci,axisOrientation:e,global:!0,metersPerUnit:Si,worldExtent:Ci})}}const Ii=[new bi("CRS:84"),new bi("EPSG:4326","neu"),new bi("urn:ogc:def:crs:OGC:1.3:CRS84"),new bi("urn:ogc:def:crs:OGC:2:84"),new bi("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new bi("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new bi("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Li={},Ti={};function Ni(t,e,i){const s=t.getCode(),n=e.getCode();s in Ti||(Ti[s]={}),Ti[s][n]=i}function Ri(t,e){let i;return t in Ti&&e in Ti[t]&&(i=Ti[t][e]),i}const Pi=6371008.8;function Oi(t,e,i){i=i||Pi;const s=Nt(t[1]),n=Nt(e[1]),r=(n-s)/2,o=Nt(e[0]-t[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(s)*Math.cos(n);return 2*i*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function Ai(t,e,i,s){s=s||Pi;const n=Nt(t[1]),r=Nt(t[0]),o=e/s,a=Math.asin(Math.sin(n)*Math.cos(o)+Math.cos(n)*Math.sin(o)*Math.cos(i));return[Tt(r+Math.atan2(Math.sin(i)*Math.sin(o)*Math.cos(n),Math.cos(o)-Math.sin(n)*Math.sin(a))),Tt(a)]}const Fi={info:1,warn:2,error:3,none:4};let Di=Fi.info;function ki(...t){Di>Fi.warn||console.warn(...t)}let Gi=!0;function zi(t,e){if(void 0!==e)for(let i=0,s=t.length;i<s;++i)e[i]=t[i];else e=t.slice();return e}function Bi(t,e){if(void 0!==e&&t!==e){for(let i=0,s=t.length;i<s;++i)e[i]=t[i];t=e}return t}function ji(t){!function(t,e){Li[t]=e}(t.getCode(),t),Ni(t,t,zi)}function qi(t){return"string"==typeof t?Li[e=t]||Li[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function Ui(t,e,i,s){let n;const r=(t=qi(t)).getPointResolutionFunc();if(r){if(n=r(e,i),s&&s!==t.getUnits()){const e=t.getMetersPerUnit();e&&(n=n*e/_i[s])}}else{const r=t.getUnits();if("degrees"==r&&!s||"degrees"==s)n=e;else{const o=Hi(t,qi("EPSG:4326"));if(o===Bi&&"degrees"!==r)n=e*t.getMetersPerUnit();else{let t=[i[0]-e/2,i[1],i[0]+e/2,i[1],i[0],i[1]-e/2,i[0],i[1]+e/2];t=o(t,t,2),n=(Oi(t.slice(0,2),t.slice(2,4))+Oi(t.slice(4,6),t.slice(6,8)))/2}const a=s?_i[s]:t.getMetersPerUnit();void 0!==a&&(n/=a)}}return n}function Yi(t){!function(t){t.forEach(ji)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&Ni(e,t,zi)}))}))}function Vi(t,e){return t?"string"==typeof t?qi(t):t:qi(e)}function Xi(t){return function(e,i,s){const n=e.length;s=void 0!==s?s:2,i=void 0!==i?i:new Array(n);for(let r=0;r<n;r+=s){const n=t(e.slice(r,r+s)),o=n.length;for(let t=0,a=s;t<a;++t)i[r+t]=t>=o?e[r+t]:n[t]}return i}}function Wi(t,e,i,s){const n=qi(t),r=qi(e);Ni(n,r,Xi(i)),Ni(r,n,Xi(s))}function $i(t,e){if(t===e)return!0;const i=t.getUnits()===e.getUnits();return(t.getCode()===e.getCode()||Hi(t,e)===zi)&&i}function Hi(t,e){let i=Ri(t.getCode(),e.getCode());return i||(i=Bi),i}function Ki(t,e){return Hi(qi(t),qi(e))}function Zi(t,e,i){return Ki(e,i)(t,void 0,t.length)}function Ji(t,e,i,s){return function(t,e,i,s){let n=[];if(s>1){const e=t[2]-t[0],i=t[3]-t[1];for(let r=0;r<s;++r)n.push(t[0]+e*r/s,t[1],t[2],t[1]+i*r/s,t[2]-e*r/s,t[3],t[0],t[3]-i*r/s)}else n=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(n,n,2);const r=[],o=[];for(let t=0,e=n.length;t<e;t+=2)r.push(n[t]),o.push(n[t+1]);return function(t,e,i){return nt(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),i)}(r,o,i)}(t,Ki(e,i),void 0,s)}let Qi=null;function ts(){return Qi}function es(t,e){return Qi?Zi(t,e,Qi):t}function is(t,e){return Qi?Zi(t,Qi,e):(Gi&&!ae(t,[0,0])&&t[0]>=-180&&t[0]<=180&&t[1]>=-90&&t[1]<=90&&(Gi=!1,ki("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),t)}function ss(t,e){return Qi?Ji(t,e,Qi):t}function ns(t,e){return Qi?Ji(t,Qi,e):t}function rs(t,e){if(!Qi)return t;const i=qi(e).getUnits(),s=Qi.getUnits();return i&&s?t*_i[i]/_i[s]:t}function os(t,e,i){return function(s){let n,r;if(t.canWrapX()){const e=t.getExtent(),o=Mt(e);r=de(s=s.slice(0),t,o),r&&(s[0]=s[0]-r*o),s[0]=bt(s[0],e[0],e[2]),s[1]=bt(s[1],e[1],e[3]),n=i(s)}else n=i(s);return r&&e.canWrapX()&&(n[0]+=r*Mt(e.getExtent())),n}}var as,hs,ls;function cs(t,e,i){return function(s,n,r,o,a){if(!s)return;if(!n&&!e)return s;const h=e?0:r[0]*n,l=e?0:r[1]*n,c=a?a[0]:0,u=a?a[1]:0;let d=t[0]+h/2+c,g=t[2]-h/2+c,p=t[1]+l/2+u,_=t[3]-l/2+u;d>g&&(d=(g+d)/2,g=d),p>_&&(p=(_+p)/2,_=p);let f=bt(s[0],d,g),m=bt(s[1],p,_);if(o&&i&&n){const t=30*n;f+=-t*Math.log(1+Math.max(0,d-s[0])/t)+t*Math.log(1+Math.max(0,s[0]-g)/t),m+=-t*Math.log(1+Math.max(0,p-s[1])/t)+t*Math.log(1+Math.max(0,s[1]-_)/t)}return[f,m]}}function us(t){return t}function ds(t,e,i,s){const n=Mt(e)/i[0],r=yt(e)/i[1];return s?Math.min(t,Math.max(n,r)):Math.min(t,Math.min(n,r))}function gs(t,e,i){let s=Math.min(t,e);return s*=Math.log(1+50*Math.max(0,t/e-1))/50+1,i&&(s=Math.max(s,i),s/=Math.log(1+50*Math.max(0,i/t-1))/50+1),bt(s,i/2,2*e)}function ps(t,e,i,s,n){return i=void 0===i||i,function(r,o,a,h){if(void 0!==r){const o=s?ds(t,s,a,n):t;return i&&h?gs(r,o,e):bt(r,e,o)}}}function _s(t){if(void 0!==t)return 0}function fs(t){if(void 0!==t)return t}function ms(t){return 1-function(t){return Math.pow(t,3)}(1-t)}function ys(t){return 3*t*t-2*t*t*t}function xs(t){return t}function vs(t,e,i,s,n,r){r=r||[];let o=0;for(let a=e;a<i;a+=s){const e=t[a],i=t[a+1];r[o++]=n[0]*e+n[2]*i+n[4],r[o++]=n[1]*e+n[3]*i+n[5]}return r&&r.length!=o&&(r.length=o),r}function ws(t,e,i,s,n,r,o){o=o||[];const a=Math.cos(n),h=Math.sin(n),l=r[0],c=r[1];let u=0;for(let n=e;n<i;n+=s){const e=t[n]-l,i=t[n+1]-c;o[u++]=l+e*a-i*h,o[u++]=c+e*h+i*a;for(let e=n+2;e<n+s;++e)o[u++]=t[e]}return o&&o.length!=u&&(o.length=u),o}function Ms(t,e,i,s,n,r,o){o=o||[];let a=0;for(let h=e;h<i;h+=s){o[a++]=t[h]+n,o[a++]=t[h+1]+r;for(let e=h+2;e<h+s;++e)o[a++]=t[e]}return o&&o.length!=a&&(o.length=a),o}Yi(Ei),Yi(Ii),as=Ei,hs=function(t,e,i){const s=t.length;i=i>1?i:2,void 0===e&&(e=i>2?t.slice():new Array(s));for(let n=0;n<s;n+=i){e[n]=yi*t[n]/180;let i=mi*Math.log(Math.tan(Math.PI*(+t[n+1]+90)/360));i>wi?i=wi:i<-wi&&(i=-wi),e[n+1]=i}return e},ls=function(t,e,i){const s=t.length;i=i>1?i:2,void 0===e&&(e=i>2?t.slice():new Array(s));for(let n=0;n<s;n+=i)e[n]=180*t[n]/yi,e[n+1]=360*Math.atan(Math.exp(t[n+1]/mi))/Math.PI-90;return e},Ii.forEach((function(t){as.forEach((function(e){Ni(t,e,hs),Ni(e,t,ls)}))}));const Es=[1,0,0,1,0,0],Cs=class extends S{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=function(t){let e,i,s,n=!1;return function(){const r=Array.prototype.slice.call(arguments);return n&&this===s&&h(r,i)||(n=!0,s=this,i=r,e=t.apply(this,arguments)),e}}((function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(i),s.getSimplifiedGeometry(e)}))}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return w()}closestPointXY(t,e,i,s){return w()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return w()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&rt(t),this.extentRevision_=this.getRevision()}return function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)}rotate(t,e){w()}scale(t,e,i){w()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return w()}getType(){return w()}applyTransform(t){w()}intersectsExtent(t){return w()}translate(t,e){w()}transform(t,e){const i=qi(t),s="tile-pixels"==i.getUnits()?function(t,s,n){const r=i.getExtent(),o=i.getWorldExtent(),a=yt(o)/yt(r);return Y(Es,o[0],o[3],a,-a,0,0,0),vs(t,0,t.length,n,Es,s),Ki(i,e)(t,s,n)}:Ki(i,e);return this.applyTransform(s),this}};function Ss(t){let e;return"XY"==t?e=2:"XYZ"==t||"XYM"==t?e=3:"XYZM"==t&&(e=4),e}const bs=class extends Cs{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return at(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return w()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Ss(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){w()}setLayout(t,e,i){let s;if(t)s=Ss(t);else{for(let t=0;t<i;++t){if(0===e.length)return this.layout="XY",void(this.stride=2);e=e[0]}s=e.length,t=function(t){let e;return 2==t?e="XY":3==t?e="XYZ":4==t&&(e="XYZM"),e}(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const s=this.getStride();ws(i,0,i.length,s,t,e,i),this.changed()}}scale(t,e,i){void 0===e&&(e=t),i||(i=ft(this.getExtent()));const s=this.getFlatCoordinates();if(s){const n=this.getStride();!function(t,e,i,s,n,r,o,a){a=a||[];const h=o[0],l=o[1];let c=0;for(let e=0;e<i;e+=s){const i=t[e]-h,o=t[e+1]-l;a[c++]=h+n*i,a[c++]=l+r*o;for(let i=e+2;i<e+s;++i)a[c++]=t[i]}a&&a.length!=c&&(a.length=c)}(s,0,s.length,n,t,e,i,s),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const s=this.getStride();Ms(i,0,i.length,s,t,e,i),this.changed()}}};function Is(t,e,i,s,n,r,o){const a=t[e],h=t[e+1],l=t[i]-a,c=t[i+1]-h;let u;if(0===l&&0===c)u=e;else{const d=((n-a)*l+(r-h)*c)/(l*l+c*c);if(d>1)u=i;else{if(d>0){for(let n=0;n<s;++n)o[n]=Pt(t[e+n],t[i+n],d);return void(o.length=s)}u=e}}for(let e=0;e<s;++e)o[e]=t[u+e];o.length=s}function Ls(t,e,i,s,n){let r=t[e],o=t[e+1];for(e+=s;e<i;e+=s){const i=t[e],s=t[e+1],a=Lt(r,o,i,s);a>n&&(n=a),r=i,o=s}return n}function Ts(t,e,i,s,n){for(let r=0,o=i.length;r<o;++r){const o=i[r];n=Ls(t,e,o,s,n),e=o}return n}function Ns(t,e,i,s,n,r,o,a,h,l,c){if(e==i)return l;let u,d;if(0===n){if(d=Lt(o,a,t[e],t[e+1]),d<l){for(u=0;u<s;++u)h[u]=t[e+u];return h.length=s,d}return l}c=c||[NaN,NaN];let g=e+s;for(;g<i;)if(Is(t,g-s,g,s,o,a,c),d=Lt(o,a,c[0],c[1]),d<l){for(l=d,u=0;u<s;++u)h[u]=c[u];h.length=s,g+=s}else g+=s*Math.max((Math.sqrt(d)-Math.sqrt(l))/n|0,1);if(r&&(Is(t,i-s,e,s,o,a,c),d=Lt(o,a,c[0],c[1]),d<l)){for(l=d,u=0;u<s;++u)h[u]=c[u];h.length=s}return l}function Rs(t,e,i,s,n,r,o,a,h,l,c){c=c||[NaN,NaN];for(let u=0,d=i.length;u<d;++u){const d=i[u];l=Ns(t,e,d,s,n,r,o,a,h,l,c),e=d}return l}function Ps(t,e,i,s){for(let s=0,n=i.length;s<n;++s)t[e++]=i[s];return e}function Os(t,e,i,s){for(let n=0,r=i.length;n<r;++n){const r=i[n];for(let i=0;i<s;++i)t[e++]=r[i]}return e}function As(t,e,i,s,n){n=n||[];let r=0;for(let o=0,a=i.length;o<a;++o){const a=Os(t,e,i[o],s);n[r++]=a,e=a}return n.length=r,n}function Fs(t,e,i,s,n,r,o){const a=(i-e)/s;if(a<3){for(;e<i;e+=s)r[o++]=t[e],r[o++]=t[e+1];return o}const h=new Array(a);h[0]=1,h[a-1]=1;const l=[e,i-s];let c=0;for(;l.length>0;){const i=l.pop(),r=l.pop();let o=0;const a=t[r],u=t[r+1],d=t[i],g=t[i+1];for(let e=r+s;e<i;e+=s){const i=It(t[e],t[e+1],a,u,d,g);i>o&&(c=e,o=i)}o>n&&(h[(c-e)/s]=1,r+s<c&&l.push(r,c),c+s<i&&l.push(c,i))}for(let i=0;i<a;++i)h[i]&&(r[o++]=t[e+i*s],r[o++]=t[e+i*s+1]);return o}function Ds(t,e){return e*Math.round(t/e)}function ks(t,e,i,s,n,r,o){if(e==i)return o;let a,h,l=Ds(t[e],n),c=Ds(t[e+1],n);e+=s,r[o++]=l,r[o++]=c;do{if(a=Ds(t[e],n),h=Ds(t[e+1],n),(e+=s)==i)return r[o++]=a,r[o++]=h,o}while(a==l&&h==c);for(;e<i;){const i=Ds(t[e],n),u=Ds(t[e+1],n);if(e+=s,i==a&&u==h)continue;const d=a-l,g=h-c,p=i-l,_=u-c;d*_==g*p&&(d<0&&p<d||d==p||d>0&&p>d)&&(g<0&&_<g||g==_||g>0&&_>g)?(a=i,h=u):(r[o++]=a,r[o++]=h,l=a,c=h,a=i,h=u)}return r[o++]=a,r[o++]=h,o}function Gs(t,e,i,s,n,r,o,a){for(let h=0,l=i.length;h<l;++h){const l=i[h];o=ks(t,e,l,s,n,r,o),a.push(o),e=l}return o}function zs(t,e,i,s,n){n=void 0!==n?n:[];let r=0;for(let o=e;o<i;o+=s)n[r++]=t.slice(o,o+s);return n.length=r,n}function Bs(t,e,i,s,n){n=void 0!==n?n:[];let r=0;for(let o=0,a=i.length;o<a;++o){const a=i[o];n[r++]=zs(t,e,a,s,n[r]),e=a}return n.length=r,n}function js(t,e,i,s,n){n=void 0!==n?n:[];let r=0;for(let o=0,a=i.length;o<a;++o){const a=i[o];n[r++]=1===a.length&&a[0]===e?[]:Bs(t,e,a,s,n[r]),e=a[a.length-1]}return n.length=r,n}function qs(t,e,i,s){let n=0,r=t[i-s],o=t[i-s+1];for(;e<i;e+=s){const i=t[e],s=t[e+1];n+=o*i-r*s,r=i,o=s}return n/2}function Us(t,e,i,s){let n=0;for(let r=0,o=i.length;r<o;++r){const o=i[r];n+=qs(t,e,o,s),e=o}return n}class Ys extends bs{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}clone(){return new Ys(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,s){return s<Q(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ls(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ns(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,s))}getArea(){return qs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return zs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Fs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Ys(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Os(this.flatCoordinates,0,t,this.stride),this.changed()}}const Vs=Ys;class Xs extends bs{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Xs(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){const n=this.flatCoordinates,r=Lt(t,e,n[0],n[1]);if(r<s){const t=this.stride;for(let e=0;e<t;++e)i[e]=n[e];return i.length=t,r}return s}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return ot(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return it(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ps(this.flatCoordinates,0,t,this.stride),this.changed()}}const Ws=Xs;function $s(t,e,i,s,n){return!gt(n,(function(n){return!Hs(t,e,i,s,n[0],n[1])}))}function Hs(t,e,i,s,n,r){let o=0,a=t[i-s],h=t[i-s+1];for(;e<i;e+=s){const i=t[e],s=t[e+1];h<=r?s>r&&(i-a)*(r-h)-(n-a)*(s-h)>0&&o++:s<=r&&(i-a)*(r-h)-(n-a)*(s-h)<0&&o--,a=i,h=s}return 0!==o}function Ks(t,e,i,s,n,r){if(0===i.length)return!1;if(!Hs(t,e,i[0],s,n,r))return!1;for(let e=1,o=i.length;e<o;++e)if(Hs(t,i[e-1],i[e],s,n,r))return!1;return!0}function Zs(t,e,i,s,r,o,a){let h,l,c,u,d,g,p;const _=r[o+1],f=[];for(let n=0,r=i.length;n<r;++n){const r=i[n];for(u=t[r-s],g=t[r-s+1],h=e;h<r;h+=s)d=t[h],p=t[h+1],(_<=g&&p<=_||g<=_&&_<=p)&&(c=(_-g)/(p-g)*(d-u)+u,f.push(c)),u=d,g=p}let m=NaN,y=-1/0;for(f.sort(n),u=f[0],h=1,l=f.length;h<l;++h){d=f[h];const n=Math.abs(d-u);n>y&&(c=(u+d)/2,Ks(t,e,i,s,c,_)&&(m=c,y=n)),u=d}return isNaN(m)&&(m=r[o]),a?(a.push(m,_,y),a):[m,_,y]}function Js(t,e,i,s,n){let r;for(e+=s;e<i;e+=s)if(r=n(t.slice(e-s,e),t.slice(e,e+s)),r)return r;return!1}function Qs(t,e,i,s,n){const r=ut([1/0,1/0,-1/0,-1/0],t,e,i,s);return!!Et(n,r)&&(!!et(n,r)||r[0]>=n[0]&&r[2]<=n[2]||r[1]>=n[1]&&r[3]<=n[3]||Js(t,e,i,s,(function(t,e){return function(t,e,i){let s=!1;const n=st(t,e),r=st(t,i);if(n===H.INTERSECTING||r===H.INTERSECTING)s=!0;else{const o=t[0],a=t[1],h=t[2],l=t[3],c=e[0],u=e[1],d=i[0],g=i[1],p=(g-u)/(d-c);let _,f;r&H.ABOVE&&!(n&H.ABOVE)&&(_=d-(g-l)/p,s=_>=o&&_<=h),s||!(r&H.RIGHT)||n&H.RIGHT||(f=g-(d-h)*p,s=f>=a&&f<=l),s||!(r&H.BELOW)||n&H.BELOW||(_=d-(g-a)/p,s=_>=o&&_<=h),s||!(r&H.LEFT)||n&H.LEFT||(f=g-(d-o)*p,s=f>=a&&f<=l)}return s}(n,t,e)})))}function tn(t,e,i,s,n){if(!function(t,e,i,s,n){return!!(Qs(t,e,i,s,n)||Hs(t,e,i,s,n[0],n[1])||Hs(t,e,i,s,n[0],n[3])||Hs(t,e,i,s,n[2],n[1])||Hs(t,e,i,s,n[2],n[3]))}(t,e,i[0],s,n))return!1;if(1===i.length)return!0;for(let e=1,r=i.length;e<r;++e)if($s(t,i[e-1],i[e],s,n)&&!Qs(t,i[e-1],i[e],s,n))return!1;return!0}function en(t,e,i,s){for(;e<i-s;){for(let n=0;n<s;++n){const r=t[e+n];t[e+n]=t[i-s+n],t[i-s+n]=r}e+=s,i-=s}}function sn(t,e,i,s){let n=0,r=t[i-s],o=t[i-s+1];for(;e<i;e+=s){const i=t[e],s=t[e+1];n+=(i-r)*(s+o),r=i,o=s}return 0===n?void 0:n>0}function nn(t,e,i,s,n){n=void 0!==n&&n;for(let r=0,o=i.length;r<o;++r){const o=i[r],a=sn(t,e,o,s);if(0===r){if(n&&a||!n&&!a)return!1}else if(n&&!a||!n&&a)return!1;e=o}return!0}function rn(t,e,i,s,n){n=void 0!==n&&n;for(let r=0,o=i.length;r<o;++r){const o=i[r],a=sn(t,e,o,s);(0===r?n&&a||!n&&!a:n&&!a||!n&&a)&&en(t,e,o,s),e=o}return e}function on(t,e,i,s,n){for(let r=0,o=i.length;r<o;++r)e=rn(t,e,i[r],s,n);return e}class an extends bs{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==e&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?a(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new an(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<Q(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ts(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Rs(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return Ks(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Us(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),rn(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Bs(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=ft(this.getExtent());this.flatInteriorPoint_=Zs(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ws(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Vs(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,s=[];let n=0;for(let r=0,o=i.length;r<o;++r){const o=i[r],a=new Vs(e.slice(n,o),t);s.push(a),n=o}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;nn(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=rn(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Gs(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new an(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return tn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=As(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const hn=an;function ln(t){const e=t[0],i=t[1],s=t[2],n=t[3],r=[e,i,e,n,s,n,s,i,e,i];return new an(r,"XY",[r.length])}function cn(t,e,i){e=e||32;const s=t.getStride(),n=t.getLayout(),r=t.getCenter(),o=s*(e+1),a=new Array(o);for(let t=0;t<o;t+=s){a[t]=0,a[t+1]=0;for(let e=2;e<s;e++)a[t+e]=r[e]}const h=[a.length],l=new an(a,n,h);return function(t,e,i,s){const n=t.getFlatCoordinates(),r=t.getStride(),o=n.length/r-1,a=s||0;for(let t=0;t<=o;++t){const s=t*r,h=a+2*Rt(t,o)*Math.PI/o;n[s]=e[0]+i*Math.cos(h),n[s+1]=e[1]+i*Math.sin(h)}t.changed()}(l,r,t.getRadius(),i),l}function un(t,e){setTimeout((function(){t(e)}),0)}function dn(t){return!(t.sourceCenter&&t.targetCenter&&!ae(t.sourceCenter,t.targetCenter))&&t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation}function gn(t,e,i,s,n){const r=Math.cos(-n);let o=Math.sin(-n),a=t[0]*r-t[1]*o,h=t[1]*r+t[0]*o;return a+=(e[0]/2-i[0])*s,h+=(i[1]-e[1]/2)*s,o=-o,[a*r-h*o,h*r+a*o]}const pn=class extends S{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Vi(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&function(t){Gi=!(void 0===t||t)}(),t.center&&(t.center=is(t.center,this.projection_)),t.extent&&(t.extent=ns(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const t in pi)delete e[t];this.setProperties(e,!0);const i=function(t){let e,i,s;let n=void 0!==t.minZoom?t.minZoom:0,o=void 0!==t.maxZoom?t.maxZoom:28;const a=void 0!==t.zoomFactor?t.zoomFactor:2,h=void 0!==t.multiWorld&&t.multiWorld,l=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,c=void 0!==t.showFullExtent&&t.showFullExtent,u=Vi(t.projection,"EPSG:3857"),d=u.getExtent();let g=t.constrainOnlyCenter,p=t.extent;if(h||p||!u.isGlobal()||(g=!1,p=d),void 0!==t.resolutions){const a=t.resolutions;i=a[n],s=void 0!==a[o]?a[o]:a[a.length-1],e=t.constrainResolution?function(t,e,i,s){return e=void 0===e||e,function(n,o,a,h){if(void 0!==n){const l=t[0],c=t[t.length-1],u=i?ds(l,i,a,s):l;if(h)return e?gs(n,u,c):bt(n,c,u);const d=Math.min(u,n),g=Math.floor(r(t,d,o));return t[g]>u&&g<t.length-1?t[g+1]:t[g]}}}(a,l,!g&&p,c):ps(i,s,l,!g&&p,c)}else{const r=(d?Math.max(Mt(d),yt(d)):360*_i.degrees/u.getMetersPerUnit())/256/Math.pow(2,0),h=r/Math.pow(2,28);i=t.maxResolution,void 0!==i?n=0:i=r/Math.pow(a,n),s=t.minResolution,void 0===s&&(s=void 0!==t.maxZoom?void 0!==t.maxResolution?i/Math.pow(a,o):r/Math.pow(a,o):h),o=n+Math.floor(Math.log(i/s)/Math.log(a)),s=i/Math.pow(a,o-n),e=t.constrainResolution?function(t,e,i,s,n,r){return s=void 0===s||s,i=void 0!==i?i:0,function(o,a,h,l){if(void 0!==o){const c=n?ds(e,n,h,r):e;if(l)return s?gs(o,c,i):bt(o,i,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(t)-u),g=-a*(.5-u)+.5,p=Math.min(c,o),_=Math.floor(Math.log(e/p)/Math.log(t)+g),f=Math.max(d,_);return bt(e/Math.pow(t,f),i,c)}}}(a,i,s,l,!g&&p,c):ps(i,s,l,!g&&p,c)}return{constraint:e,maxResolution:i,minResolution:s,minZoom:n,zoomFactor:a}}(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const s=function(t){if(void 0!==t.extent){const e=void 0===t.smoothExtentConstraint||t.smoothExtentConstraint;return cs(t.extent,t.constrainOnlyCenter,e)}const e=Vi(t.projection,"EPSG:3857");if(!0!==t.multiWorld&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,cs(t,!1,!1)}return us}(t),n=i.constraint,o=function(t){if(void 0===t.enableRotation||t.enableRotation){const i=t.constrainRotation;return void 0===i||!0===i?(e=e||Nt(5),function(t,i){return i?t:void 0!==t?Math.abs(t)<=e?0:t:void 0}):!1===i?fs:"number"==typeof i?function(t){const e=2*Math.PI/t;return function(t,i){return i?t:void 0!==t?t=Math.floor(t/e+.5)*e:void 0}}(i):fs}var e;return _s}(t);this.constraints_={center:s,resolution:n,rotation:o},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenter();if(i){const s=t||[0,0,0,0];e=e||[0,0,0,0];const n=this.getResolution(),r=n/2*(s[3]-e[3]+e[1]-s[1]),o=n/2*(s[0]-e[0]+e[2]-s[2]);this.setCenterInternal([i[0]+r,i[1]-o])}}getUpdatedOptions_(t){const e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let t=0;t<e.length;++t){let i=arguments[t];i.center&&(i=Object.assign({},i),i.center=is(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=is(i.anchor,this.getProjection())),e[t]=i}this.animateInternal.apply(this,e)}animateInternal(t){let e,i=arguments.length;i>1&&"function"==typeof arguments[i-1]&&(e=arguments[i-1],--i);let s=0;for(;s<i&&!this.isDef();++s){const t=arguments[s];t.center&&this.setCenterInternal(t.center),void 0!==t.zoom?this.setZoom(t.zoom):t.resolution&&this.setResolution(t.resolution),void 0!==t.rotation&&this.setRotation(t.rotation)}if(s===i)return void(e&&un(e,!0));let n=Date.now(),r=this.targetCenter_.slice(),o=this.targetResolution_,a=this.targetRotation_;const h=[];for(;s<i;++s){const t=arguments[s],i={start:n,complete:!1,anchor:t.anchor,duration:void 0!==t.duration?t.duration:1e3,easing:t.easing||ys,callback:e};if(t.center&&(i.sourceCenter=r,i.targetCenter=t.center.slice(),r=i.targetCenter),void 0!==t.zoom?(i.sourceResolution=o,i.targetResolution=this.getResolutionForZoom(t.zoom),o=i.targetResolution):t.resolution&&(i.sourceResolution=o,i.targetResolution=t.resolution,o=i.targetResolution),void 0!==t.rotation){i.sourceRotation=a;const e=Rt(t.rotation-a+Math.PI,2*Math.PI)-Math.PI;i.targetRotation=a+e,a=i.targetRotation}dn(i)?i.complete=!0:n+=i.duration,h.push(i)}this.animations_.push(h),this.setHint(0,1),this.updateAnimations_()}getAnimating(){return this.hints_[0]>0}getInteracting(){return this.hints_[1]>0}cancelAnimations(){let t;this.setHint(0,-this.hints_[0]);for(let e=0,i=this.animations_.length;e<i;++e){const i=this.animations_[e];if(i[0].callback&&un(i[0].callback,!1),!t)for(let e=0,s=i.length;e<s;++e){const s=i[e];if(!s.complete){t=s.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const s=this.animations_[i];let n=!0;for(let i=0,r=s.length;i<r;++i){const r=s[i];if(r.complete)continue;const o=t-r.start;let a=r.duration>0?o/r.duration:1;a>=1?(r.complete=!0,a=1):n=!1;const h=r.easing(a);if(r.sourceCenter){const t=r.sourceCenter[0],e=r.sourceCenter[1],i=r.targetCenter[0],s=r.targetCenter[1];this.nextCenter_=r.targetCenter;const n=t+h*(i-t),o=e+h*(s-e);this.targetCenter_=[n,o]}if(r.sourceResolution&&r.targetResolution){const t=1===h?r.targetResolution:r.sourceResolution+h*(r.targetResolution-r.sourceResolution);if(r.anchor){const e=this.getViewportSize_(this.getRotation()),i=this.constraints_.resolution(t,0,e,!0);this.targetCenter_=this.calculateCenterZoom(i,r.anchor)}this.nextResolution_=r.targetResolution,this.targetResolution_=t,this.applyTargetState_(!0)}if(void 0!==r.sourceRotation&&void 0!==r.targetRotation){const t=1===h?Rt(r.targetRotation+Math.PI,2*Math.PI)-Math.PI:r.sourceRotation+h*(r.targetRotation-r.sourceRotation);if(r.anchor){const e=this.constraints_.rotation(t,!0);this.targetCenter_=this.calculateCenterRotate(e,r.anchor)}this.nextRotation_=r.targetRotation,this.targetRotation_=t}if(this.applyTargetState_(!0),e=!0,!r.complete)break}if(n){this.animations_[i]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const t=s[0].callback;t&&un(t,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const s=this.getCenterInternal();var n,r;return void 0!==s&&(i=[s[0]-e[0],s[1]-e[1]],he(i,t-this.getRotation()),r=e,(n=i)[0]+=+r[0],n[1]+=+r[1]),i}calculateCenterZoom(t,e){let i;const s=this.getCenterInternal(),n=this.getResolution();return void 0!==s&&void 0!==n&&(i=[e[0]-t*(e[0]-s[0])/n,e[1]-t*(e[1]-s[1])/n]),i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],s=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(s*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t?es(t,this.getProjection()):t}getCenterInternal(){return this.get(pi.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){return ss(this.calculateExtentInternal(t),this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();q(e,1);const i=this.getResolution();q(void 0!==i,2);const s=this.getRotation();return q(void 0!==s,3),mt(e,i,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(pi.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(ns(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=Mt(t)/e[0],s=yt(t)/e[1];return Math.max(i,s)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(e/i)/Math.log(t);return function(i){return e/Math.pow(t,i*s)}}getRotation(){return this.get(pi.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,n=Math.log(i/s)/e;return function(t){return Math.log(i/t)/e/n}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let s=this.getCenterInternal();const n=this.padding_;if(n){const t=this.getViewportSizeMinusPadding_();s=gn(s,this.getViewportSize_(),[t[0]/2+n[3],t[1]/2+n[0]],e,i)}return{center:s.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getZoom(){let t;const e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e,i,s=this.minZoom_||0;if(this.resolutions_){const n=r(this.resolutions_,t,1);s=n,e=this.resolutions_[n],i=n==this.resolutions_.length-1?2:e/this.resolutions_[n+1]}else e=this.maxResolution_,i=this.zoomFactor_;return s+Math.log(e/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=bt(Math.floor(t),0,this.resolutions_.length-2),i=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(i,bt(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(q(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t))q(!Ct(t),25),i=ln(ns(t,this.getProjection()));else if("Circle"===t.getType()){const e=ns(t.getExtent(),this.getProjection());i=ln(e),i.rotate(this.getRotation(),ft(e))}else{const e=ts();i=e?t.clone().transform(e,this.getProjection()):t}this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),s=Math.sin(-e),n=t.getFlatCoordinates(),r=t.getStride();let o=1/0,a=1/0,h=-1/0,l=-1/0;for(let t=0,e=n.length;t<e;t+=r){const e=n[t]*i-n[t+1]*s,r=n[t]*s+n[t+1]*i;o=Math.min(o,e),a=Math.min(a,r),h=Math.max(h,e),l=Math.max(l,r)}return[o,a,h,l]}fitInternal(t,e){let i=(e=e||{}).size;i||(i=this.getViewportSizeMinusPadding_());const s=void 0!==e.padding?e.padding:[0,0,0,0],n=void 0!==e.nearest&&e.nearest;let r;r=void 0!==e.minResolution?e.minResolution:void 0!==e.maxZoom?this.getResolutionForZoom(e.maxZoom):0;const o=this.rotatedExtentForGeometry(t);let a=this.getResolutionForExtentInternal(o,[i[0]-s[1]-s[3],i[1]-s[0]-s[2]]);a=isNaN(a)?r:Math.max(a,r),a=this.getConstrainedResolution(a,n?0:1);const h=this.getRotation(),l=Math.sin(h),c=Math.cos(h),d=ft(o);d[0]+=(s[1]-s[3])/2*a,d[1]+=(s[0]-s[2])/2*a;const g=d[0]*c-d[1]*l,p=d[1]*c+d[0]*l,_=this.getConstrainedCenter([g,p],a),f=e.callback?e.callback:u;void 0!==e.duration?this.animateInternal({resolution:a,center:_,duration:e.duration,easing:e.easing},f):(this.targetResolution_=a,this.targetCenter_=_,this.applyTargetState_(!1,!0),un(f,!0))}centerOn(t,e,i){this.centerOnInternal(is(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(gn(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,s){let n;const r=this.padding_;if(r&&t){const o=this.getViewportSizeMinusPadding_(-i),a=gn(t,s,[o[0]/2+r[3],o[1]/2+r[0]],e,i);n=[t[0]-a[0],t[1]-a[1]]}return n}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(t){const e=es(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&is(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),n=this.constraints_.resolution(this.targetResolution_*t,0,s,i);e&&(this.targetCenter_=this.calculateCenterZoom(n,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=is(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(s,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t?is(t,this.getProjection()):t)}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,s=this.constraints_.rotation(this.targetRotation_,i),n=this.getViewportSize_(s),r=this.constraints_.resolution(this.targetResolution_,0,n,i),o=this.constraints_.center(this.targetCenter_,r,n,i,this.calculateCenterShift(this.targetCenter_,r,s,n));this.get(pi.ROTATION)!==s&&this.set(pi.ROTATION,s),this.get(pi.RESOLUTION)!==r&&(this.set(pi.RESOLUTION,r),this.set("zoom",this.getZoom(),!0)),o&&this.get(pi.CENTER)&&ae(this.get(pi.CENTER),o)||this.set(pi.CENTER,o),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=void 0!==t?t:200;const s=e||0,n=this.constraints_.rotation(this.targetRotation_),r=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,s,r),a=this.constraints_.center(this.targetCenter_,o,r,!1,this.calculateCenterShift(this.targetCenter_,o,n,r));if(0===t&&!this.cancelAnchor_)return this.targetResolution_=o,this.targetRotation_=n,this.targetCenter_=a,void this.applyTargetState_();i=i||(0===t?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===o&&this.getRotation()===n&&this.getCenterInternal()&&ae(this.getCenterInternal(),a)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:n,center:a,resolution:o,duration:t,easing:ms,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(1,1)}endInteraction(t,e,i){i=i&&is(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.setHint(1,-1),this.resolveConstraints(t,e,i)}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}},_n=class extends S{constructor(t){super();const e=t.element;!e||t.target||e.style.pointerEvents||(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){Le(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&Le(this.element);for(let t=0,e=this.listenerKeys.length;t<e;++t)y(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==u&&this.listenerKeys.push(f(t,ni,this.render,this)),t.render())}render(t){}setTarget(t){this.target_="string"==typeof t?document.getElementById(t):t}},fn=class extends _n{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===t.collapsed||t.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==t.collapsible,this.collapsible_=void 0===t.collapsible||t.collapsible,this.collapsible_||(this.collapsed_=!1);const e=void 0!==t.className?t.className:"ol-attribution",i=void 0!==t.tipLabel?t.tipLabel:"Attributions",s=void 0!==t.expandClassName?t.expandClassName:e+"-expand",n=void 0!==t.collapseLabel?t.collapseLabel:"›",r=void 0!==t.collapseClassName?t.collapseClassName:e+"-collapse";"string"==typeof n?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=n,this.collapseLabel_.className=r):this.collapseLabel_=n;const o=void 0!==t.label?t.label:"i";"string"==typeof o?(this.label_=document.createElement("span"),this.label_.textContent=o,this.label_.className=s):this.label_=o;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(a),this.toggleButton_.addEventListener(_.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+me+" "+ye+(this.collapsed_&&this.collapsible_?" "+xe:"")+(this.collapsible_?"":" ol-uncollapsible"),l=this.element;l.className=h,l.appendChild(this.toggleButton_),l.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e={},i=[];let s=!0;const n=t.layerStatesArray;for(let r=0,o=n.length;r<o;++r){const o=n[r];if(!ne(o,t.viewState))continue;const a=o.layer.getSource();if(!a)continue;const h=a.getAttributions();if(!h)continue;const l=h(t);if(l)if(s=s&&!1!==a.getAttributionsCollapsible(),Array.isArray(l))for(let t=0,s=l.length;t<s;++t)l[t]in e||(i.push(l[t]),e[l[t]]=!0);else l in e||(i.push(l),e[l]=!0)}return this.overrideCollapsible_||this.setCollapsible(s),i}updateElement_(t){if(!t)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const e=this.collectSourceAttributions_(t),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!h(e,this.renderedAttributions_)){Te(this.ulElement_);for(let t=0,i=e.length;t<i;++t){const i=document.createElement("li");i.innerHTML=e[t],this.ulElement_.appendChild(i)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(xe),this.collapsed_?Ie(this.collapseLabel_,this.label_):Ie(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},mn=class extends _n{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=void 0!==t.className?t.className:"ol-rotate",i=void 0!==t.label?t.label:"⇧",s=void 0!==t.compassClassName?t.compassClassName:"ol-compass";this.label_=null,"string"==typeof i?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(s));const n=t.tipLabel?t.tipLabel:"Reset rotation",r=document.createElement("button");r.className=e+"-reset",r.setAttribute("type","button"),r.title=n,r.appendChild(this.label_),r.addEventListener(_.CLICK,this.handleClick_.bind(this),!1);const o=e+" "+me+" "+ye,a=this.element;a.className=o,a.appendChild(r),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=void 0!==t.duration?t.duration:250,this.autoHide_=void 0===t.autoHide||t.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(fe)}handleClick_(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const e=t.getRotation();void 0!==e&&(this.duration_>0&&e%(2*Math.PI)!=0?t.animate({rotation:0,duration:this.duration_,easing:ms}):t.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const t="rotate("+i+"rad)";if(this.autoHide_){const t=this.element.classList.contains(fe);t||0!==i?t&&0!==i&&this.element.classList.remove(fe):this.element.classList.add(fe)}this.label_.style.transform=t}this.rotation_=i}},yn=class extends _n{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=void 0!==t.className?t.className:"ol-zoom",i=void 0!==t.delta?t.delta:1,s=void 0!==t.zoomInClassName?t.zoomInClassName:e+"-in",n=void 0!==t.zoomOutClassName?t.zoomOutClassName:e+"-out",r=void 0!==t.zoomInLabel?t.zoomInLabel:"+",o=void 0!==t.zoomOutLabel?t.zoomOutLabel:"–",a=void 0!==t.zoomInTipLabel?t.zoomInTipLabel:"Zoom in",h=void 0!==t.zoomOutTipLabel?t.zoomOutTipLabel:"Zoom out",l=document.createElement("button");l.className=s,l.setAttribute("type","button"),l.title=a,l.appendChild("string"==typeof r?document.createTextNode(r):r),l.addEventListener(_.CLICK,this.handleClick_.bind(this,i),!1);const c=document.createElement("button");c.className=n,c.setAttribute("type","button"),c.title=h,c.appendChild("string"==typeof o?document.createTextNode(o):o),c.addEventListener(_.CLICK,this.handleClick_.bind(this,-i),!1);const u=e+" "+me+" "+ye,d=this.element;d.className=u,d.appendChild(l),d.appendChild(c),this.duration_=void 0!==t.duration?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const e=this.getMap().getView();if(!e)return;const i=e.getZoom();if(void 0!==i){const s=e.getConstrainedZoom(i+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:s,duration:this.duration_,easing:ms})):e.setZoom(s)}}},xn="active";function vn(t,e,i,s){const n=t.getZoom();if(void 0===n)return;const r=t.getConstrainedZoom(n+e),o=t.getResolutionForZoom(r);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:o,anchor:i,duration:void 0!==s?s:250,easing:ms})}const wn=class extends S{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(xn)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(xn,t)}setMap(t){this.map_=t}},Mn=class extends wn{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:250}handleEvent(t){let e=!1;if(t.type==ei.DBLCLICK){const i=t.originalEvent,s=t.map,n=t.coordinate,r=i.shiftKey?-this.delta_:this.delta_;vn(s.getView(),r,n,this.duration_),i.preventDefault(),e=!0}return!e}};function En(t){const e=t.length;let i=0,s=0;for(let n=0;n<e;n++)i+=t[n].clientX,s+=t[n].clientY;return{clientX:i/e,clientY:s/e}}const Cn=class extends wn{constructor(t){super(t=t||{}),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==ei.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==ei.POINTERUP){const e=this.handleUpEvent(t);this.handlingDownUpSequence=e&&this.targetPointers.length>0}}else if(t.type==ei.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==ei.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function Sn(t){const e=arguments;return function(t){let i=!0;for(let s=0,n=e.length;s<n&&(i=i&&e[s](t),i);++s);return i}}const bn=function(t){const e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},In=function(t){return!t.map.getTargetElement().hasAttribute("tabindex")||function(t){const e=t.map.getTargetElement(),i=t.map.getOwnerDocument().activeElement;return e.contains(i)}(t)},Ln=l,Tn=function(t){const e=t.originalEvent;return 0==e.button&&!(D&&k&&e.ctrlKey)},Nn=c,Rn=function(t){const e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Pn=function(t){const e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},On=function(t){const e=t.originalEvent,i=e.target.tagName;return"INPUT"!==i&&"SELECT"!==i&&"TEXTAREA"!==i&&!e.target.isContentEditable},An=function(t){const e=t.originalEvent;return q(void 0!==e,56),"mouse"==e.pointerType},Fn=function(t){const e=t.originalEvent;return q(void 0!==e,56),e.isPrimary&&0===e.button},Dn=class extends Cn{constructor(t){super({stopDown:c}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:Sn(Rn,Fn);this.condition_=t.onFocusOnly?Sn(In,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const i=this.targetPointers,s=e.getEventPixel(En(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const e=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],i=t.map.getView();n=e,r=i.getResolution(),n[0]*=r,n[1]*=r,he(e,i.getRotation()),i.adjustCenterInternal(e)}}else this.kinetic_&&this.kinetic_.begin();var n,r;this.lastCentroid=s,this.lastPointersCount_=i.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const t=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),n=i.getCenterInternal(),r=e.getPixelFromCoordinateInternal(n),o=e.getCoordinateFromPixelInternal([r[0]-t*Math.cos(s),r[1]-t*Math.sin(s)]);i.animateInternal({center:i.getConstrainedCenter(o),duration:500,easing:ms})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},kn=class extends Cn{constructor(t){t=t||{},super({stopDown:c}),this.condition_=t.condition?t.condition:bn,this.lastAngle_=void 0,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){if(!An(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===_s)return;const s=e.getSize(),n=t.pixel,r=Math.atan2(s[1]/2-n[1],n[0]-s[0]/2);if(void 0!==this.lastAngle_){const t=r-this.lastAngle_;i.adjustRotationInternal(-t)}this.lastAngle_=r}handleUpEvent(t){return!An(t)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){return!!An(t)&&(!(!Tn(t)||!this.condition_(t))&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0))}},Gn=class extends s{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",s=this.element_.style;s.left=Math.min(t[0],e[0])+i,s.top=Math.min(t[1],e[1])+i,s.width=Math.abs(e[0]-t[0])+i,s.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,i=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new hn([i])}getGeometry(){return this.geometry_}};class zn extends t{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}const Bn=class extends Cn{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new Gn(t.className||"ol-dragbox"),this.minArea_=void 0!==t.minArea?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:Tn,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const s=i[0]-e[0],n=i[1]-e[1];return s*s+n*n>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new zn("boxdrag",t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new zn(e?"boxend":"boxcancel",t.coordinate,t)),!1}handleDownEvent(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new zn("boxstart",t.coordinate,t)),!0)}onBoxEnd(t){}},jn=class extends Bn{constructor(t){super({condition:(t=t||{}).condition?t.condition:Pn,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=void 0!==t.duration?t.duration:200,this.out_=void 0!==t.out&&t.out}onBoxEnd(t){const e=this.getMap().getView();let i=this.getGeometry();if(this.out_){const t=e.rotatedExtentForGeometry(i),s=e.getResolutionForExtentInternal(t),n=e.getResolution()/s;i=i.clone(),i.scale(n*n)}e.fitInternal(i,{duration:this.duration_,easing:ms})}},qn=class extends wn{constructor(t){super(),t=t||{},this.defaultCondition_=function(t){return Rn(t)&&On(t)},this.condition_=void 0!==t.condition?t.condition:this.defaultCondition_,this.duration_=void 0!==t.duration?t.duration:100,this.pixelDelta_=void 0!==t.pixelDelta?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==_.KEYDOWN){const i=t.originalEvent,s=i.keyCode;if(this.condition_(t)&&(40==s||37==s||39==s||38==s)){const n=t.map.getView(),r=n.getResolution()*this.pixelDelta_;let o=0,a=0;40==s?a=-r:37==s?o=-r:39==s?o=r:a=r;const h=[o,a];he(h,n.getRotation()),function(t,e,i){const s=t.getCenterInternal();if(s){const n=[s[0]+e[0],s[1]+e[1]];t.animateInternal({duration:void 0!==i?i:250,easing:xs,center:t.getConstrainedCenter(n)})}}(n,h,this.duration_),i.preventDefault(),e=!0}}return!e}},Un=class extends wn{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:On,this.delta_=t.delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:100}handleEvent(t){let e=!1;if(t.type==_.KEYDOWN||t.type==_.KEYPRESS){const i=t.originalEvent,s=i.charCode;if(this.condition_(t)&&(s=="+".charCodeAt(0)||s=="-".charCodeAt(0))){const n=t.map,r=s=="+".charCodeAt(0)?this.delta_:-this.delta_;vn(n.getView(),r,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}},Yn=class{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const s=this.points_[e+2]-this.points_[i+2];if(s<1e3/60)return!1;const n=this.points_[e]-this.points_[i],r=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(r,n),this.initialVelocity_=Math.sqrt(n*n+r*r)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},Vn=class extends wn{constructor(t){super(t=t||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==t.maxDelta?t.maxDelta:1,this.duration_=void 0!==t.duration?t.duration:250,this.timeout_=void 0!==t.timeout?t.timeout:80,this.useAnchor_=void 0===t.useAnchor||t.useAnchor,this.constrainResolution_=void 0!==t.constrainResolution&&t.constrainResolution;const e=t.condition?t.condition:Ln;this.condition_=t.onFocusOnly?Sn(In,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t))return!0;if(t.type!==_.WHEEL)return!0;const e=t.map,i=t.originalEvent;let s;if(i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==_.WHEEL&&(s=i.deltaY,F&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=G),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),0===s)return!1;this.lastDelta_=s;const n=Date.now();void 0===this.startTime_&&(this.startTime_=n),(!this.mode_||n-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const r=e.getView();if("trackpad"===this.mode_&&!r.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(r.getAnimating()&&r.cancelAnimations(),r.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),r.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=n,!1;this.totalDelta_+=s;const o=Math.max(this.timeout_-(n-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,e),o),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-bt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),vn(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},Xn=class extends Cn{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=c),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==t.threshold?t.threshold:.3,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],s=this.targetPointers[1],n=Math.atan2(s.clientY-i.clientY,s.clientX-i.clientX);if(void 0!==this.lastAngle_){const t=n-this.lastAngle_;this.rotationDelta_+=t,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=t}this.lastAngle_=n;const r=t.map,o=r.getView();o.getConstraints().rotation!==_s&&(this.anchor_=r.getCoordinateFromPixelInternal(r.getEventPixel(En(this.targetPointers))),this.rotating_&&(r.render(),o.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}},Wn=class extends Cn{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=c),super(e),this.anchor_=null,this.duration_=void 0!==t.duration?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],s=this.targetPointers[1],n=i.clientX-s.clientX,r=i.clientY-s.clientY,o=Math.sqrt(n*n+r*r);void 0!==this.lastDistance_&&(e=this.lastDistance_/o),this.lastDistance_=o;const a=t.map,h=a.getView();1!=e&&(this.lastScaleDelta_=e),this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(En(this.targetPointers))),a.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const e=t.map.getView(),i=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,i),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}};function $n(t){t=t||{};const e=new O,i=new Yn(-.005,.05,100);return(void 0===t.altShiftDragRotate||t.altShiftDragRotate)&&e.push(new kn),(void 0===t.doubleClickZoom||t.doubleClickZoom)&&e.push(new Mn({delta:t.zoomDelta,duration:t.zoomDuration})),(void 0===t.dragPan||t.dragPan)&&e.push(new Dn({onFocusOnly:t.onFocusOnly,kinetic:i})),(void 0===t.pinchRotate||t.pinchRotate)&&e.push(new Xn),(void 0===t.pinchZoom||t.pinchZoom)&&e.push(new Wn({duration:t.zoomDuration})),(void 0===t.keyboard||t.keyboard)&&(e.push(new qn),e.push(new Un({delta:t.zoomDelta,duration:t.zoomDuration}))),(void 0===t.mouseWheelZoom||t.mouseWheelZoom)&&e.push(new Vn({onFocusOnly:t.onFocusOnly,duration:t.zoomDuration})),(void 0===t.shiftDragZoom||t.shiftDragZoom)&&e.push(new jn({duration:t.zoomDuration})),e}function Hn(t){return t[0]>0&&t[1]>0}function Kn(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}function Zn(t){t instanceof re?t.setMapInternal(null):t instanceof Je&&t.getLayers().forEach(Zn)}function Jn(t,e){if(t instanceof re)t.setMapInternal(e);else if(t instanceof Je){const i=t.getLayers().getArray();for(let t=0,s=i.length;t<s;++t)Jn(i[t],e)}}const Qn=class extends S{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=function(t){let e=null;void 0!==t.keyboardEventTarget&&(e="string"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);const i={},s=t.layers&&"function"==typeof t.layers.getLayers?t.layers:new Je({layers:t.layers});let n,r,o;return i[ai]=s,i[li]=t.target,i[ci]=t.view instanceof pn?t.view:new pn,void 0!==t.controls&&(Array.isArray(t.controls)?n=new O(t.controls.slice()):(q("function"==typeof t.controls.getArray,47),n=t.controls)),void 0!==t.interactions&&(Array.isArray(t.interactions)?r=new O(t.interactions.slice()):(q("function"==typeof t.interactions.getArray,48),r=t.interactions)),void 0!==t.overlays?Array.isArray(t.overlays)?o=new O(t.overlays.slice()):(q("function"==typeof t.overlays.getArray,49),o=t.overlays):o=new O,{controls:n,interactions:r,keyboardEventTarget:e,overlays:o,values:i}}(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,this.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:G,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver((()=>this.updateSize())),this.controls=e.controls||function(t){t=t||{};const e=new O;return(void 0===t.zoom||t.zoom)&&e.push(new yn(t.zoomOptions)),(void 0===t.rotate||t.rotate)&&e.push(new mn(t.rotateOptions)),(void 0===t.attribution||t.attribution)&&e.push(new fn(t.attributionOptions)),e}(),this.interactions=e.interactions||$n({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new gi(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(ai,this.handleLayerGroupChanged_),this.addChangeListener(ci,this.handleViewChanged_),this.addChangeListener(hi,this.handleSizeChanged_),this.addChangeListener(li,this.handleTargetChanged_),this.setProperties(e.values);const i=this;!t.view||t.view instanceof pn||t.view.then((function(t){i.setView(new pn(t))})),this.controls.addEventListener(T,(t=>{t.element.setMap(this)})),this.controls.addEventListener(N,(t=>{t.element.setMap(null)})),this.interactions.addEventListener(T,(t=>{t.element.setMap(this)})),this.interactions.addEventListener(N,(t=>{t.element.setMap(null)})),this.overlays_.addEventListener(T,(t=>{this.addOverlayInternal_(t.element)})),this.overlays_.addEventListener(N,(t=>{const e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()],t.element.setMap(null)})),this.controls.forEach((t=>{t.setMap(this)})),this.interactions.forEach((t=>{t.setMap(this)})),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){Jn(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(t),n=void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance:0,r=void 0!==i.layerFilter?i.layerFilter:l,o=!1!==i.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,n,o,e,null,r,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,(function(t){i.push(t)}),e),i}getAllLayers(){const t=[];return function e(i){i.forEach((function(i){i instanceof Je?e(i.getLayers()):t.push(i)}))}(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t),s=void 0!==(e=void 0!==e?e:{}).layerFilter?e.layerFilter:l,n=void 0!==e.hitTolerance?e.hitTolerance:0,r=!1!==e.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,n,r,s,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const e=this.viewport_.getBoundingClientRect(),i=this.getSize(),s=e.width/i[0],n=e.height/i[1],r="changedTouches"in t?t.changedTouches[0]:t;return[(r.clientX-e.left)/s,(r.clientY-e.top)/n]}getTarget(){return this.get(li)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return es(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?U(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(ai)}setLayers(t){const e=this.getLayerGroup();if(t instanceof O)return void e.setLayers(t);const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const i=t[e];if(!i.visible)continue;const s=i.layer.getRenderer();if(s&&!s.ready)return!0;const n=i.layer.getSource();if(n&&n.loading)return!0}return!1}getPixelFromCoordinate(t){const e=is(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?U(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(hi)}getView(){return this.get(ci)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,s){return function(t,e,i,s,n){if(!t||!(i in t.wantedTiles))return ui;if(!t.wantedTiles[i][e.getKey()])return ui;const r=t.viewState.center,o=s[0]-r[0],a=s[1]-r[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n}(this.frameState_,t,e,i,s)}handleBrowserEvent(t,e){e=e||t.type;const i=new ti(e,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if(i===ii||i===_.WHEEL||i===_.KEYDOWN){const t=this.getOwnerDocument(),i=this.viewport_.getRootNode?this.viewport_.getRootNode():t,s=e.target;if(this.overlayContainerStopEvent_.contains(s)||!(i===t?t.documentElement:i).contains(s))return}if(t.frameState=this.frameState_,!1!==this.dispatchEvent(t)){const e=this.getInteractions().getArray().slice();for(let i=e.length-1;i>=0;i--){const s=e[i];if(s.getMap()===this&&s.getActive()&&this.getTargetElement()&&(!s.handleEvent(t)||t.propagationStopped))break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let i=this.maxTilesLoading_,s=i;if(t){const e=t.viewHints;if(e[0]||e[1]){const e=Date.now()-t.time>8;i=e?0:8,s=e?0:2}}e.getTilesLoading()<i&&(e.reprioritize(),e.loadMoreTiles(i,s))}t&&this.renderer_&&!t.animate&&(!0===this.renderComplete_?(this.hasListener(se)&&this.renderer_.dispatchRenderEvent(se,t),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new Qe(oi,this,t)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new Qe(ri,this,t))));const i=this.postRenderFunctions_;for(let e=0,s=i.length;e<s;++e)i[e](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let t=0,e=this.targetChangeHandlerKeys_.length;t<e;++t)y(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(_.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(_.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Le(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const t=this.targetElement_.getRootNode();t instanceof ShadowRoot&&this.resizeObserver_.unobserve(t.host)}const t=this.getTarget(),e="string"==typeof t?document.getElementById(t):t;if(this.targetElement_=e,e){e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new $e(this)),this.mapBrowserEventHandler_=new si(this,this.moveTolerance_);for(const t in ei)this.mapBrowserEventHandler_.addEventListener(ei[t],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(_.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(_.WHEEL,this.boundHandleBrowserEvent_,!!j&&{passive:!1});const t=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[f(t,_.KEYDOWN,this.handleBrowserEvent,this),f(t,_.KEYPRESS,this.handleBrowserEvent,this)];const i=e.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.observe(i.host),this.resizeObserver_.observe(e)}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(y(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(y(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=f(t,e,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=f(t,_.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(y),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new He("addlayer",t)),this.layerGroupPropertyListenerKeys_=[f(t,e,this.render,this),f(t,_.CHANGE,this.render,this),f(t,"addlayer",this.handleLayerAdd_,this),f(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const i=t[e].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){Zn(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),s=this.frameState_;let n=null;if(void 0!==e&&Hn(e)&&i&&i.isDef()){const s=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),r=i.getState();if(n={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:mt(r.center,r.resolution,r.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:r,viewHints:s,wantedTiles:{},mapId:E(this),renderTargets:{}},r.nextCenter&&r.nextResolution){const t=isNaN(r.nextRotation)?r.rotation:r.nextRotation;n.nextExtent=mt(r.nextCenter,r.nextResolution,t,e)}}this.frameState_=n,this.renderer_.renderFrame(n),n&&(n.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,n.postRenderFunctions),s&&(!this.previousExtent_||!Ct(this.previousExtent_)&&!ht(n.extent,this.previousExtent_))&&(this.dispatchEvent(new Qe("movestart",this,s)),this.previousExtent_=rt(this.previousExtent_)),this.previousExtent_&&!n.viewHints[0]&&!n.viewHints[1]&&!ht(n.extent,this.previousExtent_)&&(this.dispatchEvent(new Qe("moveend",this,n)),J(n.extent,this.previousExtent_))),this.dispatchEvent(new Qe(ni,this,n)),this.renderComplete_=this.hasListener(ri)||this.hasListener(oi)||this.hasListener(se)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout((()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()}),0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new He("removelayer",e)),this.set(ai,t)}setSize(t){this.set(hi,t)}setTarget(t){this.set(li,t)}setView(t){if(!t||t instanceof pn)return void this.set(ci,t);this.set(ci,new pn);const e=this;t.then((function(t){e.setView(new pn(t))}))}updateSize(){const t=this.getTargetElement();let e;if(t){const i=getComputedStyle(t),s=t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),n=t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);isNaN(s)||isNaN(n)||(e=[s,n],!Hn(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&ki("No map visible because the map container's width or height are 0."))}const i=this.getSize();!e||i&&h(e,i)||(this.setSize(e),this.updateViewportSize_())}updateViewportSize_(){const t=this.getView();if(t){let e;const i=getComputedStyle(this.viewport_);i.width&&i.height&&(e=[parseInt(i.width,10),parseInt(i.height,10)]),t.setViewportSize(e)}}};class tr extends Qn{constructor(){super({controls:[],interactions:$n({dragPan:!1,mouseWheelZoom:!1}).extend([new Dn,new Vn({duration:0}),new Mn({duration:0})]),view:new pn({resolutions:jy.lizmap3.map.resolutions?jy.lizmap3.map.resolutions:jy.lizmap3.map.baseLayer.resolutions,constrainResolution:!0,center:[jy.lizmap3.map.getCenter().lon,jy.lizmap3.map.getCenter().lat],projection:"EPSG:900913"===jy.projection?"EPSG:3857":jy.projection,enableRotation:!1,extent:jy.lizmap3.map.restrictedExtent.toArray(),constrainOnlyCenter:!0}),target:"newOlMap"}),this._newOlMap=!1,this._refreshOL2View=()=>{jy.lizmap3.map.setCenter(this.getView().getCenter(),this.getView().getZoom())},jy.lizmap3.map.events.on({moveend:()=>{this.un("moveend",this._refreshOL2View),this.getView().animate({center:this._lizmap3Center,zoom:jy.lizmap3.map.getZoom(),duration:0},setTimeout((()=>this.on("moveend",this._refreshOL2View)),500)),qy.dispatch("map.moveend")},zoomstart:t=>{this.un("moveend",this._refreshOL2View),this.getView().animate({zoom:t.zoom,duration:0},setTimeout((()=>this.on("moveend",this._refreshOL2View)),500)),qy.dispatch("map.zoomstart")},zoomend:()=>{qy.dispatch("map.zoomend")}}),this.on("pointerdrag",(()=>{jy.lizmap3.map.setCenter(this.getView().getCenter(),null,!0)})),this.on("moveend",this._refreshOL2View),this.syncNewOLwithOL2View()}get _lizmap3Center(){return[jy.lizmap3.map.getCenter().lon,jy.lizmap3.map.getCenter().lat]}syncNewOLwithOL2View(){this.getView().animate({center:this._lizmap3Center,zoom:jy.lizmap3.map.getZoom(),duration:0})}}class er{constructor(){this.drawFeatureActivated=!1,this._layerId=void 0,this.layerGeometry=void 0,this.drawControl=void 0,this._lastSegmentLength=void 0,lizMap.events.on({lizmapeditiondrawfeatureactivated:t=>{this.drawFeatureActivated=!0,this.layerGeometry=t.editionConfig.geometryType,this.drawControl=t.drawControl,qy.dispatch("edition.drawFeatureActivated")},lizmapeditiondrawfeaturedeactivated:()=>{this.drawFeatureActivated=!1,this.layerGeometry=void 0,this.drawControl=void 0,this.lastSegmentLength=void 0,qy.dispatch("edition.drawFeatureActivated")},lizmapeditionformdisplayed:t=>{this._layerId=t.layerId,qy.dispatch("edition.formDisplayed")},lizmapeditionformclosed:()=>{qy.dispatch("edition.formClosed")}})}get layerId(){return this._layerId}get hasEditionLayers(){return"editionLayers"in jy.lizmap3.config}get editLayer(){const t=jy.lizmap3.map.getLayersByName("editLayer");return 1===t.length?t[0]:void 0}get modifyFeatureControl(){return jy.lizmap3.map.getControlsByClass("OpenLayers.Control.ModifyFeature").filter((t=>"editLayer"===t.layer.name))[0]}get lastSegmentLength(){return this._lastSegmentLength}set lastSegmentLength(t){t=parseFloat(t),this._lastSegmentLength!==t&&(this._lastSegmentLength=t,qy.dispatch("edition.lastSegmentLength"))}fetchEditableFeatures(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(fetch(lizUrls.edition.replace("getFeature","editableFeatures"),{method:"POST",body:new URLSearchParams({repository:lizUrls.params.repository,project:lizUrls.params.project,layerId:i})}).then((t=>t.json()))),Promise.all(e).then((t=>{const e=[];for(const i of t)if(i?.success&&"restricted"===i?.status){for(const t of i.features)e.push(t);qy.dispatch({type:"edition.editableFeatures",properties:e})}}))}}}const ir="accuracy",sr="accuracyGeometry",nr="altitude",rr="altitudeAccuracy",or="heading",ar="position",hr="projection",lr="speed",cr="tracking",ur="trackingOptions";class dr extends t{constructor(t){super("error"),this.code=t.code,this.message=t.message}}const gr=class extends S{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.position_=null,this.transform_=Bi,this.watchId_=void 0,this.addChangeListener(hr,this.handleProjectionChanged_),this.addChangeListener(cr,this.handleTrackingChanged_),void 0!==t.projection&&this.setProjection(t.projection),void 0!==t.trackingOptions&&this.setTrackingOptions(t.trackingOptions),this.setTracking(void 0!==t.tracking&&t.tracking)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const t=this.getProjection();t&&(this.transform_=Hi(qi("EPSG:4326"),t),this.position_&&this.set(ar,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const t=this.getTracking();t&&void 0===this.watchId_?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):t||void 0===this.watchId_||(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(t){const e=t.coords;this.set(ir,e.accuracy),this.set(nr,null===e.altitude?void 0:e.altitude),this.set(rr,null===e.altitudeAccuracy?void 0:e.altitudeAccuracy),this.set(or,null===e.heading?void 0:Nt(e.heading)),this.position_?(this.position_[0]=e.longitude,this.position_[1]=e.latitude):this.position_=[e.longitude,e.latitude];const i=this.transform_(this.position_);this.set(ar,i.slice()),this.set(lr,null===e.speed?void 0:e.speed);const s=function(t,e,i,s){i=i||32;const n=[];for(let s=0;s<i;++s)a(n,Ai(t,e,2*Math.PI*s/i,undefined));return n.push(n[0],n[1]),new an(n,"XY",[n.length])}(this.position_,e.accuracy);s.applyTransform(this.transform_),this.set(sr,s),this.changed()}positionError_(t){this.dispatchEvent(new dr(t))}getAccuracy(){return this.get(ir)}getAccuracyGeometry(){return this.get(sr)||null}getAltitude(){return this.get(nr)}getAltitudeAccuracy(){return this.get(rr)}getHeading(){return this.get(or)}getPosition(){return this.get(ar)}getProjection(){return this.get(hr)}getSpeed(){return this.get(lr)}getTracking(){return this.get(cr)}getTrackingOptions(){return this.get(ur)}setProjection(t){this.set(hr,qi(t))}setTracking(t){this.set(cr,t)}setTrackingOptions(t){this.set(ur,t)}};class pr{constructor(){this._firstGeolocation=!0,this._isBind=!1,this._bindIntervalID=0,this._bindIntervalInSecond=10,this._isLinkedToEdition=!1,this._geolocation=new gr({trackingOptions:{enableHighAccuracy:!0},projection:jy.projection}),this._geolocation.on("change:position",(()=>{const t=this._geolocation.getPosition();this.moveGeolocationPointAndCircle(t),qy.dispatch("geolocation.position")})),this._geolocation.on("change:tracking",(()=>{const t=jy._lizmap3.map.getLayersByName("geolocation")[0];t&&t.setVisibility(this.isTracking),this.isBind&&(this.isTracking?this._startBindInterval():this._stopBindInterval()),qy.dispatch("geolocation.isTracking")})),this._geolocation.on("change:accuracy",(()=>{qy.dispatch("geolocation.accuracy")})),this._geolocation.on("change:accuracyGeometry",(()=>{this._firstGeolocation&&(jy.extent=this._geolocation.getAccuracyGeometry().getExtent(),this.center(),this._firstGeolocation=!1,qy.dispatch("geolocation.firstGeolocation"))})),this._geolocation.on("error",(function(t){jy.displayMessage(t.message,"error",!0)}))}center(){jy.center=this._geolocation.getPosition()}toggleBind(){this.isBind=!this._isBind,this.isBind?(this.center(),this._startBindInterval()):this._stopBindInterval()}_startBindInterval(){this._stopBindInterval(),this._bindIntervalID=window.setInterval((()=>{this.center()}),1e3*this.bindIntervalInSecond)}_stopBindInterval(){window.clearInterval(this._bindIntervalID)}toggleTracking(){this.isTracking=!this._geolocation.getTracking()}getPositionInCRS(t){return"ESPG:4326"===t?this.position:Zi(this._geolocation.getPosition(),jy.projection,t)}get firstGeolocation(){return this._firstGeolocation}get position(){const t=this._geolocation.getPosition();if(t){const e=Zi(t,jy.projection,"EPSG:4326");return[parseFloat(e[0].toFixed(6)),parseFloat(e[1].toFixed(6))]}}get accuracy(){if(this._geolocation.getAccuracy())return parseFloat(this._geolocation.getAccuracy().toFixed(3))}get isTracking(){return this._geolocation.getTracking()}set isTracking(t){this._geolocation.setTracking(t)}get isBind(){return this._isBind}set isBind(t){this._isBind=t,qy.dispatch("geolocation.isBind")}get isLinkedToEdition(){return this._isLinkedToEdition}set isLinkedToEdition(t){this._isLinkedToEdition=t,qy.dispatch("geolocation.isLinkedToEdition")}get bindIntervalInSecond(){return this._bindIntervalInSecond}set bindIntervalInSecond(t){this._bindIntervalInSecond=t,this._startBindInterval()}moveGeolocationPointAndCircle(t){let e=jy._lizmap3.map.getLayersByName("geolocation")[0];const i={fillColor:"#0395D6",fillOpacity:.1,strokeColor:"#0395D6",strokeWidth:1};if(void 0===e)e=new OpenLayers.Layer.Vector("geolocation"),e.addFeatures([new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t[0],t[1]),{},{graphicName:"circle",strokeColor:"#0395D6",strokeWidth:1,fillOpacity:1,fillColor:"#0395D6",pointRadius:3}),new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(t[0],t[1]),this._geolocation.getAccuracy()/2,40,0),{},i)]),jy._lizmap3.map.addLayer(e);else{const s=e.features[0];s.geometry.x=t[0],s.geometry.y=t[1],s.geometry.clearBounds(),e.drawFeature(s);let n=e.features[1];e.destroyFeatures([n]),n=new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(t[0],t[1]),this._geolocation.getAccuracy()/2,40,0),{},i),e.addFeatures([n])}}}class _r{constructor(){this.distanceLimit=0,this.timeLimit=0,this.accuracyLimit=0,this.averageRecordLimit=0,this._distanceMode=!1,this._timeMode=!1,this._timePauseMode=!1,this._accuracyMode=!1,this._averageRecordMode=!1,this._beepMode=!1,this._vibrateMode=!1,this._timeCount=0,this._intervalID=0,this._positionPointsRecord={}}_insertPoint(){if(jy.geolocation.isTracking&&(!this.accuracyMode||jy.geolocation.accuracy<=this.accuracyLimit)){if(this.averageRecordMode&&void 0!==this.positionAverageInMapCRS)jy.edition.drawControl.handler.insertXY(this.positionAverageInMapCRS);else{const t=jy.edition.drawControl.handler.point.geometry;jy.edition.drawControl.handler.insertXY(t.x,t.y)}if(this.beepMode){this.hasOwnProperty("_beep")||(this._beep=new AudioContext);const t=520,e=.2,i=1,s=this._beep.createOscillator(),n=this._beep.createGain();s.connect(n),s.frequency.value=t,s.type="square",n.connect(this._beep.destination),n.gain.value=i,s.start(this._beep.currentTime),s.stop(this._beep.currentTime+e)}this.vibrateMode&&window.navigator.vibrate(200)}}get distanceMode(){return this._distanceMode}toggleDistanceMode(){this._distanceMode=!this._distanceMode,void 0===this._distanceModeCallback&&(this._distanceModeCallback=()=>{this._distanceMode&&jy.edition.lastSegmentLength>=this.distanceLimit&&this._insertPoint()}),this._distanceMode?qy.addListener(this._distanceModeCallback,"edition.lastSegmentLength"):qy.removeListener(this._distanceModeCallback,"edition.lastSegmentLength"),qy.dispatch("geolocationSurvey.distanceMode")}get timeMode(){return this._timeMode}toggleTimeMode(t){this._timeMode=t||!this._timeMode,void 0===this._timeModeCallback&&(this._timeModeCallback=()=>{jy.edition.drawFeatureActivated&&jy.geolocation.isTracking||this.toggleTimeMode(!1)}),this._timeMode?(this._intervalID=window.setInterval((()=>{this.timePauseMode||this.accuracyMode&&!(jy.geolocation.accuracy<=this.accuracyLimit)||(this.timeCount=this.timeCount+1,this.timeCount>=this.timeLimit&&(this.timeCount=0,this._insertPoint()))}),1e3),qy.addListener(this._timeModeCallback,"edition.drawFeatureActivated"),qy.addListener(this._timeModeCallback,"geolocation.isTracking")):(window.clearInterval(this._intervalID),this.timeCount=0,this._timePauseMode=!1,qy.removeListener(this._timeModeCallback,"edition.drawFeatureActivated"),qy.removeListener(this._timeModeCallback,"geolocation.isTracking")),qy.dispatch("geolocationSurvey.timeMode")}get timePauseMode(){return this._timePauseMode}toggleTimePauseMode(){this._timePauseMode=!this._timePauseMode,qy.dispatch("geolocationSurvey.timePauseMode")}get timeCount(){return this._timeCount}set timeCount(t){this._timeCount=t,qy.dispatch("geolocationSurvey.timeCount")}get accuracyMode(){return this._accuracyMode}toggleAccuracyMode(){this._accuracyMode=!this._accuracyMode,qy.dispatch("geolocationSurvey.accuracyMode")}get averageRecordMode(){return this._averageRecordMode}get positionAverageInMapCRS(){if(this.averageRecordMode&&Object.keys(this._positionPointsRecord).length>0){let t=0,e=0,i=0;for(const s in this._positionPointsRecord)this._positionPointsRecord.hasOwnProperty(s)&&(t+=this._positionPointsRecord[s][0],e+=this._positionPointsRecord[s][1],i++);return Zi([t/i,e/i],"EPSG:4326",jy.projection)}}toggleAverageRecordMode(){this._averageRecordMode=!this._averageRecordMode,void 0===this._averageRecordModeCallback&&(this._averageRecordModeCallback=()=>{if(this._averageRecordMode&&this.averageRecordLimit>0){const t=Date.now();for(const e in this._positionPointsRecord)this._positionPointsRecord.hasOwnProperty(e)&&t-parseInt(e)>=1e3*this.averageRecordLimit&&delete this._positionPointsRecord[e];(!this.accuracyMode||jy.geolocation.accuracy<=this.accuracyLimit)&&(this._positionPointsRecord[t]=jy.geolocation.position)}}),this._averageRecordMode?qy.addListener(this._averageRecordModeCallback,"geolocation.position"):(qy.removeListener(this._averageRecordModeCallback,"geolocation.position"),this._positionPointsRecord={}),qy.dispatch("geolocationSurvey.averageRecordMode")}get beepMode(){return this._beepMode}toggleBeepMode(){this._beepMode=!this._beepMode,qy.dispatch("geolocationSurvey.beepMode")}get vibrateMode(){return this._vibrateMode}toggleVibrateMode(){this._vibrateMode=!this._vibrateMode,qy.dispatch("geolocationSurvey.vibrateMode")}}function fr(t,e){return t.interfaces_&&t.interfaces_.indexOf(e)>-1}class mr{constructor(t,e){this.low=e||0,this.high=t||0}static toBinaryString(t){let e,i="";for(e=2147483648;e>0;e>>>=1)i+=(t.high&e)===e?"1":"0";for(e=2147483648;e>0;e>>>=1)i+=(t.low&e)===e?"1":"0";return i}}function yr(){}function xr(){}yr.NaN=NaN,yr.isNaN=t=>Number.isNaN(t),yr.isInfinite=t=>!Number.isFinite(t),yr.MAX_VALUE=Number.MAX_VALUE,yr.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,yr.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,"function"==typeof Float64Array&&"function"==typeof Int32Array?function(){const t=2146435072,e=new Float64Array(1),i=new Int32Array(e.buffer);yr.doubleToLongBits=function(s){e[0]=s;let n=0|i[0],r=0|i[1];return(r&t)===t&&0!=(1048575&r)&&0!==n&&(n=0,r=2146959360),new mr(r,n)},yr.longBitsToDouble=function(t){return i[0]=t.low,i[1]=t.high,e[0]}}():function(){const t=Math.log2,e=Math.floor,i=Math.pow,s=function(){for(let s=53;s>0;s--){const n=i(2,s)-1;if(e(t(n))+1===s)return n}return 0}();yr.doubleToLongBits=function(n){let r,o,a,h,l,c,u,d,g;if(n<0||1/n===Number.NEGATIVE_INFINITY?(c=1<<31,n=-n):c=0,0===n)return g=0,d=c,new mr(d,g);if(n===1/0)return g=0,d=2146435072|c,new mr(d,g);if(n!=n)return g=0,d=2146959360,new mr(d,g);if(h=0,g=0,r=e(n),r>1)if(r<=s)h=e(t(r)),h<=20?(g=0,d=r<<20-h&1048575):(a=h-20,o=i(2,a),g=r%o<<32-a,d=r/o&1048575);else for(a=r,g=0;o=a/2,a=e(o),0!==a;)h++,g>>>=1,g|=(1&d)<<31,d>>>=1,o!==a&&(d|=524288);if(u=h+1023,l=0===r,r=n-r,h<52&&0!==r)for(a=0;;){if(o=2*r,o>=1?(r=o-1,l?(u--,l=!1):(a<<=1,a|=1,h++)):(r=o,l?0==--u&&(h++,l=!1):(a<<=1,h++)),20===h)d|=a,a=0;else if(52===h){g|=a;break}if(1===o){h<20?d|=a<<20-h:h<52&&(g|=a<<52-h);break}}return d|=u<<20,d|=c,new mr(d,g)},yr.longBitsToDouble=function(t){let e,s,n,r;const o=t.high,a=t.low,h=o&1<<31?-1:1;for(n=((2146435072&o)>>20)-1023,r=0,s=1<<19,e=1;e<=20;e++)o&s&&(r+=i(2,-e)),s>>>=1;for(s=1<<31,e=21;e<=52;e++)a&s&&(r+=i(2,-e)),s>>>=1;if(-1023===n){if(0===r)return 0*h;n=-1022}else{if(1024===n)return 0===r?h/0:NaN;r+=1}return h*r*i(2,n)}}();class vr{getM(t){if(this.hasM()){const e=this.getDimension()-this.getMeasures();return this.getOrdinate(t,e)}return yr.NaN}setOrdinate(t,e,i){}getZ(t){return this.hasZ()?this.getOrdinate(t,2):yr.NaN}size(){}getOrdinate(t,e){}getCoordinate(){}getCoordinateCopy(t){}createCoordinate(){}getDimension(){}hasM(){return this.getMeasures()>0}getX(t){}hasZ(){return this.getDimension()-this.getMeasures()>2}getMeasures(){return 0}expandEnvelope(t){}copy(){}getY(t){}toCoordinateArray(){}get interfaces_(){return[xr]}}vr.X=0,vr.Y=1,vr.Z=2,vr.M=3;class wr{create(){if(1===arguments.length)arguments[0]instanceof Array||fr(arguments[0],vr);else if(2===arguments.length);else if(3===arguments.length){const t=arguments[0],e=arguments[1];return this.create(t,e)}}}class Mr extends Error{constructor(t){super(t),this.name=Object.keys({Exception:Mr})[0]}toString(){return this.message}}class Er extends Mr{constructor(t){super(t),this.name=Object.keys({IllegalArgumentException:Er})[0]}}class Cr{filter(t){}}function Sr(){}function br(){}class Ir{static equalsWithTolerance(t,e,i){return Math.abs(t-e)<=i}}function Lr(){}class Tr extends Mr{constructor(t){super(t),this.name=Object.keys({RuntimeException:Tr})[0]}}class Nr extends Tr{constructor(){super(),Nr.constructor_.apply(this,arguments)}static constructor_(){if(0===arguments.length)Tr.constructor_.call(this);else if(1===arguments.length){const t=arguments[0];Tr.constructor_.call(this,t)}}}class Rr{static shouldNeverReachHere(){if(0===arguments.length)Rr.shouldNeverReachHere(null);else if(1===arguments.length){const t=arguments[0];throw new Nr("Should never reach here"+(null!==t?": "+t:""))}}static isTrue(){if(1===arguments.length){const t=arguments[0];Rr.isTrue(t,null)}else if(2===arguments.length){const t=arguments[1];if(!arguments[0])throw null===t?new Nr:new Nr(t)}}static equals(){if(2===arguments.length){const t=arguments[0],e=arguments[1];Rr.equals(t,e,null)}else if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];if(!e.equals(t))throw new Nr("Expected "+t+" but encountered "+e+(null!==i?": "+i:""))}}}const Pr=new ArrayBuffer(8),Or=new Float64Array(Pr),Ar=new Int32Array(Pr);class Fr{constructor(){Fr.constructor_.apply(this,arguments)}static constructor_(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)Fr.constructor_.call(this,0,0);else if(1===arguments.length){const t=arguments[0];Fr.constructor_.call(this,t.x,t.y,t.getZ())}else if(2===arguments.length){const t=arguments[0],e=arguments[1];Fr.constructor_.call(this,t,e,Fr.NULL_ORDINATE)}else if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];this.x=t,this.y=e,this.z=i}}static hashCode(t){return Or[0]=t,Ar[0]^Ar[1]}getM(){return yr.NaN}setOrdinate(t,e){switch(t){case Fr.X:this.x=e;break;case Fr.Y:this.y=e;break;case Fr.Z:this.setZ(e);break;default:throw new Er("Invalid ordinate index: "+t)}}equals2D(){if(1===arguments.length){const t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){const t=arguments[0],e=arguments[1];return!!Ir.equalsWithTolerance(this.x,t.x,e)&&!!Ir.equalsWithTolerance(this.y,t.y,e)}}setM(t){throw new Er("Invalid ordinate index: "+Fr.M)}getZ(){return this.z}getOrdinate(t){switch(t){case Fr.X:return this.x;case Fr.Y:return this.y;case Fr.Z:return this.getZ()}throw new Er("Invalid ordinate index: "+t)}equals3D(t){return this.x===t.x&&this.y===t.y&&(this.getZ()===t.getZ()||yr.isNaN(this.getZ())&&yr.isNaN(t.getZ()))}equals(t){return t instanceof Fr&&this.equals2D(t)}equalInZ(t,e){return Ir.equalsWithTolerance(this.getZ(),t.getZ(),e)}setX(t){this.x=t}compareTo(t){const e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0}getX(){return this.x}setZ(t){this.z=t}clone(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return Rr.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw t}}copy(){return new Fr(this)}toString(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}distance3D(t){const e=this.x-t.x,i=this.y-t.y,s=this.getZ()-t.getZ();return Math.sqrt(e*e+i*i+s*s)}getY(){return this.y}setY(t){this.y=t}distance(t){const e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}hashCode(){let t=17;return t=37*t+Fr.hashCode(this.x),t=37*t+Fr.hashCode(this.y),t}setCoordinate(t){this.x=t.x,this.y=t.y,this.z=t.getZ()}get interfaces_(){return[Sr,xr,br]}}class Dr{constructor(){Dr.constructor_.apply(this,arguments)}static constructor_(){if(this._dimensionsToTest=2,0===arguments.length)Dr.constructor_.call(this,2);else if(1===arguments.length){const t=arguments[0];if(2!==t&&3!==t)throw new Er("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}}static compare(t,e){return t<e?-1:t>e?1:yr.isNaN(t)?yr.isNaN(e)?0:-1:yr.isNaN(e)?1:0}compare(t,e){const i=Dr.compare(t.x,e.x);if(0!==i)return i;const s=Dr.compare(t.y,e.y);return 0!==s?s:this._dimensionsToTest<=2?0:Dr.compare(t.getZ(),e.getZ())}get interfaces_(){return[Lr]}}Fr.DimensionalComparator=Dr,Fr.NULL_ORDINATE=yr.NaN,Fr.X=0,Fr.Y=1,Fr.Z=2,Fr.M=3;class kr{constructor(){kr.constructor_.apply(this,arguments)}static constructor_(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof Fr){const t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof kr){const t=arguments[0];this.init(t)}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.init(t.x,e.x,t.y,e.y)}else if(4===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];this.init(t,e,i,s)}}static intersects(){if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];return i.x>=(t.x<e.x?t.x:e.x)&&i.x<=(t.x>e.x?t.x:e.x)&&i.y>=(t.y<e.y?t.y:e.y)&&i.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];let n=Math.min(i.x,s.x),r=Math.max(i.x,s.x),o=Math.min(t.x,e.x),a=Math.max(t.x,e.x);return!(o>r||a<n||(n=Math.min(i.y,s.y),r=Math.max(i.y,s.y),o=Math.min(t.y,e.y),a=Math.max(t.y,e.y),o>r||a<n))}}getArea(){return this.getWidth()*this.getHeight()}equals(t){if(!(t instanceof kr))return!1;const e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()}intersection(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new kr;const e=this._minx>t._minx?this._minx:t._minx,i=this._miny>t._miny?this._miny:t._miny,s=this._maxx<t._maxx?this._maxx:t._maxx,n=this._maxy<t._maxy?this._maxy:t._maxy;return new kr(e,s,i,n)}isNull(){return this._maxx<this._minx}getMaxX(){return this._maxx}covers(){if(1===arguments.length){if(arguments[0]instanceof Fr){const t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof kr){const t=arguments[0];return!this.isNull()&&!t.isNull()&&t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];return!this.isNull()&&t>=this._minx&&t<=this._maxx&&e>=this._miny&&e<=this._maxy}}intersects(){if(1===arguments.length){if(arguments[0]instanceof kr){const t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof Fr){const t=arguments[0];return this.intersects(t.x,t.y)}}else if(2===arguments.length){if(arguments[0]instanceof Fr&&arguments[1]instanceof Fr){const t=arguments[0],e=arguments[1];return!this.isNull()&&(!((t.x<e.x?t.x:e.x)>this._maxx)&&(!((t.x>e.x?t.x:e.x)<this._minx)&&(!((t.y<e.y?t.y:e.y)>this._maxy)&&!((t.y>e.y?t.y:e.y)<this._miny))))}if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){const t=arguments[0],e=arguments[1];return!this.isNull()&&!(t>this._maxx||t<this._minx||e>this._maxy||e<this._miny)}}}getMinY(){return this._miny}getDiameter(){if(this.isNull())return 0;const t=this.getWidth(),e=this.getHeight();return Math.sqrt(t*t+e*e)}getMinX(){return this._minx}expandToInclude(){if(1===arguments.length){if(arguments[0]instanceof Fr){const t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof kr){const t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.isNull()?(this._minx=t,this._maxx=t,this._miny=e,this._maxy=e):(t<this._minx&&(this._minx=t),t>this._maxx&&(this._maxx=t),e<this._miny&&(this._miny=e),e>this._maxy&&(this._maxy=e))}}minExtent(){if(this.isNull())return 0;const t=this.getWidth(),e=this.getHeight();return t<e?t:e}getWidth(){return this.isNull()?0:this._maxx-this._minx}compareTo(t){const e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0}translate(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)}copy(){return new kr(this)}toString(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}setToNull(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}disjoint(t){return!(!this.isNull()&&!t.isNull())||t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny}getHeight(){return this.isNull()?0:this._maxy-this._miny}maxExtent(){if(this.isNull())return 0;const t=this.getWidth(),e=this.getHeight();return t>e?t:e}expandBy(){if(1===arguments.length){const t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=e,this._maxy+=e,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}contains(){if(1===arguments.length){if(arguments[0]instanceof kr){const t=arguments[0];return this.covers(t)}if(arguments[0]instanceof Fr){const t=arguments[0];return this.covers(t)}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];return this.covers(t,e)}}centre(){return this.isNull()?null:new Fr((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}init(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof Fr){const t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof kr){const t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.init(t.x,e.x,t.y,e.y)}else if(4===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];t<e?(this._minx=t,this._maxx=e):(this._minx=e,this._maxx=t),i<s?(this._miny=i,this._maxy=s):(this._miny=s,this._maxy=i)}}getMaxY(){return this._maxy}distance(t){if(this.intersects(t))return 0;let e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);let i=0;return this._maxy<t._miny?i=t._miny-this._maxy:this._miny>t._maxy&&(i=this._miny-t._maxy),0===e?i:0===i?e:Math.sqrt(e*e+i*i)}hashCode(){let t=17;return t=37*t+Fr.hashCode(this._minx),t=37*t+Fr.hashCode(this._maxx),t=37*t+Fr.hashCode(this._miny),t=37*t+Fr.hashCode(this._maxy),t}get interfaces_(){return[Sr,br]}}class Gr{constructor(){Gr.constructor_.apply(this,arguments)}isGeometryCollection(){return this.getTypeCode()===Gr.TYPECODE_GEOMETRYCOLLECTION}getFactory(){return this._factory}getGeometryN(t){return this}getArea(){return 0}isRectangle(){return!1}equalsExact(t){return this===t||this.equalsExact(t,0)}geometryChanged(){this.apply(Gr.geometryChangedFilter)}geometryChangedAction(){this._envelope=null}equalsNorm(t){return null!==t&&this.norm().equalsExact(t.norm())}getLength(){return 0}getNumGeometries(){return 1}compareTo(){let t;if(1===arguments.length){const e=arguments[0];return t=e,this.getTypeCode()!==t.getTypeCode()?this.getTypeCode()-t.getTypeCode():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}if(2===arguments.length){const e=arguments[0],i=arguments[1];return t=e,this.getTypeCode()!==t.getTypeCode()?this.getTypeCode()-t.getTypeCode():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e,i)}}getUserData(){return this._userData}getSRID(){return this._SRID}getEnvelope(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}static checkNotGeometryCollection(t){if(t.getTypeCode()===Gr.TYPECODE_GEOMETRYCOLLECTION)throw new Er("This method does not support GeometryCollection arguments")}equal(t,e,i){return 0===i?t.equals(e):t.distance(e)<=i}norm(){const t=this.copy();return t.normalize(),t}reverse(){const t=this.reverseInternal();return null!=this.envelope&&(t.envelope=this.envelope.copy()),t.setSRID(this.getSRID()),t}copy(){const t=this.copyInternal();return t.envelope=null==this._envelope?null:this._envelope.copy(),t._SRID=this._SRID,t._userData=this._userData,t}getPrecisionModel(){return this._factory.getPrecisionModel()}getEnvelopeInternal(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new kr(this._envelope)}setSRID(t){this._SRID=t}setUserData(t){this._userData=t}compare(t,e){const i=t.iterator(),s=e.iterator();for(;i.hasNext()&&s.hasNext();){const t=i.next(),e=s.next(),n=t.compareTo(e);if(0!==n)return n}return i.hasNext()?1:s.hasNext()?-1:0}hashCode(){return this.getEnvelopeInternal().hashCode()}isEquivalentClass(t){return this.getTypeCode()==t.getTypeCode()}get interfaces_(){return[xr,Sr,br]}getClass(){return Gr}static hasNonEmptyElements(t){for(let e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1}static hasNullElements(t){for(let e=0;e<t.length;e++)if(null===t[e])return!0;return!1}}Gr.constructor_=function(t){t&&(this._envelope=null,this._userData=null,this._factory=t,this._SRID=t.getSRID())},Gr.TYPECODE_POINT=0,Gr.TYPECODE_MULTIPOINT=1,Gr.TYPECODE_LINESTRING=2,Gr.TYPECODE_LINEARRING=3,Gr.TYPECODE_MULTILINESTRING=4,Gr.TYPECODE_POLYGON=5,Gr.TYPECODE_MULTIPOLYGON=6,Gr.TYPECODE_GEOMETRYCOLLECTION=7,Gr.TYPENAME_POINT="Point",Gr.TYPENAME_MULTIPOINT="MultiPoint",Gr.TYPENAME_LINESTRING="LineString",Gr.TYPENAME_LINEARRING="LinearRing",Gr.TYPENAME_MULTILINESTRING="MultiLineString",Gr.TYPENAME_POLYGON="Polygon",Gr.TYPENAME_MULTIPOLYGON="MultiPolygon",Gr.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",Gr.geometryChangedFilter={get interfaces_(){return[Cr]},filter(t){t.geometryChangedAction()}};class zr{filter(t){}}class Br{static ofLine(t){const e=t.size();if(e<=1)return 0;let i=0;const s=new Fr;t.getCoordinate(0,s);let n=s.x,r=s.y;for(let o=1;o<e;o++){t.getCoordinate(o,s);const e=s.x,a=s.y,h=e-n,l=a-r;i+=Math.sqrt(h*h+l*l),n=e,r=a}return i}}class jr{}class qr{static copyCoord(t,e,i,s){const n=Math.min(t.getDimension(),i.getDimension());for(let r=0;r<n;r++)i.setOrdinate(s,r,t.getOrdinate(e,r))}static isRing(t){const e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,vr.X)===t.getOrdinate(e-1,vr.X)&&t.getOrdinate(0,vr.Y)===t.getOrdinate(e-1,vr.Y)}static scroll(){if(2===arguments.length){if(fr(arguments[0],vr)&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1];qr.scroll(t,e,qr.isRing(t))}else if(fr(arguments[0],vr)&&arguments[1]instanceof Fr){const t=arguments[0],e=arguments[1],i=qr.indexOf(e,t);if(i<=0)return null;qr.scroll(t,i)}}else if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];if(e<=0)return null;const s=t.copy(),n=i?t.size()-1:t.size();for(let i=0;i<n;i++)for(let r=0;r<t.getDimension();r++)t.setOrdinate(i,r,s.getOrdinate((e+i)%n,r));if(i)for(let e=0;e<t.getDimension();e++)t.setOrdinate(n,e,t.getOrdinate(0,e))}}static isEqual(t,e){const i=t.size();if(i!==e.size())return!1;const s=Math.min(t.getDimension(),e.getDimension());for(let n=0;n<i;n++)for(let i=0;i<s;i++){const s=t.getOrdinate(n,i),r=e.getOrdinate(n,i);if(!(t.getOrdinate(n,i)===e.getOrdinate(n,i)||yr.isNaN(s)&&yr.isNaN(r)))return!1}return!0}static minCoordinateIndex(){if(1===arguments.length){const t=arguments[0];return qr.minCoordinateIndex(t,0,t.size()-1)}if(3===arguments.length){const t=arguments[0],e=arguments[2];let i=-1,s=null;for(let n=arguments[1];n<=e;n++){const e=t.getCoordinate(n);(null===s||s.compareTo(e)>0)&&(s=e,i=n)}return i}}static extend(t,e,i){const s=t.create(i,e.getDimension()),n=e.size();if(qr.copy(e,0,s,0,n),n>0)for(let t=n;t<i;t++)qr.copy(e,n-1,s,t,1);return s}static reverse(t){const e=t.size()-1,i=Math.trunc(e/2);for(let s=0;s<=i;s++)qr.swap(t,s,e-s)}static swap(t,e,i){if(e===i)return null;for(let s=0;s<t.getDimension();s++){const n=t.getOrdinate(e,s);t.setOrdinate(e,s,t.getOrdinate(i,s)),t.setOrdinate(i,s,n)}}static copy(t,e,i,s,n){for(let r=0;r<n;r++)qr.copyCoord(t,e+r,i,s+r)}static ensureValidRing(t,e){const i=e.size();return 0===i?e:i<=3?qr.createClosedRing(t,e,4):e.getOrdinate(0,vr.X)===e.getOrdinate(i-1,vr.X)&&e.getOrdinate(0,vr.Y)===e.getOrdinate(i-1,vr.Y)?e:qr.createClosedRing(t,e,i+1)}static indexOf(t,e){for(let i=0;i<e.size();i++)if(t.x===e.getOrdinate(i,vr.X)&&t.y===e.getOrdinate(i,vr.Y))return i;return-1}static createClosedRing(t,e,i){const s=t.create(i,e.getDimension()),n=e.size();qr.copy(e,0,s,0,n);for(let t=n;t<i;t++)qr.copy(e,0,s,t,1);return s}static minCoordinate(t){let e=null;for(let i=0;i<t.size();i++){const s=t.getCoordinate(i);(null===e||e.compareTo(s)>0)&&(e=s)}return e}}class Ur extends Mr{constructor(t){super(t),this.name=Object.keys({UnsupportedOperationException:Ur})[0]}}class Yr{static isWhitespace(t){return t<=32&&t>=0||127===t}static toUpperCase(t){return t.toUpperCase()}}class Vr{static toDimensionSymbol(t){switch(t){case Vr.FALSE:return Vr.SYM_FALSE;case Vr.TRUE:return Vr.SYM_TRUE;case Vr.DONTCARE:return Vr.SYM_DONTCARE;case Vr.P:return Vr.SYM_P;case Vr.L:return Vr.SYM_L;case Vr.A:return Vr.SYM_A}throw new Er("Unknown dimension value: "+t)}static toDimensionValue(t){switch(Yr.toUpperCase(t)){case Vr.SYM_FALSE:return Vr.FALSE;case Vr.SYM_TRUE:return Vr.TRUE;case Vr.SYM_DONTCARE:return Vr.DONTCARE;case Vr.SYM_P:return Vr.P;case Vr.SYM_L:return Vr.L;case Vr.SYM_A:return Vr.A}throw new Er("Unknown dimension symbol: "+t)}}Vr.P=0,Vr.L=1,Vr.A=2,Vr.FALSE=-1,Vr.TRUE=-2,Vr.DONTCARE=-3,Vr.SYM_FALSE="F",Vr.SYM_TRUE="T",Vr.SYM_DONTCARE="*",Vr.SYM_P="0",Vr.SYM_L="1",Vr.SYM_A="2";class Xr{filter(t){}}class Wr{filter(t,e){}isDone(){}isGeometryChanged(){}}class $r extends Gr{constructor(){super(),$r.constructor_.apply(this,arguments)}static constructor_(){if(this._points=null,0===arguments.length);else if(2===arguments.length){const t=arguments[0],e=arguments[1];Gr.constructor_.call(this,e),this.init(t)}}computeEnvelopeInternal(){return this.isEmpty()?new kr:this._points.expandEnvelope(new kr)}isRing(){return this.isClosed()&&this.isSimple()}getCoordinates(){return this._points.toCoordinateArray()}copyInternal(){return new $r(this._points.copy(),this._factory)}equalsExact(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof Gr){const t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;const i=t;if(this._points.size()!==i._points.size())return!1;for(let t=0;t<this._points.size();t++)if(!this.equal(this._points.getCoordinate(t),i._points.getCoordinate(t),e))return!1;return!0}return super.equalsExact.apply(this,arguments)}normalize(){for(let t=0;t<Math.trunc(this._points.size()/2);t++){const e=this._points.size()-1-t;if(!this._points.getCoordinate(t).equals(this._points.getCoordinate(e))){if(this._points.getCoordinate(t).compareTo(this._points.getCoordinate(e))>0){const t=this._points.copy();qr.reverse(t),this._points=t}return null}}}getCoordinate(){return this.isEmpty()?null:this._points.getCoordinate(0)}getBoundaryDimension(){return this.isClosed()?Vr.FALSE:0}isClosed(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}reverseInternal(){const t=this._points.copy();return qr.reverse(t),this.getFactory().createLineString(t)}getEndPoint(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}getTypeCode(){return Gr.TYPECODE_LINESTRING}getDimension(){return 1}getLength(){return Br.ofLine(this._points)}getNumPoints(){return this._points.size()}compareToSameClass(){if(1===arguments.length){const t=arguments[0];let e=0,i=0;for(;e<this._points.size()&&i<t._points.size();){const s=this._points.getCoordinate(e).compareTo(t._points.getCoordinate(i));if(0!==s)return s;e++,i++}return e<this._points.size()?1:i<t._points.size()?-1:0}if(2===arguments.length){const t=arguments[0];return arguments[1].compare(this._points,t._points)}}apply(){if(fr(arguments[0],zr)){const t=arguments[0];for(let e=0;e<this._points.size();e++)t.filter(this._points.getCoordinate(e))}else if(fr(arguments[0],Wr)){const t=arguments[0];if(0===this._points.size())return null;for(let e=0;e<this._points.size()&&(t.filter(this._points,e),!t.isDone());e++);t.isGeometryChanged()&&this.geometryChanged()}else(fr(arguments[0],Xr)||fr(arguments[0],Cr))&&arguments[0].filter(this)}getBoundary(){throw new Ur}isEquivalentClass(t){return t instanceof $r}getCoordinateN(t){return this._points.getCoordinate(t)}getGeometryType(){return Gr.TYPENAME_LINESTRING}getCoordinateSequence(){return this._points}isEmpty(){return 0===this._points.size()}init(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new Er("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t}isCoordinate(t){for(let e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1}getStartPoint(){return this.isEmpty()?null:this.getPointN(0)}getPointN(t){return this.getFactory().createPoint(this._points.getCoordinate(t))}get interfaces_(){return[jr]}}class Hr{}class Kr extends Mr{constructor(t){super(t),this.name=Object.keys({IllegalStateException:Kr})[0]}}class Zr extends Gr{constructor(){super(),Zr.constructor_.apply(this,arguments)}static constructor_(){this._coordinates=null;const t=arguments[0],e=arguments[1];Gr.constructor_.call(this,e),this.init(t)}computeEnvelopeInternal(){if(this.isEmpty())return new kr;const t=new kr;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t}getCoordinates(){return this.isEmpty()?[]:[this.getCoordinate()]}copyInternal(){return new Zr(this._coordinates.copy(),this._factory)}equalsExact(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof Gr){const t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&(!(!this.isEmpty()||!t.isEmpty())||this.isEmpty()===t.isEmpty()&&this.equal(t.getCoordinate(),this.getCoordinate(),e))}return super.equalsExact.apply(this,arguments)}normalize(){}getCoordinate(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null}getBoundaryDimension(){return Vr.FALSE}reverseInternal(){return this.getFactory().createPoint(this._coordinates.copy())}getTypeCode(){return Gr.TYPECODE_POINT}getDimension(){return 0}getNumPoints(){return this.isEmpty()?0:1}getX(){if(null===this.getCoordinate())throw new Kr("getX called on empty Point");return this.getCoordinate().x}compareToSameClass(){if(1===arguments.length){const t=arguments[0];return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length){const t=arguments[0];return arguments[1].compare(this._coordinates,t._coordinates)}}apply(){if(fr(arguments[0],zr)){const t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(fr(arguments[0],Wr)){const t=arguments[0];if(this.isEmpty())return null;t.filter(this._coordinates,0),t.isGeometryChanged()&&this.geometryChanged()}else(fr(arguments[0],Xr)||fr(arguments[0],Cr))&&arguments[0].filter(this)}getBoundary(){return this.getFactory().createGeometryCollection()}getGeometryType(){return Gr.TYPENAME_POINT}getCoordinateSequence(){return this._coordinates}getY(){if(null===this.getCoordinate())throw new Kr("getY called on empty Point");return this.getCoordinate().y}isEmpty(){return 0===this._coordinates.size()}init(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),Rr.isTrue(t.size()<=1),this._coordinates=t}isSimple(){return!0}get interfaces_(){return[Hr]}}class Jr{static ofRing(){if(arguments[0]instanceof Array){const t=arguments[0];return Math.abs(Jr.ofRingSigned(t))}if(fr(arguments[0],vr)){const t=arguments[0];return Math.abs(Jr.ofRingSigned(t))}}static ofRingSigned(){if(arguments[0]instanceof Array){const t=arguments[0];if(t.length<3)return 0;let e=0;const i=t[0].x;for(let s=1;s<t.length-1;s++){const n=t[s].x-i,r=t[s+1].y;e+=n*(t[s-1].y-r)}return e/2}if(fr(arguments[0],vr)){const t=arguments[0],e=t.size();if(e<3)return 0;const i=new Fr,s=new Fr,n=new Fr;t.getCoordinate(0,s),t.getCoordinate(1,n);const r=s.x;n.x-=r;let o=0;for(let a=1;a<e-1;a++)i.y=s.y,s.x=n.x,s.y=n.y,t.getCoordinate(a+1,n),n.x-=r,o+=s.x*(i.y-n.y);return o/2}}}class Qr{add(){}addAll(){}isEmpty(){}iterator(){}size(){}toArray(){}remove(){}}class to extends Mr{constructor(t){super(t),this.name=Object.keys({IndexOutOfBoundsException:to})[0]}}class eo extends Qr{get(){}set(){}isEmpty(){}}class io extends Mr{constructor(t){super(t),this.name=Object.keys({NoSuchElementException:io})[0]}}class so extends eo{constructor(t){super(),this.array=[],t instanceof Qr&&this.addAll(t)}get interfaces_(){return[eo,Qr]}ensureCapacity(){}add(t){return 1===arguments.length?this.array.push(t):this.array.splice(arguments[0],0,arguments[1]),!0}clear(){this.array=[]}addAll(t){for(const e of t)this.array.push(e)}set(t,e){const i=this.array[t];return this.array[t]=e,i}iterator(){return new no(this)}get(t){if(t<0||t>=this.size())throw new to;return this.array[t]}isEmpty(){return 0===this.array.length}sort(t){t?this.array.sort(((e,i)=>t.compare(e,i))):this.array.sort()}size(){return this.array.length}toArray(){return this.array.slice()}remove(t){for(let e=0,i=this.array.length;e<i;e++)if(this.array[e]===t)return!!this.array.splice(e,1);return!1}[Symbol.iterator](){return this.array.values()}}class no{constructor(t){this.arrayList=t,this.position=0}next(){if(this.position===this.arrayList.size())throw new io;return this.arrayList.get(this.position++)}hasNext(){return this.position<this.arrayList.size()}set(t){return this.arrayList.set(this.position-1,t)}remove(){this.arrayList.remove(this.arrayList.get(this.position))}}class ro{static sort(){const t=arguments[0];if(1===arguments.length)t.sort(((t,e)=>t.compareTo(e)));else if(2===arguments.length)t.sort(((t,e)=>arguments[1].compare(t,e)));else if(3===arguments.length){const e=t.slice(arguments[1],arguments[2]);e.sort();const i=t.slice(0,arguments[1]).concat(e,t.slice(arguments[2],t.length));t.splice(0,t.length);for(const e of i)t.push(e)}else if(4===arguments.length){const e=t.slice(arguments[1],arguments[2]);e.sort(((t,e)=>arguments[3].compare(t,e)));const i=t.slice(0,arguments[1]).concat(e,t.slice(arguments[2],t.length));t.splice(0,t.length);for(const e of i)t.push(e)}}static asList(t){const e=new so;for(const i of t)e.add(i);return e}static copyOf(t,e){return t.slice(0,e)}}class oo{constructor(t){this.str=t}append(t){this.str+=t}setCharAt(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)}toString(){return this.str}}class ao{constructor(t){this.value=t}intValue(){return this.value}compareTo(t){return this.value<t?-1:this.value>t?1:0}static compare(t,e){return t<e?-1:t>e?1:0}static isNan(t){return Number.isNaN(t)}static valueOf(t){return new ao(t)}}class ho{constructor(){ho.constructor_.apply(this,arguments)}static constructor_(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){const t=arguments[0];this.init(t)}else if(arguments[0]instanceof ho){const t=arguments[0];this.init(t)}else if("string"==typeof arguments[0]){const t=arguments[0];ho.constructor_.call(this,ho.parse(t))}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.init(t,e)}}static determinant(){if("number"==typeof arguments[3]&&"number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];return ho.determinant(ho.valueOf(t),ho.valueOf(e),ho.valueOf(i),ho.valueOf(s))}if(arguments[3]instanceof ho&&arguments[2]instanceof ho&&arguments[0]instanceof ho&&arguments[1]instanceof ho){const t=arguments[1],e=arguments[2],i=arguments[3];return arguments[0].multiply(i).selfSubtract(t.multiply(e))}}static sqr(t){return ho.valueOf(t).selfMultiply(t)}static valueOf(){if("string"==typeof arguments[0]){const t=arguments[0];return ho.parse(t)}if("number"==typeof arguments[0])return new ho(arguments[0])}static sqrt(t){return ho.valueOf(t).sqrt()}static parse(t){let e=0;const i=t.length;for(;Yr.isWhitespace(t.charAt(e));)e++;let s=!1;if(e<i){const i=t.charAt(e);"-"!==i&&"+"!==i||(e++,"-"===i&&(s=!0))}const n=new ho;let r=0,o=0,a=0,h=!1;for(;!(e>=i);){const i=t.charAt(e);if(e++,Yr.isDigit(i)){const t=i-"0";n.selfMultiply(ho.TEN),n.selfAdd(t),r++}else{if("."!==i){if("e"===i||"E"===i){const i=t.substring(e);try{a=ao.parseInt(i)}catch(e){throw e instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+i+" in string "+t):e}break}throw new NumberFormatException("Unexpected character '"+i+"' at position "+e+" in string "+t)}o=r,h=!0}}let l=n;h||(o=r);const c=r-o-a;if(0===c)l=n;else if(c>0){const t=ho.TEN.pow(c);l=n.divide(t)}else if(c<0){const t=ho.TEN.pow(-c);l=n.multiply(t)}return s?l.negate():l}static createNaN(){return new ho(yr.NaN,yr.NaN)}static copy(t){return new ho(t)}static magnitude(t){const e=Math.abs(t),i=Math.log(e)/Math.log(10);let s=Math.trunc(Math.floor(i));return 10*Math.pow(10,s)<=e&&(s+=1),s}static stringOfChar(t,e){const i=new oo;for(let s=0;s<e;s++)i.append(t);return i.toString()}le(t){return this._hi<t._hi||this._hi===t._hi&&this._lo<=t._lo}extractSignificantDigits(t,e){let i=this.abs(),s=ho.magnitude(i._hi);const n=ho.TEN.pow(s);i=i.divide(n),i.gt(ho.TEN)?(i=i.divide(ho.TEN),s+=1):i.lt(ho.ONE)&&(i=i.multiply(ho.TEN),s-=1);const r=s+1,o=new oo,a=ho.MAX_PRINT_DIGITS-1;for(let e=0;e<=a;e++){t&&e===r&&o.append(".");const s=Math.trunc(i._hi);if(s<0)break;let n=!1,h=0;s>9?(n=!0,h="9"):h="0"+s,o.append(h),i=i.subtract(ho.valueOf(s)).multiply(ho.TEN),n&&i.selfAdd(ho.TEN);let l=!0;const c=ho.magnitude(i._hi);if(c<0&&Math.abs(c)>=a-e&&(l=!1),!l)break}return e[0]=s,o.toString()}sqr(){return this.multiply(this)}doubleValue(){return this._hi+this._lo}subtract(){if(arguments[0]instanceof ho){const t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){const t=arguments[0];return this.add(-t)}}equals(){if(1===arguments.length&&arguments[0]instanceof ho){const t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}}isZero(){return 0===this._hi&&0===this._lo}selfSubtract(){if(arguments[0]instanceof ho){const t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){const t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}}getSpecialNumberString(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}min(t){return this.le(t)?this:t}selfDivide(){if(1===arguments.length){if(arguments[0]instanceof ho){const t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){const t=arguments[0];return this.selfDivide(t,0)}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];let i=null,s=null,n=null,r=null,o=null,a=null,h=null,l=null;return o=this._hi/t,a=ho.SPLIT*o,i=a-o,l=ho.SPLIT*t,i=a-i,s=o-i,n=l-t,h=o*t,n=l-n,r=t-n,l=i*n-h+i*r+s*n+s*r,a=(this._hi-h-l+this._lo-o*e)/t,l=o+a,this._hi=l,this._lo=o-l+a,this}}dump(){return"DD<"+this._hi+", "+this._lo+">"}divide(){if(arguments[0]instanceof ho){const t=arguments[0];let e=null,i=null,s=null,n=null,r=null,o=null,a=null,h=null;return r=this._hi/t._hi,o=ho.SPLIT*r,e=o-r,h=ho.SPLIT*t._hi,e=o-e,i=r-e,s=h-t._hi,a=r*t._hi,s=h-s,n=t._hi-s,h=e*s-a+e*n+i*s+i*n,o=(this._hi-a-h+this._lo-r*t._lo)/t._hi,h=r+o,new ho(h,r-h+o)}if("number"==typeof arguments[0]){const t=arguments[0];return yr.isNaN(t)?ho.createNaN():ho.copy(this).selfDivide(t,0)}}ge(t){return this._hi>t._hi||this._hi===t._hi&&this._lo>=t._lo}pow(t){if(0===t)return ho.valueOf(1);let e=new ho(this),i=ho.valueOf(1),s=Math.abs(t);if(s>1)for(;s>0;)s%2==1&&i.selfMultiply(e),s/=2,s>0&&(e=e.sqr());else i=e;return t<0?i.reciprocal():i}ceil(){if(this.isNaN())return ho.NaN;const t=Math.ceil(this._hi);let e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new ho(t,e)}compareTo(t){const e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0}rint(){return this.isNaN()?this:this.add(.5).floor()}setValue(){if(arguments[0]instanceof ho){const t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){const t=arguments[0];return this.init(t),this}}max(t){return this.ge(t)?this:t}sqrt(){if(this.isZero())return ho.valueOf(0);if(this.isNegative())return ho.NaN;const t=1/Math.sqrt(this._hi),e=this._hi*t,i=ho.valueOf(e),s=this.subtract(i.sqr())._hi*(.5*t);return i.add(s)}selfAdd(){if(1===arguments.length){if(arguments[0]instanceof ho){const t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){const t=arguments[0];let e=null,i=null,s=null,n=null,r=null,o=null;return s=this._hi+t,r=s-this._hi,n=s-r,n=t-r+(this._hi-n),o=n+this._lo,e=s+o,i=o+(s-e),this._hi=e+i,this._lo=i+(e-this._hi),this}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];let i=null,s=null,n=null,r=null,o=null,a=null,h=null,l=null;o=this._hi+t,n=this._lo+e,h=o-this._hi,l=n-this._lo,a=o-h,r=n-l,a=t-h+(this._hi-a),r=e-l+(this._lo-r),h=a+n,i=o+h,s=h+(o-i),h=r+s;const c=i+h,u=h+(i-c);return this._hi=c,this._lo=u,this}}selfMultiply(){if(1===arguments.length){if(arguments[0]instanceof ho){const t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){const t=arguments[0];return this.selfMultiply(t,0)}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];let i=null,s=null,n=null,r=null,o=null,a=null;o=ho.SPLIT*this._hi,i=o-this._hi,a=ho.SPLIT*t,i=o-i,s=this._hi-i,n=a-t,o=this._hi*t,n=a-n,r=t-n,a=i*n-o+i*r+s*n+s*r+(this._hi*e+this._lo*t);const h=o+a;i=o-h;const l=a+i;return this._hi=h,this._lo=l,this}}selfSqr(){return this.selfMultiply(this)}floor(){if(this.isNaN())return ho.NaN;const t=Math.floor(this._hi);let e=0;return t===this._hi&&(e=Math.floor(this._lo)),new ho(t,e)}negate(){return this.isNaN()?this:new ho(-this._hi,-this._lo)}clone(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return null;throw t}}multiply(){if(arguments[0]instanceof ho){const t=arguments[0];return t.isNaN()?ho.createNaN():ho.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){const t=arguments[0];return yr.isNaN(t)?ho.createNaN():ho.copy(this).selfMultiply(t,0)}}isNaN(){return yr.isNaN(this._hi)}intValue(){return Math.trunc(this._hi)}toString(){const t=ho.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()}toStandardNotation(){const t=this.getSpecialNumberString();if(null!==t)return t;const e=new Array(1).fill(null),i=this.extractSignificantDigits(!0,e),s=e[0]+1;let n=i;if("."===i.charAt(0))n="0"+i;else if(s<0)n="0."+ho.stringOfChar("0",-s)+i;else if(-1===i.indexOf(".")){const t=s-i.length;n=i+ho.stringOfChar("0",t)+".0"}return this.isNegative()?"-"+n:n}reciprocal(){let t=null,e=null,i=null,s=null,n=null,r=null,o=null,a=null;n=1/this._hi,r=ho.SPLIT*n,t=r-n,a=ho.SPLIT*this._hi,t=r-t,e=n-t,i=a-this._hi,o=n*this._hi,i=a-i,s=this._hi-i,a=t*i-o+t*s+e*i+e*s,r=(1-o-a-n*this._lo)/this._hi;const h=n+r;return new ho(h,n-h+r)}toSciNotation(){if(this.isZero())return ho.SCI_NOT_ZERO;const t=this.getSpecialNumberString();if(null!==t)return t;const e=new Array(1).fill(null),i=this.extractSignificantDigits(!1,e),s=ho.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===i.charAt(0))throw new Kr("Found leading zero: "+i);let n="";i.length>1&&(n=i.substring(1));const r=i.charAt(0)+"."+n;return this.isNegative()?"-"+r+s:r+s}abs(){return this.isNaN()?ho.NaN:this.isNegative()?this.negate():new ho(this)}isPositive(){return this._hi>0||0===this._hi&&this._lo>0}lt(t){return this._hi<t._hi||this._hi===t._hi&&this._lo<t._lo}add(){if(arguments[0]instanceof ho){const t=arguments[0];return ho.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){const t=arguments[0];return ho.copy(this).selfAdd(t)}}init(){if(1===arguments.length){if("number"==typeof arguments[0]){const t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof ho){const t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this._hi=t,this._lo=e}}gt(t){return this._hi>t._hi||this._hi===t._hi&&this._lo>t._lo}isNegative(){return this._hi<0||0===this._hi&&this._lo<0}trunc(){return this.isNaN()?ho.NaN:this.isPositive()?this.floor():this.ceil()}signum(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}get interfaces_(){return[br,Sr,xr]}}ho.PI=new ho(3.141592653589793,12246467991473532e-32),ho.TWO_PI=new ho(6.283185307179586,24492935982947064e-32),ho.PI_2=new ho(1.5707963267948966,6123233995736766e-32),ho.E=new ho(2.718281828459045,14456468917292502e-32),ho.NaN=new ho(yr.NaN,yr.NaN),ho.EPS=123259516440783e-46,ho.SPLIT=134217729,ho.MAX_PRINT_DIGITS=32,ho.TEN=ho.valueOf(10),ho.ONE=ho.valueOf(1),ho.SCI_NOT_EXPONENT_CHAR="E",ho.SCI_NOT_ZERO="0.0E0";class lo{static orientationIndex(t,e,i){const s=lo.orientationIndexFilter(t,e,i);if(s<=1)return s;const n=ho.valueOf(e.x).selfAdd(-t.x),r=ho.valueOf(e.y).selfAdd(-t.y),o=ho.valueOf(i.x).selfAdd(-e.x),a=ho.valueOf(i.y).selfAdd(-e.y);return n.selfMultiply(a).selfSubtract(r.selfMultiply(o)).signum()}static signOfDet2x2(){if(arguments[3]instanceof ho&&arguments[2]instanceof ho&&arguments[0]instanceof ho&&arguments[1]instanceof ho){const t=arguments[1],e=arguments[2],i=arguments[3];return arguments[0].multiply(i).selfSubtract(t.multiply(e)).signum()}if("number"==typeof arguments[3]&&"number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3],n=ho.valueOf(t),r=ho.valueOf(e),o=ho.valueOf(i),a=ho.valueOf(s);return n.multiply(a).selfSubtract(r.multiply(o)).signum()}}static intersection(t,e,i,s){const n=new ho(t.y).selfSubtract(e.y),r=new ho(e.x).selfSubtract(t.x),o=new ho(t.x).selfMultiply(e.y).selfSubtract(new ho(e.x).selfMultiply(t.y)),a=new ho(i.y).selfSubtract(s.y),h=new ho(s.x).selfSubtract(i.x),l=new ho(i.x).selfMultiply(s.y).selfSubtract(new ho(s.x).selfMultiply(i.y)),c=r.multiply(l).selfSubtract(h.multiply(o)),u=a.multiply(o).selfSubtract(n.multiply(l)),d=n.multiply(h).selfSubtract(a.multiply(r)),g=c.selfDivide(d).doubleValue(),p=u.selfDivide(d).doubleValue();return yr.isNaN(g)||yr.isInfinite(g)||yr.isNaN(p)||yr.isInfinite(p)?null:new Fr(g,p)}static orientationIndexFilter(t,e,i){let s=null;const n=(t.x-i.x)*(e.y-i.y),r=(t.y-i.y)*(e.x-i.x),o=n-r;if(n>0){if(r<=0)return lo.signum(o);s=n+r}else{if(!(n<0))return lo.signum(o);if(r>=0)return lo.signum(o);s=-n-r}const a=lo.DP_SAFE_EPSILON*s;return o>=a||-o>=a?lo.signum(o):2}static signum(t){return t>0?1:t<0?-1:0}}lo.DP_SAFE_EPSILON=1e-15;class co{static index(t,e,i){return lo.orientationIndex(t,e,i)}static isCCW(){if(arguments[0]instanceof Array){const t=arguments[0],e=t.length-1;if(e<3)throw new Er("Ring has fewer than 4 points, so orientation cannot be determined");let i=t[0],s=0;for(let n=1;n<=e;n++){const e=t[n];e.y>i.y&&(i=e,s=n)}let n=s;do{n-=1,n<0&&(n=e)}while(t[n].equals2D(i)&&n!==s);let r=s;do{r=(r+1)%e}while(t[r].equals2D(i)&&r!==s);const o=t[n],a=t[r];if(o.equals2D(i)||a.equals2D(i)||o.equals2D(a))return!1;const h=co.index(o,i,a);let l=null;return l=0===h?o.x>a.x:h>0,l}if(fr(arguments[0],vr)){const t=arguments[0],e=t.size()-1;if(e<3)throw new Er("Ring has fewer than 4 points, so orientation cannot be determined");let i=t.getCoordinate(0),s=0;for(let n=1;n<=e;n++){const e=t.getCoordinate(n);e.y>i.y&&(i=e,s=n)}let n=null,r=s;do{r-=1,r<0&&(r=e),n=t.getCoordinate(r)}while(n.equals2D(i)&&r!==s);let o=null,a=s;do{a=(a+1)%e,o=t.getCoordinate(a)}while(o.equals2D(i)&&a!==s);if(n.equals2D(i)||o.equals2D(i)||n.equals2D(o))return!1;const h=co.index(n,i,o);let l=null;return l=0===h?n.x>o.x:h>0,l}}}co.CLOCKWISE=-1,co.RIGHT=co.CLOCKWISE,co.COUNTERCLOCKWISE=1,co.LEFT=co.COUNTERCLOCKWISE,co.COLLINEAR=0,co.STRAIGHT=co.COLLINEAR;class uo{}class go extends Gr{constructor(){super(),go.constructor_.apply(this,arguments)}static constructor_(){this._shell=null,this._holes=null;let t=arguments[0],e=arguments[1],i=arguments[2];if(Gr.constructor_.call(this,i),null===t&&(t=this.getFactory().createLinearRing()),null===e&&(e=[]),Gr.hasNullElements(e))throw new Er("holes must not contain null elements");if(t.isEmpty()&&Gr.hasNonEmptyElements(e))throw new Er("shell is empty but holes are not");this._shell=t,this._holes=e}computeEnvelopeInternal(){return this._shell.getEnvelopeInternal()}getCoordinates(){if(this.isEmpty())return[];const t=new Array(this.getNumPoints()).fill(null);let e=-1;const i=this._shell.getCoordinates();for(let s=0;s<i.length;s++)e++,t[e]=i[s];for(let i=0;i<this._holes.length;i++){const s=this._holes[i].getCoordinates();for(let i=0;i<s.length;i++)e++,t[e]=s[i]}return t}getArea(){let t=0;t+=Jr.ofRing(this._shell.getCoordinateSequence());for(let e=0;e<this._holes.length;e++)t-=Jr.ofRing(this._holes[e].getCoordinateSequence());return t}copyInternal(){const t=this._shell.copy(),e=new Array(this._holes.length).fill(null);for(let t=0;t<this._holes.length;t++)e[t]=this._holes[t].copy();return new go(t,e,this._factory)}isRectangle(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;const t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal();for(let i=0;i<5;i++){const s=t.getX(i);if(s!==e.getMinX()&&s!==e.getMaxX())return!1;const n=t.getY(i);if(n!==e.getMinY()&&n!==e.getMaxY())return!1}let i=t.getX(0),s=t.getY(0);for(let e=1;e<=4;e++){const n=t.getX(e),r=t.getY(e);if(n!==i==(r!==s))return!1;i=n,s=r}return!0}equalsExact(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof Gr){const t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;const i=t,s=this._shell,n=i._shell;if(!s.equalsExact(n,e))return!1;if(this._holes.length!==i._holes.length)return!1;for(let t=0;t<this._holes.length;t++)if(!this._holes[t].equalsExact(i._holes[t],e))return!1;return!0}return super.equalsExact.apply(this,arguments)}normalize(){if(0===arguments.length){this._shell=this.normalized(this._shell,!0);for(let t=0;t<this._holes.length;t++)this._holes[t]=this.normalized(this._holes[t],!1);ro.sort(this._holes)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];if(t.isEmpty())return null;const i=t.getCoordinateSequence(),s=qr.minCoordinateIndex(i,0,i.size()-2);qr.scroll(i,s,!0),co.isCCW(i)===e&&qr.reverse(i)}}getCoordinate(){return this._shell.getCoordinate()}getNumInteriorRing(){return this._holes.length}getBoundaryDimension(){return 1}reverseInternal(){const t=this.getExteriorRing().reverse(),e=new Array(this.getNumInteriorRing()).fill(null);for(let t=0;t<e.length;t++)e[t]=this.getInteriorRingN(t).reverse();return this.getFactory().createPolygon(t,e)}getTypeCode(){return Gr.TYPECODE_POLYGON}getDimension(){return 2}getLength(){let t=0;t+=this._shell.getLength();for(let e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t}getNumPoints(){let t=this._shell.getNumPoints();for(let e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t}convexHull(){return this.getExteriorRing().convexHull()}normalized(t,e){const i=t.copy();return this.normalize(i,e),i}compareToSameClass(){if(1===arguments.length){const t=arguments[0],e=this._shell,i=t._shell;return e.compareToSameClass(i)}if(2===arguments.length){const t=arguments[1],e=arguments[0],i=this._shell,s=e._shell,n=i.compareToSameClass(s,t);if(0!==n)return n;const r=this.getNumInteriorRing(),o=e.getNumInteriorRing();let a=0;for(;a<r&&a<o;){const i=this.getInteriorRingN(a),s=e.getInteriorRingN(a),n=i.compareToSameClass(s,t);if(0!==n)return n;a++}return a<r?1:a<o?-1:0}}apply(){if(fr(arguments[0],zr)){const t=arguments[0];this._shell.apply(t);for(let e=0;e<this._holes.length;e++)this._holes[e].apply(t)}else if(fr(arguments[0],Wr)){const t=arguments[0];if(this._shell.apply(t),!t.isDone())for(let e=0;e<this._holes.length&&(this._holes[e].apply(t),!t.isDone());e++);t.isGeometryChanged()&&this.geometryChanged()}else if(fr(arguments[0],Xr))arguments[0].filter(this);else if(fr(arguments[0],Cr)){const t=arguments[0];t.filter(this),this._shell.apply(t);for(let e=0;e<this._holes.length;e++)this._holes[e].apply(t)}}getBoundary(){if(this.isEmpty())return this.getFactory().createMultiLineString();const t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(let e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)}getGeometryType(){return Gr.TYPENAME_POLYGON}getExteriorRing(){return this._shell}isEmpty(){return this._shell.isEmpty()}getInteriorRingN(t){return this._holes[t]}get interfaces_(){return[uo]}}class po extends Qr{contains(){}}class _o extends po{}class fo extends _o{constructor(t){super(),this.array=[],t instanceof Qr&&this.addAll(t)}contains(t){for(const e of this.array)if(0===e.compareTo(t))return!0;return!1}add(t){if(this.contains(t))return!1;for(let e=0,i=this.array.length;e<i;e++)if(1===this.array[e].compareTo(t))return!!this.array.splice(e,0,t);return this.array.push(t),!0}addAll(t){for(const e of t)this.add(e);return!0}remove(){throw new Ur}size(){return this.array.length}isEmpty(){return 0===this.array.length}toArray(){return this.array.slice()}iterator(){return new mo(this.array)}}class mo{constructor(t){this.array=t,this.position=0}next(){if(this.position===this.array.length)throw new io;return this.array[this.position++]}hasNext(){return this.position<this.array.length}remove(){throw new Ur}}class yo extends Gr{constructor(){super(),yo.constructor_.apply(this,arguments)}static constructor_(){if(this._geometries=null,0===arguments.length);else if(2===arguments.length){let t=arguments[0],e=arguments[1];if(Gr.constructor_.call(this,e),null===t&&(t=[]),Gr.hasNullElements(t))throw new Er("geometries must not contain null elements");this._geometries=t}}computeEnvelopeInternal(){const t=new kr;for(let e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t}getGeometryN(t){return this._geometries[t]}getCoordinates(){const t=new Array(this.getNumPoints()).fill(null);let e=-1;for(let i=0;i<this._geometries.length;i++){const s=this._geometries[i].getCoordinates();for(let i=0;i<s.length;i++)e++,t[e]=s[i]}return t}getArea(){let t=0;for(let e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t}copyInternal(){const t=new Array(this._geometries.length).fill(null);for(let e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new yo(t,this._factory)}equalsExact(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof Gr){const t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;const i=t;if(this._geometries.length!==i._geometries.length)return!1;for(let t=0;t<this._geometries.length;t++)if(!this._geometries[t].equalsExact(i._geometries[t],e))return!1;return!0}return super.equalsExact.apply(this,arguments)}normalize(){for(let t=0;t<this._geometries.length;t++)this._geometries[t].normalize();ro.sort(this._geometries)}getCoordinate(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}getBoundaryDimension(){let t=Vr.FALSE;for(let e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t}reverseInternal(){const t=this._geometries.length,e=new so(t);for(let i=0;i<t;i++)e.add(this._geometries[i].reverse());return this.getFactory().buildGeometry(e)}getTypeCode(){return Gr.TYPECODE_GEOMETRYCOLLECTION}getDimension(){let t=Vr.FALSE;for(let e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t}getLength(){let t=0;for(let e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t}getNumPoints(){let t=0;for(let e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t}getNumGeometries(){return this._geometries.length}compareToSameClass(){if(1===arguments.length){const t=arguments[0],e=new fo(ro.asList(this._geometries)),i=new fo(ro.asList(t._geometries));return this.compare(e,i)}if(2===arguments.length){const t=arguments[1],e=arguments[0],i=this.getNumGeometries(),s=e.getNumGeometries();let n=0;for(;n<i&&n<s;){const i=this.getGeometryN(n),s=e.getGeometryN(n),r=i.compareToSameClass(s,t);if(0!==r)return r;n++}return n<i?1:n<s?-1:0}}apply(){if(fr(arguments[0],zr)){const t=arguments[0];for(let e=0;e<this._geometries.length;e++)this._geometries[e].apply(t)}else if(fr(arguments[0],Wr)){const t=arguments[0];if(0===this._geometries.length)return null;for(let e=0;e<this._geometries.length&&(this._geometries[e].apply(t),!t.isDone());e++);t.isGeometryChanged()&&this.geometryChanged()}else if(fr(arguments[0],Xr)){const t=arguments[0];t.filter(this);for(let e=0;e<this._geometries.length;e++)this._geometries[e].apply(t)}else if(fr(arguments[0],Cr)){const t=arguments[0];t.filter(this);for(let e=0;e<this._geometries.length;e++)this._geometries[e].apply(t)}}getBoundary(){return Gr.checkNotGeometryCollection(this),Rr.shouldNeverReachHere(),null}getGeometryType(){return Gr.TYPENAME_GEOMETRYCOLLECTION}isEmpty(){for(let t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0}}class xo extends yo{constructor(){super(),xo.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];yo.constructor_.call(this,t,e)}copyInternal(){const t=new Array(this._geometries.length).fill(null);for(let e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new xo(t,this._factory)}isValid(){return!0}equalsExact(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof Gr){const t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&super.equalsExact.call(this,t,e)}return super.equalsExact.apply(this,arguments)}getCoordinate(){if(1===arguments.length&&Number.isInteger(arguments[0])){const t=arguments[0];return this._geometries[t].getCoordinate()}return super.getCoordinate.apply(this,arguments)}getBoundaryDimension(){return Vr.FALSE}getTypeCode(){return Gr.TYPECODE_MULTIPOINT}getDimension(){return 0}getBoundary(){return this.getFactory().createGeometryCollection()}getGeometryType(){return Gr.TYPENAME_MULTIPOINT}get interfaces_(){return[Hr]}}class vo extends $r{constructor(){super(),vo.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];$r.constructor_.call(this,t,e),this.validateConstruction()}copyInternal(){return new vo(this._points.copy(),this._factory)}getBoundaryDimension(){return Vr.FALSE}isClosed(){return!!this.isEmpty()||super.isClosed.call(this)}reverseInternal(){const t=this._points.copy();return qr.reverse(t),this.getFactory().createLinearRing(t)}getTypeCode(){return Gr.TYPECODE_LINEARRING}validateConstruction(){if(!this.isEmpty()&&!super.isClosed.call(this))throw new Er("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<vo.MINIMUM_VALID_SIZE)throw new Er("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}getGeometryType(){return Gr.TYPENAME_LINEARRING}}vo.MINIMUM_VALID_SIZE=4;class wo extends Fr{constructor(){super(),wo.constructor_.apply(this,arguments)}static constructor_(){if(0===arguments.length)Fr.constructor_.call(this);else if(1===arguments.length){if(arguments[0]instanceof wo){const t=arguments[0];Fr.constructor_.call(this,t.x,t.y)}else if(arguments[0]instanceof Fr){const t=arguments[0];Fr.constructor_.call(this,t.x,t.y)}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];Fr.constructor_.call(this,t,e,Fr.NULL_ORDINATE)}}setOrdinate(t,e){switch(t){case wo.X:this.x=e;break;case wo.Y:this.y=e;break;default:throw new Er("Invalid ordinate index: "+t)}}getZ(){return Fr.NULL_ORDINATE}getOrdinate(t){switch(t){case wo.X:return this.x;case wo.Y:return this.y}throw new Er("Invalid ordinate index: "+t)}setZ(t){throw new Er("CoordinateXY dimension 2 does not support z-ordinate")}copy(){return new wo(this)}toString(){return"("+this.x+", "+this.y+")"}setCoordinate(t){this.x=t.x,this.y=t.y,this.z=t.getZ()}}wo.X=0,wo.Y=1,wo.Z=-1,wo.M=-1;class Mo extends Fr{constructor(){super(),Mo.constructor_.apply(this,arguments)}static constructor_(){if(this._m=null,0===arguments.length)Fr.constructor_.call(this),this._m=0;else if(1===arguments.length){if(arguments[0]instanceof Mo){const t=arguments[0];Fr.constructor_.call(this,t.x,t.y),this._m=t._m}else if(arguments[0]instanceof Fr){const t=arguments[0];Fr.constructor_.call(this,t.x,t.y),this._m=this.getM()}}else if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];Fr.constructor_.call(this,t,e,Fr.NULL_ORDINATE),this._m=i}}getM(){return this._m}setOrdinate(t,e){switch(t){case Mo.X:this.x=e;break;case Mo.Y:this.y=e;break;case Mo.M:this._m=e;break;default:throw new Er("Invalid ordinate index: "+t)}}setM(t){this._m=t}getZ(){return Fr.NULL_ORDINATE}getOrdinate(t){switch(t){case Mo.X:return this.x;case Mo.Y:return this.y;case Mo.M:return this._m}throw new Er("Invalid ordinate index: "+t)}setZ(t){throw new Er("CoordinateXY dimension 2 does not support z-ordinate")}copy(){return new Mo(this)}toString(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}setCoordinate(t){this.x=t.x,this.y=t.y,this.z=t.getZ(),this._m=t.getM()}}Mo.X=0,Mo.Y=1,Mo.Z=-1,Mo.M=2;class Eo extends Fr{constructor(){super(),Eo.constructor_.apply(this,arguments)}static constructor_(){if(this._m=null,0===arguments.length)Fr.constructor_.call(this),this._m=0;else if(1===arguments.length){if(arguments[0]instanceof Eo){const t=arguments[0];Fr.constructor_.call(this,t),this._m=t._m}else if(arguments[0]instanceof Fr){const t=arguments[0];Fr.constructor_.call(this,t),this._m=this.getM()}}else if(4===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];Fr.constructor_.call(this,t,e,i),this._m=s}}getM(){return this._m}setOrdinate(t,e){switch(t){case Fr.X:this.x=e;break;case Fr.Y:this.y=e;break;case Fr.Z:this.z=e;break;case Fr.M:this._m=e;break;default:throw new Er("Invalid ordinate index: "+t)}}setM(t){this._m=t}getOrdinate(t){switch(t){case Fr.X:return this.x;case Fr.Y:return this.y;case Fr.Z:return this.getZ();case Fr.M:return this.getM()}throw new Er("Invalid ordinate index: "+t)}copy(){return new Eo(this)}toString(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}setCoordinate(t){this.x=t.x,this.y=t.y,this.z=t.getZ(),this._m=t.getM()}}class Co{static measures(t){return t instanceof wo?0:t instanceof Mo||t instanceof Eo?1:0}static dimension(t){return t instanceof wo?2:t instanceof Mo?3:t instanceof Eo?4:3}static create(){if(1===arguments.length){const t=arguments[0];return Co.create(t,0)}if(2===arguments.length){const t=arguments[0],e=arguments[1];return 2===t?new wo:3===t&&0===e?new Fr:3===t&&1===e?new Mo:4===t&&1===e?new Eo:new Fr}}}class So extends so{constructor(){super(),So.constructor_.apply(this,arguments)}static constructor_(){if(0===arguments.length);else if(1===arguments.length){const t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.ensureCapacity(t.length),this.add(t,e)}}getCoordinate(t){return this.get(t)}addAll(){if(2===arguments.length&&"boolean"==typeof arguments[1]&&fr(arguments[0],Qr)){const t=arguments[1];let e=!1;for(let i=arguments[0].iterator();i.hasNext();)this.add(i.next(),t),e=!0;return e}return super.addAll.apply(this,arguments)}clone(){const t=super.clone.call(this);for(let e=0;e<this.size();e++)t.add(e,this.get(e).clone());return t}toCoordinateArray(){if(0===arguments.length)return this.toArray(So.coordArrayType);if(1===arguments.length){if(arguments[0])return this.toArray(So.coordArrayType);const t=this.size(),e=new Array(t).fill(null);for(let i=0;i<t;i++)e[i]=this.get(t-i-1);return e}}add(){if(1===arguments.length){const t=arguments[0];return super.add.call(this,t)}if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){const t=arguments[0],e=arguments[1];return this.add(t,e,!0),!0}if(arguments[0]instanceof Fr&&"boolean"==typeof arguments[1]){const t=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(t))return null;super.add.call(this,t)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){const t=arguments[0],e=arguments[1];return this.add(t,e),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){const t=arguments[0],e=arguments[1];if(arguments[2])for(let i=0;i<t.length;i++)this.add(t[i],e);else for(let i=t.length-1;i>=0;i--)this.add(t[i],e);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof Fr){const t=arguments[0],e=arguments[1];if(!arguments[2]){const i=this.size();if(i>0){if(t>0&&this.get(t-1).equals2D(e))return null;if(t<i&&this.get(t).equals2D(e))return null}}super.add.call(this,t,e)}}else if(4===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];let n=1;i>s&&(n=-1);for(let r=i;r!==s;r+=n)this.add(t[r],e);return!0}}closeRing(){if(this.size()>0){const t=this.get(0).copy();this.add(t,!1)}}}So.coordArrayType=new Array(0).fill(null);class bo{static log10(t){const e=Math.log(t);return yr.isInfinite(e)||yr.isNaN(e)?e:e/bo.LOG_10}static min(t,e,i,s){let n=t;return e<n&&(n=e),i<n&&(n=i),s<n&&(n=s),n}static clamp(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){const t=arguments[0],e=arguments[1],i=arguments[2];return t<e?e:t>i?i:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1],i=arguments[2];return t<e?e:t>i?i:t}}static wrap(t,e){return t<0?e- -t%e:t%e}static max(){if(3===arguments.length){const t=arguments[1],e=arguments[2];let i=arguments[0];return t>i&&(i=t),e>i&&(i=e),i}if(4===arguments.length){const t=arguments[1],e=arguments[2],i=arguments[3];let s=arguments[0];return t>s&&(s=t),e>s&&(s=e),i>s&&(s=i),s}}static average(t,e){return(t+e)/2}}bo.LOG_10=Math.log(10);class Io{static arraycopy(t,e,i,s,n){let r=0;for(let o=e;o<e+n;o++)i[s+r]=t[o],r++}static getProperty(t){return{"line.separator":"\n"}[t]}}class Lo{static isRing(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))}static ptNotInList(t,e){for(let i=0;i<t.length;i++){const s=t[i];if(Lo.indexOf(s,e)<0)return s}return null}static scroll(t,e){const i=Lo.indexOf(e,t);if(i<0)return null;const s=new Array(t.length).fill(null);Io.arraycopy(t,i,s,0,t.length-i),Io.arraycopy(t,0,s,t.length-i,i),Io.arraycopy(s,0,t,0,t.length)}static equals(){if(2===arguments.length){const t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].equals(e[i]))return!1;return!0}if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(0!==i.compare(t[s],e[s]))return!1;return!0}}static intersection(t,e){const i=new So;for(let s=0;s<t.length;s++)e.intersects(t[s])&&i.add(t[s],!0);return i.toCoordinateArray()}static measures(t){if(null===t||0===t.length)return 0;let e=0;for(const i of t)e=Math.max(e,Co.measures(i));return e}static hasRepeatedPoints(t){for(let e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1}static removeRepeatedPoints(t){return Lo.hasRepeatedPoints(t)?new So(t,!1).toCoordinateArray():t}static reverse(t){const e=t.length-1,i=Math.trunc(e/2);for(let s=0;s<=i;s++){const i=t[s];t[s]=t[e-s],t[e-s]=i}}static removeNull(t){let e=0;for(let i=0;i<t.length;i++)null!==t[i]&&e++;const i=new Array(e).fill(null);if(0===e)return i;let s=0;for(let e=0;e<t.length;e++)null!==t[e]&&(i[s++]=t[e]);return i}static copyDeep(){if(1===arguments.length){const t=arguments[0],e=new Array(t.length).fill(null);for(let i=0;i<t.length;i++)e[i]=t[i].copy();return e}if(5===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3],n=arguments[4];for(let r=0;r<n;r++)i[s+r]=t[e+r].copy()}}static isEqualReversed(t,e){for(let i=0;i<t.length;i++){const s=t[i],n=e[t.length-i-1];if(0!==s.compareTo(n))return!1}return!0}static envelope(t){const e=new kr;for(let i=0;i<t.length;i++)e.expandToInclude(t[i]);return e}static toCoordinateArray(t){return t.toArray(Lo.coordArrayType)}static dimension(t){if(null===t||0===t.length)return 3;let e=0;for(const i of t)e=Math.max(e,Co.dimension(i));return e}static atLeastNCoordinatesOrNothing(t,e){return e.length>=t?e:[]}static indexOf(t,e){for(let i=0;i<e.length;i++)if(t.equals(e[i]))return i;return-1}static increasingDirection(t){for(let e=0;e<Math.trunc(t.length/2);e++){const i=t.length-1-e,s=t[e].compareTo(t[i]);if(0!==s)return s}return 1}static compare(t,e){let i=0;for(;i<t.length&&i<e.length;){const s=t[i].compareTo(e[i]);if(0!==s)return s;i++}return i<e.length?-1:i<t.length?1:0}static minCoordinate(t){let e=null;for(let i=0;i<t.length;i++)(null===e||e.compareTo(t[i])>0)&&(e=t[i]);return e}static extract(t,e,i){e=bo.clamp(e,0,t.length);let s=(i=bo.clamp(i,-1,t.length))-e+1;i<0&&(s=0),e>=t.length&&(s=0),i<e&&(s=0);const n=new Array(s).fill(null);if(0===s)return n;let r=0;for(let s=e;s<=i;s++)n[r++]=t[s];return n}}Lo.ForwardComparator=class{compare(t,e){const i=t,s=e;return Lo.compare(i,s)}get interfaces_(){return[Lr]}},Lo.BidirectionalComparator=class{compare(t,e){const i=t,s=e;if(i.length<s.length)return-1;if(i.length>s.length)return 1;if(0===i.length)return 0;const n=Lo.compare(i,s);return Lo.isEqualReversed(i,s)?0:n}OLDcompare(t,e){const i=t,s=e;if(i.length<s.length)return-1;if(i.length>s.length)return 1;if(0===i.length)return 0;const n=Lo.increasingDirection(i),r=Lo.increasingDirection(s);let o=n>0?0:i.length-1,a=r>0?0:i.length-1;for(let t=0;t<i.length;t++){const t=i[o].compareTo(s[a]);if(0!==t)return t;o+=n,a+=r}return 0}get interfaces_(){return[Lr]}},Lo.coordArrayType=new Array(0).fill(null);class To{constructor(t){this.str=t}append(t){this.str+=t}setCharAt(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)}toString(){return this.str}}class No{constructor(){No.constructor_.apply(this,arguments)}static constructor_(){if(this._dimension=3,this._measures=0,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array){const t=arguments[0];No.constructor_.call(this,t,Lo.dimension(t),Lo.measures(t))}else if(Number.isInteger(arguments[0])){const t=arguments[0];this._coordinates=new Array(t).fill(null);for(let e=0;e<t;e++)this._coordinates[e]=new Fr}else if(fr(arguments[0],vr)){const t=arguments[0];if(null===t)return this._coordinates=new Array(0).fill(null),null;this._dimension=t.getDimension(),this._measures=t.getMeasures(),this._coordinates=new Array(t.size()).fill(null);for(let e=0;e<this._coordinates.length;e++)this._coordinates[e]=t.getCoordinateCopy(e)}}else if(2===arguments.length){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1];No.constructor_.call(this,t,e,Lo.measures(t))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1];this._coordinates=new Array(t).fill(null),this._dimension=e;for(let i=0;i<t;i++)this._coordinates[i]=Co.create(e)}}else if(3===arguments.length)if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1],i=arguments[2];this._dimension=e,this._measures=i,this._coordinates=null===t?new Array(0).fill(null):t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1],i=arguments[2];this._coordinates=new Array(t).fill(null),this._dimension=e,this._measures=i;for(let e=0;e<t;e++)this._coordinates[e]=this.createCoordinate()}}getM(t){return this.hasM()?this._coordinates[t].getM():yr.NaN}setOrdinate(t,e,i){switch(e){case vr.X:this._coordinates[t].x=i;break;case vr.Y:this._coordinates[t].y=i;break;default:this._coordinates[t].setOrdinate(e,i)}}getZ(t){return this.hasZ()?this._coordinates[t].getZ():yr.NaN}size(){return this._coordinates.length}getOrdinate(t,e){switch(e){case vr.X:return this._coordinates[t].x;case vr.Y:return this._coordinates[t].y;default:return this._coordinates[t].getOrdinate(e)}}getCoordinate(){if(1===arguments.length){const t=arguments[0];return this._coordinates[t]}if(2===arguments.length){const t=arguments[0];arguments[1].setCoordinate(this._coordinates[t])}}getCoordinateCopy(t){const e=this.createCoordinate();return e.setCoordinate(this._coordinates[t]),e}createCoordinate(){return Co.create(this.getDimension(),this.getMeasures())}getDimension(){return this._dimension}getX(t){return this._coordinates[t].x}getMeasures(){return this._measures}expandEnvelope(t){for(let e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t}copy(){const t=new Array(this.size()).fill(null);for(let e=0;e<this._coordinates.length;e++){const i=this.createCoordinate();i.setCoordinate(this._coordinates[e]),t[e]=i}return new No(t,this._dimension,this._measures)}toString(){if(this._coordinates.length>0){const t=new To(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(let e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"}getY(t){return this._coordinates[t].y}toCoordinateArray(){return this._coordinates}get interfaces_(){return[vr,br]}}class Ro{static instance(){return Ro.instanceObject}readResolve(){return Ro.instance()}create(){if(1===arguments.length){if(arguments[0]instanceof Array)return new No(arguments[0]);if(fr(arguments[0],vr))return new No(arguments[0])}else{if(2===arguments.length){let t=arguments[1];return t>3&&(t=3),t<2&&(t=2),new No(arguments[0],t)}if(3===arguments.length){let t=arguments[2],e=arguments[1]-t;return t>1&&(t=1),e>3&&(e=3),e<2&&(e=2),new No(arguments[0],e+t,t)}}}get interfaces_(){return[wr,br]}}Ro.instanceObject=new Ro;class Po extends yo{constructor(){super(),Po.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];yo.constructor_.call(this,t,e)}copyInternal(){const t=new Array(this._geometries.length).fill(null);for(let e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new Po(t,this._factory)}equalsExact(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof Gr){const t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&super.equalsExact.call(this,t,e)}return super.equalsExact.apply(this,arguments)}getBoundaryDimension(){return 1}getTypeCode(){return Gr.TYPECODE_MULTIPOLYGON}getDimension(){return 2}getBoundary(){if(this.isEmpty())return this.getFactory().createMultiLineString();const t=new so;for(let e=0;e<this._geometries.length;e++){const i=this._geometries[e].getBoundary();for(let e=0;e<i.getNumGeometries();e++)t.add(i.getGeometryN(e))}const e=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(e))}getGeometryType(){return Gr.TYPENAME_MULTIPOLYGON}get interfaces_(){return[uo]}}class Oo{get(){}put(){}size(){}values(){}entrySet(){}}class Ao extends po{constructor(t){super(),this.map=new Map,t instanceof Qr&&this.addAll(t)}contains(t){const e=t.hashCode?t.hashCode():t;return!!this.map.has(e)}add(t){const e=t.hashCode?t.hashCode():t;return!this.map.has(e)&&!!this.map.set(e,t)}addAll(t){for(const e of t)this.add(e);return!0}remove(){throw new Ur}size(){return this.map.size}isEmpty(){return 0===this.map.size}toArray(){return Array.from(this.map.values())}iterator(){return new Fo(this.map)}[Symbol.iterator](){return this.map}}class Fo{constructor(t){this.iterator=t.values();const{done:e,value:i}=this.iterator.next();this.done=e,this.value=i}next(){if(this.done)throw new io;const t=this.value,{done:e,value:i}=this.iterator.next();return this.done=e,this.value=i,t}hasNext(){return!this.done}remove(){throw new Ur}}class Do{constructor(){Do.constructor_.apply(this,arguments)}static constructor_(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=Do.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof ko){const t=arguments[0];this._modelType=t,t===Do.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){const t=arguments[0];this._modelType=Do.FIXED,this.setScale(t)}else if(arguments[0]instanceof Do){const t=arguments[0];this._modelType=t._modelType,this._scale=t._scale}}static mostPrecise(t,e){return t.compareTo(e)>=0?t:e}equals(t){if(!(t instanceof Do))return!1;const e=t;return this._modelType===e._modelType&&this._scale===e._scale}compareTo(t){const e=t,i=this.getMaximumSignificantDigits(),s=e.getMaximumSignificantDigits();return ao.compare(i,s)}getScale(){return this._scale}isFloating(){return this._modelType===Do.FLOATING||this._modelType===Do.FLOATING_SINGLE}getType(){return this._modelType}toString(){let t="UNKNOWN";return this._modelType===Do.FLOATING?t="Floating":this._modelType===Do.FLOATING_SINGLE?t="Floating-Single":this._modelType===Do.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t}makePrecise(){if("number"==typeof arguments[0]){const t=arguments[0];return yr.isNaN(t)||this._modelType===Do.FLOATING_SINGLE?t:this._modelType===Do.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof Fr){const t=arguments[0];if(this._modelType===Do.FLOATING)return null;t.x=this.makePrecise(t.x),t.y=this.makePrecise(t.y)}}getMaximumSignificantDigits(){let t=16;return this._modelType===Do.FLOATING?t=16:this._modelType===Do.FLOATING_SINGLE?t=6:this._modelType===Do.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t}setScale(t){this._scale=Math.abs(t)}get interfaces_(){return[br,Sr]}}class ko{constructor(){ko.constructor_.apply(this,arguments)}static constructor_(){this._name=null;const t=arguments[0];this._name=t,ko.nameToTypeMap.put(t,this)}readResolve(){return ko.nameToTypeMap.get(this._name)}toString(){return this._name}get interfaces_(){return[br]}}ko.nameToTypeMap=new class extends Oo{constructor(){super(),this.map=new Map}get(t){return this.map.get(t)||null}put(t,e){return this.map.set(t,e),e}values(){const t=new so,e=this.map.values();let i=e.next();for(;!i.done;)t.add(i.value),i=e.next();return t}entrySet(){const t=new Ao;return this.map.entries().forEach((e=>t.add(e))),t}size(){return this.map.size()}},Do.Type=ko,Do.FIXED=new ko("FIXED"),Do.FLOATING=new ko("FLOATING"),Do.FLOATING_SINGLE=new ko("FLOATING SINGLE"),Do.maximumPreciseValue=9007199254740992;class Go extends yo{constructor(){super(),Go.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];yo.constructor_.call(this,t,e)}copyInternal(){const t=new Array(this._geometries.length).fill(null);for(let e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new Go(t,this._factory)}equalsExact(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof Gr){const t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&super.equalsExact.call(this,t,e)}return super.equalsExact.apply(this,arguments)}getBoundaryDimension(){return this.isClosed()?Vr.FALSE:0}isClosed(){if(this.isEmpty())return!1;for(let t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0}getTypeCode(){return Gr.TYPECODE_MULTILINESTRING}getDimension(){return 1}getBoundary(){throw new Ur}getGeometryType(){return Gr.TYPENAME_MULTILINESTRING}get interfaces_(){return[jr]}}class zo{constructor(){zo.constructor_.apply(this,arguments)}static constructor_(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,0===arguments.length)zo.constructor_.call(this,new Do,0);else if(1===arguments.length){if(fr(arguments[0],wr)){const t=arguments[0];zo.constructor_.call(this,new Do,0,t)}else if(arguments[0]instanceof Do){const t=arguments[0];zo.constructor_.call(this,t,0,zo.getDefaultCoordinateSequenceFactory())}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];zo.constructor_.call(this,t,e,zo.getDefaultCoordinateSequenceFactory())}else if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];this._precisionModel=t,this._coordinateSequenceFactory=i,this._SRID=e}}static toMultiPolygonArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toGeometryArray(t){if(null===t)return null;const e=new Array(t.size()).fill(null);return t.toArray(e)}static getDefaultCoordinateSequenceFactory(){return Ro.instance()}static toMultiLineStringArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toLineStringArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toMultiPointArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toLinearRingArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toPointArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toPolygonArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static createPointFromInternalCoord(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)}createEmpty(t){switch(t){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new Er("Invalid dimension: "+t)}}toGeometry(t){return t.isNull()?this.createPoint():t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new Fr(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new Fr(t.getMinX(),t.getMinY()),new Fr(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new Fr(t.getMinX(),t.getMinY()),new Fr(t.getMinX(),t.getMaxY()),new Fr(t.getMaxX(),t.getMaxY()),new Fr(t.getMaxX(),t.getMinY()),new Fr(t.getMinX(),t.getMinY())]),null)}createLineString(){if(0===arguments.length)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){const t=arguments[0];return this.createLineString(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(fr(arguments[0],vr))return new $r(arguments[0],this)}}createMultiLineString(){return 0===arguments.length?new Go(null,this):1===arguments.length?new Go(arguments[0],this):void 0}buildGeometry(t){let e=null,i=!1,s=!1;for(let n=t.iterator();n.hasNext();){const t=n.next(),r=t.getTypeCode();null===e&&(e=r),r!==e&&(i=!0),t instanceof yo&&(s=!0)}if(null===e)return this.createGeometryCollection();if(i||s)return this.createGeometryCollection(zo.toGeometryArray(t));const n=t.iterator().next();if(t.size()>1){if(n instanceof go)return this.createMultiPolygon(zo.toPolygonArray(t));if(n instanceof $r)return this.createMultiLineString(zo.toLineStringArray(t));if(n instanceof Zr)return this.createMultiPoint(zo.toPointArray(t));Rr.shouldNeverReachHere("Unhandled geometry type: "+n.getGeometryType())}return n}createMultiPointFromCoords(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}createPoint(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Fr){const t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(fr(arguments[0],vr))return new Zr(arguments[0],this)}}getCoordinateSequenceFactory(){return this._coordinateSequenceFactory}createPolygon(){if(0===arguments.length)return this.createPolygon(null,null);if(1===arguments.length){if(fr(arguments[0],vr)){const t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){const t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof vo){const t=arguments[0];return this.createPolygon(t,null)}}else if(2===arguments.length)return new go(arguments[0],arguments[1],this)}getSRID(){return this._SRID}createGeometryCollection(){return 0===arguments.length?new yo(null,this):1===arguments.length?new yo(arguments[0],this):void 0}getPrecisionModel(){return this._precisionModel}createLinearRing(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){const t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(fr(arguments[0],vr))return new vo(arguments[0],this)}}createMultiPolygon(){return 0===arguments.length?new Po(null,this):1===arguments.length?new Po(arguments[0],this):void 0}createMultiPoint(){if(0===arguments.length)return new xo(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new xo(arguments[0],this);if(fr(arguments[0],vr)){const t=arguments[0];if(null===t)return this.createMultiPoint(new Array(0).fill(null));const e=new Array(t.size()).fill(null);for(let i=0;i<t.size();i++){const s=this.getCoordinateSequenceFactory().create(1,t.getDimension(),t.getMeasures());qr.copy(t,i,s,0,1),e[i]=this.createPoint(s)}return this.createMultiPoint(e)}}}get interfaces_(){return[br]}}const Bo=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"];class jo{constructor(t){this.geometryFactory=t||new zo}read(t){let e;e="string"==typeof t?JSON.parse(t):t;const i=e.type;if(!qo[i])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==Bo.indexOf(i)?qo[i].call(this,e.coordinates):"GeometryCollection"===i?qo[i].call(this,e.geometries):qo[i].call(this,e)}write(t){const e=t.getGeometryType();if(!Uo[e])throw new Error("Geometry is not supported");return Uo[e].call(this,t)}}const qo={Feature:function(t){const e={};for(const i in t)e[i]=t[i];if(t.geometry){const i=t.geometry.type;if(!qo[i])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=qo.bbox.call(this,t.bbox)),e},FeatureCollection:function(t){const e={};if(t.features){e.features=[];for(let i=0;i<t.features.length;++i)e.features.push(this.read(t.features[i]))}return t.bbox&&(e.bbox=this.parse.bbox.call(this,t.bbox)),e},coordinates:function(t){const e=[];for(let i=0;i<t.length;++i){const s=t[i];e.push(new Fr(...s))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new Fr(t[0],t[1]),new Fr(t[2],t[1]),new Fr(t[2],t[3]),new Fr(t[0],t[3]),new Fr(t[0],t[1])])},Point:function(t){const e=new Fr(...t);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){const e=[];for(let i=0;i<t.length;++i)e.push(qo.Point.call(this,t[i]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){const e=qo.coordinates.call(this,t);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){const e=[];for(let i=0;i<t.length;++i)e.push(qo.LineString.call(this,t[i]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){const e=qo.coordinates.call(this,t[0]),i=this.geometryFactory.createLinearRing(e),s=[];for(let e=1;e<t.length;++e){const i=t[e],n=qo.coordinates.call(this,i),r=this.geometryFactory.createLinearRing(n);s.push(r)}return this.geometryFactory.createPolygon(i,s)},MultiPolygon:function(t){const e=[];for(let i=0;i<t.length;++i){const s=t[i];e.push(qo.Polygon.call(this,s))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){const e=[];for(let i=0;i<t.length;++i){const s=t[i];e.push(this.read(s))}return this.geometryFactory.createGeometryCollection(e)}},Uo={coordinate:function(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e},Point:function(t){return{type:"Point",coordinates:Uo.coordinate.call(this,t.getCoordinate())}},MultiPoint:function(t){const e=[];for(let i=0;i<t._geometries.length;++i){const s=t._geometries[i],n=Uo.Point.call(this,s);e.push(n.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){const e=[],i=t.getCoordinates();for(let t=0;t<i.length;++t){const s=i[t];e.push(Uo.coordinate.call(this,s))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){const e=[];for(let i=0;i<t._geometries.length;++i){const s=t._geometries[i],n=Uo.LineString.call(this,s);e.push(n.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){const e=[],i=Uo.LineString.call(this,t._shell);e.push(i.coordinates);for(let i=0;i<t._holes.length;++i){const s=t._holes[i],n=Uo.LineString.call(this,s);e.push(n.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){const e=[];for(let i=0;i<t._geometries.length;++i){const s=t._geometries[i],n=Uo.Polygon.call(this,s);e.push(n.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){const e=[];for(let i=0;i<t._geometries.length;++i){const s=t._geometries[i],n=s.getGeometryType();e.push(Uo[n].call(this,s))}return{type:"GeometryCollection",geometries:e}}};class Yo{constructor(t){this.parser=new jo(t||new zo)}read(t){return this.parser.read(t)}}class Vo{constructor(){this.parser=new jo(this.geometryFactory)}write(t){return this.parser.write(t)}}class Xo{constructor(){Xo.constructor_.apply(this,arguments)}static constructor_(){if(this._quadrantSegments=Xo.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=Xo.CAP_ROUND,this._joinStyle=Xo.JOIN_ROUND,this._mitreLimit=Xo.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=Xo.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){const t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.setQuadrantSegments(t),this.setEndCapStyle(e)}else if(4===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];this.setQuadrantSegments(t),this.setEndCapStyle(e),this.setJoinStyle(i),this.setMitreLimit(s)}}static bufferDistanceError(t){const e=Math.PI/2/t;return 1-Math.cos(e/2)}getEndCapStyle(){return this._endCapStyle}isSingleSided(){return this._isSingleSided}setQuadrantSegments(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=Xo.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Xo.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==Xo.JOIN_ROUND&&(this._quadrantSegments=Xo.DEFAULT_QUADRANT_SEGMENTS)}getJoinStyle(){return this._joinStyle}setJoinStyle(t){this._joinStyle=t}setSimplifyFactor(t){this._simplifyFactor=t<0?0:t}getSimplifyFactor(){return this._simplifyFactor}getQuadrantSegments(){return this._quadrantSegments}setEndCapStyle(t){this._endCapStyle=t}getMitreLimit(){return this._mitreLimit}setMitreLimit(t){this._mitreLimit=t}setSingleSided(t){this._isSingleSided=t}}Xo.CAP_ROUND=1,Xo.CAP_FLAT=2,Xo.CAP_SQUARE=3,Xo.JOIN_ROUND=1,Xo.JOIN_MITRE=2,Xo.JOIN_BEVEL=3,Xo.DEFAULT_QUADRANT_SEGMENTS=8,Xo.DEFAULT_MITRE_LIMIT=5,Xo.DEFAULT_SIMPLIFY_FACTOR=.01;class Wo{static toLocationSymbol(t){switch(t){case Wo.EXTERIOR:return"e";case Wo.BOUNDARY:return"b";case Wo.INTERIOR:return"i";case Wo.NONE:return"-"}throw new Er("Unknown location value: "+t)}}Wo.INTERIOR=0,Wo.BOUNDARY=1,Wo.EXTERIOR=2,Wo.NONE=-1;class $o{static opposite(t){return t===$o.LEFT?$o.RIGHT:t===$o.RIGHT?$o.LEFT:t}}$o.ON=0,$o.LEFT=1,$o.RIGHT=2;class Ho extends Mr{constructor(t){super(t),this.name=Object.keys({EmptyStackException:Ho})[0]}}class Ko extends eo{constructor(){super(),this.array=[]}add(t){return this.array.push(t),!0}get(t){if(t<0||t>=this.size())throw new to;return this.array[t]}push(t){return this.array.push(t),t}pop(){if(0===this.array.length)throw new Ho;return this.array.pop()}peek(){if(0===this.array.length)throw new Ho;return this.array[this.array.length-1]}empty(){return 0===this.array.length}isEmpty(){return this.empty()}search(t){return this.array.indexOf(t)}size(){return this.array.length}toArray(){return this.array.slice()}}class Zo{constructor(){Zo.constructor_.apply(this,arguments)}static constructor_(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}getCoordinate(){return this._minCoord}getRightmostSide(t,e){let i=this.getRightmostSideOfSegment(t,e);return i<0&&(i=this.getRightmostSideOfSegment(t,e-1)),i<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),i}findRightmostEdgeAtVertex(){const t=this._minDe.getEdge().getCoordinates();Rr.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");const e=t[this._minIndex-1],i=t[this._minIndex+1],s=co.index(this._minCoord,i,e);let n=!1;(e.y<this._minCoord.y&&i.y<this._minCoord.y&&s===co.COUNTERCLOCKWISE||e.y>this._minCoord.y&&i.y>this._minCoord.y&&s===co.CLOCKWISE)&&(n=!0),n&&(this._minIndex=this._minIndex-1)}getRightmostSideOfSegment(t,e){const i=t.getEdge().getCoordinates();if(e<0||e+1>=i.length)return-1;if(i[e].y===i[e+1].y)return-1;let s=$o.LEFT;return i[e].y<i[e+1].y&&(s=$o.RIGHT),s}getEdge(){return this._orientedDe}checkForRightmostCoordinate(t){const e=t.getEdge().getCoordinates();for(let i=0;i<e.length-1;i++)(null===this._minCoord||e[i].x>this._minCoord.x)&&(this._minDe=t,this._minIndex=i,this._minCoord=e[i])}findRightmostEdgeAtNode(){const t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}findEdge(t){for(let e=t.iterator();e.hasNext();){const t=e.next();t.isForward()&&this.checkForRightmostCoordinate(t)}Rr.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===$o.LEFT&&(this._orientedDe=this._minDe.getSym())}}class Jo extends Tr{constructor(t,e){super(e?t+" [ "+e+" ]":t),this.pt=e?new Fr(e):void 0,this.name=Object.keys({TopologyException:Jo})[0]}getCoordinate(){return this.pt}}class Qo{constructor(){this.array=[]}addLast(t){this.array.push(t)}removeFirst(){return this.array.shift()}isEmpty(){return 0===this.array.length}}class ta{constructor(){ta.constructor_.apply(this,arguments)}static constructor_(){this._finder=null,this._dirEdgeList=new so,this._nodes=new so,this._rightMostCoord=null,this._env=null,this._finder=new Zo}clearVisitedEdges(){for(let t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)}getRightmostCoordinate(){return this._rightMostCoord}computeNodeDepth(t){let e=null;for(let i=t.getEdges().iterator();i.hasNext();){const t=i.next();if(t.isVisited()||t.getSym().isVisited()){e=t;break}}if(null===e)throw new Jo("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(let e=t.getEdges().iterator();e.hasNext();){const t=e.next();t.setVisited(!0),this.copySymDepths(t)}}computeDepth(t){this.clearVisitedEdges();const e=this._finder.getEdge();e.getNode(),e.getLabel(),e.setEdgeDepths($o.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)}create(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}findResultEdges(){for(let t=this._dirEdgeList.iterator();t.hasNext();){const e=t.next();e.getDepth($o.RIGHT)>=1&&e.getDepth($o.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}}computeDepths(t){const e=new Ao,i=new Qo,s=t.getNode();for(i.addLast(s),e.add(s),t.setVisited(!0);!i.isEmpty();){const t=i.removeFirst();e.add(t),this.computeNodeDepth(t);for(let s=t.getEdges().iterator();s.hasNext();){const t=s.next().getSym();if(t.isVisited())continue;const n=t.getNode();e.contains(n)||(i.addLast(n),e.add(n))}}}compareTo(t){const e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0}getEnvelope(){if(null===this._env){const t=new kr;for(let e=this._dirEdgeList.iterator();e.hasNext();){const i=e.next().getEdge().getCoordinates();for(let e=0;e<i.length-1;e++)t.expandToInclude(i[e])}this._env=t}return this._env}addReachable(t){const e=new Ko;for(e.add(t);!e.empty();){const t=e.pop();this.add(t,e)}}copySymDepths(t){const e=t.getSym();e.setDepth($o.LEFT,t.getDepth($o.RIGHT)),e.setDepth($o.RIGHT,t.getDepth($o.LEFT))}add(t,e){t.setVisited(!0),this._nodes.add(t);for(let i=t.getEdges().iterator();i.hasNext();){const t=i.next();this._dirEdgeList.add(t);const s=t.getSym().getNode();s.isVisited()||e.push(s)}}getNodes(){return this._nodes}getDirectedEdges(){return this._dirEdgeList}get interfaces_(){return[Sr]}}class ea{static intersection(t,e,i,s){const n=t.x<e.x?t.x:e.x,r=t.y<e.y?t.y:e.y,o=t.x>e.x?t.x:e.x,a=t.y>e.y?t.y:e.y,h=i.x<s.x?i.x:s.x,l=i.y<s.y?i.y:s.y,c=i.x>s.x?i.x:s.x,u=i.y>s.y?i.y:s.y,d=((n>h?n:h)+(o<c?o:c))/2,g=((r>l?r:l)+(a<u?a:u))/2,p=t.x-d,_=t.y-g,f=e.x-d,m=e.y-g,y=i.x-d,x=i.y-g,v=s.x-d,w=s.y-g,M=_-m,E=f-p,C=p*m-f*_,S=x-w,b=v-y,I=y*w-v*x,L=M*b-S*E,T=(E*I-b*C)/L,N=(S*C-M*I)/L;return yr.isNaN(T)||yr.isInfinite(T)||yr.isNaN(N)||yr.isInfinite(N)?null:new Fr(T+d,N+g)}}class ia{static segmentToSegment(t,e,i,s){if(t.equals(e))return ia.pointToSegment(t,i,s);if(i.equals(s))return ia.pointToSegment(s,t,e);let n=!1;if(kr.intersects(t,e,i,s)){const r=(e.x-t.x)*(s.y-i.y)-(e.y-t.y)*(s.x-i.x);if(0===r)n=!0;else{const o=(t.y-i.y)*(s.x-i.x)-(t.x-i.x)*(s.y-i.y),a=((t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y))/r,h=o/r;(h<0||h>1||a<0||a>1)&&(n=!0)}}else n=!0;return n?bo.min(ia.pointToSegment(t,i,s),ia.pointToSegment(e,i,s),ia.pointToSegment(i,t,e),ia.pointToSegment(s,t,e)):0}static pointToSegment(t,e,i){if(e.x===i.x&&e.y===i.y)return t.distance(e);const s=(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y),n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/s;if(n<=0)return t.distance(e);if(n>=1)return t.distance(i);const r=((e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y))/s;return Math.abs(r)*Math.sqrt(s)}static pointToLinePerpendicular(t,e,i){const s=(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y),n=((e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y))/s;return Math.abs(n)*Math.sqrt(s)}static pointToSegmentString(t,e){if(0===e.length)throw new Er("Line array must contain at least one vertex");let i=t.distance(e[0]);for(let s=0;s<e.length-1;s++){const n=ia.pointToSegment(t,e[s],e[s+1]);n<i&&(i=n)}return i}}const sa="XY",na={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},ra="EMPTY",oa="Z",aa="M",ha={};for(const t in na)ha[t]=na[t].toUpperCase();class la{constructor(t){this.wkt=t,this.index_=-1}isAlpha_(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}isNumeric_(t,e){return t>="0"&&t<="9"||"."==t&&!(void 0!==e&&e)}isWhiteSpace_(t){return" "==t||"\t"==t||"\r"==t||"\n"==t}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const t=this.nextChar_(),e=this.index_;let i,s=t;if("("==t)i=2;else if(","==t)i=5;else if(")"==t)i=3;else if(this.isNumeric_(t)||"-"==t)i=4,s=this.readNumber_();else if(this.isAlpha_(t))i=1,s=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(""!==t)throw new Error("Unexpected character: "+t);i=6}return{position:e,value:s,type:i}}readNumber_(){let t;const e=this.index_;let i=!1,s=!1;do{"."==t?i=!0:"e"!=t&&"E"!=t||(s=!0),t=this.nextChar_()}while(this.isNumeric_(t,i)||!s&&("e"==t||"E"==t)||s&&("-"==t||"+"==t));return parseFloat(this.wkt.substring(e,this.index_--))}readText_(){let t;const e=this.index_;do{t=this.nextChar_()}while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()}}class ca{constructor(t,e){this.lexer_=t,this.token_,this.layout_=sa,this.factory=e}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(t){return this.token_.type==t}match(t){const e=this.isTokenType(t);return e&&this.consume_(),e}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let t=sa;const e=this.token_;if(this.isTokenType(1)){const i=e.value;i===oa?t="XYZ":i===aa?t="XYM":"ZM"===i&&(t="XYZM"),t!==sa&&this.consume_()}return t}parseGeometryCollectionText_(){if(this.match(2)){const t=[];do{t.push(this.parseGeometry_())}while(this.match(5));if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(2)){const t=this.parsePoint_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(2)){const t=this.parsePointList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(2)){const t=this.parseLineStringTextList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(2)){let t;if(t=2==this.token_.type?this.parsePointTextList_():this.parsePointList_(),this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(2)){const t=this.parseLineStringTextList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(2)){const t=this.parsePolygonTextList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}parsePoint_(){const t=[],e=this.layout_.length;for(let i=0;i<e;++i){const e=this.token_;if(!this.match(4))break;t.push(e.value)}if(t.length==e)return t;throw new Error(this.formatErrorMessage_())}parsePointList_(){const t=[this.parsePoint_()];for(;this.match(5);)t.push(this.parsePoint_());return t}parsePointTextList_(){const t=[this.parsePointText_()];for(;this.match(5);)t.push(this.parsePointText_());return t}parseLineStringTextList_(){const t=[this.parseLineStringText_()];for(;this.match(5);)t.push(this.parseLineStringText_());return t}parsePolygonTextList_(){const t=[this.parsePolygonText_()];for(;this.match(5);)t.push(this.parsePolygonText_());return t}isEmptyGeometry_(){const t=this.isTokenType(1)&&this.token_.value==ra;return t&&this.consume_(),t}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const t=this.factory,e=t=>new Fr(...t),i=i=>{const s=i.map((i=>t.createLinearRing(i.map(e))));return s.length>1?t.createPolygon(s[0],s.slice(1)):t.createPolygon(s[0])},s=this.token_;if(this.match(1)){const n=s.value;if(this.layout_=this.parseGeometryLayout_(),"GEOMETRYCOLLECTION"==n){const e=this.parseGeometryCollectionText_();return t.createGeometryCollection(e)}switch(n){case"POINT":{const e=this.parsePointText_();return e?t.createPoint(new Fr(...e)):t.createPoint()}case"LINESTRING":{const i=this.parseLineStringText_().map(e);return t.createLineString(i)}case"LINEARRING":{const i=this.parseLineStringText_().map(e);return t.createLinearRing(i)}case"POLYGON":{const e=this.parsePolygonText_();return e&&0!==e.length?i(e):t.createPolygon()}case"MULTIPOINT":{const i=this.parseMultiPointText_();if(!i||0===i.length)return t.createMultiPoint();const s=i.map(e).map((e=>t.createPoint(e)));return t.createMultiPoint(s)}case"MULTILINESTRING":{const i=this.parseMultiLineStringText_().map((i=>t.createLineString(i.map(e))));return t.createMultiLineString(i)}case"MULTIPOLYGON":{const e=this.parseMultiPolygonText_();if(!e||0===e.length)return t.createMultiPolygon();const s=e.map(i);return t.createMultiPolygon(s)}default:throw new Error("Invalid geometry type: "+n)}}throw new Error(this.formatErrorMessage_())}}function ua(t){if(t.isEmpty())return"";const e=t.getCoordinate(),i=[e.x,e.y];return void 0===e.z||Number.isNaN(e.z)||i.push(e.z),void 0===e.m||Number.isNaN(e.m)||i.push(e.m),i.join(" ")}function da(t){const e=t.getCoordinates().map((t=>{const e=[t.x,t.y];return void 0===t.z||Number.isNaN(t.z)||e.push(t.z),void 0===t.m||Number.isNaN(t.m)||e.push(t.m),e})),i=[];for(let t=0,s=e.length;t<s;++t)i.push(e[t].join(" "));return i.join(", ")}function ga(t){const e=[];e.push("("+da(t.getExteriorRing())+")");for(let i=0,s=t.getNumInteriorRing();i<s;++i)e.push("("+da(t.getInteriorRingN(i))+")");return e.join(", ")}const pa={Point:ua,LineString:da,LinearRing:da,Polygon:ga,MultiPoint:function(t){const e=[];for(let i=0,s=t.getNumGeometries();i<s;++i)e.push("("+ua(t.getGeometryN(i))+")");return e.join(", ")},MultiLineString:function(t){const e=[];for(let i=0,s=t.getNumGeometries();i<s;++i)e.push("("+da(t.getGeometryN(i))+")");return e.join(", ")},MultiPolygon:function(t){const e=[];for(let i=0,s=t.getNumGeometries();i<s;++i)e.push("("+ga(t.getGeometryN(i))+")");return e.join(", ")},GeometryCollection:function(t){const e=[];for(let i=0,s=t.getNumGeometries();i<s;++i)e.push(_a(t.getGeometryN(i)));return e.join(", ")}};function _a(t){let e=t.getGeometryType();const i=pa[e];e=e.toUpperCase();const s=function(t){let e="";if(t.isEmpty())return e;const i=t.getCoordinate();return void 0===i.z||Number.isNaN(i.z)||(e+=oa),void 0===i.m||Number.isNaN(i.m)||(e+=aa),e}(t);return s.length>0&&(e+=" "+s),t.isEmpty()?e+" "+ra:e+" ("+i(t)+")"}class fa{constructor(t){this.geometryFactory=t||new zo,this.precisionModel=this.geometryFactory.getPrecisionModel()}read(t){const e=new la(t);return new ca(e,this.geometryFactory).parse()}write(t){return _a(t)}}class ma{constructor(t){this.parser=new fa(t)}write(t){return this.parser.write(t)}static toLineString(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"}}class ya{constructor(){ya.constructor_.apply(this,arguments)}static constructor_(){this._result=null,this._inputLines=Array(2).fill().map((()=>Array(2))),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Fr,this._intPt[1]=new Fr,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}static computeEdgeDistance(t,e,i){const s=Math.abs(i.x-e.x),n=Math.abs(i.y-e.y);let r=-1;if(t.equals(e))r=0;else if(t.equals(i))r=s>n?s:n;else{const i=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y);r=s>n?i:o,0!==r||t.equals(e)||(r=Math.max(i,o))}return Rr.isTrue(!(0===r&&!t.equals(e)),"Bad distance calculation"),r}static nonRobustComputeEdgeDistance(t,e,i){const s=t.x-e.x,n=t.y-e.y,r=Math.sqrt(s*s+n*n);return Rr.isTrue(!(0===r&&!t.equals(e)),"Invalid distance calculation"),r}getIndexAlongSegment(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]}getTopologySummary(){const t=new To;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()}computeIntersection(t,e,i,s){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=i,this._inputLines[1][1]=s,this._result=this.computeIntersect(t,e,i,s)}getIntersectionNum(){return this._result}computeIntLineIndex(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map((()=>Array(2))),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){const t=arguments[0];this.getEdgeDistance(t,0)>this.getEdgeDistance(t,1)?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}}isProper(){return this.hasIntersection()&&this._isProper}setPrecisionModel(t){this._precisionModel=t}isInteriorIntersection(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){const t=arguments[0];for(let e=0;e<this._result;e++)if(!this._intPt[e].equals2D(this._inputLines[t][0])&&!this._intPt[e].equals2D(this._inputLines[t][1]))return!0;return!1}}getIntersection(t){return this._intPt[t]}isEndPoint(){return this.hasIntersection()&&!this._isProper}hasIntersection(){return this._result!==ya.NO_INTERSECTION}getEdgeDistance(t,e){return ya.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])}isCollinear(){return this._result===ya.COLLINEAR_INTERSECTION}toString(){return ma.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+ma.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}getEndpoint(t,e){return this._inputLines[t][e]}isIntersection(t){for(let e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1}getIntersectionAlongSegment(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]}}ya.DONT_INTERSECT=0,ya.DO_INTERSECT=1,ya.COLLINEAR=2,ya.NO_INTERSECTION=0,ya.POINT_INTERSECTION=1,ya.COLLINEAR_INTERSECTION=2;class xa extends ya{constructor(){super()}static nearestEndpoint(t,e,i,s){let n=t,r=ia.pointToSegment(t,i,s),o=ia.pointToSegment(e,i,s);return o<r&&(r=o,n=e),o=ia.pointToSegment(i,t,e),o<r&&(r=o,n=i),o=ia.pointToSegment(s,t,e),o<r&&(r=o,n=s),n}isInSegmentEnvelopes(t){const e=new kr(this._inputLines[0][0],this._inputLines[0][1]),i=new kr(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&i.contains(t)}computeIntersection(){if(3!==arguments.length)return super.computeIntersection.apply(this,arguments);{const t=arguments[0],e=arguments[1],i=arguments[2];if(this._isProper=!1,kr.intersects(e,i,t)&&0===co.index(e,i,t)&&0===co.index(i,e,t))return this._isProper=!0,(t.equals(e)||t.equals(i))&&(this._isProper=!1),this._result=ya.POINT_INTERSECTION,null;this._result=ya.NO_INTERSECTION}}intersection(t,e,i,s){let n=this.intersectionSafe(t,e,i,s);return this.isInSegmentEnvelopes(n)||(n=new Fr(xa.nearestEndpoint(t,e,i,s))),null!==this._precisionModel&&this._precisionModel.makePrecise(n),n}checkDD(t,e,i,s,n){const r=lo.intersection(t,e,i,s),o=this.isInSegmentEnvelopes(r);Io.out.println("DD in env = "+o+"  --------------------- "+r),n.distance(r)>1e-4&&Io.out.println("Distance = "+n.distance(r))}intersectionSafe(t,e,i,s){let n=ea.intersection(t,e,i,s);return null===n&&(n=xa.nearestEndpoint(t,e,i,s)),n}computeCollinearIntersection(t,e,i,s){const n=kr.intersects(t,e,i),r=kr.intersects(t,e,s),o=kr.intersects(i,s,t),a=kr.intersects(i,s,e);return n&&r?(this._intPt[0]=i,this._intPt[1]=s,ya.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=t,this._intPt[1]=e,ya.COLLINEAR_INTERSECTION):n&&o?(this._intPt[0]=i,this._intPt[1]=t,!i.equals(t)||r||a?ya.COLLINEAR_INTERSECTION:ya.POINT_INTERSECTION):n&&a?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||r||o?ya.COLLINEAR_INTERSECTION:ya.POINT_INTERSECTION):r&&o?(this._intPt[0]=s,this._intPt[1]=t,!s.equals(t)||n||a?ya.COLLINEAR_INTERSECTION:ya.POINT_INTERSECTION):r&&a?(this._intPt[0]=s,this._intPt[1]=e,!s.equals(e)||n||o?ya.COLLINEAR_INTERSECTION:ya.POINT_INTERSECTION):ya.NO_INTERSECTION}computeIntersect(t,e,i,s){if(this._isProper=!1,!kr.intersects(t,e,i,s))return ya.NO_INTERSECTION;const n=co.index(t,e,i),r=co.index(t,e,s);if(n>0&&r>0||n<0&&r<0)return ya.NO_INTERSECTION;const o=co.index(i,s,t),a=co.index(i,s,e);return o>0&&a>0||o<0&&a<0?ya.NO_INTERSECTION:0===n&&0===r&&0===o&&0===a?this.computeCollinearIntersection(t,e,i,s):(0===n||0===r||0===o||0===a?(this._isProper=!1,t.equals2D(i)||t.equals2D(s)?this._intPt[0]=t:e.equals2D(i)||e.equals2D(s)?this._intPt[0]=e:0===n?this._intPt[0]=new Fr(i):0===r?this._intPt[0]=new Fr(s):0===o?this._intPt[0]=new Fr(t):0===a&&(this._intPt[0]=new Fr(e))):(this._isProper=!0,this._intPt[0]=this.intersection(t,e,i,s)),ya.POINT_INTERSECTION)}}class va{constructor(){va.constructor_.apply(this,arguments)}static constructor_(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;const t=arguments[0];this._p=t}static locatePointInRing(){if(arguments[0]instanceof Fr&&fr(arguments[1],vr)){const t=arguments[1],e=new va(arguments[0]),i=new Fr,s=new Fr;for(let n=1;n<t.size();n++)if(t.getCoordinate(n,i),t.getCoordinate(n-1,s),e.countSegment(i,s),e.isOnSegment())return e.getLocation();return e.getLocation()}if(arguments[0]instanceof Fr&&arguments[1]instanceof Array){const t=arguments[1],e=new va(arguments[0]);for(let i=1;i<t.length;i++){const s=t[i],n=t[i-1];if(e.countSegment(s,n),e.isOnSegment())return e.getLocation()}return e.getLocation()}}countSegment(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){let i=t.x,s=e.x;return i>s&&(i=e.x,s=t.x),this._p.x>=i&&this._p.x<=s&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){let i=co.index(t,e,this._p);if(i===co.COLLINEAR)return this._isPointOnSegment=!0,null;e.y<t.y&&(i=-i),i===co.LEFT&&this._crossingCount++}}isPointInPolygon(){return this.getLocation()!==Wo.EXTERIOR}getLocation(){return this._isPointOnSegment?Wo.BOUNDARY:this._crossingCount%2==1?Wo.INTERIOR:Wo.EXTERIOR}isOnSegment(){return this._isPointOnSegment}}class wa{static isOnLine(){if(arguments[0]instanceof Fr&&fr(arguments[1],vr)){const t=arguments[0],e=arguments[1],i=new xa,s=new Fr,n=new Fr,r=e.size();for(let o=1;o<r;o++)if(e.getCoordinate(o-1,s),e.getCoordinate(o,n),i.computeIntersection(t,s,n),i.hasIntersection())return!0;return!1}if(arguments[0]instanceof Fr&&arguments[1]instanceof Array){const t=arguments[0],e=arguments[1],i=new xa;for(let s=1;s<e.length;s++){const n=e[s-1],r=e[s];if(i.computeIntersection(t,n,r),i.hasIntersection())return!0}return!1}}static locateInRing(t,e){return va.locatePointInRing(t,e)}static isInRing(t,e){return wa.locateInRing(t,e)!==Wo.EXTERIOR}}class Ma{constructor(){Ma.constructor_.apply(this,arguments)}static constructor_(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){const t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){const t=arguments[0];this.init(1),this.location[$o.ON]=t}else if(arguments[0]instanceof Ma){const t=arguments[0];if(this.init(t.location.length),null!==t)for(let e=0;e<this.location.length;e++)this.location[e]=t.location[e]}}else if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];this.init(3),this.location[$o.ON]=t,this.location[$o.LEFT]=e,this.location[$o.RIGHT]=i}}setAllLocations(t){for(let e=0;e<this.location.length;e++)this.location[e]=t}isNull(){for(let t=0;t<this.location.length;t++)if(this.location[t]!==Wo.NONE)return!1;return!0}setAllLocationsIfNull(t){for(let e=0;e<this.location.length;e++)this.location[e]===Wo.NONE&&(this.location[e]=t)}isLine(){return 1===this.location.length}merge(t){if(t.location.length>this.location.length){const t=new Array(3).fill(null);t[$o.ON]=this.location[$o.ON],t[$o.LEFT]=Wo.NONE,t[$o.RIGHT]=Wo.NONE,this.location=t}for(let e=0;e<this.location.length;e++)this.location[e]===Wo.NONE&&e<t.location.length&&(this.location[e]=t.location[e])}getLocations(){return this.location}flip(){if(this.location.length<=1)return null;const t=this.location[$o.LEFT];this.location[$o.LEFT]=this.location[$o.RIGHT],this.location[$o.RIGHT]=t}toString(){const t=new oo;return this.location.length>1&&t.append(Wo.toLocationSymbol(this.location[$o.LEFT])),t.append(Wo.toLocationSymbol(this.location[$o.ON])),this.location.length>1&&t.append(Wo.toLocationSymbol(this.location[$o.RIGHT])),t.toString()}setLocations(t,e,i){this.location[$o.ON]=t,this.location[$o.LEFT]=e,this.location[$o.RIGHT]=i}get(t){return t<this.location.length?this.location[t]:Wo.NONE}isArea(){return this.location.length>1}isAnyNull(){for(let t=0;t<this.location.length;t++)if(this.location[t]===Wo.NONE)return!0;return!1}setLocation(){if(1===arguments.length){const t=arguments[0];this.setLocation($o.ON,t)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.location[t]=e}}init(t){this.location=new Array(t).fill(null),this.setAllLocations(Wo.NONE)}isEqualOnSide(t,e){return this.location[e]===t.location[e]}allPositionsEqual(t){for(let e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0}}class Ea{constructor(){Ea.constructor_.apply(this,arguments)}static constructor_(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){const t=arguments[0];this.elt[0]=new Ma(t),this.elt[1]=new Ma(t)}else if(arguments[0]instanceof Ea){const t=arguments[0];this.elt[0]=new Ma(t.elt[0]),this.elt[1]=new Ma(t.elt[1])}}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.elt[0]=new Ma(Wo.NONE),this.elt[1]=new Ma(Wo.NONE),this.elt[t].setLocation(e)}else if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];this.elt[0]=new Ma(t,e,i),this.elt[1]=new Ma(t,e,i)}else if(4===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];this.elt[0]=new Ma(Wo.NONE,Wo.NONE,Wo.NONE),this.elt[1]=new Ma(Wo.NONE,Wo.NONE,Wo.NONE),this.elt[t].setLocations(e,i,s)}}static toLineLabel(t){const e=new Ea(Wo.NONE);for(let i=0;i<2;i++)e.setLocation(i,t.getLocation(i));return e}getGeometryCount(){let t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t}setAllLocations(t,e){this.elt[t].setAllLocations(e)}isNull(t){return this.elt[t].isNull()}setAllLocationsIfNull(){if(1===arguments.length){const t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.elt[t].setAllLocationsIfNull(e)}}isLine(t){return this.elt[t].isLine()}merge(t){for(let e=0;e<2;e++)null===this.elt[e]&&null!==t.elt[e]?this.elt[e]=new Ma(t.elt[e]):this.elt[e].merge(t.elt[e])}flip(){this.elt[0].flip(),this.elt[1].flip()}getLocation(){if(1===arguments.length){const t=arguments[0];return this.elt[t].get($o.ON)}if(2===arguments.length){const t=arguments[0],e=arguments[1];return this.elt[t].get(e)}}toString(){const t=new oo;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()}isArea(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){const t=arguments[0];return this.elt[t].isArea()}}isAnyNull(t){return this.elt[t].isAnyNull()}setLocation(){if(2===arguments.length){const t=arguments[0],e=arguments[1];this.elt[t].setLocation($o.ON,e)}else if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];this.elt[t].setLocation(e,i)}}isEqualOnSide(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)}allPositionsEqual(t,e){return this.elt[t].allPositionsEqual(e)}toLine(t){this.elt[t].isArea()&&(this.elt[t]=new Ma(this.elt[t].location[0]))}}class Ca{constructor(){Ca.constructor_.apply(this,arguments)}static constructor_(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new so,this._pts=new so,this._label=new Ea(Wo.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new so,this._geometryFactory=null,0===arguments.length);else if(2===arguments.length){const t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()}}computeRing(){if(null!==this._ring)return null;const t=new Array(this._pts.size()).fill(null);for(let e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=co.isCCW(this._ring.getCoordinates())}isIsolated(){return 1===this._label.getGeometryCount()}computePoints(t){this._startDe=t;let e=t,i=!0;do{if(null===e)throw new Jo("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new Jo("Directed Edge visited twice during ring-building at "+e.getCoordinate());this._edges.add(e);const t=e.getLabel();Rr.isTrue(t.isArea()),this.mergeLabel(t),this.addPoints(e.getEdge(),e.isForward(),i),i=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this._startDe)}getLinearRing(){return this._ring}getCoordinate(t){return this._pts.get(t)}computeMaxNodeDegree(){this._maxNodeDegree=0;let t=this._startDe;do{const e=t.getNode().getEdges().getOutgoingDegree(this);e>this._maxNodeDegree&&(this._maxNodeDegree=e),t=this.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2}addPoints(t,e,i){const s=t.getCoordinates();if(e){let t=1;i&&(t=0);for(let e=t;e<s.length;e++)this._pts.add(s[e])}else{let t=s.length-2;i&&(t=s.length-1);for(let e=t;e>=0;e--)this._pts.add(s[e])}}isHole(){return this._isHole}setInResult(){let t=this._startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this._startDe)}containsPoint(t){const e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!wa.isInRing(t,e.getCoordinates()))return!1;for(let e=this._holes.iterator();e.hasNext();)if(e.next().containsPoint(t))return!1;return!0}addHole(t){this._holes.add(t)}isShell(){return null===this._shell}getLabel(){return this._label}getEdges(){return this._edges}getMaxNodeDegree(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}getShell(){return this._shell}mergeLabel(){if(1===arguments.length){const t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){const t=arguments[1],e=arguments[0].getLocation(t,$o.RIGHT);if(e===Wo.NONE)return null;if(this._label.getLocation(t)===Wo.NONE)return this._label.setLocation(t,e),null}}setShell(t){this._shell=t,null!==t&&t.addHole(this)}toPolygon(t){const e=new Array(this._holes.size()).fill(null);for(let t=0;t<this._holes.size();t++)e[t]=this._holes.get(t).getLinearRing();return t.createPolygon(this.getLinearRing(),e)}}class Sa extends Ca{constructor(){super(),Sa.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];Ca.constructor_.call(this,t,e)}setEdgeRing(t,e){t.setMinEdgeRing(e)}getNext(t){return t.getNextMin()}}class ba extends Ca{constructor(){super(),ba.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];Ca.constructor_.call(this,t,e)}buildMinimalRings(){const t=new so;let e=this._startDe;do{if(null===e.getMinEdgeRing()){const i=new Sa(e,this._geometryFactory);t.add(i)}e=e.getNext()}while(e!==this._startDe);return t}setEdgeRing(t,e){t.setEdgeRing(e)}linkDirectedEdgesForMinimalEdgeRings(){let t=this._startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this._startDe)}getNext(t){return t.getNext()}}class Ia{constructor(){Ia.constructor_.apply(this,arguments)}static constructor_(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){const t=arguments[0];this._label=t}}setVisited(t){this._isVisited=t}setInResult(t){this._isInResult=t}isCovered(){return this._isCovered}isCoveredSet(){return this._isCoveredSet}setLabel(t){this._label=t}getLabel(){return this._label}setCovered(t){this._isCovered=t,this._isCoveredSet=!0}updateIM(t){Rr.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)}isInResult(){return this._isInResult}isVisited(){return this._isVisited}}class La extends Ia{constructor(){super(),La.constructor_.apply(this,arguments)}static constructor_(){this._coord=null,this._edges=null;const t=arguments[0],e=arguments[1];this._coord=t,this._edges=e,this._label=new Ea(0,Wo.NONE)}isIncidentEdgeInResult(){for(let t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1}isIsolated(){return 1===this._label.getGeometryCount()}getCoordinate(){return this._coord}print(t){t.println("node "+this._coord+" lbl: "+this._label)}computeIM(t){}computeMergedLocation(t,e){let i=Wo.NONE;if(i=this._label.getLocation(e),!t.isNull(e)){const s=t.getLocation(e);i!==Wo.BOUNDARY&&(i=s)}return i}setLabel(){if(2!==arguments.length||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return super.setLabel.apply(this,arguments);{const t=arguments[0],e=arguments[1];null===this._label?this._label=new Ea(t,e):this._label.setLocation(t,e)}}getEdges(){return this._edges}mergeLabel(){if(arguments[0]instanceof La){const t=arguments[0];this.mergeLabel(t._label)}else if(arguments[0]instanceof Ea){const t=arguments[0];for(let e=0;e<2;e++){const i=this.computeMergedLocation(t,e);this._label.getLocation(e)===Wo.NONE&&this._label.setLocation(e,i)}}}add(t){this._edges.insert(t),t.setNode(this)}setLabelBoundary(t){if(null===this._label)return null;let e=Wo.NONE;null!==this._label&&(e=this._label.getLocation(t));let i=null;switch(e){case Wo.BOUNDARY:i=Wo.INTERIOR;break;case Wo.INTERIOR:default:i=Wo.BOUNDARY}this._label.setLocation(t,i)}}class Ta extends Oo{}const Na=0;function Ra(t){return null==t?Na:t.color}function Pa(t){return null==t?null:t.parent}function Oa(t,e){null!==t&&(t.color=e)}function Aa(t){return null==t?null:t.left}function Fa(t){return null==t?null:t.right}class Da extends Ta{constructor(){super(),this.root_=null,this.size_=0}get(t){let e=this.root_;for(;null!==e;){const i=t.compareTo(e.key);if(i<0)e=e.left;else{if(!(i>0))return e.value;e=e.right}}return null}put(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Na,getValue(){return this.value},getKey(){return this.key}},this.size_=1,null;let i,s,n=this.root_;do{if(i=n,s=t.compareTo(n.key),s<0)n=n.left;else{if(!(s>0)){const t=n.value;return n.value=e,t}n=n.right}}while(null!==n);const r={key:t,left:null,right:null,value:e,parent:i,color:Na,getValue(){return this.value},getKey(){return this.key}};return s<0?i.left=r:i.right=r,this.fixAfterInsertion(r),this.size_++,null}fixAfterInsertion(t){let e;for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)Pa(t)===Aa(Pa(Pa(t)))?(e=Fa(Pa(Pa(t))),1===Ra(e)?(Oa(Pa(t),Na),Oa(e,Na),Oa(Pa(Pa(t)),1),t=Pa(Pa(t))):(t===Fa(Pa(t))&&(t=Pa(t),this.rotateLeft(t)),Oa(Pa(t),Na),Oa(Pa(Pa(t)),1),this.rotateRight(Pa(Pa(t))))):(e=Aa(Pa(Pa(t))),1===Ra(e)?(Oa(Pa(t),Na),Oa(e,Na),Oa(Pa(Pa(t)),1),t=Pa(Pa(t))):(t===Aa(Pa(t))&&(t=Pa(t),this.rotateRight(t)),Oa(Pa(t),Na),Oa(Pa(Pa(t)),1),this.rotateLeft(Pa(Pa(t)))));this.root_.color=Na}values(){const t=new so;let e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=Da.successor(e));)t.add(e.value);return t}entrySet(){const t=new Ao;let e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=Da.successor(e));)t.add(e);return t}rotateLeft(t){if(null!=t){const e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null==t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}}rotateRight(t){if(null!=t){const e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null==t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}}getFirstEntry(){let t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t}static successor(t){let e;if(null===t)return null;if(null!==t.right){for(e=t.right;null!==e.left;)e=e.left;return e}{e=t.parent;let i=t;for(;null!==e&&i===e.right;)i=e,e=e.parent;return e}}size(){return this.size_}containsKey(t){let e=this.root_;for(;null!==e;){const i=t.compareTo(e.key);if(i<0)e=e.left;else{if(!(i>0))return!0;e=e.right}}return!1}}class ka{constructor(){ka.constructor_.apply(this,arguments)}static constructor_(){this.nodeMap=new Da,this.nodeFact=null;const t=arguments[0];this.nodeFact=t}find(t){return this.nodeMap.get(t)}addNode(){if(arguments[0]instanceof Fr){const t=arguments[0];let e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof La){const t=arguments[0],e=this.nodeMap.get(t.getCoordinate());return null===e?(this.nodeMap.put(t.getCoordinate(),t),t):(e.mergeLabel(t),e)}}print(t){for(let e=this.iterator();e.hasNext();)e.next().print(t)}iterator(){return this.nodeMap.values().iterator()}values(){return this.nodeMap.values()}getBoundaryNodes(t){const e=new so;for(let i=this.iterator();i.hasNext();){const s=i.next();s.getLabel().getLocation(t)===Wo.BOUNDARY&&e.add(s)}return e}add(t){const e=t.getCoordinate();this.addNode(e).add(t)}}class Ga{static isNorthern(t){return t===Ga.NE||t===Ga.NW}static isOpposite(t,e){return t!==e&&2==(t-e+4)%4}static commonHalfPlane(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;const i=t<e?t:e;return 0===i&&3===(t>e?t:e)?3:i}static isInHalfPlane(t,e){return e===Ga.SE?t===Ga.SE||t===Ga.SW:t===e||t===e+1}static quadrant(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){const t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new Er("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Ga.NE:Ga.SE:e>=0?Ga.NW:Ga.SW}if(arguments[0]instanceof Fr&&arguments[1]instanceof Fr){const t=arguments[0],e=arguments[1];if(e.x===t.x&&e.y===t.y)throw new Er("Cannot compute the quadrant for two identical points "+t);return e.x>=t.x?e.y>=t.y?Ga.NE:Ga.SE:e.y>=t.y?Ga.NW:Ga.SW}}}Ga.NE=0,Ga.NW=1,Ga.SW=2,Ga.SE=3;class za{constructor(){za.constructor_.apply(this,arguments)}static constructor_(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){const t=arguments[0];this._edge=t}else if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];za.constructor_.call(this,t,e,i,null)}else if(4===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];za.constructor_.call(this,t),this.init(e,i),this._label=s}}compareDirection(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:co.index(t._p0,t._p1,this._p1)}getDy(){return this._dy}getCoordinate(){return this._p0}setNode(t){this._node=t}print(t){const e=Math.atan2(this._dy,this._dx),i=this.getClass().getName(),s=i.lastIndexOf("."),n=i.substring(s+1);t.print("  "+n+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)}compareTo(t){const e=t;return this.compareDirection(e)}getDirectedCoordinate(){return this._p1}getDx(){return this._dx}getLabel(){return this._label}getEdge(){return this._edge}getQuadrant(){return this._quadrant}getNode(){return this._node}toString(){const t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),i=e.lastIndexOf(".");return"  "+e.substring(i+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label}computeLabel(t){}init(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Ga.quadrant(this._dx,this._dy),Rr.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")}get interfaces_(){return[Sr]}}class Ba extends za{constructor(){super(),Ba.constructor_.apply(this,arguments)}static constructor_(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];const t=arguments[0],e=arguments[1];if(za.constructor_.call(this,t),this._isForward=e,e)this.init(t.getCoordinate(0),t.getCoordinate(1));else{const e=t.getNumPoints()-1;this.init(t.getCoordinate(e),t.getCoordinate(e-1))}this.computeDirectedLabel()}static depthFactor(t,e){return t===Wo.EXTERIOR&&e===Wo.INTERIOR?1:t===Wo.INTERIOR&&e===Wo.EXTERIOR?-1:0}getNextMin(){return this._nextMin}getDepth(t){return this._depth[t]}setVisited(t){this._isVisited=t}computeDirectedLabel(){this._label=new Ea(this._edge.getLabel()),this._isForward||this._label.flip()}getNext(){return this._next}setDepth(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new Jo("assigned depths do not match",this.getCoordinate());this._depth[t]=e}isInteriorAreaEdge(){let t=!0;for(let e=0;e<2;e++)this._label.isArea(e)&&this._label.getLocation(e,$o.LEFT)===Wo.INTERIOR&&this._label.getLocation(e,$o.RIGHT)===Wo.INTERIOR||(t=!1);return t}setNextMin(t){this._nextMin=t}print(t){super.print.call(this,t),t.print(" "+this._depth[$o.LEFT]+"/"+this._depth[$o.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this._isInResult&&t.print(" inResult")}setMinEdgeRing(t){this._minEdgeRing=t}isLineEdge(){const t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,Wo.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,Wo.EXTERIOR);return t&&e&&i}setEdgeRing(t){this._edgeRing=t}getMinEdgeRing(){return this._minEdgeRing}getDepthDelta(){let t=this._edge.getDepthDelta();return this._isForward||(t=-t),t}setInResult(t){this._isInResult=t}getSym(){return this._sym}isForward(){return this._isForward}getEdge(){return this._edge}printEdge(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)}setSym(t){this._sym=t}setVisitedEdge(t){this.setVisited(t),this._sym.setVisited(t)}setEdgeDepths(t,e){let i=this.getEdge().getDepthDelta();this._isForward||(i=-i);let s=1;t===$o.LEFT&&(s=-1);const n=$o.opposite(t),r=e+i*s;this.setDepth(t,e),this.setDepth(n,r)}getEdgeRing(){return this._edgeRing}isInResult(){return this._isInResult}setNext(t){this._next=t}isVisited(){return this._isVisited}}class ja{createNode(t){return new La(t,null)}}class qa{constructor(){qa.constructor_.apply(this,arguments)}static constructor_(){if(this._edges=new so,this._nodes=null,this._edgeEndList=new so,0===arguments.length)this._nodes=new ka(new ja);else if(1===arguments.length){const t=arguments[0];this._nodes=new ka(t)}}static linkResultDirectedEdges(t){for(let e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()}printEdges(t){t.println("Edges:");for(let e=0;e<this._edges.size();e++){t.println("edge "+e+":");const i=this._edges.get(e);i.print(t),i.eiList.print(t)}}find(t){return this._nodes.find(t)}addNode(){if(arguments[0]instanceof La){const t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof Fr){const t=arguments[0];return this._nodes.addNode(t)}}getNodeIterator(){return this._nodes.iterator()}linkResultDirectedEdges(){for(let t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()}debugPrintln(t){Io.out.println(t)}isBoundaryNode(t,e){const i=this._nodes.find(e);if(null===i)return!1;const s=i.getLabel();return null!==s&&s.getLocation(t)===Wo.BOUNDARY}linkAllDirectedEdges(){for(let t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()}matchInSameDirection(t,e,i,s){return!!t.equals(i)&&co.index(t,e,s)===co.COLLINEAR&&Ga.quadrant(t,e)===Ga.quadrant(i,s)}getEdgeEnds(){return this._edgeEndList}debugPrint(t){Io.out.print(t)}getEdgeIterator(){return this._edges.iterator()}findEdgeInSameDirection(t,e){for(let i=0;i<this._edges.size();i++){const s=this._edges.get(i),n=s.getCoordinates();if(this.matchInSameDirection(t,e,n[0],n[1]))return s;if(this.matchInSameDirection(t,e,n[n.length-1],n[n.length-2]))return s}return null}insertEdge(t){this._edges.add(t)}findEdgeEnd(t){for(let e=this.getEdgeEnds().iterator();e.hasNext();){const i=e.next();if(i.getEdge()===t)return i}return null}addEdges(t){for(let e=t.iterator();e.hasNext();){const t=e.next();this._edges.add(t);const i=new Ba(t,!0),s=new Ba(t,!1);i.setSym(s),s.setSym(i),this.add(i),this.add(s)}}add(t){this._nodes.add(t),this._edgeEndList.add(t)}getNodes(){return this._nodes.values()}findEdge(t,e){for(let i=0;i<this._edges.size();i++){const s=this._edges.get(i),n=s.getCoordinates();if(t.equals(n[0])&&e.equals(n[1]))return s}return null}}class Ua{constructor(){Ua.constructor_.apply(this,arguments)}static constructor_(){this._geometryFactory=null,this._shellList=new so;const t=arguments[0];this._geometryFactory=t}static findEdgeRingContaining(t,e){const i=t.getLinearRing(),s=i.getEnvelopeInternal();let n=i.getCoordinateN(0),r=null,o=null;for(let t=e.iterator();t.hasNext();){const e=t.next(),a=e.getLinearRing(),h=a.getEnvelopeInternal();if(h.equals(s))continue;if(!h.contains(s))continue;n=Lo.ptNotInList(i.getCoordinates(),a.getCoordinates());let l=!1;wa.isInRing(n,a.getCoordinates())&&(l=!0),l&&(null===r||o.contains(h))&&(r=e,o=r.getLinearRing().getEnvelopeInternal())}return r}sortShellsAndHoles(t,e,i){for(let s=t.iterator();s.hasNext();){const t=s.next();t.isHole()?i.add(t):e.add(t)}}computePolygons(t){const e=new so;for(let i=t.iterator();i.hasNext();){const t=i.next().toPolygon(this._geometryFactory);e.add(t)}return e}placeFreeHoles(t,e){for(let i=e.iterator();i.hasNext();){const e=i.next();if(null===e.getShell()){const i=Ua.findEdgeRingContaining(e,t);if(null===i)throw new Jo("unable to assign hole to a shell",e.getCoordinate(0));e.setShell(i)}}}buildMinimalEdgeRings(t,e,i){const s=new so;for(let n=t.iterator();n.hasNext();){const t=n.next();if(t.getMaxNodeDegree()>2){t.linkDirectedEdgesForMinimalEdgeRings();const s=t.buildMinimalRings(),n=this.findShell(s);null!==n?(this.placePolygonHoles(n,s),e.add(n)):i.addAll(s)}else s.add(t)}return s}buildMaximalEdgeRings(t){const e=new so;for(let i=t.iterator();i.hasNext();){const t=i.next();if(t.isInResult()&&t.getLabel().isArea()&&null===t.getEdgeRing()){const i=new ba(t,this._geometryFactory);e.add(i),i.setInResult()}}return e}placePolygonHoles(t,e){for(let i=e.iterator();i.hasNext();){const e=i.next();e.isHole()&&e.setShell(t)}}getPolygons(){return this.computePolygons(this._shellList)}findShell(t){let e=0,i=null;for(let s=t.iterator();s.hasNext();){const t=s.next();t.isHole()||(i=t,e++)}return Rr.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),i}add(){if(1===arguments.length){const t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){const t=arguments[0],e=arguments[1];qa.linkResultDirectedEdges(e);const i=this.buildMaximalEdgeRings(t),s=new so,n=this.buildMinimalEdgeRings(i,this._shellList,s);this.sortShellsAndHoles(n,this._shellList,s),this.placeFreeHoles(this._shellList,s)}}}class Ya{getBounds(){}}class Va{constructor(){Va.constructor_.apply(this,arguments)}static constructor_(){this._bounds=null,this._item=null;const t=arguments[0],e=arguments[1];this._bounds=t,this._item=e}getItem(){return this._item}getBounds(){return this._bounds}get interfaces_(){return[Ya,br]}}class Xa{constructor(){Xa.constructor_.apply(this,arguments)}static constructor_(){this._size=null,this._items=null,this._size=0,this._items=new so,this._items.add(null)}poll(){if(this.isEmpty())return null;const t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t}size(){return this._size}reorder(t){let e=null;const i=this._items.get(t);for(;2*t<=this._size&&(e=2*t,e!==this._size&&this._items.get(e+1).compareTo(this._items.get(e))<0&&e++,this._items.get(e).compareTo(i)<0);t=e)this._items.set(t,this._items.get(e));this._items.set(t,i)}clear(){this._size=0,this._items.clear()}peek(){return this.isEmpty()?null:this._items.get(1)}isEmpty(){return 0===this._size}add(t){this._items.add(null),this._size+=1;let e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)}}class Wa{insert(t,e){}remove(t,e){}query(){}}class $a{constructor(){$a.constructor_.apply(this,arguments)}static constructor_(){if(this._childBoundables=new so,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){const t=arguments[0];this._level=t}}getLevel(){return this._level}size(){return this._childBoundables.size()}getChildBoundables(){return this._childBoundables}addChildBoundable(t){Rr.isTrue(null===this._bounds),this._childBoundables.add(t)}isEmpty(){return this._childBoundables.isEmpty()}getBounds(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds}get interfaces_(){return[Ya,br]}}const Ha={reverseOrder:function(){return{compare:(t,e)=>e.compareTo(t)}},min:function(t){return Ha.sort(t),t.get(0)},sort:function(t,e){const i=t.toArray();e?ro.sort(i,e):ro.sort(i);const s=t.iterator();for(let t=0,e=i.length;t<e;t++)s.next(),s.set(i[t])},singletonList:function(t){const e=new so;return e.add(t),e}},Ka=Ha;class Za{static maxDistance(t,e,i,s,n,r,o,a){let h=Za.distance(t,e,n,r);return h=Math.max(h,Za.distance(t,e,o,a)),h=Math.max(h,Za.distance(i,s,n,r)),h=Math.max(h,Za.distance(i,s,o,a)),h}static distance(t,e,i,s){const n=i-t,r=s-e;return Math.sqrt(n*n+r*r)}static maximumDistance(t,e){const i=Math.min(t.getMinX(),e.getMinX()),s=Math.min(t.getMinY(),e.getMinY()),n=Math.max(t.getMaxX(),e.getMaxX()),r=Math.max(t.getMaxY(),e.getMaxY());return Za.distance(i,s,n,r)}static minMaxDistance(t,e){const i=t.getMinX(),s=t.getMinY(),n=t.getMaxX(),r=t.getMaxY(),o=e.getMinX(),a=e.getMinY(),h=e.getMaxX(),l=e.getMaxY();let c=Za.maxDistance(i,s,i,r,o,a,o,l);return c=Math.min(c,Za.maxDistance(i,s,i,r,o,a,h,a)),c=Math.min(c,Za.maxDistance(i,s,i,r,h,l,o,l)),c=Math.min(c,Za.maxDistance(i,s,i,r,h,l,h,a)),c=Math.min(c,Za.maxDistance(i,s,n,s,o,a,o,l)),c=Math.min(c,Za.maxDistance(i,s,n,s,o,a,h,a)),c=Math.min(c,Za.maxDistance(i,s,n,s,h,l,o,l)),c=Math.min(c,Za.maxDistance(i,s,n,s,h,l,h,a)),c=Math.min(c,Za.maxDistance(n,r,i,r,o,a,o,l)),c=Math.min(c,Za.maxDistance(n,r,i,r,o,a,h,a)),c=Math.min(c,Za.maxDistance(n,r,i,r,h,l,o,l)),c=Math.min(c,Za.maxDistance(n,r,i,r,h,l,h,a)),c=Math.min(c,Za.maxDistance(n,r,n,s,o,a,o,l)),c=Math.min(c,Za.maxDistance(n,r,n,s,o,a,h,a)),c=Math.min(c,Za.maxDistance(n,r,n,s,h,l,o,l)),c=Math.min(c,Za.maxDistance(n,r,n,s,h,l,h,a)),c}}class Ja{constructor(){Ja.constructor_.apply(this,arguments)}static constructor_(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;const t=arguments[0],e=arguments[1],i=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=i,this._distance=this.distance()}static area(t){return t.getBounds().getArea()}static isComposite(t){return t instanceof $a}maximumDistance(){return Za.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}expandToQueue(t,e){const i=Ja.isComposite(this._boundable1),s=Ja.isComposite(this._boundable2);if(i&&s)return Ja.area(this._boundable1)>Ja.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,t,e),null):(this.expand(this._boundable2,this._boundable1,!0,t,e),null);if(i)return this.expand(this._boundable1,this._boundable2,!1,t,e),null;if(s)return this.expand(this._boundable2,this._boundable1,!0,t,e),null;throw new Er("neither boundable is composite")}isLeaves(){return!(Ja.isComposite(this._boundable1)||Ja.isComposite(this._boundable2))}compareTo(t){const e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0}expand(t,e,i,s,n){for(let r=t.getChildBoundables().iterator();r.hasNext();){const t=r.next();let o=null;o=i?new Ja(e,t,this._itemDistance):new Ja(t,e,this._itemDistance),o.getDistance()<n&&s.add(o)}}getBoundable(t){return 0===t?this._boundable1:this._boundable2}getDistance(){return this._distance}distance(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}get interfaces_(){return[Sr]}}class Qa{visitItem(t){}}class th{constructor(){th.constructor_.apply(this,arguments)}static constructor_(){if(this._root=null,this._built=!1,this._itemBoundables=new so,this._nodeCapacity=null,0===arguments.length)th.constructor_.call(this,th.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){const t=arguments[0];Rr.isTrue(t>1,"Node capacity must be greater than 1"),this._nodeCapacity=t}}static compareDoubles(t,e){return t>e?1:t<e?-1:0}queryInternal(){if(fr(arguments[2],Qa)&&arguments[0]instanceof Object&&arguments[1]instanceof $a){const t=arguments[0],e=arguments[2],i=arguments[1].getChildBoundables();for(let s=0;s<i.size();s++){const n=i.get(s);this.getIntersectsOp().intersects(n.getBounds(),t)&&(n instanceof $a?this.queryInternal(t,n,e):n instanceof Va?e.visitItem(n.getItem()):Rr.shouldNeverReachHere())}}else if(fr(arguments[2],eo)&&arguments[0]instanceof Object&&arguments[1]instanceof $a){const t=arguments[0],e=arguments[2],i=arguments[1].getChildBoundables();for(let s=0;s<i.size();s++){const n=i.get(s);this.getIntersectsOp().intersects(n.getBounds(),t)&&(n instanceof $a?this.queryInternal(t,n,e):n instanceof Va?e.add(n.getItem()):Rr.shouldNeverReachHere())}}}getNodeCapacity(){return this._nodeCapacity}lastNode(t){return t.get(t.size()-1)}size(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){let t=0;for(let e=arguments[0].getChildBoundables().iterator();e.hasNext();){const i=e.next();i instanceof $a?t+=this.size(i):i instanceof Va&&(t+=1)}return t}}removeItem(t,e){let i=null;for(let s=t.getChildBoundables().iterator();s.hasNext();){const t=s.next();t instanceof Va&&t.getItem()===e&&(i=t)}return null!==i&&(t.getChildBoundables().remove(i),!0)}itemsTree(){if(0===arguments.length){this.build();const t=this.itemsTree(this._root);return null===t?new so:t}if(1===arguments.length){const t=arguments[0],e=new so;for(let i=t.getChildBoundables().iterator();i.hasNext();){const t=i.next();if(t instanceof $a){const i=this.itemsTree(t);null!==i&&e.add(i)}else t instanceof Va?e.add(t.getItem()):Rr.shouldNeverReachHere()}return e.size()<=0?null:e}}insert(t,e){Rr.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Va(t,e))}boundablesAtLevel(){if(1===arguments.length){const t=arguments[0],e=new so;return this.boundablesAtLevel(t,this._root,e),e}if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];if(Rr.isTrue(t>-2),e.getLevel()===t)return i.add(e),null;for(let s=e.getChildBoundables().iterator();s.hasNext();){const e=s.next();e instanceof $a?this.boundablesAtLevel(t,e,i):(Rr.isTrue(e instanceof Va),-1===t&&i.add(e))}return null}}query(){if(1===arguments.length){const t=arguments[0];this.build();const e=new so;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.queryInternal(t,this._root,e),e}if(2===arguments.length){const t=arguments[0],e=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.queryInternal(t,this._root,e)}}build(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}getRoot(){return this.build(),this._root}remove(){if(2===arguments.length){const t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.remove(t,this._root,e)}if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];let s=this.removeItem(e,i);if(s)return!0;let n=null;for(let r=e.getChildBoundables().iterator();r.hasNext();){const e=r.next();if(this.getIntersectsOp().intersects(e.getBounds(),t)&&e instanceof $a&&(s=this.remove(t,e,i),s)){n=e;break}}return null!==n&&n.getChildBoundables().isEmpty()&&e.getChildBoundables().remove(n),s}}createHigherLevels(t,e){Rr.isTrue(!t.isEmpty());const i=this.createParentBoundables(t,e+1);return 1===i.size()?i.get(0):this.createHigherLevels(i,e+1)}depth(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){let t=0;for(let e=arguments[0].getChildBoundables().iterator();e.hasNext();){const i=e.next();if(i instanceof $a){const e=this.depth(i);e>t&&(t=e)}}return t+1}}createParentBoundables(t,e){Rr.isTrue(!t.isEmpty());const i=new so;i.add(this.createNode(e));const s=new so(t);Ka.sort(s,this.getComparator());for(let t=s.iterator();t.hasNext();){const s=t.next();this.lastNode(i).getChildBoundables().size()===this.getNodeCapacity()&&i.add(this.createNode(e)),this.lastNode(i).addChildBoundable(s)}return i}isEmpty(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}get interfaces_(){return[br]}}th.IntersectsOp=function(){},th.DEFAULT_NODE_CAPACITY=10;class eh{distance(t,e){}}class ih extends th{constructor(){super(),ih.constructor_.apply(this,arguments)}static constructor_(){if(0===arguments.length)ih.constructor_.call(this,ih.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){const t=arguments[0];th.constructor_.call(this,t)}}static centreX(t){return ih.avg(t.getMinX(),t.getMaxX())}static avg(t,e){return(t+e)/2}static getItems(t){const e=new Array(t.size()).fill(null);let i=0;for(;!t.isEmpty();){const s=t.poll();e[i]=s.getBoundable(0).getItem(),i++}return e}static centreY(t){return ih.avg(t.getMinY(),t.getMaxY())}createParentBoundablesFromVerticalSlices(t,e){Rr.isTrue(t.length>0);const i=new so;for(let s=0;s<t.length;s++)i.addAll(this.createParentBoundablesFromVerticalSlice(t[s],e));return i}nearestNeighbourK(){if(2===arguments.length){const t=arguments[0],e=arguments[1];return this.nearestNeighbourK(t,yr.POSITIVE_INFINITY,e)}if(3===arguments.length){const t=arguments[0],e=arguments[2];let i=arguments[1];const s=new Xa;s.add(t);const n=new Xa;for(;!s.isEmpty()&&i>=0;){const t=s.poll(),r=t.getDistance();if(r>=i)break;t.isLeaves()?n.size()<e?n.add(t):(n.peek().getDistance()>r&&(n.poll(),n.add(t)),i=n.peek().getDistance()):t.expandToQueue(s,i)}return ih.getItems(n)}}createNode(t){return new sh(t)}size(){return 0===arguments.length?super.size.call(this):super.size.apply(this,arguments)}insert(){if(!(2===arguments.length&&arguments[1]instanceof Object&&arguments[0]instanceof kr))return super.insert.apply(this,arguments);{const t=arguments[0],e=arguments[1];if(t.isNull())return null;super.insert.call(this,t,e)}}getIntersectsOp(){return ih.intersectsOp}verticalSlices(t,e){const i=Math.trunc(Math.ceil(t.size()/e)),s=new Array(e).fill(null),n=t.iterator();for(let t=0;t<e;t++){s[t]=new so;let e=0;for(;n.hasNext()&&e<i;){const i=n.next();s[t].add(i),e++}}return s}query(){if(1===arguments.length){const t=arguments[0];return super.query.call(this,t)}if(2===arguments.length){const t=arguments[0],e=arguments[1];super.query.call(this,t,e)}}getComparator(){return ih.yComparator}createParentBoundablesFromVerticalSlice(t,e){return super.createParentBoundables.call(this,t,e)}remove(){if(2===arguments.length&&arguments[1]instanceof Object&&arguments[0]instanceof kr){const t=arguments[0],e=arguments[1];return super.remove.call(this,t,e)}return super.remove.apply(this,arguments)}depth(){return 0===arguments.length?super.depth.call(this):super.depth.apply(this,arguments)}createParentBoundables(t,e){Rr.isTrue(!t.isEmpty());const i=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),s=new so(t);Ka.sort(s,ih.xComparator);const n=this.verticalSlices(s,Math.trunc(Math.ceil(Math.sqrt(i))));return this.createParentBoundablesFromVerticalSlices(n,e)}nearestNeighbour(){if(1===arguments.length){if(fr(arguments[0],eh)){const t=arguments[0];if(this.isEmpty())return null;const e=new Ja(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}if(arguments[0]instanceof Ja){const t=arguments[0];let e=yr.POSITIVE_INFINITY,i=null;const s=new Xa;for(s.add(t);!s.isEmpty()&&e>0;){const t=s.poll(),n=t.getDistance();if(n>=e)break;t.isLeaves()?(e=n,i=t):t.expandToQueue(s,e)}return null===i?null:[i.getBoundable(0).getItem(),i.getBoundable(1).getItem()]}}else{if(2===arguments.length){const t=arguments[0],e=arguments[1];if(this.isEmpty()||t.isEmpty())return null;const i=new Ja(this.getRoot(),t.getRoot(),e);return this.nearestNeighbour(i)}if(3===arguments.length){const t=arguments[2],e=new Va(arguments[0],arguments[1]),i=new Ja(this.getRoot(),e,t);return this.nearestNeighbour(i)[0]}if(4===arguments.length){const t=arguments[2],e=arguments[3],i=new Va(arguments[0],arguments[1]),s=new Ja(this.getRoot(),i,t);return this.nearestNeighbourK(s,e)}}}isWithinDistance(){if(2===arguments.length){const t=arguments[0],e=arguments[1];let i=yr.POSITIVE_INFINITY;const s=new Xa;for(s.add(t);!s.isEmpty();){const t=s.poll(),n=t.getDistance();if(n>e)return!1;if(t.maximumDistance()<=e)return!0;if(t.isLeaves()){if(i=n,i<=e)return!0}else t.expandToQueue(s,i)}return!1}if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=new Ja(this.getRoot(),t.getRoot(),e);return this.isWithinDistance(s,i)}}get interfaces_(){return[Wa,br]}}class sh extends $a{constructor(){super(),sh.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0];$a.constructor_.call(this,t)}computeBounds(){let t=null;for(let e=this.getChildBoundables().iterator();e.hasNext();){const i=e.next();null===t?t=new kr(i.getBounds()):t.expandToInclude(i.getBounds())}return t}}ih.STRtreeNode=sh,ih.xComparator=new class{get interfaces_(){return[Lr]}compare(t,e){return th.compareDoubles(ih.centreX(t.getBounds()),ih.centreX(e.getBounds()))}},ih.yComparator=new class{get interfaces_(){return[Lr]}compare(t,e){return th.compareDoubles(ih.centreY(t.getBounds()),ih.centreY(e.getBounds()))}},ih.intersectsOp=new class{get interfaces_(){return[IntersectsOp]}intersects(t,e){return t.intersects(e)}},ih.DEFAULT_NODE_CAPACITY=10;class nh{static relativeSign(t,e){return t<e?-1:t>e?1:0}static compare(t,e,i){if(e.equals2D(i))return 0;const s=nh.relativeSign(e.x,i.x),n=nh.relativeSign(e.y,i.y);switch(t){case 0:return nh.compareValue(s,n);case 1:return nh.compareValue(n,s);case 2:return nh.compareValue(n,-s);case 3:return nh.compareValue(-s,n);case 4:return nh.compareValue(-s,-n);case 5:return nh.compareValue(-n,-s);case 6:return nh.compareValue(-n,s);case 7:return nh.compareValue(s,-n)}return Rr.shouldNeverReachHere("invalid octant value"),0}static compareValue(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0}}class rh{constructor(){rh.constructor_.apply(this,arguments)}static constructor_(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];this._segString=t,this.coord=new Fr(e),this.segmentIndex=i,this._segmentOctant=s,this._isInterior=!e.equals2D(t.getCoordinate(i))}getCoordinate(){return this.coord}print(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)}compareTo(t){const e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:this._isInterior?e._isInterior?nh.compare(this._segmentOctant,this.coord,e.coord):1:-1}isEndPoint(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t}toString(){return this.segmentIndex+":"+this.coord.toString()}isInterior(){return this._isInterior}get interfaces_(){return[Sr]}}class oh{constructor(){oh.constructor_.apply(this,arguments)}static constructor_(){this._nodeMap=new Da,this._edge=null;const t=arguments[0];this._edge=t}getSplitCoordinates(){const t=new So;this.addEndpoints();const e=this.iterator();let i=e.next();for(;e.hasNext();){const s=e.next();this.addEdgeCoordinates(i,s,t),i=s}return t.toCoordinateArray()}addCollapsedNodes(){const t=new so;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(let e=t.iterator();e.hasNext();){const t=e.next().intValue();this.add(this._edge.getCoordinate(t),t)}}createSplitEdgePts(t,e){let i=e.segmentIndex-t.segmentIndex+2;if(2===i)return[new Fr(t.coord),new Fr(e.coord)];const s=this._edge.getCoordinate(e.segmentIndex),n=e.isInterior()||!e.coord.equals2D(s);n||i--;const r=new Array(i).fill(null);let o=0;r[o++]=new Fr(t.coord);for(let i=t.segmentIndex+1;i<=e.segmentIndex;i++)r[o++]=this._edge.getCoordinate(i);return n&&(r[o]=new Fr(e.coord)),r}print(t){t.println("Intersections:");for(let e=this.iterator();e.hasNext();)e.next().print(t)}findCollapsesFromExistingVertices(t){for(let e=0;e<this._edge.size()-2;e++){const i=this._edge.getCoordinate(e),s=(this._edge.getCoordinate(e+1),this._edge.getCoordinate(e+2));i.equals2D(s)&&t.add(ao.valueOf(e+1))}}addEdgeCoordinates(t,e,i){const s=this.createSplitEdgePts(t,e);i.add(s,!1)}iterator(){return this._nodeMap.values().iterator()}addSplitEdges(t){this.addEndpoints(),this.addCollapsedNodes();const e=this.iterator();let i=e.next();for(;e.hasNext();){const s=e.next(),n=this.createSplitEdge(i,s);t.add(n),i=s}}findCollapseIndex(t,e,i){if(!t.coord.equals2D(e.coord))return!1;let s=e.segmentIndex-t.segmentIndex;return e.isInterior()||s--,1===s&&(i[0]=t.segmentIndex+1,!0)}findCollapsesFromInsertedNodes(t){const e=new Array(1).fill(null),i=this.iterator();let s=i.next();for(;i.hasNext();){const n=i.next();this.findCollapseIndex(s,n,e)&&t.add(ao.valueOf(e[0])),s=n}}getEdge(){return this._edge}addEndpoints(){const t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)}createSplitEdge(t,e){const i=this.createSplitEdgePts(t,e);return new ch(i,this._edge.getData())}add(t,e){const i=new rh(this._edge,t,e,this._edge.getSegmentOctant(e)),s=this._nodeMap.get(i);return null!==s?(Rr.isTrue(s.coord.equals2D(t),"Found equal nodes with different coordinates"),s):(this._nodeMap.put(i,i),i)}checkSplitEdgesCorrectness(t){const e=this._edge.getCoordinates(),i=t.get(0).getCoordinate(0);if(!i.equals2D(e[0]))throw new Tr("bad split edge start point at "+i);const s=t.get(t.size()-1).getCoordinates(),n=s[s.length-1];if(!n.equals2D(e[e.length-1]))throw new Tr("bad split edge end point at "+n)}}class ah{static octant(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){const t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new Er("Cannot compute the octant for point ( "+t+", "+e+" )");const i=Math.abs(t),s=Math.abs(e);return t>=0?e>=0?i>=s?0:1:i>=s?7:6:e>=0?i>=s?3:2:i>=s?4:5}if(arguments[0]instanceof Fr&&arguments[1]instanceof Fr){const t=arguments[0],e=arguments[1],i=e.x-t.x,s=e.y-t.y;if(0===i&&0===s)throw new Er("Cannot compute the octant for two identical points "+t);return ah.octant(i,s)}}}class hh{getCoordinates(){}size(){}getCoordinate(t){}isClosed(){}setData(t){}getData(){}}class lh{addIntersection(t,e){}get interfaces_(){return[hh]}}class ch{constructor(){ch.constructor_.apply(this,arguments)}static constructor_(){this._nodeList=new oh(this),this._pts=null,this._data=null;const t=arguments[0],e=arguments[1];this._pts=t,this._data=e}static getNodedSubstrings(){if(1===arguments.length){const t=arguments[0],e=new so;return ch.getNodedSubstrings(t,e),e}if(2===arguments.length){const t=arguments[1];for(let e=arguments[0].iterator();e.hasNext();)e.next().getNodeList().addSplitEdges(t)}}getCoordinates(){return this._pts}size(){return this._pts.length}getCoordinate(t){return this._pts[t]}isClosed(){return this._pts[0].equals(this._pts[this._pts.length-1])}getSegmentOctant(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))}setData(t){this._data=t}safeOctant(t,e){return t.equals2D(e)?0:ah.octant(t,e)}getData(){return this._data}addIntersection(){if(2===arguments.length){const t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){const t=arguments[1],e=arguments[3],i=new Fr(arguments[0].getIntersection(e));this.addIntersection(i,t)}}toString(){return ma.toLineString(new No(this._pts))}getNodeList(){return this._nodeList}addIntersectionNode(t,e){let i=e;const s=i+1;if(s<this._pts.length){const e=this._pts[s];t.equals2D(e)&&(i=s)}return this._nodeList.add(t,i)}addIntersections(t,e,i){for(let s=0;s<t.getIntersectionNum();s++)this.addIntersection(t,e,i,s)}get interfaces_(){return[lh]}}class uh{constructor(){uh.constructor_.apply(this,arguments)}static constructor_(){if(this.p0=null,this.p1=null,0===arguments.length)uh.constructor_.call(this,new Fr,new Fr);else if(1===arguments.length){const t=arguments[0];uh.constructor_.call(this,t.p0,t.p1)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.p0=t,this.p1=e}else if(4===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];uh.constructor_.call(this,new Fr(t,e),new Fr(i,s))}}static midPoint(t,e){return new Fr((t.x+e.x)/2,(t.y+e.y)/2)}minX(){return Math.min(this.p0.x,this.p1.x)}orientationIndex(){if(arguments[0]instanceof uh){const t=arguments[0],e=co.index(this.p0,this.p1,t.p0),i=co.index(this.p0,this.p1,t.p1);return e>=0&&i>=0||e<=0&&i<=0?Math.max(e,i):0}if(arguments[0]instanceof Fr){const t=arguments[0];return co.index(this.p0,this.p1,t)}}toGeometry(t){return t.createLineString([this.p0,this.p1])}isVertical(){return this.p0.x===this.p1.x}equals(t){if(!(t instanceof uh))return!1;const e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)}intersection(t){const e=new xa;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null}project(){if(arguments[0]instanceof Fr){const t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new Fr(t);const e=this.projectionFactor(t),i=new Fr;return i.x=this.p0.x+e*(this.p1.x-this.p0.x),i.y=this.p0.y+e*(this.p1.y-this.p0.y),i}if(arguments[0]instanceof uh){const t=arguments[0],e=this.projectionFactor(t.p0),i=this.projectionFactor(t.p1);if(e>=1&&i>=1)return null;if(e<=0&&i<=0)return null;let s=this.project(t.p0);e<0&&(s=this.p0),e>1&&(s=this.p1);let n=this.project(t.p1);return i<0&&(n=this.p0),i>1&&(n=this.p1),new uh(s,n)}}normalize(){this.p1.compareTo(this.p0)<0&&this.reverse()}angle(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}getCoordinate(t){return 0===t?this.p0:this.p1}distancePerpendicular(t){return ia.pointToLinePerpendicular(t,this.p0,this.p1)}minY(){return Math.min(this.p0.y,this.p1.y)}midPoint(){return uh.midPoint(this.p0,this.p1)}projectionFactor(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;const e=this.p1.x-this.p0.x,i=this.p1.y-this.p0.y,s=e*e+i*i;return s<=0?yr.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*i)/s}closestPoints(t){const e=this.intersection(t);if(null!==e)return[e,e];const i=new Array(2).fill(null);let s=yr.MAX_VALUE,n=null;const r=this.closestPoint(t.p0);s=r.distance(t.p0),i[0]=r,i[1]=t.p0;const o=this.closestPoint(t.p1);n=o.distance(t.p1),n<s&&(s=n,i[0]=o,i[1]=t.p1);const a=t.closestPoint(this.p0);n=a.distance(this.p0),n<s&&(s=n,i[0]=this.p0,i[1]=a);const h=t.closestPoint(this.p1);return n=h.distance(this.p1),n<s&&(s=n,i[0]=this.p1,i[1]=h),i}closestPoint(t){const e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1}maxX(){return Math.max(this.p0.x,this.p1.x)}getLength(){return this.p0.distance(this.p1)}compareTo(t){const e=t,i=this.p0.compareTo(e.p0);return 0!==i?i:this.p1.compareTo(e.p1)}reverse(){const t=this.p0;this.p0=this.p1,this.p1=t}equalsTopo(t){return this.p0.equals(t.p0)&&this.p1.equals(t.p1)||this.p0.equals(t.p1)&&this.p1.equals(t.p0)}lineIntersection(t){return ea.intersection(this.p0,this.p1,t.p0,t.p1)}maxY(){return Math.max(this.p0.y,this.p1.y)}pointAlongOffset(t,e){const i=this.p0.x+t*(this.p1.x-this.p0.x),s=this.p0.y+t*(this.p1.y-this.p0.y),n=this.p1.x-this.p0.x,r=this.p1.y-this.p0.y,o=Math.sqrt(n*n+r*r);let a=0,h=0;if(0!==e){if(o<=0)throw new Kr("Cannot compute offset from zero-length line segment");a=e*n/o,h=e*r/o}return new Fr(i-h,s+a)}setCoordinates(){if(1===arguments.length){const t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=e.x,this.p1.y=e.y}}segmentFraction(t){let e=this.projectionFactor(t);return e<0?e=0:(e>1||yr.isNaN(e))&&(e=1),e}toString(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}isHorizontal(){return this.p0.y===this.p1.y}reflect(t){const e=this.p1.getY()-this.p0.getY(),i=this.p0.getX()-this.p1.getX(),s=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),n=e*e+i*i,r=e*e-i*i,o=t.getX(),a=t.getY();return new Fr((-r*o-2*e*i*a-2*e*s)/n,(r*a-2*e*i*o-2*i*s)/n)}distance(){if(arguments[0]instanceof uh){const t=arguments[0];return ia.segmentToSegment(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof Fr){const t=arguments[0];return ia.pointToSegment(t,this.p0,this.p1)}}pointAlong(t){const e=new Fr;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e}hashCode(){let t=yr.doubleToLongBits(this.p0.x);t^=31*yr.doubleToLongBits(this.p0.y);const e=Math.trunc(t)^Math.trunc(t>>32);let i=yr.doubleToLongBits(this.p1.x);return i^=31*yr.doubleToLongBits(this.p1.y),e^Math.trunc(i)^Math.trunc(i>>32)}get interfaces_(){return[Sr,br]}}class dh{constructor(){dh.constructor_.apply(this,arguments)}static constructor_(){this._overlapSeg1=new uh,this._overlapSeg2=new uh}overlap(){if(2===arguments.length);else if(4===arguments.length){const t=arguments[1],e=arguments[2],i=arguments[3];arguments[0].getLineSegment(t,this._overlapSeg1),e.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}class gh{constructor(){gh.constructor_.apply(this,arguments)}static constructor_(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];this._pts=t,this._start=e,this._end=i,this._context=s}getLineSegment(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]}computeSelect(t,e,i,s){const n=this._pts[e],r=this._pts[i];if(i-e==1)return s.select(this,e),null;if(!t.intersects(n,r))return null;const o=Math.trunc((e+i)/2);e<o&&this.computeSelect(t,e,o,s),o<i&&this.computeSelect(t,o,i,s)}getCoordinates(){const t=new Array(this._end-this._start+1).fill(null);let e=0;for(let i=this._start;i<=this._end;i++)t[e++]=this._pts[i];return t}computeOverlaps(){if(2===arguments.length){const t=arguments[0],e=arguments[1];this.computeOverlaps(this._start,this._end,t,t._start,t._end,e)}else if(6===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3],n=arguments[4],r=arguments[5];if(e-t==1&&n-s==1)return r.overlap(this,t,i,s),null;if(!this.overlaps(t,e,i,s,n))return null;const o=Math.trunc((t+e)/2),a=Math.trunc((s+n)/2);t<o&&(s<a&&this.computeOverlaps(t,o,i,s,a,r),a<n&&this.computeOverlaps(t,o,i,a,n,r)),o<e&&(s<a&&this.computeOverlaps(o,e,i,s,a,r),a<n&&this.computeOverlaps(o,e,i,a,n,r))}}setId(t){this._id=t}select(t,e){this.computeSelect(t,this._start,this._end,e)}getEnvelope(){if(null===this._env){const t=this._pts[this._start],e=this._pts[this._end];this._env=new kr(t,e)}return this._env}overlaps(t,e,i,s,n){return kr.intersects(this._pts[t],this._pts[e],i._pts[s],i._pts[n])}getEndIndex(){return this._end}getStartIndex(){return this._start}getContext(){return this._context}getId(){return this._id}}class ph{static findChainEnd(t,e){let i=e;for(;i<t.length-1&&t[i].equals2D(t[i+1]);)i++;if(i>=t.length-1)return t.length-1;const s=Ga.quadrant(t[i],t[i+1]);let n=e+1;for(;n<t.length&&(t[n-1].equals2D(t[n])||Ga.quadrant(t[n-1],t[n])===s);)n++;return n-1}static getChains(){if(1===arguments.length){const t=arguments[0];return ph.getChains(t,null)}if(2===arguments.length){const t=arguments[0],e=arguments[1],i=new so;let s=0;do{const n=ph.findChainEnd(t,s),r=new gh(t,s,n,e);i.add(r),s=n}while(s<t.length-1);return i}}}class _h{computeNodes(t){}getNodedSubstrings(){}}class fh{constructor(){fh.constructor_.apply(this,arguments)}static constructor_(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){const t=arguments[0];this.setSegmentIntersector(t)}}setSegmentIntersector(t){this._segInt=t}get interfaces_(){return[_h]}}class mh extends fh{constructor(){super(),mh.constructor_.apply(this,arguments)}static constructor_(){if(this._monoChains=new so,this._index=new ih,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,0===arguments.length);else if(1===arguments.length){const t=arguments[0];fh.constructor_.call(this,t)}}getMonotoneChains(){return this._monoChains}getNodedSubstrings(){return ch.getNodedSubstrings(this._nodedSegStrings)}getIndex(){return this._index}add(t){for(let e=ph.getChains(t.getCoordinates(),t).iterator();e.hasNext();){const t=e.next();t.setId(this._idCounter++),this._index.insert(t.getEnvelope(),t),this._monoChains.add(t)}}computeNodes(t){this._nodedSegStrings=t;for(let e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()}intersectChains(){const t=new yh(this._segInt);for(let e=this._monoChains.iterator();e.hasNext();){const i=e.next();for(let e=this._index.query(i.getEnvelope()).iterator();e.hasNext();){const s=e.next();if(s.getId()>i.getId()&&(i.computeOverlaps(s,t),this._nOverlaps++),this._segInt.isDone())return null}}}}class yh extends dh{constructor(){super(),yh.constructor_.apply(this,arguments)}static constructor_(){this._si=null;const t=arguments[0];this._si=t}overlap(){if(4!==arguments.length)return super.overlap.apply(this,arguments);{const t=arguments[1],e=arguments[2],i=arguments[3],s=arguments[0].getContext(),n=e.getContext();this._si.processIntersections(s,t,n,i)}}}mh.SegmentOverlapAction=yh;class xh{constructor(){xh.constructor_.apply(this,arguments)}static constructor_(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=co.COUNTERCLOCKWISE;const t=arguments[0];this._inputLine=t}static simplify(t,e){return new xh(t).simplify(e)}isDeletable(t,e,i,s){const n=this._inputLine[t],r=this._inputLine[e],o=this._inputLine[i];return!!this.isConcave(n,r,o)&&!!this.isShallow(n,r,o,s)&&this.isShallowSampled(n,r,t,i,s)}deleteShallowConcavities(){let t=1,e=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(e),s=!1;for(;i<this._inputLine.length;){let n=!1;this.isDeletable(t,e,i,this._distanceTol)&&(this._isDeleted[e]=xh.DELETE,n=!0,s=!0),t=n?i:e,e=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(e)}return s}isShallowConcavity(t,e,i,s){return co.index(t,e,i)===this._angleOrientation&&ia.pointToSegment(e,t,i)<s}isShallowSampled(t,e,i,s,n){let r=Math.trunc((s-i)/xh.NUM_PTS_TO_CHECK);r<=0&&(r=1);for(let o=i;o<s;o+=r)if(!this.isShallow(t,e,this._inputLine[o],n))return!1;return!0}isConcave(t,e,i){return co.index(t,e,i)===this._angleOrientation}simplify(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=co.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);let e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()}findNextNonDeletedIndex(t){let e=t+1;for(;e<this._inputLine.length&&this._isDeleted[e]===xh.DELETE;)e++;return e}isShallow(t,e,i,s){return ia.pointToSegment(e,t,i)<s}collapseLine(){const t=new So;for(let e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==xh.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()}}xh.INIT=0,xh.DELETE=1,xh.KEEP=1,xh.NUM_PTS_TO_CHECK=10;class vh{constructor(){vh.constructor_.apply(this,arguments)}static constructor_(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new so}getCoordinates(){return this._ptList.toArray(vh.COORDINATE_ARRAY_TYPE)}setPrecisionModel(t){this._precisionModel=t}addPt(t){const e=new Fr(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)}reverse(){}addPts(t,e){if(e)for(let e=0;e<t.length;e++)this.addPt(t[e]);else for(let e=t.length-1;e>=0;e--)this.addPt(t[e])}isRedundant(t){if(this._ptList.size()<1)return!1;const e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance}toString(){return(new zo).createLineString(this.getCoordinates()).toString()}closeRing(){if(this._ptList.size()<1)return null;const t=new Fr(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)}setMinimumVertexDistance(t){this._minimimVertexDistance=t}}vh.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);class wh{static toDegrees(t){return 180*t/Math.PI}static normalize(t){for(;t>Math.PI;)t-=wh.PI_TIMES_2;for(;t<=-Math.PI;)t+=wh.PI_TIMES_2;return t}static angle(){if(1===arguments.length){const t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){const t=arguments[0],e=arguments[1],i=e.x-t.x,s=e.y-t.y;return Math.atan2(s,i)}}static isAcute(t,e,i){const s=t.x-e.x,n=t.y-e.y;return s*(i.x-e.x)+n*(i.y-e.y)>0}static isObtuse(t,e,i){const s=t.x-e.x,n=t.y-e.y;return s*(i.x-e.x)+n*(i.y-e.y)<0}static interiorAngle(t,e,i){const s=wh.angle(e,t),n=wh.angle(e,i);return Math.abs(n-s)}static normalizePositive(t){if(t<0){for(;t<0;)t+=wh.PI_TIMES_2;t>=wh.PI_TIMES_2&&(t=0)}else{for(;t>=wh.PI_TIMES_2;)t-=wh.PI_TIMES_2;t<0&&(t=0)}return t}static angleBetween(t,e,i){const s=wh.angle(e,t),n=wh.angle(e,i);return wh.diff(s,n)}static diff(t,e){let i=null;return i=t<e?e-t:t-e,i>Math.PI&&(i=2*Math.PI-i),i}static toRadians(t){return t*Math.PI/180}static getTurn(t,e){const i=Math.sin(e-t);return i>0?wh.COUNTERCLOCKWISE:i<0?wh.CLOCKWISE:wh.NONE}static angleBetweenOriented(t,e,i){const s=wh.angle(e,t),n=wh.angle(e,i)-s;return n<=-Math.PI?n+wh.PI_TIMES_2:n>Math.PI?n-wh.PI_TIMES_2:n}}wh.PI_TIMES_2=2*Math.PI,wh.PI_OVER_2=Math.PI/2,wh.PI_OVER_4=Math.PI/4,wh.COUNTERCLOCKWISE=co.COUNTERCLOCKWISE,wh.CLOCKWISE=co.CLOCKWISE,wh.NONE=co.COLLINEAR;class Mh{constructor(){Mh.constructor_.apply(this,arguments)}static constructor_(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new uh,this._seg1=new uh,this._offset0=new uh,this._offset1=new uh,this._side=0,this._hasNarrowConcaveAngle=!1;const t=arguments[0],e=arguments[1],i=arguments[2];this._precisionModel=t,this._bufParams=e,this._li=new xa,this._filletAngleQuantum=Math.PI/2/e.getQuadrantSegments(),e.getQuadrantSegments()>=8&&e.getJoinStyle()===Xo.JOIN_ROUND&&(this._closingSegLengthFactor=Mh.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)}addNextSegment(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;const i=co.index(this._s0,this._s1,this._s2),s=i===co.CLOCKWISE&&this._side===$o.LEFT||i===co.COUNTERCLOCKWISE&&this._side===$o.RIGHT;0===i?this.addCollinear(e):s?this.addOutsideTurn(i,e):this.addInsideTurn(i,e)}addLineEndCap(t,e){const i=new uh(t,e),s=new uh;this.computeOffsetSegment(i,$o.LEFT,this._distance,s);const n=new uh;this.computeOffsetSegment(i,$o.RIGHT,this._distance,n);const r=e.x-t.x,o=e.y-t.y,a=Math.atan2(o,r);switch(this._bufParams.getEndCapStyle()){case Xo.CAP_ROUND:this._segList.addPt(s.p1),this.addDirectedFillet(e,a+Math.PI/2,a-Math.PI/2,co.CLOCKWISE,this._distance),this._segList.addPt(n.p1);break;case Xo.CAP_FLAT:this._segList.addPt(s.p1),this._segList.addPt(n.p1);break;case Xo.CAP_SQUARE:const t=new Fr;t.x=Math.abs(this._distance)*Math.cos(a),t.y=Math.abs(this._distance)*Math.sin(a);const i=new Fr(s.p1.x+t.x,s.p1.y+t.y),r=new Fr(n.p1.x+t.x,n.p1.y+t.y);this._segList.addPt(i),this._segList.addPt(r)}}getCoordinates(){return this._segList.getCoordinates()}addMitreJoin(t,e,i,s){const n=ea.intersection(e.p0,e.p1,i.p0,i.p1);if(null!==n&&(s<=0?1:n.distance(t)/Math.abs(s))<=this._bufParams.getMitreLimit())return this._segList.addPt(n),null;this.addLimitedMitreJoin(e,i,s,this._bufParams.getMitreLimit())}addOutsideTurn(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Mh.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Xo.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Xo.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))}createSquare(t){this._segList.addPt(new Fr(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new Fr(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new Fr(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new Fr(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()}addSegments(t,e){this._segList.addPts(t,e)}addFirstSegment(){this._segList.addPt(this._offset1.p0)}addCornerFillet(t,e,i,s,n){const r=e.x-t.x,o=e.y-t.y;let a=Math.atan2(o,r);const h=i.x-t.x,l=i.y-t.y,c=Math.atan2(l,h);s===co.CLOCKWISE?a<=c&&(a+=2*Math.PI):a>=c&&(a-=2*Math.PI),this._segList.addPt(e),this.addDirectedFillet(t,a,c,s,n),this._segList.addPt(i)}addLastSegment(){this._segList.addPt(this._offset1.p1)}initSideSegments(t,e,i){this._s1=t,this._s2=e,this._side=i,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,i,this._distance,this._offset1)}addLimitedMitreJoin(t,e,i,s){const n=this._seg0.p1,r=wh.angle(n,this._seg0.p0),o=wh.angleBetweenOriented(this._seg0.p0,n,this._seg1.p1)/2,a=wh.normalize(r+o),h=wh.normalize(a+Math.PI),l=s*i,c=i-l*Math.abs(Math.sin(o)),u=n.x+l*Math.cos(h),d=n.y+l*Math.sin(h),g=new Fr(u,d),p=new uh(n,g),_=p.pointAlongOffset(1,c),f=p.pointAlongOffset(1,-c);this._side===$o.LEFT?(this._segList.addPt(_),this._segList.addPt(f)):(this._segList.addPt(f),this._segList.addPt(_))}addDirectedFillet(t,e,i,s,n){const r=s===co.CLOCKWISE?-1:1,o=Math.abs(e-i),a=Math.trunc(o/this._filletAngleQuantum+.5);if(a<1)return null;const h=o/a,l=new Fr;for(let i=0;i<a;i++){const s=e+r*i*h;l.x=t.x+n*Math.cos(s),l.y=t.y+n*Math.sin(s),this._segList.addPt(l)}}computeOffsetSegment(t,e,i,s){const n=e===$o.LEFT?1:-1,r=t.p1.x-t.p0.x,o=t.p1.y-t.p0.y,a=Math.sqrt(r*r+o*o),h=n*i*r/a,l=n*i*o/a;s.p0.x=t.p0.x-l,s.p0.y=t.p0.y+h,s.p1.x=t.p1.x-l,s.p1.y=t.p1.y+h}addInsideTurn(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Mh.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){const t=new Fr((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(t);const e=new Fr((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(e)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}createCircle(t){const e=new Fr(t.x+this._distance,t.y);this._segList.addPt(e),this.addDirectedFillet(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}addBevelJoin(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)}init(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new vh,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Mh.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}addCollinear(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Xo.JOIN_BEVEL||this._bufParams.getJoinStyle()===Xo.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,co.CLOCKWISE,this._distance))}closeRing(){this._segList.closeRing()}hasNarrowConcaveAngle(){return this._hasNarrowConcaveAngle}}Mh.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Mh.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Mh.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Mh.MAX_CLOSING_SEG_LEN_FACTOR=80;class Eh{constructor(){Eh.constructor_.apply(this,arguments)}static constructor_(){this._distance=0,this._precisionModel=null,this._bufParams=null;const t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e}static copyCoordinates(t){const e=new Array(t.length).fill(null);for(let i=0;i<e.length;i++)e[i]=new Fr(t[i]);return e}getOffsetCurve(t,e){if(this._distance=e,0===e)return null;const i=e<0,s=Math.abs(e),n=this.getSegGen(s);t.length<=1?this.computePointCurve(t[0],n):this.computeOffsetCurve(t,i,n);const r=n.getCoordinates();return i&&Lo.reverse(r),r}computeSingleSidedBufferCurve(t,e,i){const s=this.simplifyTolerance(this._distance);if(e){i.addSegments(t,!0);const e=xh.simplify(t,-s),n=e.length-1;i.initSideSegments(e[n],e[n-1],$o.LEFT),i.addFirstSegment();for(let t=n-2;t>=0;t--)i.addNextSegment(e[t],!0)}else{i.addSegments(t,!1);const e=xh.simplify(t,s),n=e.length-1;i.initSideSegments(e[0],e[1],$o.LEFT),i.addFirstSegment();for(let t=2;t<=n;t++)i.addNextSegment(e[t],!0)}i.addLastSegment(),i.closeRing()}computeRingBufferCurve(t,e,i){let s=this.simplifyTolerance(this._distance);e===$o.RIGHT&&(s=-s);const n=xh.simplify(t,s),r=n.length-1;i.initSideSegments(n[r-1],n[0],e);for(let t=1;t<=r;t++){const e=1!==t;i.addNextSegment(n[t],e)}i.closeRing()}computeLineBufferCurve(t,e){const i=this.simplifyTolerance(this._distance),s=xh.simplify(t,i),n=s.length-1;e.initSideSegments(s[0],s[1],$o.LEFT);for(let t=2;t<=n;t++)e.addNextSegment(s[t],!0);e.addLastSegment(),e.addLineEndCap(s[n-1],s[n]);const r=xh.simplify(t,-i),o=r.length-1;e.initSideSegments(r[o],r[o-1],$o.LEFT);for(let t=o-2;t>=0;t--)e.addNextSegment(r[t],!0);e.addLastSegment(),e.addLineEndCap(r[1],r[0]),e.closeRing()}computePointCurve(t,e){switch(this._bufParams.getEndCapStyle()){case Xo.CAP_ROUND:e.createCircle(t);break;case Xo.CAP_SQUARE:e.createSquare(t)}}getLineCurve(t,e){if(this._distance=e,this.isLineOffsetEmpty(e))return null;const i=Math.abs(e),s=this.getSegGen(i);if(t.length<=1)this.computePointCurve(t[0],s);else if(this._bufParams.isSingleSided()){const i=e<0;this.computeSingleSidedBufferCurve(t,i,s)}else this.computeLineBufferCurve(t,s);return s.getCoordinates()}getBufferParameters(){return this._bufParams}simplifyTolerance(t){return t*this._bufParams.getSimplifyFactor()}getRingCurve(t,e,i){if(this._distance=i,t.length<=2)return this.getLineCurve(t,i);if(0===i)return Eh.copyCoordinates(t);const s=this.getSegGen(i);return this.computeRingBufferCurve(t,e,s),s.getCoordinates()}computeOffsetCurve(t,e,i){const s=this.simplifyTolerance(this._distance);if(e){const e=xh.simplify(t,-s),n=e.length-1;i.initSideSegments(e[n],e[n-1],$o.LEFT),i.addFirstSegment();for(let t=n-2;t>=0;t--)i.addNextSegment(e[t],!0)}else{const e=xh.simplify(t,s),n=e.length-1;i.initSideSegments(e[0],e[1],$o.LEFT),i.addFirstSegment();for(let t=2;t<=n;t++)i.addNextSegment(e[t],!0)}i.addLastSegment()}isLineOffsetEmpty(t){return 0===t||t<0&&!this._bufParams.isSingleSided()}getSegGen(t){return new Mh(this._precisionModel,this._bufParams,t)}}class Ch{constructor(){Ch.constructor_.apply(this,arguments)}static constructor_(){this._subgraphs=null,this._seg=new uh;const t=arguments[0];this._subgraphs=t}findStabbedSegments(){if(1===arguments.length){const t=arguments[0],e=new so;for(let i=this._subgraphs.iterator();i.hasNext();){const s=i.next(),n=s.getEnvelope();t.y<n.getMinY()||t.y>n.getMaxY()||this.findStabbedSegments(t,s.getDirectedEdges(),e)}return e}if(3===arguments.length)if(fr(arguments[2],eo)&&arguments[0]instanceof Fr&&arguments[1]instanceof Ba){const t=arguments[0],e=arguments[1],i=arguments[2],s=e.getEdge().getCoordinates();for(let n=0;n<s.length-1;n++){if(this._seg.p0=s[n],this._seg.p1=s[n+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),Math.max(this._seg.p0.x,this._seg.p1.x)<t.x)continue;if(this._seg.isHorizontal())continue;if(t.y<this._seg.p0.y||t.y>this._seg.p1.y)continue;if(co.index(this._seg.p0,this._seg.p1,t)===co.RIGHT)continue;let r=e.getDepth($o.LEFT);this._seg.p0.equals(s[n])||(r=e.getDepth($o.RIGHT));const o=new Sh(this._seg,r);i.add(o)}}else if(fr(arguments[2],eo)&&arguments[0]instanceof Fr&&fr(arguments[1],eo)){const t=arguments[0],e=arguments[2];for(let i=arguments[1].iterator();i.hasNext();){const s=i.next();s.isForward()&&this.findStabbedSegments(t,s,e)}}}getDepth(t){const e=this.findStabbedSegments(t);return 0===e.size()?0:Ka.min(e)._leftDepth}}class Sh{constructor(){Sh.constructor_.apply(this,arguments)}static constructor_(){this._upwardSeg=null,this._leftDepth=null;const t=arguments[0],e=arguments[1];this._upwardSeg=new uh(t),this._leftDepth=e}compareTo(t){const e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;let i=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==i?i:(i=-1*e._upwardSeg.orientationIndex(this._upwardSeg),0!==i?i:this._upwardSeg.compareTo(e._upwardSeg))}compareX(t,e){const i=t.p0.compareTo(e.p0);return 0!==i?i:t.p1.compareTo(e.p1)}toString(){return this._upwardSeg.toString()}get interfaces_(){return[Sr]}}Ch.DepthSegment=Sh;class bh extends Mr{constructor(){super(),bh.constructor_.apply(this,arguments)}static constructor_(){Mr.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}class Ih{constructor(){Ih.constructor_.apply(this,arguments)}static constructor_(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){const t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){const t=arguments[0],e=arguments[1];this.x=t,this.y=e,this.w=1}else if(arguments[0]instanceof Ih&&arguments[1]instanceof Ih){const t=arguments[0],e=arguments[1];this.x=t.y*e.w-e.y*t.w,this.y=e.x*t.w-t.x*e.w,this.w=t.x*e.y-e.x*t.y}else if(arguments[0]instanceof Fr&&arguments[1]instanceof Fr){const t=arguments[0],e=arguments[1];this.x=t.y-e.y,this.y=e.x-t.x,this.w=t.x*e.y-e.x*t.y}}else if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];this.x=t,this.y=e,this.w=i}else if(4===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3],n=t.y-e.y,r=e.x-t.x,o=t.x*e.y-e.x*t.y,a=i.y-s.y,h=s.x-i.x,l=i.x*s.y-s.x*i.y;this.x=r*l-h*o,this.y=a*o-n*l,this.w=n*h-a*r}}getY(){const t=this.y/this.w;if(yr.isNaN(t)||yr.isInfinite(t))throw new bh;return t}getX(){const t=this.x/this.w;if(yr.isNaN(t)||yr.isInfinite(t))throw new bh;return t}getCoordinate(){const t=new Fr;return t.x=this.getX(),t.y=this.getY(),t}}class Lh{constructor(){Lh.constructor_.apply(this,arguments)}static constructor_(){this.p0=null,this.p1=null,this.p2=null;const t=arguments[0],e=arguments[1],i=arguments[2];this.p0=t,this.p1=e,this.p2=i}static area(t,e,i){return Math.abs(((i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y))/2)}static signedArea(t,e,i){return((i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y))/2}static det(t,e,i,s){return t*s-e*i}static interpolateZ(t,e,i,s){const n=e.x,r=e.y,o=i.x-n,a=s.x-n,h=i.y-r,l=s.y-r,c=o*l-a*h,u=t.x-n,d=t.y-r,g=(l*u-a*d)/c,p=(-h*u+o*d)/c;return e.getZ()+g*(i.getZ()-e.getZ())+p*(s.getZ()-e.getZ())}static longestSideLength(t,e,i){const s=t.distance(e),n=e.distance(i),r=i.distance(t);let o=s;return n>o&&(o=n),r>o&&(o=r),o}static circumcentreDD(t,e,i){const s=ho.valueOf(t.x).subtract(i.x),n=ho.valueOf(t.y).subtract(i.y),r=ho.valueOf(e.x).subtract(i.x),o=ho.valueOf(e.y).subtract(i.y),a=ho.determinant(s,n,r,o).multiply(2),h=s.sqr().add(n.sqr()),l=r.sqr().add(o.sqr()),c=ho.determinant(n,h,o,l),u=ho.determinant(s,h,r,l),d=ho.valueOf(i.x).subtract(c.divide(a)).doubleValue(),g=ho.valueOf(i.y).add(u.divide(a)).doubleValue();return new Fr(d,g)}static isAcute(t,e,i){return!!wh.isAcute(t,e,i)&&!!wh.isAcute(e,i,t)&&!!wh.isAcute(i,t,e)}static circumcentre(t,e,i){const s=i.x,n=i.y,r=t.x-s,o=t.y-n,a=e.x-s,h=e.y-n,l=2*Lh.det(r,o,a,h),c=Lh.det(o,r*r+o*o,h,a*a+h*h),u=Lh.det(r,r*r+o*o,a,a*a+h*h);return new Fr(s-c/l,n+u/l)}static perpendicularBisector(t,e){const i=e.x-t.x,s=e.y-t.y,n=new Ih(t.x+i/2,t.y+s/2,1),r=new Ih(t.x-s+i/2,t.y+i+s/2,1);return new Ih(n,r)}static angleBisector(t,e,i){const s=e.distance(t),n=s/(s+e.distance(i)),r=i.x-t.x,o=i.y-t.y;return new Fr(t.x+n*r,t.y+n*o)}static area3D(t,e,i){const s=e.x-t.x,n=e.y-t.y,r=e.getZ()-t.getZ(),o=i.x-t.x,a=i.y-t.y,h=i.getZ()-t.getZ(),l=n*h-r*a,c=r*o-s*h,u=s*a-n*o,d=l*l+c*c+u*u;return Math.sqrt(d)/2}static centroid(t,e,i){const s=(t.x+e.x+i.x)/3,n=(t.y+e.y+i.y)/3;return new Fr(s,n)}static inCentre(t,e,i){const s=e.distance(i),n=t.distance(i),r=t.distance(e),o=s+n+r,a=(s*t.x+n*e.x+r*i.x)/o,h=(s*t.y+n*e.y+r*i.y)/o;return new Fr(a,h)}area(){return Lh.area(this.p0,this.p1,this.p2)}signedArea(){return Lh.signedArea(this.p0,this.p1,this.p2)}interpolateZ(t){if(null===t)throw new Er("Supplied point is null.");return Lh.interpolateZ(t,this.p0,this.p1,this.p2)}longestSideLength(){return Lh.longestSideLength(this.p0,this.p1,this.p2)}isAcute(){return Lh.isAcute(this.p0,this.p1,this.p2)}circumcentre(){return Lh.circumcentre(this.p0,this.p1,this.p2)}area3D(){return Lh.area3D(this.p0,this.p1,this.p2)}centroid(){return Lh.centroid(this.p0,this.p1,this.p2)}inCentre(){return Lh.inCentre(this.p0,this.p1,this.p2)}}class Th{constructor(){Th.constructor_.apply(this,arguments)}static constructor_(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new so;const t=arguments[0],e=arguments[1],i=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=i}addRingSide(t,e,i,s,n){if(0===e&&t.length<vo.MINIMUM_VALID_SIZE)return null;let r=s,o=n;t.length>=vo.MINIMUM_VALID_SIZE&&co.isCCW(t)&&(r=n,o=s,i=$o.opposite(i));const a=this._curveBuilder.getRingCurve(t,i,e);this.addCurve(a,r,o)}addRingBothSides(t,e){this.addRingSide(t,e,$o.LEFT,Wo.EXTERIOR,Wo.INTERIOR),this.addRingSide(t,e,$o.RIGHT,Wo.INTERIOR,Wo.EXTERIOR)}addPoint(t){if(this._distance<=0)return null;const e=t.getCoordinates(),i=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(i,Wo.EXTERIOR,Wo.INTERIOR)}addPolygon(t){let e=this._distance,i=$o.LEFT;this._distance<0&&(e=-this._distance,i=$o.RIGHT);const s=t.getExteriorRing(),n=Lo.removeRepeatedPoints(s.getCoordinates());if(this._distance<0&&this.isErodedCompletely(s,this._distance))return null;if(this._distance<=0&&n.length<3)return null;this.addRingSide(n,e,i,Wo.EXTERIOR,Wo.INTERIOR);for(let s=0;s<t.getNumInteriorRing();s++){const n=t.getInteriorRingN(s),r=Lo.removeRepeatedPoints(n.getCoordinates());this._distance>0&&this.isErodedCompletely(n,-this._distance)||this.addRingSide(r,e,$o.opposite(i),Wo.INTERIOR,Wo.EXTERIOR)}}isTriangleErodedCompletely(t,e){const i=new Lh(t[0],t[1],t[2]),s=i.inCentre();return ia.pointToSegment(s,i.p0,i.p1)<Math.abs(e)}addLineString(t){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;const e=Lo.removeRepeatedPoints(t.getCoordinates());if(Lo.isRing(e)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(e,this._distance);else{const t=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(t,Wo.EXTERIOR,Wo.INTERIOR)}}addCurve(t,e,i){if(null===t||t.length<2)return null;const s=new ch(t,new Ea(0,Wo.BOUNDARY,e,i));this._curveList.add(s)}getCurves(){return this.add(this._inputGeom),this._curveList}add(t){if(t.isEmpty())return null;if(t instanceof go)this.addPolygon(t);else if(t instanceof $r)this.addLineString(t);else if(t instanceof Zr)this.addPoint(t);else if(t instanceof xo)this.addCollection(t);else if(t instanceof Go)this.addCollection(t);else if(t instanceof Po)this.addCollection(t);else{if(!(t instanceof yo))throw new Ur(t.getGeometryType());this.addCollection(t)}}isErodedCompletely(t,e){const i=t.getCoordinates();if(i.length<4)return e<0;if(4===i.length)return this.isTriangleErodedCompletely(i,e);const s=t.getEnvelopeInternal(),n=Math.min(s.getHeight(),s.getWidth());return e<0&&2*Math.abs(e)>n}addCollection(t){for(let e=0;e<t.getNumGeometries();e++){const i=t.getGeometryN(e);this.add(i)}}}class Nh{locate(t){}}class Rh{hasNext(){}next(){}remove(){}}class Ph{constructor(){Ph.constructor_.apply(this,arguments)}static constructor_(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;const t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()}static isAtomic(t){return!(t instanceof yo)}next(){if(this._atStart)return this._atStart=!1,Ph.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new io;const t=this._parent.getGeometryN(this._index++);return t instanceof yo?(this._subcollectionIterator=new Ph(t),this._subcollectionIterator.next()):t}remove(){throw new Ur(this.getClass().getName())}hasNext(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}get interfaces_(){return[Rh]}}class Oh{constructor(){Oh.constructor_.apply(this,arguments)}static constructor_(){this._geom=null;const t=arguments[0];this._geom=t}static locatePointInPolygon(t,e){if(e.isEmpty())return Wo.EXTERIOR;const i=e.getExteriorRing(),s=Oh.locatePointInRing(t,i);if(s!==Wo.INTERIOR)return s;for(let i=0;i<e.getNumInteriorRing();i++){const s=e.getInteriorRingN(i),n=Oh.locatePointInRing(t,s);if(n===Wo.BOUNDARY)return Wo.BOUNDARY;if(n===Wo.INTERIOR)return Wo.EXTERIOR}return Wo.INTERIOR}static locatePointInRing(t,e){return e.getEnvelopeInternal().intersects(t)?wa.locateInRing(t,e.getCoordinates()):Wo.EXTERIOR}static containsPointInPolygon(t,e){return Wo.EXTERIOR!==Oh.locatePointInPolygon(t,e)}static locateInGeometry(t,e){if(e instanceof go)return Oh.locatePointInPolygon(t,e);if(e instanceof yo){const i=new Ph(e);for(;i.hasNext();){const s=i.next();if(s!==e){const e=Oh.locateInGeometry(t,s);if(e!==Wo.EXTERIOR)return e}}}return Wo.EXTERIOR}static isContained(t,e){return Wo.EXTERIOR!==Oh.locate(t,e)}static locate(t,e){return e.isEmpty()?Wo.EXTERIOR:e.getEnvelopeInternal().intersects(t)?Oh.locateInGeometry(t,e):Wo.EXTERIOR}locate(t){return Oh.locate(t,this._geom)}get interfaces_(){return[Nh]}}class Ah{constructor(){Ah.constructor_.apply(this,arguments)}static constructor_(){this._edgeMap=new Da,this._edgeList=null,this._ptInAreaLocation=[Wo.NONE,Wo.NONE]}getNextCW(t){this.getEdges();const e=this._edgeList.indexOf(t);let i=e-1;return 0===e&&(i=this._edgeList.size()-1),this._edgeList.get(i)}propagateSideLabels(t){let e=Wo.NONE;for(let i=this.iterator();i.hasNext();){const s=i.next().getLabel();s.isArea(t)&&s.getLocation(t,$o.LEFT)!==Wo.NONE&&(e=s.getLocation(t,$o.LEFT))}if(e===Wo.NONE)return null;let i=e;for(let e=this.iterator();e.hasNext();){const s=e.next(),n=s.getLabel();if(n.getLocation(t,$o.ON)===Wo.NONE&&n.setLocation(t,$o.ON,i),n.isArea(t)){const e=n.getLocation(t,$o.LEFT),r=n.getLocation(t,$o.RIGHT);if(r!==Wo.NONE){if(r!==i)throw new Jo("side location conflict",s.getCoordinate());e===Wo.NONE&&Rr.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),i=e}else Rr.isTrue(n.getLocation(t,$o.LEFT)===Wo.NONE,"found single null side"),n.setLocation(t,$o.RIGHT,i),n.setLocation(t,$o.LEFT,i)}}}getCoordinate(){const t=this.iterator();return t.hasNext()?t.next().getCoordinate():null}print(t){Io.out.println("EdgeEndStar:   "+this.getCoordinate());for(let e=this.iterator();e.hasNext();)e.next().print(t)}isAreaLabelsConsistent(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}checkAreaLabelsConsistent(t){const e=this.getEdges();if(e.size()<=0)return!0;const i=e.size()-1,s=e.get(i).getLabel().getLocation(t,$o.LEFT);Rr.isTrue(s!==Wo.NONE,"Found unlabelled area edge");let n=s;for(let e=this.iterator();e.hasNext();){const i=e.next().getLabel();Rr.isTrue(i.isArea(t),"Found non-area edge");const s=i.getLocation(t,$o.LEFT),r=i.getLocation(t,$o.RIGHT);if(s===r)return!1;if(r!==n)return!1;n=s}return!0}findIndex(t){this.iterator();for(let e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1}iterator(){return this.getEdges().iterator()}getEdges(){return null===this._edgeList&&(this._edgeList=new so(this._edgeMap.values())),this._edgeList}getLocation(t,e,i){return this._ptInAreaLocation[t]===Wo.NONE&&(this._ptInAreaLocation[t]=Oh.locate(e,i[t].getGeometry())),this._ptInAreaLocation[t]}toString(){const t=new oo;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(let e=this.iterator();e.hasNext();){const i=e.next();t.append(i),t.append("\n")}return t.toString()}computeEdgeEndLabels(t){for(let e=this.iterator();e.hasNext();)e.next().computeLabel(t)}computeLabelling(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);const e=[!1,!1];for(let t=this.iterator();t.hasNext();){const i=t.next().getLabel();for(let t=0;t<2;t++)i.isLine(t)&&i.getLocation(t)===Wo.BOUNDARY&&(e[t]=!0)}for(let i=this.iterator();i.hasNext();){const s=i.next(),n=s.getLabel();for(let i=0;i<2;i++)if(n.isAnyNull(i)){let r=Wo.NONE;if(e[i])r=Wo.EXTERIOR;else{const e=s.getCoordinate();r=this.getLocation(i,e,t)}n.setAllLocationsIfNull(i,r)}}}getDegree(){return this._edgeMap.size()}insertEdgeEnd(t,e){this._edgeMap.put(t,e),this._edgeList=null}}class Fh extends Ah{constructor(){super(),Fh.constructor_.apply(this,arguments)}static constructor_(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}linkResultDirectedEdges(){this.getResultAreaEdges();let t=null,e=null,i=this._SCANNING_FOR_INCOMING;for(let s=0;s<this._resultAreaEdgeList.size();s++){const n=this._resultAreaEdgeList.get(s),r=n.getSym();if(n.getLabel().isArea())switch(null===t&&n.isInResult()&&(t=n),i){case this._SCANNING_FOR_INCOMING:if(!r.isInResult())continue;e=r,i=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!n.isInResult())continue;e.setNext(n),i=this._SCANNING_FOR_INCOMING}}if(i===this._LINKING_TO_OUTGOING){if(null===t)throw new Jo("no outgoing dirEdge found",this.getCoordinate());Rr.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}}insert(t){const e=t;this.insertEdgeEnd(e,e)}getRightmostEdge(){const t=this.getEdges(),e=t.size();if(e<1)return null;const i=t.get(0);if(1===e)return i;const s=t.get(e-1),n=i.getQuadrant(),r=s.getQuadrant();return Ga.isNorthern(n)&&Ga.isNorthern(r)?i:Ga.isNorthern(n)||Ga.isNorthern(r)?0!==i.getDy()?i:0!==s.getDy()?s:(Rr.shouldNeverReachHere("found two horizontal edges incident on node"),null):s}print(t){Io.out.println("DirectedEdgeStar: "+this.getCoordinate());for(let e=this.iterator();e.hasNext();){const i=e.next();t.print("out "),i.print(t),t.println(),t.print("in "),i.getSym().print(t),t.println()}}getResultAreaEdges(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new so;for(let t=this.iterator();t.hasNext();){const e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList}updateLabelling(t){for(let e=this.iterator();e.hasNext();){const i=e.next().getLabel();i.setAllLocationsIfNull(0,t.getLocation(0)),i.setAllLocationsIfNull(1,t.getLocation(1))}}linkAllDirectedEdges(){this.getEdges();let t=null,e=null;for(let i=this._edgeList.size()-1;i>=0;i--){const s=this._edgeList.get(i),n=s.getSym();null===e&&(e=n),null!==t&&n.setNext(t),t=s}e.setNext(t)}computeDepths(){if(1===arguments.length){const t=arguments[0],e=this.findIndex(t),i=t.getDepth($o.LEFT),s=t.getDepth($o.RIGHT),n=this.computeDepths(e+1,this._edgeList.size(),i);if(this.computeDepths(0,e,n)!==s)throw new Jo("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){const t=arguments[1];let e=arguments[2];for(let i=arguments[0];i<t;i++){const t=this._edgeList.get(i);t.setEdgeDepths($o.RIGHT,e),e=t.getDepth($o.LEFT)}return e}}mergeSymLabels(){for(let t=this.iterator();t.hasNext();){const e=t.next();e.getLabel().merge(e.getSym().getLabel())}}linkMinimalDirectedEdges(t){let e=null,i=null,s=this._SCANNING_FOR_INCOMING;for(let n=this._resultAreaEdgeList.size()-1;n>=0;n--){const r=this._resultAreaEdgeList.get(n),o=r.getSym();switch(null===e&&r.getEdgeRing()===t&&(e=r),s){case this._SCANNING_FOR_INCOMING:if(o.getEdgeRing()!==t)continue;i=o,s=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(r.getEdgeRing()!==t)continue;i.setNextMin(r),s=this._SCANNING_FOR_INCOMING}}s===this._LINKING_TO_OUTGOING&&(Rr.isTrue(null!==e,"found null for first outgoing dirEdge"),Rr.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),i.setNextMin(e))}getOutgoingDegree(){if(0===arguments.length){let t=0;for(let e=this.iterator();e.hasNext();)e.next().isInResult()&&t++;return t}if(1===arguments.length){const t=arguments[0];let e=0;for(let i=this.iterator();i.hasNext();)i.next().getEdgeRing()===t&&e++;return e}}getLabel(){return this._label}findCoveredLineEdges(){let t=Wo.NONE;for(let e=this.iterator();e.hasNext();){const i=e.next(),s=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){t=Wo.INTERIOR;break}if(s.isInResult()){t=Wo.EXTERIOR;break}}}if(t===Wo.NONE)return null;let e=t;for(let t=this.iterator();t.hasNext();){const i=t.next(),s=i.getSym();i.isLineEdge()?i.getEdge().setCovered(e===Wo.INTERIOR):(i.isInResult()&&(e=Wo.EXTERIOR),s.isInResult()&&(e=Wo.INTERIOR))}}computeLabelling(t){super.computeLabelling.call(this,t),this._label=new Ea(Wo.NONE);for(let t=this.iterator();t.hasNext();){const e=t.next().getEdge().getLabel();for(let t=0;t<2;t++){const i=e.getLocation(t);i!==Wo.INTERIOR&&i!==Wo.BOUNDARY||this._label.setLocation(t,Wo.INTERIOR)}}}}class Dh extends ja{constructor(){super()}createNode(t){return new La(t,new Fh)}}class kh{constructor(){kh.constructor_.apply(this,arguments)}static constructor_(){this._pts=null,this._orientation=null;const t=arguments[0];this._pts=t,this._orientation=kh.orientation(t)}static orientation(t){return 1===Lo.increasingDirection(t)}static compareOriented(t,e,i,s){const n=e?1:-1,r=s?1:-1,o=e?t.length:-1,a=s?i.length:-1;let h=e?0:t.length-1,l=s?0:i.length-1;for(;;){const e=t[h].compareTo(i[l]);if(0!==e)return e;h+=n,l+=r;const s=h===o,c=l===a;if(s&&!c)return-1;if(!s&&c)return 1;if(s&&c)return 0}}compareTo(t){const e=t;return kh.compareOriented(this._pts,this._orientation,e._pts,e._orientation)}get interfaces_(){return[Sr]}}class Gh{constructor(){Gh.constructor_.apply(this,arguments)}static constructor_(){this._edges=new so,this._ocaMap=new Da}print(t){t.print("MULTILINESTRING ( ");for(let e=0;e<this._edges.size();e++){const i=this._edges.get(e);e>0&&t.print(","),t.print("(");const s=i.getCoordinates();for(let e=0;e<s.length;e++)e>0&&t.print(","),t.print(s[e].x+" "+s[e].y);t.println(")")}t.print(")  ")}addAll(t){for(let e=t.iterator();e.hasNext();)this.add(e.next())}findEdgeIndex(t){for(let e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1}iterator(){return this._edges.iterator()}getEdges(){return this._edges}get(t){return this._edges.get(t)}findEqualEdge(t){const e=new kh(t.getCoordinates());return this._ocaMap.get(e)}add(t){this._edges.add(t);const e=new kh(t.getCoordinates());this._ocaMap.put(e,t)}}class zh{processIntersections(t,e,i,s){}isDone(){}}class Bh{constructor(){Bh.constructor_.apply(this,arguments)}static constructor_(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;const t=arguments[0];this._li=t}static isAdjacentSegments(t,e){return 1===Math.abs(t-e)}isTrivialIntersection(t,e,i,s){if(t===i&&1===this._li.getIntersectionNum()){if(Bh.isAdjacentSegments(e,s))return!0;if(t.isClosed()){const i=t.size()-1;if(0===e&&s===i||0===s&&e===i)return!0}}return!1}getProperIntersectionPoint(){return this._properIntersectionPoint}hasProperInteriorIntersection(){return this._hasProperInterior}getLineIntersector(){return this._li}hasProperIntersection(){return this._hasProper}processIntersections(t,e,i,s){if(t===i&&e===s)return null;this.numTests++;const n=t.getCoordinates()[e],r=t.getCoordinates()[e+1],o=i.getCoordinates()[s],a=i.getCoordinates()[s+1];this._li.computeIntersection(n,r,o,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,i,s)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),i.addIntersections(this._li,s,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}hasIntersection(){return this._hasIntersection}isDone(){return!1}hasInteriorIntersection(){return this._hasInterior}get interfaces_(){return[zh]}}class jh{constructor(){jh.constructor_.apply(this,arguments)}static constructor_(){this.coord=null,this.segmentIndex=null,this.dist=null;const t=arguments[0],e=arguments[1],i=arguments[2];this.coord=new Fr(t),this.segmentIndex=e,this.dist=i}getSegmentIndex(){return this.segmentIndex}getCoordinate(){return this.coord}print(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)}compareTo(t){const e=t;return this.compare(e.segmentIndex,e.dist)}isEndPoint(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t}toString(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}getDistance(){return this.dist}compare(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0}get interfaces_(){return[Sr]}}class qh{constructor(){qh.constructor_.apply(this,arguments)}static constructor_(){this._nodeMap=new Da,this.edge=null;const t=arguments[0];this.edge=t}print(t){t.println("Intersections:");for(let e=this.iterator();e.hasNext();)e.next().print(t)}iterator(){return this._nodeMap.values().iterator()}addSplitEdges(t){this.addEndpoints();const e=this.iterator();let i=e.next();for(;e.hasNext();){const s=e.next(),n=this.createSplitEdge(i,s);t.add(n),i=s}}addEndpoints(){const t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)}createSplitEdge(t,e){let i=e.segmentIndex-t.segmentIndex+2;const s=this.edge.pts[e.segmentIndex],n=e.dist>0||!e.coord.equals2D(s);n||i--;const r=new Array(i).fill(null);let o=0;r[o++]=new Fr(t.coord);for(let i=t.segmentIndex+1;i<=e.segmentIndex;i++)r[o++]=this.edge.pts[i];return n&&(r[o]=e.coord),new $h(r,new Ea(this.edge._label))}add(t,e,i){const s=new jh(t,e,i),n=this._nodeMap.get(s);return null!==n?n:(this._nodeMap.put(s,s),s)}isIntersection(t){for(let e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1}}class Uh{constructor(){Uh.constructor_.apply(this,arguments)}static constructor_(){if(this._matrix=null,0===arguments.length)this._matrix=Array(3).fill().map((()=>Array(3))),this.setAll(Vr.FALSE);else if(1===arguments.length)if("string"==typeof arguments[0]){const t=arguments[0];Uh.constructor_.call(this),this.set(t)}else if(arguments[0]instanceof Uh){const t=arguments[0];Uh.constructor_.call(this),this._matrix[Wo.INTERIOR][Wo.INTERIOR]=t._matrix[Wo.INTERIOR][Wo.INTERIOR],this._matrix[Wo.INTERIOR][Wo.BOUNDARY]=t._matrix[Wo.INTERIOR][Wo.BOUNDARY],this._matrix[Wo.INTERIOR][Wo.EXTERIOR]=t._matrix[Wo.INTERIOR][Wo.EXTERIOR],this._matrix[Wo.BOUNDARY][Wo.INTERIOR]=t._matrix[Wo.BOUNDARY][Wo.INTERIOR],this._matrix[Wo.BOUNDARY][Wo.BOUNDARY]=t._matrix[Wo.BOUNDARY][Wo.BOUNDARY],this._matrix[Wo.BOUNDARY][Wo.EXTERIOR]=t._matrix[Wo.BOUNDARY][Wo.EXTERIOR],this._matrix[Wo.EXTERIOR][Wo.INTERIOR]=t._matrix[Wo.EXTERIOR][Wo.INTERIOR],this._matrix[Wo.EXTERIOR][Wo.BOUNDARY]=t._matrix[Wo.EXTERIOR][Wo.BOUNDARY],this._matrix[Wo.EXTERIOR][Wo.EXTERIOR]=t._matrix[Wo.EXTERIOR][Wo.EXTERIOR]}}static matches(){if(Number.isInteger(arguments[0])&&"string"==typeof arguments[1]){const t=arguments[0],e=arguments[1];return e===Vr.SYM_DONTCARE||e===Vr.SYM_TRUE&&(t>=0||t===Vr.TRUE)||e===Vr.SYM_FALSE&&t===Vr.FALSE||e===Vr.SYM_P&&t===Vr.P||e===Vr.SYM_L&&t===Vr.L||e===Vr.SYM_A&&t===Vr.A}if("string"==typeof arguments[0]&&"string"==typeof arguments[1]){const t=arguments[1];return new Uh(arguments[0]).matches(t)}}static isTrue(t){return t>=0||t===Vr.TRUE}isIntersects(){return!this.isDisjoint()}isCovers(){return(Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.INTERIOR])||Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.BOUNDARY])||Uh.isTrue(this._matrix[Wo.BOUNDARY][Wo.INTERIOR])||Uh.isTrue(this._matrix[Wo.BOUNDARY][Wo.BOUNDARY]))&&this._matrix[Wo.EXTERIOR][Wo.INTERIOR]===Vr.FALSE&&this._matrix[Wo.EXTERIOR][Wo.BOUNDARY]===Vr.FALSE}isCoveredBy(){return(Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.INTERIOR])||Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.BOUNDARY])||Uh.isTrue(this._matrix[Wo.BOUNDARY][Wo.INTERIOR])||Uh.isTrue(this._matrix[Wo.BOUNDARY][Wo.BOUNDARY]))&&this._matrix[Wo.INTERIOR][Wo.EXTERIOR]===Vr.FALSE&&this._matrix[Wo.BOUNDARY][Wo.EXTERIOR]===Vr.FALSE}set(){if(1===arguments.length){const t=arguments[0];for(let e=0;e<t.length;e++){const i=Math.trunc(e/3),s=e%3;this._matrix[i][s]=Vr.toDimensionValue(t.charAt(e))}}else if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];this._matrix[t][e]=i}}isContains(){return Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.INTERIOR])&&this._matrix[Wo.EXTERIOR][Wo.INTERIOR]===Vr.FALSE&&this._matrix[Wo.EXTERIOR][Wo.BOUNDARY]===Vr.FALSE}setAtLeast(){if(1===arguments.length){const t=arguments[0];for(let e=0;e<t.length;e++){const i=Math.trunc(e/3),s=e%3;this.setAtLeast(i,s,Vr.toDimensionValue(t.charAt(e)))}}else if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2];this._matrix[t][e]<i&&(this._matrix[t][e]=i)}}setAtLeastIfValid(t,e,i){t>=0&&e>=0&&this.setAtLeast(t,e,i)}isWithin(){return Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.INTERIOR])&&this._matrix[Wo.INTERIOR][Wo.EXTERIOR]===Vr.FALSE&&this._matrix[Wo.BOUNDARY][Wo.EXTERIOR]===Vr.FALSE}isTouches(t,e){return t>e?this.isTouches(e,t):(t===Vr.A&&e===Vr.A||t===Vr.L&&e===Vr.L||t===Vr.L&&e===Vr.A||t===Vr.P&&e===Vr.A||t===Vr.P&&e===Vr.L)&&this._matrix[Wo.INTERIOR][Wo.INTERIOR]===Vr.FALSE&&(Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.BOUNDARY])||Uh.isTrue(this._matrix[Wo.BOUNDARY][Wo.INTERIOR])||Uh.isTrue(this._matrix[Wo.BOUNDARY][Wo.BOUNDARY]))}isOverlaps(t,e){return t===Vr.P&&e===Vr.P||t===Vr.A&&e===Vr.A?Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.INTERIOR])&&Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.EXTERIOR])&&Uh.isTrue(this._matrix[Wo.EXTERIOR][Wo.INTERIOR]):t===Vr.L&&e===Vr.L&&1===this._matrix[Wo.INTERIOR][Wo.INTERIOR]&&Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.EXTERIOR])&&Uh.isTrue(this._matrix[Wo.EXTERIOR][Wo.INTERIOR])}isEquals(t,e){return t===e&&Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.INTERIOR])&&this._matrix[Wo.INTERIOR][Wo.EXTERIOR]===Vr.FALSE&&this._matrix[Wo.BOUNDARY][Wo.EXTERIOR]===Vr.FALSE&&this._matrix[Wo.EXTERIOR][Wo.INTERIOR]===Vr.FALSE&&this._matrix[Wo.EXTERIOR][Wo.BOUNDARY]===Vr.FALSE}toString(){const t=new To("123456789");for(let e=0;e<3;e++)for(let i=0;i<3;i++)t.setCharAt(3*e+i,Vr.toDimensionSymbol(this._matrix[e][i]));return t.toString()}setAll(t){for(let e=0;e<3;e++)for(let i=0;i<3;i++)this._matrix[e][i]=t}get(t,e){return this._matrix[t][e]}transpose(){let t=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=t,t=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=t,t=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=t,this}matches(t){if(9!==t.length)throw new Er("Should be length 9: "+t);for(let e=0;e<3;e++)for(let i=0;i<3;i++)if(!Uh.matches(this._matrix[e][i],t.charAt(3*e+i)))return!1;return!0}add(t){for(let e=0;e<3;e++)for(let i=0;i<3;i++)this.setAtLeast(e,i,t.get(e,i))}isDisjoint(){return this._matrix[Wo.INTERIOR][Wo.INTERIOR]===Vr.FALSE&&this._matrix[Wo.INTERIOR][Wo.BOUNDARY]===Vr.FALSE&&this._matrix[Wo.BOUNDARY][Wo.INTERIOR]===Vr.FALSE&&this._matrix[Wo.BOUNDARY][Wo.BOUNDARY]===Vr.FALSE}isCrosses(t,e){return t===Vr.P&&e===Vr.L||t===Vr.P&&e===Vr.A||t===Vr.L&&e===Vr.A?Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.INTERIOR])&&Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.EXTERIOR]):t===Vr.L&&e===Vr.P||t===Vr.A&&e===Vr.P||t===Vr.A&&e===Vr.L?Uh.isTrue(this._matrix[Wo.INTERIOR][Wo.INTERIOR])&&Uh.isTrue(this._matrix[Wo.EXTERIOR][Wo.INTERIOR]):t===Vr.L&&e===Vr.L&&0===this._matrix[Wo.INTERIOR][Wo.INTERIOR]}get interfaces_(){return[xr]}}class Yh{constructor(){Yh.constructor_.apply(this,arguments)}static constructor_(){if(this._data=null,this._size=0,0===arguments.length)Yh.constructor_.call(this,10);else if(1===arguments.length){const t=arguments[0];this._data=new Array(t).fill(null)}}size(){return this._size}addAll(t){return null===t||0===t.length?null:(this.ensureCapacity(this._size+t.length),Io.arraycopy(t,0,this._data,this._size,t.length),void(this._size+=t.length))}ensureCapacity(t){if(t<=this._data.length)return null;const e=Math.max(t,2*this._data.length);this._data=ro.copyOf(this._data,e)}toArray(){const t=new Array(this._size).fill(null);return Io.arraycopy(this._data,0,t,0,this._size),t}add(t){this.ensureCapacity(this._size+1),this._data[this._size]=t,++this._size}}class Vh{static toIntArray(t){const e=new Array(t.size()).fill(null);for(let i=0;i<e.length;i++)e[i]=t.get(i).intValue();return e}getChainStartIndices(t){let e=0;const i=new Yh(Math.trunc(t.length/2));i.add(e);do{const s=this.findChainEnd(t,e);i.add(s),e=s}while(e<t.length-1);return i.toArray()}findChainEnd(t,e){const i=Ga.quadrant(t[e],t[e+1]);let s=e+1;for(;s<t.length&&Ga.quadrant(t[s-1],t[s])===i;)s++;return s-1}OLDgetChainStartIndices(t){let e=0;const i=new so;i.add(e);do{const s=this.findChainEnd(t,e);i.add(s),e=s}while(e<t.length-1);return Vh.toIntArray(i)}}class Xh{constructor(){Xh.constructor_.apply(this,arguments)}static constructor_(){this.e=null,this.pts=null,this.startIndex=null;const t=arguments[0];this.e=t,this.pts=t.getCoordinates();const e=new Vh;this.startIndex=e.getChainStartIndices(this.pts)}getCoordinates(){return this.pts}getMaxX(t){const e=this.pts[this.startIndex[t]].x,i=this.pts[this.startIndex[t+1]].x;return e>i?e:i}getMinX(t){const e=this.pts[this.startIndex[t]].x,i=this.pts[this.startIndex[t+1]].x;return e<i?e:i}computeIntersectsForChain(){if(4===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[i],e.startIndex[i+1],s)}else if(6===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3],n=arguments[4],r=arguments[5];if(e-t==1&&n-s==1)return r.addIntersections(this.e,t,i.e,s),null;if(!this.overlaps(t,e,i,s,n))return null;const o=Math.trunc((t+e)/2),a=Math.trunc((s+n)/2);t<o&&(s<a&&this.computeIntersectsForChain(t,o,i,s,a,r),a<n&&this.computeIntersectsForChain(t,o,i,a,n,r)),o<e&&(s<a&&this.computeIntersectsForChain(o,e,i,s,a,r),a<n&&this.computeIntersectsForChain(o,e,i,a,n,r))}}overlaps(t,e,i,s,n){return kr.intersects(this.pts[t],this.pts[e],i.pts[s],i.pts[n])}getStartIndexes(){return this.startIndex}computeIntersects(t,e){for(let i=0;i<this.startIndex.length-1;i++)for(let s=0;s<t.startIndex.length-1;s++)this.computeIntersectsForChain(i,t,s,e)}}class Wh{constructor(){Wh.constructor_.apply(this,arguments)}static constructor_(){this._depth=Array(2).fill().map((()=>Array(3)));for(let t=0;t<2;t++)for(let e=0;e<3;e++)this._depth[t][e]=Wh.NULL_VALUE}static depthAtLocation(t){return t===Wo.EXTERIOR?0:t===Wo.INTERIOR?1:Wh.NULL_VALUE}getDepth(t,e){return this._depth[t][e]}setDepth(t,e,i){this._depth[t][e]=i}isNull(){if(0===arguments.length){for(let t=0;t<2;t++)for(let e=0;e<3;e++)if(this._depth[t][e]!==Wh.NULL_VALUE)return!1;return!0}if(1===arguments.length){const t=arguments[0];return this._depth[t][1]===Wh.NULL_VALUE}if(2===arguments.length){const t=arguments[0],e=arguments[1];return this._depth[t][e]===Wh.NULL_VALUE}}normalize(){for(let t=0;t<2;t++)if(!this.isNull(t)){let e=this._depth[t][1];this._depth[t][2]<e&&(e=this._depth[t][2]),e<0&&(e=0);for(let i=1;i<3;i++){let s=0;this._depth[t][i]>e&&(s=1),this._depth[t][i]=s}}}getDelta(t){return this._depth[t][$o.RIGHT]-this._depth[t][$o.LEFT]}getLocation(t,e){return this._depth[t][e]<=0?Wo.EXTERIOR:Wo.INTERIOR}toString(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}add(){if(1===arguments.length){const t=arguments[0];for(let e=0;e<2;e++)for(let i=1;i<3;i++){const s=t.getLocation(e,i);s!==Wo.EXTERIOR&&s!==Wo.INTERIOR||(this.isNull(e,i)?this._depth[e][i]=Wh.depthAtLocation(s):this._depth[e][i]+=Wh.depthAtLocation(s))}}else if(3===arguments.length){const t=arguments[0],e=arguments[1];arguments[2]===Wo.INTERIOR&&this._depth[t][e]++}}}Wh.NULL_VALUE=-1;class $h extends Ia{constructor(){super(),$h.constructor_.apply(this,arguments)}static constructor_(){if(this.pts=null,this._env=null,this.eiList=new qh(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Wh,this._depthDelta=0,1===arguments.length){const t=arguments[0];$h.constructor_.call(this,t,null)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.pts=t,this._label=e}}static updateIM(){if(!(2===arguments.length&&arguments[1]instanceof Uh&&arguments[0]instanceof Ea))return super.updateIM.apply(this,arguments);{const t=arguments[0],e=arguments[1];e.setAtLeastIfValid(t.getLocation(0,$o.ON),t.getLocation(1,$o.ON),1),t.isArea()&&(e.setAtLeastIfValid(t.getLocation(0,$o.LEFT),t.getLocation(1,$o.LEFT),2),e.setAtLeastIfValid(t.getLocation(0,$o.RIGHT),t.getLocation(1,$o.RIGHT),2))}}getDepth(){return this._depth}getCollapsedEdge(){const t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new $h(t,Ea.toLineLabel(this._label))}isIsolated(){return this._isIsolated}getCoordinates(){return this.pts}setIsolated(t){this._isIsolated=t}setName(t){this._name=t}equals(t){if(!(t instanceof $h))return!1;const e=t;if(this.pts.length!==e.pts.length)return!1;let i=!0,s=!0,n=this.pts.length;for(let t=0;t<this.pts.length;t++)if(this.pts[t].equals2D(e.pts[t])||(i=!1),this.pts[t].equals2D(e.pts[--n])||(s=!1),!i&&!s)return!1;return!0}getCoordinate(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){const t=arguments[0];return this.pts[t]}}print(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(let e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)}computeIM(t){$h.updateIM(this._label,t)}isCollapsed(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])}isClosed(){return this.pts[0].equals(this.pts[this.pts.length-1])}getMaximumSegmentIndex(){return this.pts.length-1}getDepthDelta(){return this._depthDelta}getNumPoints(){return this.pts.length}printReverse(t){t.print("edge "+this._name+": ");for(let e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")}getMonotoneChainEdge(){return null===this._mce&&(this._mce=new Xh(this)),this._mce}getEnvelope(){if(null===this._env){this._env=new kr;for(let t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env}addIntersection(t,e,i,s){const n=new Fr(t.getIntersection(s));let r=e,o=t.getEdgeDistance(i,s);const a=r+1;if(a<this.pts.length){const t=this.pts[a];n.equals2D(t)&&(r=a,o=0)}this.eiList.add(n,r,o)}toString(){const t=new To;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(let e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()}isPointwiseEqual(t){if(this.pts.length!==t.pts.length)return!1;for(let e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0}setDepthDelta(t){this._depthDelta=t}getEdgeIntersectionList(){return this.eiList}addIntersections(t,e,i){for(let s=0;s<t.getIntersectionNum();s++)this.addIntersection(t,e,i,s)}}class Hh{constructor(){Hh.constructor_.apply(this,arguments)}static constructor_(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Gh;const t=arguments[0];this._bufParams=t}static depthDelta(t){const e=t.getLocation(0,$o.LEFT),i=t.getLocation(0,$o.RIGHT);return e===Wo.INTERIOR&&i===Wo.EXTERIOR?1:e===Wo.EXTERIOR&&i===Wo.INTERIOR?-1:0}static convertSegStrings(t){const e=new zo,i=new so;for(;t.hasNext();){const s=t.next(),n=e.createLineString(s.getCoordinates());i.add(n)}return e.buildGeometry(i)}setWorkingPrecisionModel(t){this._workingPrecisionModel=t}insertUniqueEdge(t){const e=this._edgeList.findEqualEdge(t);if(null!==e){const i=e.getLabel();let s=t.getLabel();e.isPointwiseEqual(t)||(s=new Ea(t.getLabel()),s.flip()),i.merge(s);const n=Hh.depthDelta(s),r=e.getDepthDelta()+n;e.setDepthDelta(r)}else this._edgeList.add(t),t.setDepthDelta(Hh.depthDelta(t.getLabel()))}buildSubgraphs(t,e){const i=new so;for(let s=t.iterator();s.hasNext();){const t=s.next(),n=t.getRightmostCoordinate(),r=new Ch(i).getDepth(n);t.computeDepth(r),t.findResultEdges(),i.add(t),e.add(t.getDirectedEdges(),t.getNodes())}}createSubgraphs(t){const e=new so;for(let i=t.getNodes().iterator();i.hasNext();){const t=i.next();if(!t.isVisited()){const i=new ta;i.create(t),e.add(i)}}return Ka.sort(e,Ka.reverseOrder()),e}createEmptyResultGeometry(){return this._geomFact.createPolygon()}getNoder(t){if(null!==this._workingNoder)return this._workingNoder;const e=new mh,i=new xa;return i.setPrecisionModel(t),e.setSegmentIntersector(new Bh(i)),e}buffer(t,e){let i=this._workingPrecisionModel;null===i&&(i=t.getPrecisionModel()),this._geomFact=t.getFactory();const s=new Eh(i,this._bufParams),n=new Th(t,e,s).getCurves();if(n.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(n,i),this._graph=new qa(new Dh),this._graph.addEdges(this._edgeList.getEdges());const r=this.createSubgraphs(this._graph),o=new Ua(this._geomFact);this.buildSubgraphs(r,o);const a=o.getPolygons();return a.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(a)}computeNodedEdges(t,e){const i=this.getNoder(e);i.computeNodes(t);for(let t=i.getNodedSubstrings().iterator();t.hasNext();){const e=t.next(),i=e.getCoordinates();if(2===i.length&&i[0].equals2D(i[1]))continue;const s=e.getData(),n=new $h(e.getCoordinates(),new Ea(s));this.insertUniqueEdge(n)}}setNoder(t){this._workingNoder=t}}class Kh{constructor(){Kh.constructor_.apply(this,arguments)}static constructor_(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){const t=arguments[0],e=arguments[1];Kh.constructor_.call(this,t,e,0,0)}else if(4===arguments.length){const t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._isScaled=!this.isIntegerPrecision()}}rescale(){if(fr(arguments[0],Qr))for(let t=arguments[0].iterator();t.hasNext();){const e=t.next();this.rescale(e.getCoordinates())}else if(arguments[0]instanceof Array){const t=arguments[0];for(let e=0;e<t.length;e++)t[e].x=t[e].x/this._scaleFactor+this._offsetX,t[e].y=t[e].y/this._scaleFactor+this._offsetY;2===t.length&&t[0].equals2D(t[1])&&Io.out.println(t)}}scale(){if(fr(arguments[0],Qr)){const t=arguments[0],e=new so(t.size());for(let i=t.iterator();i.hasNext();){const t=i.next();e.add(new ch(this.scale(t.getCoordinates()),t.getData()))}return e}if(arguments[0]instanceof Array){const t=arguments[0],e=new Array(t.length).fill(null);for(let i=0;i<t.length;i++)e[i]=new Fr(Math.round((t[i].x-this._offsetX)*this._scaleFactor),Math.round((t[i].y-this._offsetY)*this._scaleFactor),t[i].getZ());return Lo.removeRepeatedPoints(e)}}isIntegerPrecision(){return 1===this._scaleFactor}getNodedSubstrings(){const t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t}computeNodes(t){let e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)}get interfaces_(){return[_h]}}class Zh{constructor(){Zh.constructor_.apply(this,arguments)}static constructor_(){this._li=new xa,this._segStrings=null;const t=arguments[0];this._segStrings=t}checkEndPtVertexIntersections(){if(0===arguments.length)for(let t=this._segStrings.iterator();t.hasNext();){const e=t.next().getCoordinates();this.checkEndPtVertexIntersections(e[0],this._segStrings),this.checkEndPtVertexIntersections(e[e.length-1],this._segStrings)}else if(2===arguments.length){const t=arguments[0];for(let e=arguments[1].iterator();e.hasNext();){const i=e.next().getCoordinates();for(let e=1;e<i.length-1;e++)if(i[e].equals(t))throw new Tr("found endpt/interior pt intersection at index "+e+" :pt "+t)}}}checkInteriorIntersections(){if(0===arguments.length)for(let t=this._segStrings.iterator();t.hasNext();){const e=t.next();for(let t=this._segStrings.iterator();t.hasNext();){const i=t.next();this.checkInteriorIntersections(e,i)}}else if(2===arguments.length){const t=arguments[0],e=arguments[1],i=t.getCoordinates(),s=e.getCoordinates();for(let n=0;n<i.length-1;n++)for(let i=0;i<s.length-1;i++)this.checkInteriorIntersections(t,n,e,i)}else if(4===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=arguments[3];if(t===i&&e===s)return null;const n=t.getCoordinates()[e],r=t.getCoordinates()[e+1],o=i.getCoordinates()[s],a=i.getCoordinates()[s+1];if(this._li.computeIntersection(n,r,o,a),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,n,r)||this.hasInteriorIntersection(this._li,o,a)))throw new Tr("found non-noded intersection at "+n+"-"+r+" and "+o+"-"+a)}}checkValid(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}checkCollapses(){if(0===arguments.length)for(let t=this._segStrings.iterator();t.hasNext();){const e=t.next();this.checkCollapses(e)}else if(1===arguments.length){const t=arguments[0].getCoordinates();for(let e=0;e<t.length-2;e++)this.checkCollapse(t[e],t[e+1],t[e+2])}}hasInteriorIntersection(t,e,i){for(let s=0;s<t.getIntersectionNum();s++){const n=t.getIntersection(s);if(!n.equals(e)&&!n.equals(i))return!0}return!1}checkCollapse(t,e,i){if(t.equals(i))throw new Tr("found non-noded collapse at "+Zh.fact.createLineString([t,e,i]))}}Zh.fact=new zo;class Jh{constructor(){Jh.constructor_.apply(this,arguments)}static constructor_(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;const t=arguments[0],e=arguments[1],i=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=i,e<=0)throw new Er("Scale factor must be non-zero");1!==e&&(this._pt=new Fr(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new Fr,this._p1Scaled=new Fr),this.initCorners(this._pt)}intersectsScaled(t,e){const i=Math.min(t.x,e.x),s=Math.max(t.x,e.x),n=Math.min(t.y,e.y),r=Math.max(t.y,e.y),o=this._maxx<i||this._minx>s||this._maxy<n||this._miny>r;if(o)return!1;const a=this.intersectsToleranceSquare(t,e);return Rr.isTrue(!(o&&a),"Found bad envelope test"),a}initCorners(t){const e=.5;this._minx=t.x-e,this._maxx=t.x+e,this._miny=t.y-e,this._maxy=t.y+e,this._corner[0]=new Fr(this._maxx,this._maxy),this._corner[1]=new Fr(this._minx,this._maxy),this._corner[2]=new Fr(this._minx,this._miny),this._corner[3]=new Fr(this._maxx,this._miny)}intersects(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}scale(t){return Math.round(t*this._scaleFactor)}getCoordinate(){return this._originalPt}copyScaled(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)}getSafeEnvelope(){if(null===this._safeEnv){const t=Jh.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new kr(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv}intersectsPixelClosure(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))))}intersectsToleranceSquare(t,e){let i=!1,s=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(s=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper()||i&&s||t.equals(this._pt)||e.equals(this._pt)))))}addSnappedNode(t,e){const i=t.getCoordinate(e),s=t.getCoordinate(e+1);return!!this.intersects(i,s)&&(t.addIntersection(this.getCoordinate(),e),!0)}}Jh.SAFE_ENV_EXPANSION_FACTOR=.75;class Qh{constructor(){Qh.constructor_.apply(this,arguments)}static constructor_(){this.selectedSegment=new uh}select(){if(1===arguments.length);else if(2===arguments.length){const t=arguments[1];arguments[0].getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}}}class tl{constructor(){tl.constructor_.apply(this,arguments)}static constructor_(){this._index=null;const t=arguments[0];this._index=t}snap(){if(1===arguments.length){const t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){const t=arguments[0],e=arguments[1],i=arguments[2],s=t.getSafeEnvelope(),n=new el(t,e,i);return this._index.query(s,new class{get interfaces_(){return[Qa]}visitItem(t){t.select(s,n)}}),n.isNodeAdded()}}}class el extends Qh{constructor(){super(),el.constructor_.apply(this,arguments)}static constructor_(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;const t=arguments[0],e=arguments[1],i=arguments[2];this._hotPixel=t,this._parentEdge=e,this._hotPixelVertexIndex=i}isNodeAdded(){return this._isNodeAdded}select(){if(!(2===arguments.length&&Number.isInteger(arguments[1])&&arguments[0]instanceof gh))return super.select.apply(this,arguments);{const t=arguments[1],e=arguments[0].getContext();if(this._parentEdge===e&&(t===this._hotPixelVertexIndex||t+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(e,t)}}}tl.HotPixelSnapAction=el;class il{constructor(){il.constructor_.apply(this,arguments)}static constructor_(){this._li=null,this._interiorIntersections=null;const t=arguments[0];this._li=t,this._interiorIntersections=new so}processIntersections(t,e,i,s){if(t===i&&e===s)return null;const n=t.getCoordinates()[e],r=t.getCoordinates()[e+1],o=i.getCoordinates()[s],a=i.getCoordinates()[s+1];if(this._li.computeIntersection(n,r,o,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(let t=0;t<this._li.getIntersectionNum();t++)this._interiorIntersections.add(this._li.getIntersection(t));t.addIntersections(this._li,e,0),i.addIntersections(this._li,s,1)}}isDone(){return!1}getInteriorIntersections(){return this._interiorIntersections}get interfaces_(){return[zh]}}class sl{constructor(){sl.constructor_.apply(this,arguments)}static constructor_(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;const t=arguments[0];this._pm=t,this._li=new xa,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()}checkCorrectness(t){const e=ch.getNodedSubstrings(t),i=new Zh(e);try{i.checkValid()}catch(t){if(!(t instanceof Mr))throw t;t.printStackTrace()}}getNodedSubstrings(){return ch.getNodedSubstrings(this._nodedSegStrings)}snapRound(t,e){const i=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(i),this.computeVertexSnaps(t)}findInteriorIntersections(t,e){const i=new il(e);return this._noder.setSegmentIntersector(i),this._noder.computeNodes(t),i.getInteriorIntersections()}computeVertexSnaps(){if(fr(arguments[0],Qr))for(let t=arguments[0].iterator();t.hasNext();){const e=t.next();this.computeVertexSnaps(e)}else if(arguments[0]instanceof ch){const t=arguments[0],e=t.getCoordinates();for(let i=0;i<e.length;i++){const s=new Jh(e[i],this._scaleFactor,this._li);this._pointSnapper.snap(s,t,i)&&t.addIntersection(e[i],i)}}}computeNodes(t){this._nodedSegStrings=t,this._noder=new mh,this._pointSnapper=new tl(this._noder.getIndex()),this.snapRound(t,this._li)}computeIntersectionSnaps(t){for(let e=t.iterator();e.hasNext();){const t=e.next(),i=new Jh(t,this._scaleFactor,this._li);this._pointSnapper.snap(i)}}get interfaces_(){return[_h]}}class nl{constructor(){nl.constructor_.apply(this,arguments)}static constructor_(){if(this._argGeom=null,this._distance=null,this._bufParams=new Xo,this._resultGeometry=null,this._saveException=null,1===arguments.length){const t=arguments[0];this._argGeom=t}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this._argGeom=t,this._bufParams=e}}static bufferOp(){if(2===arguments.length){const t=arguments[1];return new nl(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Gr&&"number"==typeof arguments[1]){const t=arguments[1],e=arguments[2],i=new nl(arguments[0]);return i.setQuadrantSegments(e),i.getResultGeometry(t)}if(arguments[2]instanceof Xo&&arguments[0]instanceof Gr&&"number"==typeof arguments[1]){const t=arguments[1];return new nl(arguments[0],arguments[2]).getResultGeometry(t)}}else if(4===arguments.length){const t=arguments[1],e=arguments[2],i=arguments[3],s=new nl(arguments[0]);return s.setQuadrantSegments(e),s.setEndCapStyle(i),s.getResultGeometry(t)}}static precisionScaleFactor(t,e,i){const s=t.getEnvelopeInternal(),n=bo.max(Math.abs(s.getMaxX()),Math.abs(s.getMaxY()),Math.abs(s.getMinX()),Math.abs(s.getMinY()))+2*(e>0?e:0),r=i-Math.trunc(Math.log(n)/Math.log(10)+1);return Math.pow(10,r)}bufferFixedPrecision(t){const e=new Kh(new sl(new Do(1)),t.getScale()),i=new Hh(this._bufParams);i.setWorkingPrecisionModel(t),i.setNoder(e),this._resultGeometry=i.buffer(this._argGeom,this._distance)}bufferReducedPrecision(){if(0===arguments.length){for(let t=nl.MAX_PRECISION_DIGITS;t>=0;t--){try{this.bufferReducedPrecision(t)}catch(t){if(!(t instanceof Jo))throw t;this._saveException=t}if(null!==this._resultGeometry)return null}throw this._saveException}if(1===arguments.length){const t=arguments[0],e=nl.precisionScaleFactor(this._argGeom,this._distance,t),i=new Do(e);this.bufferFixedPrecision(i)}}computeGeometry(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;const t=this._argGeom.getFactory().getPrecisionModel();t.getType()===Do.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()}setQuadrantSegments(t){this._bufParams.setQuadrantSegments(t)}bufferOriginalPrecision(){try{const t=new Hh(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof Tr))throw t;this._saveException=t}}getResultGeometry(t){return this._distance=t,this.computeGeometry(),this._resultGeometry}setEndCapStyle(t){this._bufParams.setEndCapStyle(t)}}nl.CAP_ROUND=Xo.CAP_ROUND,nl.CAP_BUTT=Xo.CAP_FLAT,nl.CAP_FLAT=Xo.CAP_FLAT,nl.CAP_SQUARE=Xo.CAP_SQUARE,nl.MAX_PRECISION_DIGITS=12;class rl{constructor(){this._layers=[],this._allFeatureTypeSelected=[],this._bufferValue=0,this._bufferLayer=new OpenLayers.Layer.Vector("selectionBufferLayer",{styleMap:new OpenLayers.StyleMap({fillColor:"white",fillOpacity:0,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeDashstyle:"longdash"})}),jy.lizmap3.map.addLayer(this._bufferLayer),this._geomOperator="intersects",this._newAddRemove=["new","add","remove"],this._newAddRemoveSelected=this._newAddRemove[0];const t=jy.vectorLayerFeatureTypes;if(0===t.length)return document.getElementById("button-selectiontool")&&document.getElementById("button-selectiontool").parentNode.remove(),!1;const e=jy.config,i=[];for(const s in e.attributeLayers)if(e.attributeLayers.hasOwnProperty(s))for(const n of t){const t=jy.getNameByTypeName(n.getElementsByTagName("Name")[0].textContent);s===t&&t in e.layers&&"none"!=e.layers[t].geometryType&&"unknown"!=e.layers[t].geometryType&&(i[e.attributeLayers[s].order]={name:t,title:e.layers[t].title})}for(const t of i)void 0!==t&&(this._layers.push(t),this._allFeatureTypeSelected.push(t.name));if(0===this._layers.length)return document.getElementById("button-selectiontool")&&document.getElementById("button-selectiontool").parentNode.remove(),!1;qy.addListener((()=>{if(this.isActive&&jy.digitizing.featureDrawn){jy.digitizing.featureDrawn.length>1&&(jy.digitizing.drawLayer.destroyFeatures(jy.digitizing.drawLayer.features.shift()),jy.digitizing.saveFeatureDrawn());const t=jy.digitizing.featureDrawn[0];if(t){if(this._bufferLayer.destroyFeatures(),this._bufferValue>0){t.geometry.transform(jy.projection,jy.qgisProjectProjection);const e=new OpenLayers.Format.GeoJSON,i=new Yo,s=new Vo,n=i.read(e.write(t.geometry)),r=nl.bufferOp(n,this._bufferValue),o=e.read(s.write(r))[0];o.geometry.transform(jy.qgisProjectProjection,jy.projection),this._bufferLayer.addFeatures(o),this._bufferLayer.redraw(!0)}for(const e of this.allFeatureTypeSelected)jy.lizmap3.selectLayerFeaturesFromSelectionFeature(e,this.featureDrawnBuffered||t,this._geomOperator)}}}),["digitizing.featureDrawn","digitizing.editionEnds"]),qy.addListener((()=>{this._bufferLayer.setVisibility(jy.digitizing.featureDrawnVisibility)}),["digitizing.featureDrawnVisibility"]),qy.addListener((()=>{this._bufferLayer.destroyFeatures()}),["digitizing.erase"]),jy.lizmap3.events.on({minidockclosed:t=>{"selectiontool"===t.id&&(jy.digitizing.toolSelected="deactivate")}})}get isActive(){return document.getElementById("button-selectiontool").parentElement.classList.contains("active")}get layers(){return this._layers}get bufferLayer(){return this._bufferLayer}get bufferValue(){return this._bufferValue}set bufferValue(t){this._bufferValue=isNaN(t)?0:t,qy.dispatch("selection.bufferValue")}get featureDrawnBuffered(){return this._bufferLayer.features.length?this._bufferLayer.features[0]:null}get exportFormats(){return jy.vectorLayerResultFormat.filter((t=>!["GML2","GML3","GEOJSON"].includes(t.toUpperCase())))}get isExportable(){return 1===this._allFeatureTypeSelected.length&&this.selectedFeaturesCount}get selectedFeaturesCount(){let t=0;for(const e of this.allFeatureTypeSelected)e in jy.config.layers&&"selectedFeatures"in jy.config.layers[e]&&jy.config.layers[e].selectedFeatures.length&&(t+=jy.config.layers[e].selectedFeatures.length);return t}get filterActive(){return jy.lizmap3.lizmapLayerFilterActive}set filterActive(t){jy.lizmap3.lizmapLayerFilterActive=t}get filteredFeaturesCount(){let t=0;for(const e of this.allFeatureTypeSelected)e in jy.config.layers&&"filteredFeatures"in jy.config.layers[e]&&(t+=jy.config.layers[e].filteredFeatures.length);return t}get allFeatureTypeSelected(){return this._allFeatureTypeSelected}set allFeatureTypeSelected(t){this._allFeatureTypeSelected!==t&&(this._allFeatureTypeSelected="selectable-layers"===t?this.layers.map((t=>t.name)):"selectable-visible-layers"===t?this.layers.map((t=>t.name)).filter((t=>{for(let e=0;e<jy.lizmap3.map.layers.length;e++)if(jy.lizmap3.map.layers[e].visibility&&jy.lizmap3.map.layers[e].name===t)return!0})):[t],qy.dispatch("selectionTool.allFeatureTypeSelected"))}set geomOperator(t){this._geomOperator!==t&&(this._geomOperator=t)}get newAddRemoveSelected(){return this._newAddRemoveSelected}set newAddRemoveSelected(t){this._newAddRemove.includes(t)&&(this._newAddRemoveSelected=t,qy.dispatch("selectionTool.newAddRemoveSelected"))}disable(){this.isActive&&document.getElementById("button-selectiontool").click()}unselect(){for(const t of this.allFeatureTypeSelected)jy.lizmap3.events.triggerEvent("layerfeatureunselectall",{featureType:t,updateDrawing:!0});jy.digitizing.drawLayer.destroyFeatures(),this._bufferLayer.destroyFeatures()}filter(){if(this.filteredFeaturesCount){for(const t of this.allFeatureTypeSelected)jy.lizmap3.events.triggerEvent("layerfeatureremovefilter",{featureType:t});this.filterActive=null}else for(const t of this.allFeatureTypeSelected)t in jy.config.layers&&"selectedFeatures"in jy.config.layers[t]&&jy.config.layers[t].selectedFeatures.length&&(this.filterActive=t,jy.lizmap3.events.triggerEvent("layerfeaturefilterselected",{featureType:t}))}invert(t){const e=t||this.allFeatureTypeSelected[0];e in jy.config.layers&&"selectedFeatures"in jy.config.layers[e]&&jy.config.layers[e].selectedFeatures.length&&jy.lizmap3.getFeatureData(e,null,null,"extent",!1,null,null,((t,i,s)=>{const n=[];for(const e of s){const i=e.id.split(".")[1];jy.config.layers[t].selectedFeatures.includes(i)||n.push(i)}jy.config.layers[e].selectedFeatures=n,jy.lizmap3.events.triggerEvent("layerSelectionChanged",{featureType:e,featureIds:"40",updateDrawing:!0})}))}export(t){"GML"===t&&(t="GML3"),jy.lizmap3.exportVectorLayer(this._allFeatureTypeSelected[0],t,!1)}}class ol{static downloadFileFromString(t,e,i){var s=new Blob([t],{type:e}),n=document.createElement("a");n.download=i,n.href=URL.createObjectURL(s),n.dataset.downloadurl=[e,n.download,n.href].join(":"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout((()=>{URL.revokeObjectURL(n.href)}),1500)}}class al extends S{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if("function"==typeof t.getSimplifiedGeometry){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new al(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(y(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=f(t,_.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?function(t){if("function"==typeof t)return t;let e;return Array.isArray(t)?e=t:(q("function"==typeof t.getZIndex,41),e=[t]),function(){return e}}(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}const hl=al;class ll extends bs{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){this.flatCoordinates?a(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new ll(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<Q(this.getExtent(),t,e))return s;const n=this.flatCoordinates,r=this.stride;for(let o=0,a=n.length;o<a;o+=r){const a=Lt(t,e,n[o],n[o+1]);if(a<s){s=a;for(let t=0;t<r;++t)i[t]=n[o+t];i.length=r}}return s}getCoordinates(){return zs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new Ws(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,s=[];for(let n=0,r=t.length;n<r;n+=i){const r=new Ws(t.slice(n,n+i),e);s.push(r)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let s=0,n=e.length;s<n;s+=i)if(it(t,e[s],e[s+1]))return!0;return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Os(this.flatCoordinates,0,t,this.stride),this.changed()}}const cl=ll;function ul(t,e,i,s,r,o,a){let h,l;const c=(i-e)/s;if(1===c)h=e;else if(2===c)h=e,l=r;else if(0!==c){let o=t[e],a=t[e+1],c=0;const u=[0];for(let n=e+s;n<i;n+=s){const e=t[n],i=t[n+1];c+=Math.sqrt((e-o)*(e-o)+(i-a)*(i-a)),u.push(c),o=e,a=i}const d=r*c,g=function(t,e,i){let s,r;i=i||n;let o=0,a=t.length,h=!1;for(;o<a;)s=o+(a-o>>1),r=+i(t[s],e),r<0?o=s+1:(a=s,h=!r);return h?o:~o}(u,d);g<0?(l=(d-u[-g-2])/(u[-g-1]-u[-g-2]),h=e+(-g-2)*s):h=e+g*s}a=a>1?a:2,o=o||new Array(a);for(let e=0;e<a;++e)o[e]=void 0===h?NaN:void 0===l?t[h+e]:Pt(t[h+e],t[h+s+e],l);return o}function dl(t,e,i,s,n,r){if(i==e)return null;let o;if(n<t[e+s-1])return r?(o=t.slice(e,e+s),o[s-1]=n,o):null;if(t[i-1]<n)return r?(o=t.slice(i-s,i),o[s-1]=n,o):null;if(n==t[e+s-1])return t.slice(e,e+s);let a=e/s,h=i/s;for(;a<h;){const e=a+h>>1;n<t[(e+1)*s-1]?h=e:a=e+1}const l=t[a*s-1];if(n==l)return t.slice((a-1)*s,(a-1)*s+s);const c=(n-l)/(t[(a+1)*s-1]-l);o=[];for(let e=0;e<s-1;++e)o.push(Pt(t[(a-1)*s+e],t[a*s+e],c));return o.push(n),o}function gl(t,e,i,s){let n=t[e],r=t[e+1],o=0;for(let a=e+s;a<i;a+=s){const e=t[a],i=t[a+1];o+=Math.sqrt((e-n)*(e-n)+(i-r)*(i-r)),n=e,r=i}return o}class pl extends bs{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}appendCoordinate(t){this.flatCoordinates?a(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){const t=new pl(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<Q(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ls(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ns(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,s))}forEachSegment(t){return Js(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return"XYM"!=this.layout&&"XYZM"!=this.layout?null:(e=void 0!==e&&e,dl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return zs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return ul(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return gl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Fs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new pl(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Qs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Os(this.flatCoordinates,0,t,this.stride),this.changed()}}const _l=pl;class fl extends bs{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(void 0!==e&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{let e=this.getLayout();const i=t,s=[],n=[];for(let t=0,r=i.length;t<r;++t){const r=i[t];0===t&&(e=r.getLayout()),a(s,r.getFlatCoordinates()),n.push(s.length)}this.setFlatCoordinates(e,s),this.ends_=n}}appendLineString(t){this.flatCoordinates?a(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new fl(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<Q(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ts(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Rs(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,s))}getCoordinateAtM(t,e,i){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:(e=void 0!==e&&e,i=void 0!==i&&i,function(t,e,i,s,n,r,o){if(o)return dl(t,e,i[i.length-1],s,n,r);let a;if(n<t[s-1])return r?(a=t.slice(0,s),a[s-1]=n,a):null;if(t[t.length-1]<n)return r?(a=t.slice(t.length-s),a[s-1]=n,a):null;for(let r=0,o=i.length;r<o;++r){const o=i[r];if(e!=o){if(n<t[e+s-1])return null;if(n<=t[o-1])return dl(t,e,o,s,n,!1);e=o}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return Bs(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new _l(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,s=[];let n=0;for(let r=0,o=e.length;r<o;++r){const o=e[r],a=new _l(t.slice(n,o),i);s.push(a),n=o}return s}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const s=this.ends_,n=this.stride;for(let r=0,o=s.length;r<o;++r){const o=s[r];a(t,ul(e,i,o,n,.5)),i=o}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=function(t,e,i,s,n,r,o,a){for(let h=0,l=i.length;h<l;++h){const l=i[h];o=Fs(t,e,l,s,n,r,o),a.push(o),e=l}return o}(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new fl(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return function(t,e,i,s,n){for(let r=0,o=i.length;r<o;++r){if(Qs(t,e,i[r],s,n))return!0;e=i[r]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=As(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const ml=fl;class yl extends bs{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){let s=this.getLayout();const n=t,r=[],o=[];for(let t=0,e=n.length;t<e;++t){const e=n[t];0===t&&(s=e.getLayout());const i=r.length,h=e.getEnds();for(let t=0,e=h.length;t<e;++t)h[t]+=i;a(r,e.getFlatCoordinates()),o.push(h)}e=s,t=r,i=o}void 0!==e&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(this.flatCoordinates){const i=this.flatCoordinates.length;a(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let t=0,s=e.length;t<s;++t)e[t]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let i=0;i<t;++i)e[i]=this.endss_[i].slice();const i=new yl(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,s){return s<Q(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,i,s,n){for(let r=0,o=i.length;r<o;++r){const o=i[r];n=Ts(t,e,o,s,n),e=o[o.length-1]}return n}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,i,s,n,r,o,a,h,l,c){c=c||[NaN,NaN];for(let r=0,u=i.length;r<u;++r){const u=i[r];l=Rs(t,e,u,s,n,true,o,a,h,l,c),e=u[u.length-1]}return l}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,0,t,e,i,s))}containsXY(t,e){return function(t,e,i,s,n,r){if(0===i.length)return!1;for(let o=0,a=i.length;o<a;++o){const a=i[o];if(Ks(t,e,a,s,n,r))return!0;e=a[a.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return function(t,e,i,s){let n=0;for(let r=0,o=i.length;r<o;++r){const o=i[r];n+=Us(t,e,o,s),e=o[o.length-1]}return n}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),on(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,js(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=function(t,e,i,s){const n=[];let r=[1/0,1/0,-1/0,-1/0];for(let o=0,a=i.length;o<a;++o){const a=i[o];r=at(t,e,a[0],s),n.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=a[a.length-1]}return n}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=function(t,e,i,s,n){let r=[];for(let o=0,a=i.length;o<a;++o){const a=i[o];r=Zs(t,e,a,s,n,2*o,r),e=a[a.length-1]}return r}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new cl(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;!function(t,e,i,s,n){for(let n=0,r=i.length;n<r;++n){const r=i[n];if(!nn(t,e,r,s,undefined))return!1;r.length&&(e=r[r.length-1])}return!0}(t,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=on(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=function(t,e,i,s,n,r,o,a){for(let h=0,l=i.length;h<l;++h){const l=i[h],c=[];o=Gs(t,e,l,s,n,r,o,c),a.push(c),e=l[l.length-1]}return o}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new yl(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(0===t)e=0;else{const i=this.endss_[t-1];e=i[i.length-1]}const i=this.endss_[t].slice(),s=i[i.length-1];if(0!==e)for(let t=0,s=i.length;t<s;++t)i[t]-=e;return new hn(this.flatCoordinates.slice(e,s),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,s=[];let n=0;for(let r=0,o=i.length;r<o;++r){const o=i[r].slice(),a=o[o.length-1];if(0!==n)for(let t=0,e=o.length;t<e;++t)o[t]-=n;const h=new hn(e.slice(n,a),t,o);s.push(h),n=a}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return function(t,e,i,s,n){for(let r=0,o=i.length;r<o;++r){const o=i[r];if(tn(t,e,o,s,n))return!0;e=o[o.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=function(t,e,i,s,n){n=n||[];let r=0;for(let o=0,a=i.length;o<a;++o){const a=As(t,e,i[o],s,n[r]);0===a.length&&(a[0]=e),n[r++]=a,e=a[a.length-1]}return n.length=r,n}(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{const t=i[i.length-1];this.flatCoordinates.length=0===t.length?0:t[t.length-1]}this.changed()}}const xl=yl;class vl extends Cs{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(y),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(f(this.geometries_[t],_.CHANGE,this.changed,this))}clone(){const t=new vl(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<Q(this.getExtent(),t,e))return s;const n=this.geometries_;for(let r=0,o=n.length;r<o;++r)s=n[r].closestPointXY(t,e,i,s);return s}containsXY(t,e){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)if(i[s].containsXY(t,e))return!0;return!1}computeExtent(t){rt(t);const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)lt(t,e[i].getExtent());return t}getGeometries(){return wl(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let s=!1;for(let n=0,r=i.length;n<r;++n){const r=i[n],o=r.getSimplifiedGeometry(t);e.push(o),o!==r&&(s=!0)}if(s){const t=new vl(null);return t.setGeometriesArray(e),t}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(t,e){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)i[s].rotate(t,e);this.changed()}scale(t,e,i){i||(i=ft(this.getExtent()));const s=this.geometries_;for(let n=0,r=s.length;n<r;++n)s[n].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(wl(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)i[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function wl(t){const e=[];for(let i=0,s=t.length;i<s;++i)e.push(t[i].clone());return e}const Ml=vl,El=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?qi(e.dataProjection):this.readProjection(t);e.extent&&i&&"tile-pixels"===i.getUnits()&&(i=qi(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)}getType(){return w()}readFeature(t,e){return w()}readFeatures(t,e){return w()}readGeometry(t,e){return w()}readProjection(t){return w()}writeFeature(t,e){return w()}writeFeatures(t,e){return w()}writeGeometry(t,e){return w()}};function Cl(t,e,i){const s=i?qi(i.featureProjection):null,n=i?qi(i.dataProjection):null;let r;if(r=s&&n&&!$i(s,n)?(e?t.clone():t).transform(e?s:n,e?n:s):t,e&&i&&void 0!==i.decimals){const e=Math.pow(10,i.decimals),s=function(t){for(let i=0,s=t.length;i<s;++i)t[i]=Math.round(t[i]*e)/e;return t};r===t&&(r=t.clone()),r.applyTransform(s)}return r}function Sl(t){if("string"==typeof t){return JSON.parse(t)||null}return null!==t?t:null}const bl=class extends El{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Sl(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Sl(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return w()}readFeaturesFromObject(t,e){return w()}readGeometry(t,e){return this.readGeometryFromObject(Sl(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return w()}readProjection(t){return this.readProjectionFromObject(Sl(t))}readProjectionFromObject(t){return w()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return w()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return w()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return w()}};function Il(t,e){if(!t)return null;let i;switch(t.type){case"Point":i=function(t){return new Ws(t.coordinates)}(t);break;case"LineString":i=function(t){return new _l(t.coordinates)}(t);break;case"Polygon":i=function(t){return new hn(t.coordinates)}(t);break;case"MultiPoint":i=function(t){return new cl(t.coordinates)}(t);break;case"MultiLineString":i=function(t){return new ml(t.coordinates)}(t);break;case"MultiPolygon":i=function(t){return new xl(t.coordinates)}(t);break;case"GeometryCollection":i=function(t,e){const i=t.geometries.map((function(t){return Il(t,undefined)}));return new Ml(i)}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return Cl(i,!1,e)}function Ll(t,e){const i=(t=Cl(t,!0,e)).getType();let s;switch(i){case"Point":s=function(t,e){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case"LineString":s=function(t,e){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case"Polygon":s=function(t,e){let i;return e&&(i=e.rightHanded),{type:"Polygon",coordinates:t.getCoordinates(i)}}(t,e);break;case"MultiPoint":s=function(t,e){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case"MultiLineString":s=function(t,e){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case"MultiPolygon":s=function(t,e){let i;return e&&(i=e.rightHanded),{type:"MultiPolygon",coordinates:t.getCoordinates(i)}}(t,e);break;case"GeometryCollection":s=function(t,e){delete(e=Object.assign({},e)).featureProjection;return{type:"GeometryCollection",geometries:t.getGeometriesArray().map((function(t){return Ll(t,e)}))}}(t,e);break;case"Circle":s={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+i)}return s}const Tl=class extends bl{constructor(t){t=t||{},super(),this.dataProjection=qi(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=qi(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;i="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null};const s=Il(i.geometry,e),n=new hl;return this.geometryName_?n.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&n.setGeometryName(i.geometry_name),n.setGeometry(s),"id"in i&&n.setId(i.id),i.properties&&n.setProperties(i.properties,!0),n}readFeaturesFromObject(t,e){let i=null;if("FeatureCollection"===t.type){i=[];const s=t.features;for(let t=0,n=s.length;t<n;++t)i.push(this.readFeatureFromObject(s[t],e))}else i=[this.readFeatureFromObject(t,e)];return i}readGeometryFromObject(t,e){return Il(t,e)}readProjectionFromObject(t){const e=t.crs;let i;return e?"name"==e.type?i=qi(e.properties.name):"EPSG"===e.type?i=qi("EPSG:"+e.properties.code):q(!1,36):i=this.dataProjection,i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},s=t.getId();if(void 0!==s&&(i.id=s),!t.hasProperties())return i;const n=t.getProperties(),r=t.getGeometry();return r&&(i.geometry=Ll(r,e),delete n[t.getGeometryName()]),g(n)||(i.properties=n),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let s=0,n=t.length;s<n;++s)i.push(this.writeFeatureObject(t[s],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return Ll(t,this.adaptOptions(e))}},Nl="http://www.w3.org/2001/XMLSchema-instance";function Rl(t,e){return Jl().createElementNS(t,e)}function Pl(t,e){return Ol(t,e,[]).join("")}function Ol(t,e,i){if(t.nodeType==Node.CDATA_SECTION_NODE||t.nodeType==Node.TEXT_NODE)e?i.push(String(t.nodeValue).replace(/(\r\n|\r|\n)/g,"")):i.push(t.nodeValue);else{let s;for(s=t.firstChild;s;s=s.nextSibling)Ol(s,e,i)}return i}function Al(t){return"documentElement"in t}function Fl(t){return(new DOMParser).parseFromString(t,"application/xml")}function Dl(t,e){return function(i,s){const n=t.call(void 0!==e?e:this,i,s);void 0!==n&&a(s[s.length-1],n)}}function kl(t,e){return function(i,s){const n=t.call(void 0!==e?e:this,i,s);void 0!==n&&s[s.length-1].push(n)}}function Gl(t,e){return function(i,s){const n=t.call(void 0!==e?e:this,i,s);void 0!==n&&(s[s.length-1]=n)}}function zl(t,e,i){return function(s,n){const r=t.call(void 0!==i?i:this,s,n);void 0!==r&&(n[n.length-1][void 0!==e?e:s.localName]=r)}}function Bl(t,e){return function(i,s,n){t.call(void 0!==e?e:this,i,s,n),n[n.length-1].node.appendChild(i)}}function jl(t,e){let i,s;return function(e,n,r){if(void 0===i){i={};const n={};n[e.localName]=t,i[e.namespaceURI]=n,s=ql(e.localName)}$l(i,s,n,r)}}function ql(t,e){return function(i,s,n){const r=s[s.length-1].node;let o=t;return void 0===o&&(o=n),Rl(void 0!==e?e:r.namespaceURI,o)}}const Ul=ql();function Yl(t,e){const i=e.length,s=new Array(i);for(let n=0;n<i;++n)s[n]=t[e[n]];return s}function Vl(t,e,i){let s,n;for(i=void 0!==i?i:{},s=0,n=t.length;s<n;++s)i[t[s]]=e;return i}function Xl(t,e,i,s){let n;for(n=e.firstElementChild;n;n=n.nextElementSibling){const e=t[n.namespaceURI];if(void 0!==e){const t=e[n.localName];void 0!==t&&t.call(s,n,i)}}}function Wl(t,e,i,s,n){return s.push(t),Xl(e,i,s,n),s.pop()}function $l(t,e,i,s,n,r){const o=(void 0!==n?n:i).length;let a,h;for(let l=0;l<o;++l)a=i[l],void 0!==a&&(h=e.call(void 0!==r?r:this,a,s,void 0!==n?n[l]:void 0),void 0!==h&&t[h.namespaceURI][h.localName].call(r,h,a,s))}function Hl(t,e,i,s,n,r,o){return n.push(t),$l(e,i,s,n,r,o),n.pop()}let Kl,Zl;function Jl(){return void 0===Zl&&"undefined"!=typeof document&&(Zl=document.implementation.createDocument("","",null)),Zl}const Ql=class extends El{constructor(){super(),this.xmlSerializer_=(void 0===Kl&&"undefined"!=typeof XMLSerializer&&(Kl=new XMLSerializer),Kl)}getType(){return"xml"}readFeature(t,e){if(!t)return null;if("string"==typeof t){const i=Fl(t);return this.readFeatureFromDocument(i,e)}return Al(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}readFeatureFromDocument(t,e){const i=this.readFeaturesFromDocument(t,e);return i.length>0?i[0]:null}readFeatureFromNode(t,e){return null}readFeatures(t,e){if(!t)return[];if("string"==typeof t){const i=Fl(t);return this.readFeaturesFromDocument(i,e)}return Al(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}readFeaturesFromDocument(t,e){const i=[];for(let s=t.firstChild;s;s=s.nextSibling)s.nodeType==Node.ELEMENT_NODE&&a(i,this.readFeaturesFromNode(s,e));return i}readFeaturesFromNode(t,e){return w()}readGeometry(t,e){if(!t)return null;if("string"==typeof t){const i=Fl(t);return this.readGeometryFromDocument(i,e)}return Al(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}readGeometryFromDocument(t,e){return null}readGeometryFromNode(t,e){return null}readProjection(t){if(!t)return null;if("string"==typeof t){const e=Fl(t);return this.readProjectionFromDocument(e)}return Al(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}readProjectionFromDocument(t){return this.dataProjection}readProjectionFromNode(t){return this.dataProjection}writeFeature(t,e){const i=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeFeatureNode(t,e){return null}writeFeatures(t,e){const i=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeFeaturesNode(t,e){return null}writeGeometry(t,e){const i=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeGeometryNode(t,e){return null}};function tc(t,e,i){const s=void 0!==i?t.toFixed(i):""+t;let n=s.indexOf(".");return n=-1===n?s.length:n,n>e?s:new Array(1+e-n).join("0")+s}function ec(t){return function(t){const e=/^\s*(true|1)|(false|0)\s*$/.exec(t);if(e)return void 0!==e[1]||!1}(Pl(t,!1))}function ic(t){const e=Pl(t,!1),i=Date.parse(e);return isNaN(i)?void 0:i/1e3}function sc(t){return function(t){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(t);if(e)return parseFloat(e[1])}(Pl(t,!1))}function nc(t){return function(t){const e=/^\s*(\d+)\s*$/.exec(t);if(e)return parseInt(e[1],10)}(Pl(t,!1))}function rc(t){return Pl(t,!1).trim()}function oc(t,e){lc(t,e?"1":"0")}function ac(t,e){const i=e.toPrecision();t.appendChild(Jl().createTextNode(i))}function hc(t,e){const i=e.toString();t.appendChild(Jl().createTextNode(i))}function lc(t,e){t.appendChild(Jl().createTextNode(e))}const cc=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],uc={rte:Gc,trk:zc,wpt:Bc},dc=Vl(cc,{rte:kl(Gc),trk:kl(zc),wpt:kl(Bc)}),gc=Vl(cc,{text:zl(rc,"linkText"),type:zl(rc,"linkType")}),pc=Vl(cc,{rte:Bl((function(t,e,i){const s=i[0],n=e.getProperties(),r={node:t};r.properties=n;const o=e.getGeometry();if("LineString"==o.getType()){const t=Cl(o,!0,s);r.geometryLayout=t.getLayout(),n.rtept=t.getCoordinates()}const a=i[i.length-1].node,h=Ec[a.namespaceURI],l=Yl(n,h);Hl(r,Cc,Ul,l,i,h)})),trk:Bl((function(t,e,i){const s=i[0],n=e.getProperties(),r={node:t};r.properties=n;const o=e.getGeometry();if("MultiLineString"==o.getType()){const t=Cl(o,!0,s);n.trkseg=t.getLineStrings()}const a=i[i.length-1].node,h=bc[a.namespaceURI],l=Yl(n,h);Hl(r,Ic,Ul,l,i,h)})),wpt:Bl((function(t,e,i){const s=i[0],n=i[i.length-1];n.properties=e.getProperties();const r=e.getGeometry();if("Point"==r.getType()){const e=Cl(r,!0,s);n.geometryLayout=e.getLayout(),qc(t,e.getCoordinates(),i)}}))}),_c=Vl(cc,{name:zl(rc),cmt:zl(rc),desc:zl(rc),src:zl(rc),link:Dc,number:zl(nc),extensions:kc,type:zl(rc),rtept:function(t,e){const i=Wl({},fc,t,e);if(i){const s=e[e.length-1];Ac(s.flatCoordinates,s.layoutOptions,t,i)}}}),fc=Vl(cc,{ele:zl(sc),time:zl(ic)}),mc=Vl(cc,{name:zl(rc),cmt:zl(rc),desc:zl(rc),src:zl(rc),link:Dc,number:zl(nc),type:zl(rc),extensions:kc,trkseg:function(t,e){const i=e[e.length-1];Xl(yc,t,e);const s=i.flatCoordinates;i.ends.push(s.length)}}),yc=Vl(cc,{trkpt:function(t,e){const i=Wl({},xc,t,e);if(i){const s=e[e.length-1];Ac(s.flatCoordinates,s.layoutOptions,t,i)}}}),xc=Vl(cc,{ele:zl(sc),time:zl(ic)}),vc=Vl(cc,{ele:zl(sc),time:zl(ic),magvar:zl(sc),geoidheight:zl(sc),name:zl(rc),cmt:zl(rc),desc:zl(rc),src:zl(rc),link:Dc,sym:zl(rc),type:zl(rc),fix:zl(rc),sat:zl(nc),hdop:zl(sc),vdop:zl(sc),pdop:zl(sc),ageofdgpsdata:zl(sc),dgpsid:zl(nc),extensions:kc}),wc=["text","type"],Mc=Vl(cc,{text:Bl(lc),type:Bl(lc)}),Ec=Vl(cc,["name","cmt","desc","src","link","number","type","rtept"]),Cc=Vl(cc,{name:Bl(lc),cmt:Bl(lc),desc:Bl(lc),src:Bl(lc),link:Bl(jc),number:Bl(hc),type:Bl(lc),rtept:jl(Bl(qc))}),Sc=Vl(cc,["ele","time"]),bc=Vl(cc,["name","cmt","desc","src","link","number","type","trkseg"]),Ic=Vl(cc,{name:Bl(lc),cmt:Bl(lc),desc:Bl(lc),src:Bl(lc),link:Bl(jc),number:Bl(hc),type:Bl(lc),trkseg:jl(Bl((function(t,e,i){const s={node:t};s.geometryLayout=e.getLayout(),s.properties={},Hl(s,Tc,Lc,e.getCoordinates(),i)})))}),Lc=ql("trkpt"),Tc=Vl(cc,{trkpt:Bl(qc)}),Nc=Vl(cc,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Rc=Vl(cc,{ele:Bl(ac),time:Bl((function(t,e){const i=new Date(1e3*e),s=i.getUTCFullYear()+"-"+tc(i.getUTCMonth()+1,2)+"-"+tc(i.getUTCDate(),2)+"T"+tc(i.getUTCHours(),2)+":"+tc(i.getUTCMinutes(),2)+":"+tc(i.getUTCSeconds(),2)+"Z";t.appendChild(Jl().createTextNode(s))})),magvar:Bl(ac),geoidheight:Bl(ac),name:Bl(lc),cmt:Bl(lc),desc:Bl(lc),src:Bl(lc),link:Bl(jc),sym:Bl(lc),type:Bl(lc),fix:Bl(lc),sat:Bl(hc),hdop:Bl(ac),vdop:Bl(ac),pdop:Bl(ac),ageofdgpsdata:Bl(ac),dgpsid:Bl(hc)}),Pc={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Oc(t,e,i){const s=t.getGeometry();if(s){const t=Pc[s.getType()];if(t)return Rl(e[e.length-1].node.namespaceURI,t)}}function Ac(t,e,i,s){return t.push(parseFloat(i.getAttribute("lon")),parseFloat(i.getAttribute("lat"))),"ele"in s?(t.push(s.ele),delete s.ele,e.hasZ=!0):t.push(0),"time"in s?(t.push(s.time),delete s.time,e.hasM=!0):t.push(0),t}function Fc(t,e,i){let s="XY",n=2;if(t.hasZ&&t.hasM?(s="XYZM",n=4):t.hasZ?(s="XYZ",n=3):t.hasM&&(s="XYM",n=3),4!==n){for(let i=0,s=e.length/4;i<s;i++)e[i*n]=e[4*i],e[i*n+1]=e[4*i+1],t.hasZ&&(e[i*n+2]=e[4*i+2]),t.hasM&&(e[i*n+2]=e[4*i+3]);if(e.length=e.length/4*n,i)for(let t=0,e=i.length;t<e;t++)i[t]=i[t]/4*n}return s}function Dc(t,e){const i=e[e.length-1],s=t.getAttribute("href");null!==s&&(i.link=s),Xl(gc,t,e)}function kc(t,e){e[e.length-1].extensionsNode_=t}function Gc(t,e){const i=e[0],s=Wl({flatCoordinates:[],layoutOptions:{}},_c,t,e);if(!s)return;const n=s.flatCoordinates;delete s.flatCoordinates;const r=s.layoutOptions;delete s.layoutOptions;const o=Fc(r,n),a=new _l(n,o);Cl(a,!1,i);const h=new hl(a);return h.setProperties(s,!0),h}function zc(t,e){const i=e[0],s=Wl({flatCoordinates:[],ends:[],layoutOptions:{}},mc,t,e);if(!s)return;const n=s.flatCoordinates;delete s.flatCoordinates;const r=s.ends;delete s.ends;const o=s.layoutOptions;delete s.layoutOptions;const a=Fc(o,n,r),h=new ml(n,a,r);Cl(h,!1,i);const l=new hl(h);return l.setProperties(s,!0),l}function Bc(t,e){const i=e[0],s=Wl({},vc,t,e);if(!s)return;const n={},r=Ac([],n,t,s),o=Fc(n,r),a=new Ws(r,o);Cl(a,!1,i);const h=new hl(a);return h.setProperties(s,!0),h}function jc(t,e,i){t.setAttribute("href",e);const s=i[i.length-1].properties,n=[s.linkText,s.linkType];Hl({node:t},Mc,Ul,n,i,wc)}function qc(t,e,i){const s=i[i.length-1],n=s.node.namespaceURI,r=s.properties;switch(t.setAttributeNS(null,"lat",String(e[1])),t.setAttributeNS(null,"lon",String(e[0])),s.geometryLayout){case"XYZM":0!==e[3]&&(r.time=e[3]);case"XYZ":0!==e[2]&&(r.ele=e[2]);break;case"XYM":0!==e[2]&&(r.time=e[2])}const o="rtept"==t.nodeName?Sc[n]:Nc[n],a=Yl(r,o);Hl({node:t,properties:r},Rc,Ul,a,i,o)}const Uc=class extends Ql{constructor(t){super(),t=t||{},this.dataProjection=qi("EPSG:4326"),this.readExtensions_=t.readExtensions}handleReadExtensions_(t){t||(t=[]);for(let e=0,i=t.length;e<i;++e){const i=t[e];if(this.readExtensions_){const t=i.get("extensionsNode_")||null;this.readExtensions_(i,t)}i.set("extensionsNode_",void 0)}}readFeatureFromNode(t,e){if(!cc.includes(t.namespaceURI))return null;const i=uc[t.localName];if(!i)return null;const s=i(t,[this.getReadOptions(t,e)]);return s?(this.handleReadExtensions_([s]),s):null}readFeaturesFromNode(t,e){if(!cc.includes(t.namespaceURI))return[];if("gpx"==t.localName){const i=Wl([],dc,t,[this.getReadOptions(t,e)]);return i?(this.handleReadExtensions_(i),i):[]}return[]}writeFeaturesNode(t,e){e=this.adaptOptions(e);const i=Rl("http://www.topografix.com/GPX/1/1","gpx");return i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Nl),i.setAttributeNS(Nl,"xsi:schemaLocation","http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd"),i.setAttribute("version","1.1"),i.setAttribute("creator","OpenLayers"),Hl({node:i},pc,Oc,t,[e]),i}};class Yc{constructor(t){t=t||{},this.color_=void 0!==t.color?t.color:null}clone(){const t=this.getColor();return new Yc({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}const Vc=Yc,Xc={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Wc{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Kn(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Wc({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return w()}getImage(t){return w()}getHitDetectionImage(){return w()}getPixelRatio(t){return 1}getImageState(){return w()}getImageSize(){return w()}getOrigin(){return w()}getSize(){return w()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Kn(t)}listenImageChange(t){w()}load(){w()}unlistenImageChange(t){w()}}const $c=Wc,Hc=class extends p{constructor(t,e,i,s){super(),this.extent=t,this.pixelRatio_=i,this.resolution=e,this.state=s}changed(){this.dispatchEvent(_.CHANGE)}getExtent(){return this.extent}getImage(){return w()}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){w()}};function Kc(t,e,i){const s=t;let n=!0,r=!1,o=!1;const a=[m(s,_.LOAD,(function(){o=!0,r||e()}))];return s.src&&B?(r=!0,s.decode().then((function(){n&&e()})).catch((function(t){n&&(o?e():i())}))):a.push(m(s,_.ERROR,i)),function(){n=!1,a.forEach(y)}}const Zc=class extends Hc{constructor(t,e,i,s,n,r){super(t,e,i,Xc.IDLE),this.src_=s,this.image_=new Image,null!==n&&(this.image_.crossOrigin=n),this.unlisten_=null,this.state=Xc.IDLE,this.imageLoadFunction_=r}getImage(){return this.image_}handleImageError_(){this.state=Xc.ERROR,this.unlistenImage_(),this.changed()}handleImageLoad_(){void 0===this.resolution&&(this.resolution=yt(this.extent)/this.image_.height),this.state=Xc.LOADED,this.unlistenImage_(),this.changed()}load(){this.state!=Xc.IDLE&&this.state!=Xc.ERROR||(this.state=Xc.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=Kc(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}setImage(t){this.image_=t,this.resolution=yt(this.extent)/this.image_.height}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}};let Jc=null;class Qc extends p{constructor(t,e,i,s,n,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=s,this.canvas_={},this.color_=r,this.unlisten_=null,this.imageState_=n,this.size_=i,this.src_=e,this.tainted_}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&this.imageState_===Xc.LOADED){Jc||(Jc=Ee(1,1,void 0,{willReadFrequently:!0})),Jc.drawImage(this.image_,0,0);try{Jc.getImageData(0,0,1,1),this.tainted_=!1}catch(t){Jc=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(_.CHANGE)}handleImageError_(){this.imageState_=Xc.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Xc.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=Ee(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===Xc.IDLE){this.image_||this.initializeImage_(),this.imageState_=Xc.LOADING;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=Kc(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==Xc.LOADED)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const s=i.getContext("2d");s.scale(t,t),s.drawImage(e,0,0),s.globalCompositeOperation="multiply",s.fillStyle=zt(this.color_),s.fillRect(0,0,i.width/t,i.height/t),s.globalCompositeOperation="destination-in",s.drawImage(e,0,0),this.canvas_[t]=i}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}class tu extends $c{constructor(t){const e=void 0!==(t=t||{}).opacity?t.opacity:1,i=void 0!==t.rotation?t.rotation:0,s=void 0!==t.scale?t.scale:1,n=void 0!==t.rotateWithView&&t.rotateWithView;super({opacity:e,rotation:i,scale:s,displacement:void 0!==t.displacement?t.displacement:[0,0],rotateWithView:n,declutterMode:t.declutterMode}),this.anchor_=void 0!==t.anchor?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==t.anchorOrigin?t.anchorOrigin:"top-left",this.anchorXUnits_=void 0!==t.anchorXUnits?t.anchorXUnits:"fraction",this.anchorYUnits_=void 0!==t.anchorYUnits?t.anchorYUnits:"fraction",this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;const r=void 0!==t.img?t.img:null;this.imgSize_=t.imgSize;let o=t.src;q(!(void 0!==o&&r),4),q(!r||r&&this.imgSize_,5),void 0!==o&&0!==o.length||!r||(o=r.src||E(r)),q(void 0!==o&&o.length>0,6),q(!((void 0!==t.width||void 0!==t.height)&&void 0!==t.scale),69);const a=void 0!==t.src?Xc.IDLE:Xc.LOADED;if(this.color_=void 0!==t.color?jt(t.color):null,this.iconImage_=function(t,e,i,s,n,r){let o=Vt.get(e,s,r);return o||(o=new Qc(t,e,i,s,n,r),Vt.set(e,s,r,o)),o}(r,o,void 0!==this.imgSize_?this.imgSize_:null,this.crossOrigin_,a,this.color_),this.offset_=void 0!==t.offset?t.offset:[0,0],this.offsetOrigin_=void 0!==t.offsetOrigin?t.offsetOrigin:"top-left",this.origin_=null,this.size_=void 0!==t.size?t.size:null,this.width_=t.width,this.height_=t.height,void 0!==this.width_||void 0!==this.height_){const t=this.getImage(1),e=()=>{this.updateScaleFromWidthAndHeight(this.width_,this.height_)};t.width>0?this.updateScaleFromWidthAndHeight(this.width_,this.height_):t.addEventListener("load",e)}}clone(){const t=this.getScale();return new tu({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode(),width:this.width_,height:this.height_})}updateScaleFromWidthAndHeight(t,e){const i=this.getImage(1);void 0!==t&&void 0!==e?super.setScale([t/i.width,e/i.height]):void 0!==t?super.setScale([t/i.width,t/i.width]):void 0!==e?super.setScale([e/i.height,e/i.height]):super.setScale([1,1])}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const e=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!e)return null;t=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(t[0]*=e[0]),"fraction"==this.anchorYUnits_&&(t[1]*=e[1])}if("top-left"!=this.anchorOrigin_){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),"top-right"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(t[0]=-t[0]+e[0]),"bottom-left"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if("top-left"!=this.offsetOrigin_){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),"top-right"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(t[0]=i[0]-e[0]-t[0]),"bottom-left"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){return this.width_}getHeight(){return this.height_}setWidth(t){this.width_=t,this.updateScaleFromWidthAndHeight(t,this.height_)}setHeight(t){this.height_=t,this.updateScaleFromWidthAndHeight(this.width_,t)}setScale(t){super.setScale(t);const e=this.getImage(1);if(e){const i=Array.isArray(t)?t[0]:t;void 0!==i&&(this.width_=i*e.width);const s=Array.isArray(t)?t[1]:t;void 0!==s&&(this.height_=s*e.height)}}listenImageChange(t){this.iconImage_.addEventListener(_.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(_.CHANGE,t)}}const eu=tu;class iu{constructor(t){t=t||{},this.color_=void 0!==t.color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new iu({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const su=iu;function nu(t){return Array.isArray(t)?Ut(t):t}class ru extends $c{constructor(t){super({opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=void 0!==t.radius?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new ru({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const i=this.renderOptions_,s=Ee(i.size*t,i.size*t);this.draw_(i,s,t),e=s.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return Xc.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;let s=this.radius_,n=void 0===this.radius2_?s:this.radius2_;if(s<n){const t=s;s=n,n=t}const r=void 0===this.radius2_?this.points_:2*this.points_,o=2*Math.PI/r,a=n*Math.sin(o),h=s-Math.sqrt(n*n-a*a),l=Math.sqrt(a*a+h*h),c=l/a;if("miter"===t&&c<=i)return c*e;const u=e/2/c,d=e/2*(h/l),g=Math.sqrt((s+u)*(s+u)+d*d)-s;if(void 0===this.radius2_||"bevel"===t)return 2*g;const p=s*Math.sin(o),_=n-Math.sqrt(s*s-p*p),f=Math.sqrt(p*p+_*_)/p;if(f<=i){const t=f*e/2-n-s;return 2*Math.max(g,t)}return 2*g}createRenderOptions(){let t,e=Ae,i=0,s=null,n=0,r=0;this.stroke_&&(t=this.stroke_.getColor(),null===t&&(t=Fe),t=nu(t),r=this.stroke_.getWidth(),void 0===r&&(r=1),s=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset(),e=this.stroke_.getLineJoin(),void 0===e&&(e=Ae),i=this.stroke_.getMiterLimit(),void 0===i&&(i=10));const o=this.calculateLineJoinSize_(e,r,i),a=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:r,size:Math.ceil(2*a+o),lineDash:s,lineDashOffset:n,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let t=this.fill_.getColor();null===t&&(t=Re),e.fillStyle=nu(t),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),i=0;if("string"==typeof e&&(e=jt(e)),null===e?i=1:Array.isArray(e)&&(i=4===e.length?e[3]:1),0===i){const e=Ee(t.size,t.size);this.hitDetectionCanvas_=e.canvas,this.drawHitDetectionCanvas_(t,e)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const s=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);const n=this.angle_-Math.PI/2,r=2*Math.PI/e;for(let o=0;o<e;o++){const e=n+o*r,a=o%2==0?i:s;t.lineTo(a*Math.cos(e),a*Math.sin(e))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Re,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}const ou=ru;class au extends ou{constructor(t){super({points:1/0,fill:(t=t||{radius:5}).fill,radius:t.radius,stroke:t.stroke,scale:void 0!==t.scale?t.scale:1,rotation:void 0!==t.rotation?t.rotation:0,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new au({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}const hu=au;class lu{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=gu,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.hitDetectionRenderer_=void 0!==t.hitDetectionRenderer?t.hitDetectionRenderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new lu({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=gu,this.geometry_=t}setZIndex(t){this.zIndex_=t}}let cu=null;function uu(t,e){if(!cu){const t=new Vc({color:"rgba(255,255,255,0.4)"}),e=new su({color:"#3399CC",width:1.25});cu=[new lu({image:new hu({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]}return cu}function du(){const t={},e=[255,255,255,1],i=[0,153,255,1];return t.Polygon=[new lu({fill:new Vc({color:[255,255,255,.5]})})],t.MultiPolygon=t.Polygon,t.LineString=[new lu({stroke:new su({color:e,width:5})}),new lu({stroke:new su({color:i,width:3})})],t.MultiLineString=t.LineString,t.Circle=t.Polygon.concat(t.LineString),t.Point=[new lu({image:new hu({radius:6,fill:new Vc({color:i}),stroke:new su({color:e,width:1.5})}),zIndex:1/0})],t.MultiPoint=t.Point,t.GeometryCollection=t.Polygon.concat(t.LineString,t.Point),t}function gu(t){return t.getGeometry()}const pu=lu;class _u{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=Kn(void 0!==t.scale?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.textBaseline_=t.textBaseline,this.fill_=void 0!==t.fill?t.fill:new Vc({color:"#333"}),this.maxAngle_=void 0!==t.maxAngle?t.maxAngle:Math.PI/4,this.placement_=void 0!==t.placement?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=void 0!==t.stroke?t.stroke:null,this.offsetX_=void 0!==t.offsetX?t.offsetX:0,this.offsetY_=void 0!==t.offsetY?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=void 0===t.padding?null:t.padding}clone(){const t=this.getScale();return new _u({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Kn(void 0!==t?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const fu=_u,mu=["http://www.google.com/kml/ext/2.2"],yu=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],xu={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},vu=Vl(yu,{ExtendedData:Md,Region:Ed,MultiGeometry:zl(gd,"geometry"),LineString:zl(cd,"geometry"),LinearRing:zl(ud,"geometry"),Point:zl(pd,"geometry"),Polygon:zl(fd,"geometry"),Style:zl(yd),StyleMap:function(t,e){const i=Ku.call(this,t,e);if(!i)return;const s=e[e.length-1];Array.isArray(i)?s.Style=i:"string"==typeof i?s.styleUrl=i:q(!1,38)},address:zl(rc),description:zl(rc),name:zl(rc),open:zl(ec),phoneNumber:zl(rc),styleUrl:zl(Wu),visibility:zl(ec)},Vl(mu,{MultiTrack:zl((function(t,e){const i=Wl([],sd,t,e);if(i)return new ml(i)}),"geometry"),Track:zl(rd,"geometry")})),wu=Vl(yu,{ExtendedData:Md,Region:Ed,Link:function(t,e){Xl(Mu,t,e)},address:zl(rc),description:zl(rc),name:zl(rc),open:zl(ec),phoneNumber:zl(rc),visibility:zl(ec)}),Mu=Vl(yu,{href:zl(Xu)}),Eu=Vl(yu,{LatLonAltBox:function(t,e){const i=Wl({},bd,t,e);if(!i)return;const s=e[e.length-1],n=[parseFloat(i.west),parseFloat(i.south),parseFloat(i.east),parseFloat(i.north)];s.extent=n,s.altitudeMode=i.altitudeMode,s.minAltitude=parseFloat(i.minAltitude),s.maxAltitude=parseFloat(i.maxAltitude)},Lod:function(t,e){const i=Wl({},Id,t,e);if(!i)return;const s=e[e.length-1];s.minLodPixels=parseFloat(i.minLodPixels),s.maxLodPixels=parseFloat(i.maxLodPixels),s.minFadeExtent=parseFloat(i.minFadeExtent),s.maxFadeExtent=parseFloat(i.maxFadeExtent)}}),Cu=Vl(yu,["Document","Placemark"]),Su=Vl(yu,{Document:Bl((function(t,e,i){Hl({node:t},Pd,Od,e,i,void 0,this)})),Placemark:Bl(sg)});let bu,Iu,Lu,Tu,Nu,Ru,Pu,Ou,Au,Fu=null,Du=null,ku=null,Gu=null,zu=null,Bu=null;function ju(t){return 32/Math.min(t[0],t[1])}function qu(t){return t}function Uu(t,e,i){return Array.isArray(t)?t:"string"==typeof t?Uu(i[t],e,i):e}function Yu(t){const e=Pl(t,!1),i=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(i){const t=i[1];return[parseInt(t.substr(6,2),16),parseInt(t.substr(4,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(0,2),16)/255]}}function Vu(t){let e=Pl(t,!1);const i=[];e=e.replace(/\s*,\s*/g,",");const s=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let n;for(;n=s.exec(e);){const t=parseFloat(n[1]),s=parseFloat(n[2]),r=n[3]?parseFloat(n[3]):0;i.push(t,s,r),e=e.substr(n[0].length)}if(""===e)return i}function Xu(t){const e=Pl(t,!1).trim();let i=t.baseURI;return i&&"about:blank"!=i||(i=window.location.href),i?new URL(e,i).href:e}function Wu(t){const e=Pl(t,!1).trim().replace(/^(?!.*#)/,"#");let i=t.baseURI;return i&&"about:blank"!=i||(i=window.location.href),i?new URL(e,i).href:e}function $u(t){return sc(t)}const Hu=Vl(yu,{Pair:function(t,e){const i=Wl({},Cd,t,e,this);if(!i)return;const s=i.key;if(s&&"normal"==s){const t=i.styleUrl;t&&(e[e.length-1]=t);const s=i.Style;s&&(e[e.length-1]=s)}}});function Ku(t,e){return Wl(void 0,Hu,t,e,this)}const Zu=Vl(yu,{Icon:zl((function(t,e){const i=Wl({},od,t,e);return i||null})),color:zl(Yu),heading:zl(sc),hotSpot:zl((function(t){const e=t.getAttribute("xunits"),i=t.getAttribute("yunits");let s;return s="insetPixels"!==e?"insetPixels"!==i?"bottom-left":"top-left":"insetPixels"!==i?"bottom-right":"top-right",{x:parseFloat(t.getAttribute("x")),xunits:xu[e],y:parseFloat(t.getAttribute("y")),yunits:xu[i],origin:s}})),scale:zl($u)}),Ju=Vl(yu,{color:zl(Yu),scale:zl($u)}),Qu=Vl(yu,{color:zl(Yu),width:zl(sc)}),td=Vl(yu,{color:zl(Yu),fill:zl(ec),outline:zl(ec)}),ed=Vl(yu,{coordinates:Gl(Vu)});function id(t,e){return Wl(null,ed,t,e)}const sd=Vl(mu,{Track:kl(rd)}),nd=Vl(yu,{when:function(t,e){const i=e[e.length-1].whens,s=Pl(t,!1),n=Date.parse(s);i.push(isNaN(n)?0:n)}},Vl(mu,{coord:function(t,e){const i=e[e.length-1].coordinates,s=Pl(t,!1),n=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(s);if(n){const t=parseFloat(n[1]),e=parseFloat(n[2]),s=parseFloat(n[3]);i.push([t,e,s])}else i.push([])}}));function rd(t,e){const i=Wl({coordinates:[],whens:[]},nd,t,e);if(!i)return;const s=[],n=i.coordinates,r=i.whens;for(let t=0,e=Math.min(n.length,r.length);t<e;++t)3==n[t].length&&s.push(n[t][0],n[t][1],n[t][2],r[t]);return new _l(s,"XYZM")}const od=Vl(yu,{href:zl(Xu)},Vl(mu,{x:zl(sc),y:zl(sc),w:zl(sc),h:zl(sc)})),ad=Vl(yu,{coordinates:Gl(Vu)});function hd(t,e){return Wl(null,ad,t,e)}const ld=Vl(yu,{extrude:zl(ec),tessellate:zl(ec),altitudeMode:zl(rc)});function cd(t,e){const i=Wl({},ld,t,e),s=hd(t,e);if(s){const t=new _l(s,"XYZ");return t.setProperties(i,!0),t}}function ud(t,e){const i=Wl({},ld,t,e),s=hd(t,e);if(s){const t=new hn(s,"XYZ",[s.length]);return t.setProperties(i,!0),t}}const dd=Vl(yu,{LineString:kl(cd),LinearRing:kl(ud),MultiGeometry:kl(gd),Point:kl(pd),Polygon:kl(fd)});function gd(t,e){const i=Wl([],dd,t,e);if(!i)return null;if(0===i.length)return new Ml(i);let s,n=!0;const r=i[0].getType();let o;for(let t=1,e=i.length;t<e;++t)if(o=i[t],o.getType()!=r){n=!1;break}if(n){let t,e;if("Point"==r){const n=i[0];t=n.getLayout(),e=n.getFlatCoordinates();for(let t=1,s=i.length;t<s;++t)o=i[t],a(e,o.getFlatCoordinates());s=new cl(e,t),xd(s,i)}else"LineString"==r?(s=new ml(i),xd(s,i)):"Polygon"==r?(s=new xl(i),xd(s,i)):"GeometryCollection"==r?s=new Ml(i):q(!1,37)}else s=new Ml(i);return s}function pd(t,e){const i=Wl({},ld,t,e),s=hd(t,e);if(s){const t=new Ws(s,"XYZ");return t.setProperties(i,!0),t}}const _d=Vl(yu,{innerBoundaryIs:function(t,e){const i=Wl([],Ld,t,e);i.length>0&&e[e.length-1].push(...i)},outerBoundaryIs:function(t,e){const i=Wl(void 0,Td,t,e);i&&(e[e.length-1][0]=i)}});function fd(t,e){const i=Wl({},ld,t,e),s=Wl([null],_d,t,e);if(s&&s[0]){const t=s[0],e=[t.length];for(let i=1,n=s.length;i<n;++i)a(t,s[i]),e.push(t.length);const n=new hn(t,"XYZ",e);return n.setProperties(i,!0),n}}const md=Vl(yu,{IconStyle:function(t,e){const i=Wl({},Zu,t,e);if(!i)return;const s=e[e.length-1],n="Icon"in i?i.Icon:{},r=!("Icon"in i)||Object.keys(n).length>0;let o;const a=n.href;let h,l,c;a?o=a:r&&(o=Ru);let u="bottom-left";const d=i.hotSpot;let g;d?(h=[d.x,d.y],l=d.xunits,c=d.yunits,u=d.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(o)&&(o.includes("pushpin")?(h=Iu,l=Lu,c=Tu):o.includes("arrow-reverse")?(h=[54,42],l=Lu,c=Tu):o.includes("paddle")&&(h=[32,1],l=Lu,c=Tu));const p=n.x,_=n.y;let f;void 0!==p&&void 0!==_&&(g=[p,_]);const m=n.w,y=n.h;let x;void 0!==m&&void 0!==y&&(f=[m,y]);const v=i.heading;void 0!==v&&(x=Nt(v));const w=i.scale,M=i.color;if(r){o==Ru&&(f=Nu);const t=new eu({anchor:h,anchorOrigin:u,anchorXUnits:l,anchorYUnits:c,crossOrigin:this.crossOrigin_,offset:g,offsetOrigin:"bottom-left",rotation:x,scale:w,size:f,src:this.iconUrlFunction_(o),color:M}),e=t.getScaleArray()[0],i=t.getSize();if(null===i){const i=t.getImageState();if(i===Xc.IDLE||i===Xc.LOADING){const s=function(){const i=t.getImageState();if(i!==Xc.IDLE&&i!==Xc.LOADING){const i=t.getSize();if(i&&2==i.length){const s=ju(i);t.setScale(e*s)}t.unlistenImageChange(s)}};t.listenImageChange(s),i===Xc.IDLE&&t.load()}}else if(2==i.length){const s=ju(i);t.setScale(e*s)}s.imageStyle=t}else s.imageStyle=Pu},LabelStyle:function(t,e){const i=Wl({},Ju,t,e);if(!i)return;const s=e[e.length-1],n=new fu({fill:new Vc({color:"color"in i?i.color:bu}),scale:i.scale});s.textStyle=n},LineStyle:function(t,e){const i=Wl({},Qu,t,e);if(!i)return;const s=e[e.length-1],n=new su({color:"color"in i?i.color:bu,width:"width"in i?i.width:1});s.strokeStyle=n},PolyStyle:function(t,e){const i=Wl({},td,t,e);if(!i)return;const s=e[e.length-1],n=new Vc({color:"color"in i?i.color:bu});s.fillStyle=n;const r=i.fill;void 0!==r&&(s.fill=r);const o=i.outline;void 0!==o&&(s.outline=o)}});function yd(t,e){const i=Wl({},md,t,e,this);if(!i)return null;let s="fillStyle"in i?i.fillStyle:Fu;const n=i.fill;let r;void 0===n||n||(s=null),"imageStyle"in i?i.imageStyle!=Pu&&(r=i.imageStyle):r=Du;const o="textStyle"in i?i.textStyle:Gu,a="strokeStyle"in i?i.strokeStyle:ku,h=i.outline;return void 0===h||h?[new pu({fill:s,image:r,stroke:a,text:o,zIndex:void 0})]:[new pu({geometry:function(t){const e=t.getGeometry(),i=e.getType();return"GeometryCollection"===i?new Ml(e.getGeometriesArrayRecursive().filter((function(t){const e=t.getType();return"Polygon"!==e&&"MultiPolygon"!==e}))):"Polygon"!==i&&"MultiPolygon"!==i?e:void 0},fill:s,image:r,stroke:a,text:o,zIndex:void 0}),new pu({geometry:function(t){const e=t.getGeometry(),i=e.getType();return"GeometryCollection"===i?new Ml(e.getGeometriesArrayRecursive().filter((function(t){const e=t.getType();return"Polygon"===e||"MultiPolygon"===e}))):"Polygon"===i||"MultiPolygon"===i?e:void 0},fill:s,stroke:null,zIndex:void 0})]}function xd(t,e){const i=e.length,s=new Array(e.length),n=new Array(e.length),r=new Array(e.length);let o,a,h;o=!1,a=!1,h=!1;for(let t=0;t<i;++t){const i=e[t];s[t]=i.get("extrude"),n[t]=i.get("tessellate"),r[t]=i.get("altitudeMode"),o=o||void 0!==s[t],a=a||void 0!==n[t],h=h||r[t]}o&&t.set("extrude",s),a&&t.set("tessellate",n),h&&t.set("altitudeMode",r)}const vd=Vl(yu,{displayName:zl(rc),value:zl(rc)}),wd=Vl(yu,{Data:function(t,e){const i=t.getAttribute("name");Xl(vd,t,e);const s=e[e.length-1];i&&s.displayName?s[i]={value:s.value,displayName:s.displayName,toString:function(){return s.value}}:null!==i?s[i]=s.value:null!==s.displayName&&(s[s.displayName]=s.value),delete s.value},SchemaData:function(t,e){Xl(Sd,t,e)}});function Md(t,e){Xl(wd,t,e)}function Ed(t,e){Xl(Eu,t,e)}const Cd=Vl(yu,{Style:zl(yd),key:zl(rc),styleUrl:zl(Wu)}),Sd=Vl(yu,{SimpleData:function(t,e){const i=t.getAttribute("name");if(null!==i){const s=rc(t);e[e.length-1][i]=s}}}),bd=Vl(yu,{altitudeMode:zl(rc),minAltitude:zl(sc),maxAltitude:zl(sc),north:zl(sc),south:zl(sc),east:zl(sc),west:zl(sc)}),Id=Vl(yu,{minLodPixels:zl(sc),maxLodPixels:zl(sc),minFadeExtent:zl(sc),maxFadeExtent:zl(sc)}),Ld=Vl(yu,{LinearRing:kl(id)}),Td=Vl(yu,{LinearRing:Gl(id)});function Nd(t,e){const i=jt(e),s=[255*(4==i.length?i[3]:1),i[2],i[1],i[0]];for(let t=0;t<4;++t){const e=Math.floor(s[t]).toString(16);s[t]=1==e.length?"0"+e:e}lc(t,s.join(""))}const Rd=Vl(yu,{Data:Bl((function(t,e,i){t.setAttribute("name",e.name);const s={node:t},n=e.value;"object"==typeof n?(null!==n&&n.displayName&&Hl(s,Rd,Ul,[n.displayName],i,["displayName"]),null!==n&&n.value&&Hl(s,Rd,Ul,[n.value],i,["value"])):Hl(s,Rd,Ul,[n],i,["value"])})),value:Bl((function(t,e){lc(t,e)})),displayName:Bl((function(t,e){!function(t,e){t.appendChild(Jl().createCDATASection(e))}(t,e)}))}),Pd=Vl(yu,{Placemark:Bl(sg)}),Od=function(t,e,i){return Rl(e[e.length-1].node.namespaceURI,"Placemark")},Ad=ql("Data"),Fd=Vl(yu,["href"],Vl(mu,["x","y","w","h"])),Dd=Vl(yu,{href:Bl(lc)},Vl(mu,{x:Bl(ac),y:Bl(ac),w:Bl(ac),h:Bl(ac)})),kd=function(t,e,i){return Rl(mu[0],"gx:"+i)},Gd=Vl(yu,["scale","heading","Icon","color","hotSpot"]),zd=Vl(yu,{Icon:Bl((function(t,e,i){const s={node:t},n=i[i.length-1].node;let r=Fd[n.namespaceURI],o=Yl(e,r);Hl(s,Dd,Ul,o,i,r),r=Fd[mu[0]],o=Yl(e,r),Hl(s,Dd,kd,o,i,r)})),color:Bl(Nd),heading:Bl(ac),hotSpot:Bl((function(t,e){t.setAttribute("x",String(e.x)),t.setAttribute("y",String(e.y)),t.setAttribute("xunits",e.xunits),t.setAttribute("yunits",e.yunits)})),scale:Bl(gg)}),Bd=Vl(yu,["color","scale"]),jd=Vl(yu,{color:Bl(Nd),scale:Bl(gg)}),qd=Vl(yu,["color","width"]),Ud=Vl(yu,{color:Bl(Nd),width:Bl(ac)}),Yd={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Vd=function(t,e,i){if(t)return Rl(e[e.length-1].node.namespaceURI,Yd[t.getType()])},Xd=ql("Point"),Wd=ql("LineString"),$d=ql("LinearRing"),Hd=ql("Polygon"),Kd=Vl(yu,{LineString:Bl(og),Point:Bl(og),Polygon:Bl(ug),GeometryCollection:Bl(Zd)});function Zd(t,e,i){const s={node:t},n=e.getType();let r,o=[];"GeometryCollection"===n?(e.getGeometriesArrayRecursive().forEach((function(t){const e=t.getType();"MultiPoint"===e?o=o.concat(t.getPoints()):"MultiLineString"===e?o=o.concat(t.getLineStrings()):"MultiPolygon"===e?o=o.concat(t.getPolygons()):"Point"===e||"LineString"===e||"Polygon"===e?o.push(t):q(!1,39)})),r=Vd):"MultiPoint"===n?(o=e.getPoints(),r=Xd):"MultiLineString"===n?(o=e.getLineStrings(),r=Wd):"MultiPolygon"===n?(o=e.getPolygons(),r=Hd):q(!1,39),Hl(s,Kd,r,o,i)}const Jd=Vl(yu,{LinearRing:Bl(og)});function Qd(t,e,i){Hl({node:t},Jd,$d,[e],i)}const tg=Vl(yu,{ExtendedData:Bl((function(t,e,i){const s={node:t},n=e.names,r=e.values,o=n.length;for(let t=0;t<o;t++)Hl(s,Rd,Ad,[{name:n[t],value:r[t]}],i)})),MultiGeometry:Bl(Zd),LineString:Bl(og),LinearRing:Bl(og),Point:Bl(og),Polygon:Bl(ug),Style:Bl((function(t,e,i){const s={node:t},n={};if(e.pointStyles.length){const t=e.pointStyles[0].getText();t&&(n.LabelStyle=t);const i=e.pointStyles[0].getImage();i&&"function"==typeof i.getSrc&&(n.IconStyle=i)}if(e.lineStyles.length){const t=e.lineStyles[0].getStroke();t&&(n.LineStyle=t)}if(e.polyStyles.length){const t=e.polyStyles[0].getStroke();t&&!n.LineStyle&&(n.LineStyle=t),n.PolyStyle=e.polyStyles[0]}const r=i[i.length-1].node,o=pg[r.namespaceURI],a=Yl(n,o);Hl(s,_g,Ul,a,i,o)})),address:Bl(lc),description:Bl(lc),name:Bl(lc),open:Bl(oc),phoneNumber:Bl(lc),styleUrl:Bl(lc),visibility:Bl(oc)}),eg=Vl(yu,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),ig=ql("ExtendedData");function sg(t,e,i){const s={node:t};e.getId()&&t.setAttribute("id",e.getId());const n=e.getProperties(),r={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};r[e.getGeometryName()]=1;const o=Object.keys(n||{}).sort().filter((function(t){return!r[t]})),a=e.getStyleFunction();if(a){const t=a(e,0);if(t){const i=Array.isArray(t)?t:[t];let s=i;if(e.getGeometry()&&(s=i.filter((function(t){const i=t.getGeometryFunction()(e);if(i){const t=i.getType();return"GeometryCollection"===t?i.getGeometriesArrayRecursive().filter((function(t){const e=t.getType();return"Point"===e||"MultiPoint"===e})).length:"Point"===t||"MultiPoint"===t}}))),this.writeStyles_){let t=i,r=i;e.getGeometry()&&(t=i.filter((function(t){const i=t.getGeometryFunction()(e);if(i){const t=i.getType();return"GeometryCollection"===t?i.getGeometriesArrayRecursive().filter((function(t){const e=t.getType();return"LineString"===e||"MultiLineString"===e})).length:"LineString"===t||"MultiLineString"===t}})),r=i.filter((function(t){const i=t.getGeometryFunction()(e);if(i){const t=i.getType();return"GeometryCollection"===t?i.getGeometriesArrayRecursive().filter((function(t){const e=t.getType();return"Polygon"===e||"MultiPolygon"===e})).length:"Polygon"===t||"MultiPolygon"===t}}))),n.Style={pointStyles:s,lineStyles:t,polyStyles:r}}if(s.length&&void 0===n.name){const t=s[0].getText();t&&(n.name=t.getText())}}}const h=i[i.length-1].node,l=eg[h.namespaceURI],c=Yl(n,l);if(Hl(s,tg,Ul,c,i,l),o.length>0){const t=Yl(n,o);Hl(s,tg,ig,[{names:o,values:t}],i)}const u=i[0];let d=e.getGeometry();d&&(d=Cl(d,!0,u)),Hl(s,tg,Vd,[d],i)}const ng=Vl(yu,["extrude","tessellate","altitudeMode","coordinates"]),rg=Vl(yu,{extrude:Bl(oc),tessellate:Bl(oc),altitudeMode:Bl(lc),coordinates:Bl((function(t,e,i){const s=i[i.length-1],n=s.layout,r=s.stride;let o;"XY"==n||"XYM"==n?o=2:"XYZ"==n||"XYZM"==n?o=3:q(!1,34);const a=e.length;let h="";if(a>0){h+=e[0];for(let t=1;t<o;++t)h+=","+e[t];for(let t=r;t<a;t+=r){h+=" "+e[t];for(let i=1;i<o;++i)h+=","+e[t+i]}}lc(t,h)}))});function og(t,e,i){const s=e.getFlatCoordinates(),n={node:t};n.layout=e.getLayout(),n.stride=e.getStride();const r=e.getProperties();r.coordinates=s;const o=i[i.length-1].node,a=ng[o.namespaceURI],h=Yl(r,a);Hl(n,rg,Ul,h,i,a)}const ag=Vl(yu,["color","fill","outline"]),hg=Vl(yu,{outerBoundaryIs:Bl(Qd),innerBoundaryIs:Bl(Qd)}),lg=ql("innerBoundaryIs"),cg=ql("outerBoundaryIs");function ug(t,e,i){const s=e.getLinearRings(),n=s.shift(),r={node:t};Hl(r,hg,lg,s,i),Hl(r,hg,cg,[n],i)}const dg=Vl(yu,{color:Bl(Nd),fill:Bl(oc),outline:Bl(oc)});function gg(t,e){ac(t,Math.round(1e6*e)/1e6)}const pg=Vl(yu,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),_g=Vl(yu,{IconStyle:Bl((function(t,e,i){const s={node:t},n={},r=e.getSrc(),o=e.getSize(),a=e.getImageSize(),h={href:r};if(o){h.w=o[0],h.h=o[1];const t=e.getAnchor(),i=e.getOrigin();if(i&&a&&0!==i[0]&&i[1]!==o[1]&&(h.x=i[0],h.y=a[1]-(i[1]+o[1])),t&&(t[0]!==o[0]/2||t[1]!==o[1]/2)){const e={x:t[0],xunits:"pixels",y:o[1]-t[1],yunits:"pixels"};n.hotSpot=e}}n.Icon=h;let l=e.getScaleArray()[0],c=o;null===c&&(c=Nu),2==c.length&&(l/=ju(c)),1!==l&&(n.scale=l);const u=e.getRotation();0!==u&&(n.heading=u);const d=e.getColor();d&&(n.color=d);const g=i[i.length-1].node,p=Gd[g.namespaceURI],_=Yl(n,p);Hl(s,zd,Ul,_,i,p)})),LabelStyle:Bl((function(t,e,i){const s={node:t},n={},r=e.getFill();r&&(n.color=r.getColor());const o=e.getScale();o&&1!==o&&(n.scale=o);const a=i[i.length-1].node,h=Bd[a.namespaceURI],l=Yl(n,h);Hl(s,jd,Ul,l,i,h)})),LineStyle:Bl((function(t,e,i){const s={node:t},n={color:e.getColor(),width:Number(e.getWidth())||1},r=i[i.length-1].node,o=qd[r.namespaceURI],a=Yl(n,o);Hl(s,Ud,Ul,a,i,o)})),PolyStyle:Bl((function(t,e,i){const s={node:t},n=e.getFill(),r=e.getStroke(),o={color:n?n.getColor():void 0,fill:!!n&&void 0,outline:!!r&&void 0},a=i[i.length-1].node,h=ag[a.namespaceURI],l=Yl(o,h);Hl(s,dg,Ul,l,i,h)}))}),fg=class extends Ql{constructor(t){super(),t=t||{},Bu||(bu=[255,255,255,1],Fu=new Vc({color:bu}),Iu=[20,2],Lu="pixels",Tu="pixels",Nu=[64,64],Ru="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Du=new eu({anchor:Iu,anchorOrigin:"bottom-left",anchorXUnits:Lu,anchorYUnits:Tu,crossOrigin:"anonymous",rotation:0,scale:ju(Nu),size:Nu,src:Ru}),Pu="NO_IMAGE",ku=new su({color:bu,width:1}),Ou=new su({color:[51,51,51,1],width:2}),Gu=new fu({font:"bold 16px Helvetica",fill:Fu,stroke:Ou,scale:.8}),zu=new pu({fill:Fu,image:Du,text:Gu,stroke:ku,zIndex:0}),Bu=[zu]),this.dataProjection=qi("EPSG:4326"),this.defaultStyle_=t.defaultStyle?t.defaultStyle:Bu,this.extractStyles_=void 0===t.extractStyles||t.extractStyles,this.writeStyles_=void 0===t.writeStyles||t.writeStyles,this.sharedStyles_={},this.showPointNames_=void 0===t.showPointNames||t.showPointNames,this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:"anonymous",this.iconUrlFunction_=t.iconUrlFunction?t.iconUrlFunction:qu,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(t,e){const i=Wl([],Vl(yu,{Document:Dl(this.readDocumentOrFolder_,this),Folder:Dl(this.readDocumentOrFolder_,this),Placemark:kl(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),t,e,this);if(i)return i}readPlacemark_(t,e){const i=Wl({geometry:null},vu,t,e,this);if(!i)return;const s=new hl,n=t.getAttribute("id");null!==n&&s.setId(n);const r=e[0],o=i.geometry;if(o&&Cl(o,!1,r),s.setGeometry(o),delete i.geometry,this.extractStyles_){const t=(a=i.Style,h=i.styleUrl,l=this.defaultStyle_,c=this.sharedStyles_,u=this.showPointNames_,function(t,e){let i=u,s="",n=[];if(i){const e=t.getGeometry();if(e)if(e instanceof Ml)n=e.getGeometriesArrayRecursive().filter((function(t){const e=t.getType();return"Point"===e||"MultiPoint"===e})),i=n.length>0;else{const t=e.getType();i="Point"===t||"MultiPoint"===t}}i&&(s=t.get("name"),i=i&&!!s,i&&/&[^&]+;/.test(s)&&(Au||(Au=document.createElement("textarea")),Au.innerHTML=s,s=Au.value));let r=l;if(a?r=a:h&&(r=Uu(h,l,c)),i){const t=function(t,e){const i=[0,0];let s="start";const n=t.getImage();if(n){const t=n.getSize();if(t&&2==t.length){const e=n.getScaleArray(),r=n.getAnchor();i[0]=e[0]*(t[0]-r[0]),i[1]=e[1]*(t[1]/2-r[1]),s="left"}}let r=t.getText();return r?(r=r.clone(),r.setFont(r.getFont()||Gu.getFont()),r.setScale(r.getScale()||Gu.getScale()),r.setFill(r.getFill()||Gu.getFill()),r.setStroke(r.getStroke()||Ou)):r=Gu.clone(),r.setText(e),r.setOffsetX(i[0]),r.setOffsetY(i[1]),r.setTextAlign(s),new pu({image:n,text:r})}(r[0],s);return n.length>0?(t.setGeometry(new Ml(n)),[t,new pu({geometry:r[0].getGeometry(),image:null,fill:r[0].getFill(),stroke:r[0].getStroke(),text:null})].concat(r.slice(1))):t}return r});s.setStyle(t)}var a,h,l,c,u;return delete i.Style,s.setProperties(i,!0),s}readSharedStyle_(t,e){const i=t.getAttribute("id");if(null!==i){const s=yd.call(this,t,e);if(s){let e,n=t.baseURI;n&&"about:blank"!=n||(n=window.location.href),e=n?new URL("#"+i,n).href:"#"+i,this.sharedStyles_[e]=s}}}readSharedStyleMap_(t,e){const i=t.getAttribute("id");if(null===i)return;const s=Ku.call(this,t,e);if(!s)return;let n,r=t.baseURI;r&&"about:blank"!=r||(r=window.location.href),n=r?new URL("#"+i,r).href:"#"+i,this.sharedStyles_[n]=s}readFeatureFromNode(t,e){if(!yu.includes(t.namespaceURI))return null;return this.readPlacemark_(t,[this.getReadOptions(t,e)])||null}readFeaturesFromNode(t,e){if(!yu.includes(t.namespaceURI))return[];let i;const s=t.localName;if("Document"==s||"Folder"==s)return i=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]),i||[];if("Placemark"==s){const i=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return i?[i]:[]}if("kml"==s){i=[];for(let s=t.firstElementChild;s;s=s.nextElementSibling){const t=this.readFeaturesFromNode(s,e);t&&a(i,t)}return i}return[]}readName(t){if(t){if("string"==typeof t){const e=Fl(t);return this.readNameFromDocument(e)}return Al(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}}readNameFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){const t=this.readNameFromNode(e);if(t)return t}}readNameFromNode(t){for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(yu.includes(e.namespaceURI)&&"name"==e.localName)return rc(e);for(let e=t.firstElementChild;e;e=e.nextElementSibling){const t=e.localName;if(yu.includes(e.namespaceURI)&&("Document"==t||"Folder"==t||"Placemark"==t||"kml"==t)){const t=this.readNameFromNode(e);if(t)return t}}}readNetworkLinks(t){const e=[];if("string"==typeof t){const i=Fl(t);a(e,this.readNetworkLinksFromDocument(i))}else Al(t)?a(e,this.readNetworkLinksFromDocument(t)):a(e,this.readNetworkLinksFromNode(t));return e}readNetworkLinksFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&a(e,this.readNetworkLinksFromNode(i));return e}readNetworkLinksFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(yu.includes(i.namespaceURI)&&"NetworkLink"==i.localName){const t=Wl({},wu,i,[]);e.push(t)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const t=i.localName;!yu.includes(i.namespaceURI)||"Document"!=t&&"Folder"!=t&&"kml"!=t||a(e,this.readNetworkLinksFromNode(i))}return e}readRegion(t){const e=[];if("string"==typeof t){const i=Fl(t);a(e,this.readRegionFromDocument(i))}else Al(t)?a(e,this.readRegionFromDocument(t)):a(e,this.readRegionFromNode(t));return e}readRegionFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&a(e,this.readRegionFromNode(i));return e}readRegionFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(yu.includes(i.namespaceURI)&&"Region"==i.localName){const t=Wl({},Eu,i,[]);e.push(t)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const t=i.localName;!yu.includes(i.namespaceURI)||"Document"!=t&&"Folder"!=t&&"kml"!=t||a(e,this.readRegionFromNode(i))}return e}writeFeaturesNode(t,e){e=this.adaptOptions(e);const i=Rl(yu[4],"kml"),s="http://www.w3.org/2000/xmlns/";i.setAttributeNS(s,"xmlns:gx",mu[0]),i.setAttributeNS(s,"xmlns:xsi",Nl),i.setAttributeNS(Nl,"xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");const n={node:i},r={};t.length>1?r.Document=t:1==t.length&&(r.Placemark=t[0]);const o=Cu[i.namespaceURI],a=Yl(r,o);return Hl(n,Su,Ul,a,[e],o,this),i}};class mg{constructor(){this._context="draw",this._contextFeatures={},this._tools=["deactivate","point","line","polygon","box","circle","freehand"],this._toolSelected=this._tools[0],this._repoAndProjectString=lizUrls.params.repository+"_"+lizUrls.params.project,this._drawColor=localStorage.getItem(this._repoAndProjectString+"_drawColor")||"#ff0000",this._featureDrawnVisibility=!0,this._isEdited=!1,this._isSaved=!1;const t=new OpenLayers.Style({pointRadius:7,fillColor:this._drawColor,fillOpacity:.2,strokeColor:this._drawColor,strokeOpacity:1,strokeWidth:3}),e=new OpenLayers.Style({pointRadius:7,fillColor:this._drawColor,fillOpacity:.3,strokeColor:this._drawColor,strokeOpacity:1,strokeWidth:3}),i=new OpenLayers.Style({pointRadius:7,fillColor:"blue",fillOpacity:.3,strokeColor:"blue",strokeOpacity:1,strokeWidth:3}),s=new OpenLayers.StyleMap({default:t,temporary:e,select:i});this._drawLayer=new OpenLayers.Layer.Vector("drawLayer",{styleMap:s}),this._drawLayer.events.on({featureadded:()=>{this.saveFeatureDrawn(),qy.dispatch("digitizing.featureDrawn")}}),jy.lizmap3.map.addLayer(this._drawLayer);const n=t=>{lizMap.controls.hasOwnProperty("featureInfo")&&lizMap.controls.featureInfo&&("activate"===t.type&&lizMap.controls.featureInfo.active?lizMap.controls.featureInfo.deactivate():"deactivate"!==t.type||lizMap.controls.featureInfo.active||lizMap.controls.featureInfo.activate())};this._drawPointLayerCtrl=new OpenLayers.Control.DrawFeature(this._drawLayer,OpenLayers.Handler.Point,{styleMap:s,eventListeners:{activate:n,deactivate:n}}),this._drawLineLayerCtrl=new OpenLayers.Control.DrawFeature(this._drawLayer,OpenLayers.Handler.Path,{styleMap:s,eventListeners:{activate:n,deactivate:n}}),this._drawPolygonLayerCtrl=new OpenLayers.Control.DrawFeature(this._drawLayer,OpenLayers.Handler.Polygon,{styleMap:s,eventListeners:{activate:n,deactivate:n}}),this._drawBoxLayerCtrl=new OpenLayers.Control.DrawFeature(this._drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0}}),this._drawCircleLayerCtrl=new OpenLayers.Control.DrawFeature(this._drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:40}}),this._drawFreehandLayerCtrl=new OpenLayers.Control.DrawFeature(this._drawLayer,OpenLayers.Handler.Polygon,{styleMap:s,handlerOptions:{freehand:!0}}),this._drawCtrls=[this._drawPointLayerCtrl,this._drawLineLayerCtrl,this._drawPolygonLayerCtrl,this._drawBoxLayerCtrl,this._drawCircleLayerCtrl,this._drawFreehandLayerCtrl],this._editCtrl=new OpenLayers.Control.ModifyFeature(this._drawLayer,{clickout:!1,eventListeners:{activate:n,deactivate:n}}),jy.lizmap3.map.addControls(this._drawCtrls),jy.lizmap3.map.addControl(this._editCtrl),this.loadFeatureDrawnToMap(),jy.lizmap3.events.on({minidockopened:t=>{"measure"==t.id?this.toolSelected=this._tools[0]:"draw"!=t.id&&"selectiontool"!=t.id||(this.context=t.id)}})}get drawLayer(){return this._drawLayer}get context(){return this._context}set context(t){const e=new OpenLayers.Format.WKT;this.featureDrawn?this._contextFeatures[this._context]=e.write(this.featureDrawn):this._contextFeatures[this._context]=null,this._isSaved=!1,this._drawLayer.destroyFeatures(),this._context=t,this._contextFeatures[this._context]?(this._drawLayer.addFeatures(e.read(this._contextFeatures[this._context])),this._drawLayer.redraw(!0)):this.loadFeatureDrawnToMap()}get toolSelected(){return this._toolSelected}set toolSelected(t){if(this._tools.includes(t)){for(const t of this._drawCtrls)t.deactivate();if(this._toolSelected===t)this._toolSelected=this._tools[0];else{switch(t){case this._tools[1]:this._drawPointLayerCtrl.activate();break;case this._tools[2]:this._drawLineLayerCtrl.activate();break;case this._tools[3]:this._drawPolygonLayerCtrl.activate();break;case this._tools[4]:this._drawBoxLayerCtrl.activate();break;case this._tools[5]:this._drawCircleLayerCtrl.activate();break;case this._tools[6]:this._drawFreehandLayerCtrl.activate()}this._toolSelected=t}this._toolSelected!==this._tools[0]&&(this.isEdited=!1),qy.dispatch("digitizing.toolSelected")}}get drawColor(){return this._drawColor}set drawColor(t){this._drawColor=t;const e=this._drawLayer.styleMap.styles;e.default.defaultStyle.fillColor=t,e.default.defaultStyle.strokeColor=t,e.temporary.defaultStyle.fillColor=t,e.temporary.defaultStyle.strokeColor=t,this._drawLayer.redraw(!0),localStorage.setItem(this._repoAndProjectString+"_drawColor",this._drawColor),qy.dispatch("digitizing.drawColor")}get featureDrawn(){return this._drawLayer.features.length?this._drawLayer.features:null}get featureDrawnVisibility(){return this._featureDrawnVisibility}get isEdited(){return this._isEdited}set isEdited(t){this._isEdited!==t&&(this._isEdited=t,this._isEdited?(1===this.featureDrawn.length?(this._editCtrl.standalone=!0,this._editCtrl.selectFeature(this.featureDrawn[0])):this._editCtrl.standalone=!1,this._editCtrl.activate(),this.toolSelected="deactivate",qy.dispatch("digitizing.editionBegins")):(this._editCtrl.deactivate(),this.saveFeatureDrawn(),qy.dispatch("digitizing.editionEnds")))}get isSaved(){return this._isSaved}getFeatureDrawnSLD(t){if(this.featureDrawn[t]){const e=this.featureDrawn[t].layer.styleMap.styles.default.defaultStyle;let i="",s=`<Stroke>\n                                        <SvgParameter name="stroke">${e.strokeColor}</SvgParameter>\n                                        <SvgParameter name="stroke-opacity">${e.strokeOpacity}</SvgParameter>\n                                        <SvgParameter name="stroke-width">${e.strokeWidth}</SvgParameter>\n                                    </Stroke>\n                                    <Fill>\n                                        <SvgParameter name="fill">${e.fillColor}</SvgParameter>\n                                        <SvgParameter name="fill-opacity">${e.fillOpacity}</SvgParameter>\n                                    </Fill>`;return i="OpenLayers.Geometry.Point"===this.featureDrawn[t].geometry.CLASS_NAME?`<PointSymbolizer>\n                                <Graphic>\n                                    <Mark>\n                                        <WellKnownName>circle</WellKnownName>\n                                        ${s}\n                                    </Mark>\n                                    <Size>${2*e.pointRadius}</Size>\n                                </Graphic>\n                            </PointSymbolizer>`:`<PolygonSymbolizer>\n                                    ${s}\n                                </PolygonSymbolizer>`,`<?xml version="1.0" encoding="UTF-8"?>\n                    <StyledLayerDescriptor xmlns="http://www.opengis.net/sld"\n                        xmlns:ogc="http://www.opengis.net/ogc"\n                        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.1.0"\n                        xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/sld http://schemas.opengis.net/sld/1.1.0/StyledLayerDescriptor.xsd"\n                        xmlns:se="http://www.opengis.net/se">\n                        <UserStyle>\n                            <FeatureTypeStyle>\n                                <Rule>\n                                    ${i}\n                                </Rule>\n                            </FeatureTypeStyle>\n                        </UserStyle>\n                    </StyledLayerDescriptor>`}return null}toggleFeatureDrawnVisibility(){this._featureDrawnVisibility=!this._featureDrawnVisibility,this._drawLayer.setVisibility(this._featureDrawnVisibility),qy.dispatch("digitizing.featureDrawnVisibility")}toggleEdit(){this.isEdited=!this.isEdited}erase(){if(!confirm(lizDict["digitizing.confirme.erase"]))return!1;this._drawLayer.destroyFeatures(),localStorage.removeItem(this._repoAndProjectString+"_"+this._context+"_drawLayer"),this.isEdited=!1,qy.dispatch("digitizing.erase")}toggleSave(){this._isSaved=!this._isSaved,this.saveFeatureDrawn(),qy.dispatch("digitizing.save")}saveFeatureDrawn(){const t=new OpenLayers.Format.WKT;this.featureDrawn&&this._isSaved&&localStorage.setItem(this._repoAndProjectString+"_"+this._context+"_drawLayer",t.write(this.featureDrawn))}loadFeatureDrawnToMap(){const t=new OpenLayers.Format.WKT,e=localStorage.getItem(this._repoAndProjectString+"_drawLayer"),i=null!==e?e:localStorage.getItem(this._repoAndProjectString+"_"+this._context+"_drawLayer");i&&(this._drawLayer.addFeatures(t.read(i)),this._drawLayer.redraw(!0))}download(t){if(this.featureDrawn){const e=[];for(const t of this.featureDrawn){const i=t.geometry;let s;if("OpenLayers.Geometry.Point"===i.CLASS_NAME)s=new hl(new Ws([i.x,i.y]));else if("OpenLayers.Geometry.MultiPoint"===i.CLASS_NAME){let t=[];for(const e of i.components)t.push([e.x,e.y]);s=new hl(new cl(t))}else if("OpenLayers.Geometry.LineString"===i.CLASS_NAME){let t=[];for(const e of i.components)t.push([e.x,e.y]);s=new hl(new _l(t))}else if("OpenLayers.Geometry.MultiLineString"===i.CLASS_NAME){let t=[];for(const e of i.components){let i=[];for(const t of e.components)i.push([t.x,t.y]);t.push(new _l(i))}s=new hl(new ml(t))}else if("OpenLayers.Geometry.Polygon"===i.CLASS_NAME){let t=[];for(const e of i.components){let i=[];for(const t of e.components)i.push([t.x,t.y]);t.push(i)}s=new hl(new hn(t))}else if("OpenLayers.Geometry.MultiPolygon"===i.CLASS_NAME){let t=[];for(const e of i.components){let i=[];for(const t of e.components){let e=[];for(const i of t.components)e.push([i.x,i.y]);i.push(e)}t.push(new hn(i))}s=new hl(new xl(t))}s.getGeometry().transform(jy.projection,"EPSG:4326"),e.push(s)}if("geojson"===t){const t=(new Tl).writeFeatures(e);ol.downloadFileFromString(t,"application/geo+json","export.geojson")}else if("gpx"===t){const t=(new Uc).writeFeatures(e);ol.downloadFileFromString(t,"application/gpx+xml","export.gpx")}else if("kml"===t){const t=(new fg).writeFeatures(e);ol.downloadFileFromString(t,"application/vnd.google-earth.kml+xml","export.kml")}}}import(t){const e=new FileReader,i=t.name.split(".").pop();e.onload=(()=>t=>{const e=t.target.result;let s;try{"geojson"===i||"json"===i?s=(new Tl).readFeatures(e):"gpx"===i?s=(new Uc).readFeatures(e):"kml"===i&&(s=(new fg).readFeatures(e))}catch(t){lizMap.addMessage(t,"error",!0)}if(s){const t=[];for(const e of s){const i=e.getGeometry(),s=i.getType();i.transform("EPSG:4326",jy.projection);const n=i.getCoordinates(),r=[];let o;if("Point"===s)o=new OpenLayers.Geometry.Point(n[0],n[1]);else if("MultiPoint"===s){let t=[];for(const e of n)t.push(new OpenLayers.Geometry.Point(e[0],e[1]));o=new OpenLayers.Geometry.MultiPoint(t)}else if("LineString"===s){for(const t of n)r.push(new OpenLayers.Geometry.Point(t[0],t[1]));o=new OpenLayers.Geometry.LineString(r)}else if("MultiLineString"===s){const t=[];for(const e of n){let i=[];for(const t of e)i.push(new OpenLayers.Geometry.Point(t[0],t[1]));t.push(new OpenLayers.Geometry.LineString(i))}o=new OpenLayers.Geometry.MultiLineString(t)}else if("Polygon"===s){const t=[];for(const e of n){let i=[];for(const t of e)i.push(new OpenLayers.Geometry.Point(t[0],t[1]));t.push(new OpenLayers.Geometry.LinearRing(i))}o=new OpenLayers.Geometry.Polygon(t)}else if("MultiPolygon"===s){const t=[];for(const e of n){const i=[];for(const t of e){let e=[];for(const i of t)e.push(new OpenLayers.Geometry.Point(i[0],i[1]));i.push(new OpenLayers.Geometry.LinearRing(e))}t.push(new OpenLayers.Geometry.Polygon(i))}o=new OpenLayers.Geometry.MultiPolygon(t)}o&&t.push(new OpenLayers.Feature.Vector(o))}t&&(this._drawLayer.addFeatures(t),this._drawLayer.redraw(!0),jy.lizmap3.map.zoomToExtent(this._drawLayer.getDataExtent()))}})(),e.readAsText(t)}}class yg{constructor(){this._active=!1,this._snapLayersRefreshable=!1,this._maxFeatures=1e3,this._restrictToMapExtent=!0,this._config=void 0;const t=new OpenLayers.Layer.Vector("snaplayer",{visibility:!1,styleMap:new OpenLayers.StyleMap({pointRadius:2,fill:!1,stroke:!0,strokeWidth:3,strokeColor:"red",strokeOpacity:.8})});jy.lizmap3.map.addLayer(t);const e=new OpenLayers.Control.Snapping({layer:jy.edition.editLayer,targets:[{layer:t}]});jy.lizmap3.map.addControls([e]),jy.lizmap3.controls.snapControl=e,this._setSnapLayersRefreshable=()=>{this._active&&(this.snapLayersRefreshable=!0)},qy.addListener((()=>{for(const t in jy.config.editionLayers)if(jy.config.editionLayers.hasOwnProperty(t)&&jy.config.editionLayers[t].layerId===jy.edition.layerId){const e=jy.config.editionLayers[t];e.hasOwnProperty("snap_layers")&&e.snap_layers.length>0&&(this.config={snap_layers:e.snap_layers,snap_vertices:!(!e.hasOwnProperty("snap_vertices")||"True"!==e.snap_vertices),snap_segments:!(!e.hasOwnProperty("snap_segments")||"True"!==e.snap_segments),snap_intersections:!(!e.hasOwnProperty("snap_intersections")||"True"!==e.snap_intersections),snap_vertices_tolerance:e.hasOwnProperty("snap_vertices_tolerance")?e.snap_vertices_tolerance:10,snap_segments_tolerance:e.hasOwnProperty("snap_segments_tolerance")?e.snap_segments_tolerance:10,snap_intersections_tolerance:e.hasOwnProperty("snap_intersections_tolerance")?e.snap_intersections_tolerance:10})}if(void 0!==this._config){const t=jy.lizmap3.controls.snapControl;t.setLayer(jy.edition.editLayer),t.targets[0].node=this._config.snap_vertices,t.targets[0].vertex=this._config.snap_intersections,t.targets[0].edge=this._config.snap_segments,t.targets[0].nodeTolerance=this._config.snap_vertices_tolerance,t.targets[0].vertexTolerance=this._config.snap_intersections_tolerance,t.targets[0].edgeTolerance=this._config.snap_segments_tolerance,qy.addListener(this._setSnapLayersRefreshable,"map.moveend")}}),"edition.formDisplayed"),qy.addListener((()=>{this.active=!1,jy.lizmap3.map.getLayersByName("snaplayer")[0].destroyFeatures(),this.config=void 0,qy.removeListener(this._setSnapLayersRefreshable,"map.moveend")}),"edition.formClosed")}getSnappingData(){jy.lizmap3.map.getLayersByName("snaplayer")[0].destroyFeatures();for(const t of this._config.snap_layers)lizMap.getFeatureData(jy.lizmap3.getLayerConfigById(t)[0],null,null,"geom",this._restrictToMapExtent,null,this._maxFeatures,((t,e,i)=>{const s=lizMap.config.layers[t];let n=s.featureCrs;n||(n=s.crs);const r=new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0,externalProjection:n,internalProjection:jy.projection}).read({type:"FeatureCollection",features:i});jy.lizmap3.map.getLayersByName("snaplayer")[0].addFeatures(r)}));this.snapLayersRefreshable=!1}toggle(){this.active=!this._active}get snapLayersRefreshable(){return this._snapLayersRefreshable}set snapLayersRefreshable(t){this._snapLayersRefreshable=t,qy.dispatch("snapping.refreshable")}get active(){return this._active}set active(t){this._active=t,this._active?(this.getSnappingData(),jy.lizmap3.controls.snapControl.activate()):(this.snapLayersRefreshable=!1,jy.lizmap3.controls.snapControl.deactivate()),jy.lizmap3.map.getLayersByName("snaplayer")[0].setVisibility(this._active),qy.dispatch("snapping.active")}get config(){return this._config}set config(t){this._config=t,qy.dispatch("snapping.config")}}var xg=i(582);const vg=class{constructor(t){this.rbush_=new xg(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[E(e)]=i}load(t,e){const i=new Array(e.length);for(let s=0,n=e.length;s<n;s++){const n=t[s],r=e[s],o={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3],value:r};i[s]=o,this.items_[E(r)]=o}this.rbush_.load(i)}remove(t){const e=E(t),i=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(i)}update(t,e){const i=this.items_[E(e)];ht([i.minX,i.minY,i.maxX,i.maxY],t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map((function(t){return t.value}))}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map((function(t){return t.value}))}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let s=0,n=t.length;s<n;s++)if(i=e(t[s]),i)return i;return i}isEmpty(){return g(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return nt(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}};function wg(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}const Mg=class extends S{constructor(t){super(),this.projection=qi(t.projection),this.attributions_=wg(t.attributions),this.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,this.loading=!1,this.state_=void 0!==t.state?t.state:"ready",this.wrapX_=void 0!==t.wrapX&&t.wrapX,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise((function(t,i){e.viewResolver=t,e.viewRejector=i}))}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=wg(t),this.changed()}setState(t){this.state_=t,this.changed()}},Eg="addfeature",Cg="removefeature";function Sg(t,e){return[[-1/0,-1/0,1/0,1/0]]}let bg=!1;function Ig(t,e){return function(i,s,n,r,o){const a=this;!function(t,e,i,s,n,r,o){const a=new XMLHttpRequest;a.open("GET","function"==typeof t?t(i,s,n):t,!0),"arraybuffer"==e.getType()&&(a.responseType="arraybuffer"),a.withCredentials=bg,a.onload=function(t){if(!a.status||a.status>=200&&a.status<300){const t=e.getType();let s;"json"==t||"text"==t?s=a.responseText:"xml"==t?(s=a.responseXML,s||(s=(new DOMParser).parseFromString(a.responseText,"application/xml"))):"arraybuffer"==t&&(s=a.response),s?r(e.readFeatures(s,{extent:i,featureProjection:n}),e.readProjection(s)):o()}else o()},a.onerror=o,a.send()}(t,e,i,s,n,(function(t,e){a.addFeatures(t),void 0!==r&&r(t)}),o||u)}}class Lg extends t{constructor(t,e,i){super(t),this.feature=e,this.features=i}}const Tg=class extends Mg{constructor(t){super({attributions:(t=t||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===t.wrapX||t.wrapX}),this.on,this.once,this.un,this.loader_=u,this.format_=t.format,this.overlaps_=void 0===t.overlaps||t.overlaps,this.url_=t.url,void 0!==t.loader?this.loader_=t.loader:void 0!==this.url_&&(q(this.format_,7),this.loader_=Ig(this.url_,this.format_)),this.strategy_=void 0!==t.strategy?t.strategy:Sg;const e=void 0===t.useSpatialIndex||t.useSpatialIndex;let i,s;this.featuresRtree_=e?new vg:null,this.loadedExtentsRtree_=new vg,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(t.features)?s=t.features:t.features&&(i=t.features,s=i.getArray()),e||void 0!==i||(i=new O(s)),void 0!==s&&this.addFeaturesInternal(s),void 0!==i&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=E(t);if(!this.addToIndex_(e,t))return void(this.featuresCollection_&&this.featuresCollection_.remove(t));this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const e=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(e,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Lg(Eg,t))}setupChangeEvents_(t,i){this.featureChangeKeys_[t]=[f(i,_.CHANGE,this.handleFeatureChange_,this),f(i,e,this.handleFeatureChange_,this)]}addToIndex_(t,e){let i=!0;const s=e.getId();return void 0!==s&&(s.toString()in this.idIndex_?i=!1:this.idIndex_[s.toString()]=e),i&&(q(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],s=[];for(let e=0,s=t.length;e<s;e++){const s=t[e],n=E(s);this.addToIndex_(n,s)&&i.push(s)}for(let t=0,n=i.length;t<n;t++){const n=i[t],r=E(n);this.setupChangeEvents_(r,n);const o=n.getGeometry();if(o){const t=o.getExtent();e.push(t),s.push(n)}else this.nullGeometryFeatures_[r]=n}if(this.featuresRtree_&&this.featuresRtree_.load(e,s),this.hasListener(Eg))for(let t=0,e=i.length;t<e;t++)this.dispatchEvent(new Lg(Eg,i[t]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(Eg,(function(i){e||(e=!0,t.push(i.feature),e=!1)})),this.addEventListener(Cg,(function(i){e||(e=!0,t.remove(i.feature),e=!1)})),t.addEventListener(T,(t=>{e||(e=!0,this.addFeature(t.element),e=!1)})),t.addEventListener(N,(t=>{e||(e=!0,this.removeFeature(t.element),e=!1)})),this.featuresCollection_=t}clear(t){if(t){for(const t in this.featureChangeKeys_)this.featureChangeKeys_[t].forEach(y);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const t=t=>{this.removeFeatureInternal(t)};this.featuresRtree_.forEach(t);for(const t in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[t])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Lg("clear");this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,(function(i){if(i.getGeometry().intersectsCoordinate(t))return e(i)}))}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,(function(i){if(i.getGeometry().intersectsExtent(t)){const t=e(i);if(t)return t}}))}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),g(this.nullGeometryFeatures_)||a(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,(function(t){e.push(t)})),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const i=function(t,e){if(e.canWrapX()){const i=e.getExtent();if(!isFinite(t[0])||!isFinite(t[2]))return[[i[0],t[1],i[2],t[3]]];St(t,e);const s=Mt(i);if(Mt(t)>s)return[[i[0],t[1],i[2],t[3]]];if(t[0]<i[0])return[[t[0]+s,t[1],i[2],t[3]],[i[0],t[1],t[2],t[3]]];if(t[2]>i[2])return[[t[0],t[1],i[2],t[3]],[i[0],t[1],t[2]-s,t[3]]]}return[t]}(t,e);return[].concat(...i.map((t=>this.featuresRtree_.getInExtent(t))))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],s=t[1];let n=null;const r=[NaN,NaN];let o=1/0;const a=[-1/0,-1/0,1/0,1/0];return e=e||l,this.featuresRtree_.forEachInExtent(a,(function(t){if(e(t)){const e=t.getGeometry(),h=o;if(o=e.closestPointXY(i,s,r,o),o<h){n=t;const e=Math.sqrt(o);a[0]=i-e,a[1]=s-e,a[2]=i+e,a[3]=s+e}}})),n}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return void 0!==e?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return void 0!==e?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=E(e),s=e.getGeometry();if(s){const t=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(t,e)):this.featuresRtree_&&this.featuresRtree_.update(t,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);const n=e.getId();if(void 0!==n){const t=n.toString();this.idIndex_[t]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[t]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new Lg("changefeature",e))}hasFeature(t){const e=t.getId();return void 0!==e?e in this.idIndex_:E(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&g(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(t,e,i){const s=this.loadedExtentsRtree_,n=this.strategy_(t,e,i);for(let t=0,r=n.length;t<r;++t){const r=n[t];s.forEachInExtent(r,(function(t){return et(t.extent,r)}))||(++this.loadingExtentsCount_,this.dispatchEvent(new Lg("featuresloadstart")),this.loader_.call(this,r,e,i,(t=>{--this.loadingExtentsCount_,this.dispatchEvent(new Lg("featuresloadend",void 0,t))}),(()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Lg("featuresloaderror"))})),s.insert(r,{extent:r.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,(function(e){if(ht(e.extent,t))return i=e,!0})),i&&e.remove(i)}removeFeature(t){if(!t)return;const e=E(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=E(t),i=this.featureChangeKeys_[e];if(!i)return;i.forEach(y),delete this.featureChangeKeys_[e];const s=t.getId();return void 0!==s&&delete this.idIndex_[s.toString()],delete this.uidIndex_[e],this.dispatchEvent(new Lg(Cg,t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e}setLoader(t){this.loader_=t}setUrl(t){q(this.format_,7),this.url_=t,this.setLoader(Ig(t,this.format_))}};function Ng(t){return new pu({fill:Rg(t,""),stroke:Pg(t,""),text:Og(t),image:Ag(t)})}function Rg(t,e){const i=t[e+"fill-color"];if(i)return new Vc({color:i})}function Pg(t,e){const i=t[e+"stroke-width"],s=t[e+"stroke-color"];if(i||s)return new su({width:i,color:s,lineCap:t[e+"stroke-line-cap"],lineJoin:t[e+"stroke-line-join"],lineDash:t[e+"stroke-line-dash"],lineDashOffset:t[e+"stroke-line-dash-offset"],miterLimit:t[e+"stroke-miter-limit"]})}function Og(t){const e=t["text-value"];if(e)return new fu({text:e,font:t["text-font"],maxAngle:t["text-max-angle"],offsetX:t["text-offset-x"],offsetY:t["text-offset-y"],overflow:t["text-overflow"],placement:t["text-placement"],scale:t["text-scale"],rotateWithView:t["text-rotate-with-view"],rotation:t["text-rotation"],textAlign:t["text-align"],justify:t["text-justify"],textBaseline:t["text-baseline"],padding:t["text-padding"],fill:Rg(t,"text-"),backgroundFill:Rg(t,"text-background-"),stroke:Pg(t,"text-"),backgroundStroke:Pg(t,"text-background-")})}function Ag(t){const e=t["icon-src"],i=t["icon-img"];if(e||i)return new eu({src:e,img:i,imgSize:t["icon-img-size"],anchor:t["icon-anchor"],anchorOrigin:t["icon-anchor-origin"],anchorXUnits:t["icon-anchor-x-units"],anchorYUnits:t["icon-anchor-y-units"],color:t["icon-color"],crossOrigin:t["icon-cross-origin"],offset:t["icon-offset"],displacement:t["icon-displacement"],opacity:t["icon-opacity"],scale:t["icon-scale"],rotation:t["icon-rotation"],rotateWithView:t["icon-rotate-with-view"],size:t["icon-size"],declutterMode:t["icon-declutter-mode"]});const s=t["shape-points"];if(s){const e="shape-";return new ou({points:s,fill:Rg(t,e),stroke:Pg(t,e),radius:t["shape-radius"],radius1:t["shape-radius1"],radius2:t["shape-radius2"],angle:t["shape-angle"],displacement:t["shape-displacement"],rotation:t["shape-rotation"],rotateWithView:t["shape-rotate-with-view"],scale:t["shape-scale"],declutterMode:t["shape-declutter-mode"]})}const n=t["circle-radius"];if(n){const e="circle-";return new hu({radius:n,fill:Rg(t,e),stroke:Pg(t,e),displacement:t["circle-displacement"],scale:t["circle-scale"],rotation:t["circle-rotation"],rotateWithView:t["circle-rotate-with-view"],declutterMode:t["circle-declutter-mode"]})}}const Fg="renderOrder",Dg=class extends re{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=void 0!==t.declutter&&t.declutter,this.renderBuffer_=void 0!==t.renderBuffer?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=void 0!==t.updateWhileAnimating&&t.updateWhileAnimating,this.updateWhileInteracting_=void 0!==t.updateWhileInteracting&&t.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Fg)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new xg(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set(Fg,t)}setStyle(t){let e;if(void 0===t)e=uu;else if(null===t)e=null;else if("function"==typeof t)e=t;else if(t instanceof pu)e=t;else if(Array.isArray(t)){const i=t.length,s=new Array(i);for(let e=0;e<i;++e){const i=t[e];s[e]=i instanceof pu?i:Ng(i)}e=s}else e=Ng(t);this.style_=e,this.styleFunction_=null===t?void 0:function(t){let e;if("function"==typeof t)e=t;else{let i;Array.isArray(t)?i=t:(q("function"==typeof t.getZIndex,41),i=[t]),e=function(){return i}}return e}(this.style_),this.changed()}},kg={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Gg=[kg.FILL],zg=[kg.STROKE],Bg=[kg.BEGIN_PATH],jg=[kg.CLOSE_PATH],qg=kg,Ug=class{drawCustom(t,e,i,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}},Yg=class extends Ug{constructor(t,e,i,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return 1==e?t:t.map((function(t){return t*e}))}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,n=this.coordinates;let r=n.length;for(let o=0,a=t.length;o<a;o+=e)s[0]=t[o],s[1]=t[o+1],tt(i,s)&&(n[r++]=s[0],n[r++]=s[1]);return r}appendFlatLineCoordinates(t,e,i,s,n,r){const o=this.coordinates;let a=o.length;const h=this.getBufferedMaxExtent();r&&(e+=s);let l=t[e],c=t[e+1];const u=this.tmpCoordinate_;let d,g,p,_=!0;for(d=e+s;d<i;d+=s)u[0]=t[d],u[1]=t[d+1],p=st(h,u),p!==g?(_&&(o[a++]=l,o[a++]=c,_=!1),o[a++]=u[0],o[a++]=u[1]):p===H.INTERSECTING?(o[a++]=u[0],o[a++]=u[1],_=!1):_=!0,l=u[0],c=u[1],g=p;return(n&&_||d===e+s)&&(o[a++]=l,o[a++]=c),a}drawCustomCoordinates_(t,e,i,s,n){for(let r=0,o=i.length;r<o;++r){const o=i[r],a=this.appendFlatLineCoordinates(t,e,o,s,!1,!1);n.push(a),e=o}return e}drawCustom(t,e,i,s){this.beginGeometry(t,e);const n=t.getType(),r=t.getStride(),o=this.coordinates.length;let a,h,l,c,u;switch(n){case"MultiPolygon":a=t.getOrientedFlatCoordinates(),c=[];const e=t.getEndss();u=0;for(let t=0,i=e.length;t<i;++t){const i=[];u=this.drawCustomCoordinates_(a,u,e[t],r,i),c.push(i)}this.instructions.push([qg.CUSTOM,o,c,t,i,js]),this.hitDetectionInstructions.push([qg.CUSTOM,o,c,t,s||i,js]);break;case"Polygon":case"MultiLineString":l=[],a="Polygon"==n?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),u=this.drawCustomCoordinates_(a,0,t.getEnds(),r,l),this.instructions.push([qg.CUSTOM,o,l,t,i,Bs]),this.hitDetectionInstructions.push([qg.CUSTOM,o,l,t,s||i,Bs]);break;case"LineString":case"Circle":a=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(a,0,a.length,r,!1,!1),this.instructions.push([qg.CUSTOM,o,h,t,i,zs]),this.hitDetectionInstructions.push([qg.CUSTOM,o,h,t,s||i,zs]);break;case"MultiPoint":a=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(a,r),h>o&&(this.instructions.push([qg.CUSTOM,o,h,t,i,zs]),this.hitDetectionInstructions.push([qg.CUSTOM,o,h,t,s||i,zs]));break;case"Point":a=t.getFlatCoordinates(),this.coordinates.push(a[0],a[1]),h=this.coordinates.length,this.instructions.push([qg.CUSTOM,o,h,t,i]),this.hitDetectionInstructions.push([qg.CUSTOM,o,h,t,s||i])}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[qg.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[qg.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;let e;t.reverse();const i=t.length;let s,n,r=-1;for(e=0;e<i;++e)s=t[e],n=s[0],n==qg.END_GEOMETRY?r=e:n==qg.BEGIN_GEOMETRY&&(s[2]=e,o(this.hitDetectionInstructions,r,e),r=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const e=t.getColor();i.fillStyle=nu(e||Re)}else i.fillStyle=void 0;if(e){const t=e.getColor();i.strokeStyle=nu(t||Fe);const s=e.getLineCap();i.lineCap=void 0!==s?s:Pe;const n=e.getLineDash();i.lineDash=n?n.slice():Oe;const r=e.getLineDashOffset();i.lineDashOffset=r||0;const o=e.getLineJoin();i.lineJoin=void 0!==o?o:Ae;const a=e.getWidth();i.lineWidth=void 0!==a?a:1;const h=e.getMiterLimit();i.miterLimit=void 0!==h?h:10,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[qg.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(!0),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[qg.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;"string"==typeof i&&t.currentFillStyle==i||(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,s=t.lineCap,n=t.lineDash,r=t.lineDashOffset,o=t.lineJoin,a=t.lineWidth,l=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=s||n!=t.currentLineDash&&!h(t.currentLineDash,n)||t.currentLineDashOffset!=r||t.currentLineJoin!=o||t.currentLineWidth!=a||t.currentMiterLimit!=l)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=s,t.currentLineDash=n,t.currentLineDashOffset=r,t.currentLineJoin=o,t.currentLineWidth=a,t.currentMiterLimit=l)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[qg.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=J(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Z(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},Vg=class extends Yg{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinatess_(t,e,i,s){const n=this.state,r=void 0!==n.fillStyle,o=void 0!==n.strokeStyle,a=i.length;this.instructions.push(Bg),this.hitDetectionInstructions.push(Bg);for(let n=0;n<a;++n){const r=i[n],a=this.coordinates.length,h=this.appendFlatLineCoordinates(t,e,r,s,!0,!o),l=[qg.MOVE_TO_LINE_TO,a,h];this.instructions.push(l),this.hitDetectionInstructions.push(l),o&&(this.instructions.push(jg),this.hitDetectionInstructions.push(jg)),e=r}return r&&(this.instructions.push(Gg),this.hitDetectionInstructions.push(Gg)),o&&(this.instructions.push(zg),this.hitDetectionInstructions.push(zg)),e}drawCircle(t,e){const i=this.state,s=i.fillStyle,n=i.strokeStyle;if(void 0===s&&void 0===n)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([qg.SET_FILL_STYLE,Re]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([qg.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const r=t.getFlatCoordinates(),o=t.getStride(),a=this.coordinates.length;this.appendFlatLineCoordinates(r,0,r.length,o,!1,!1);const h=[qg.CIRCLE,a];this.instructions.push(Bg,h),this.hitDetectionInstructions.push(Bg,h),void 0!==i.fillStyle&&(this.instructions.push(Gg),this.hitDetectionInstructions.push(Gg)),void 0!==i.strokeStyle&&(this.instructions.push(zg),this.hitDetectionInstructions.push(zg)),this.endGeometry(e)}drawPolygon(t,e){const i=this.state,s=i.fillStyle,n=i.strokeStyle;if(void 0===s&&void 0===n)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([qg.SET_FILL_STYLE,Re]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([qg.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const r=t.getEnds(),o=t.getOrientedFlatCoordinates(),a=t.getStride();this.drawFlatCoordinatess_(o,0,r,a),this.endGeometry(e)}drawMultiPolygon(t,e){const i=this.state,s=i.fillStyle,n=i.strokeStyle;if(void 0===s&&void 0===n)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([qg.SET_FILL_STYLE,Re]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([qg.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const r=t.getEndss(),o=t.getOrientedFlatCoordinates(),a=t.getStride();let h=0;for(let t=0,e=r.length;t<e;++t)h=this.drawFlatCoordinatess_(o,h,r[t],a);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(0!==t){const e=this.coordinates;for(let i=0,s=e.length;i<s;++i)e[i]=Ds(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}};function Xg(t,e,i,s,n){let r,o,a,h,l,c,u,d,g,p,_=i,f=i,m=0,y=0,x=i;for(o=i;o<s;o+=n){const i=e[o],s=e[o+1];void 0!==l&&(g=i-l,p=s-c,h=Math.sqrt(g*g+p*p),void 0!==u&&(y+=a,r=Math.acos((u*g+d*p)/(a*h)),r>t&&(y>m&&(m=y,_=x,f=o),y=0,x=o-n)),a=h,u=g,d=p),l=i,c=s}return y+=h,y>m?[x,o]:[_,f]}const Wg={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},$g={Circle:Vg,Default:Yg,Image:class extends Yg{constructor(t,e,i,s){super(t,e,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),s=t.getStride(),n=this.coordinates.length,r=this.appendFlatPointCoordinates(i,s);this.instructions.push([qg.DRAW_IMAGE,n,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([qg.DRAW_IMAGE,n,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),s=t.getStride(),n=this.coordinates.length,r=this.appendFlatPointCoordinates(i,s);this.instructions.push([qg.DRAW_IMAGE,n,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([qg.DRAW_IMAGE,n,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),s=t.getSize(),n=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=n[0],this.originY_=n[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},LineString:class extends Yg{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinates_(t,e,i,s){const n=this.coordinates.length,r=this.appendFlatLineCoordinates(t,e,i,s,!1,!1),o=[qg.MOVE_TO_LINE_TO,n,r];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e){const i=this.state,s=i.strokeStyle,n=i.lineWidth;if(void 0===s||void 0===n)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([qg.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Oe,0],Bg);const r=t.getFlatCoordinates(),o=t.getStride();this.drawFlatCoordinates_(r,0,r.length,o),this.hitDetectionInstructions.push(zg),this.endGeometry(e)}drawMultiLineString(t,e){const i=this.state,s=i.strokeStyle,n=i.lineWidth;if(void 0===s||void 0===n)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([qg.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],Bg);const r=t.getEnds(),o=t.getFlatCoordinates(),a=t.getStride();let h=0;for(let t=0,e=r.length;t<e;++t)h=this.drawFlatCoordinates_(o,h,r[t],a);this.hitDetectionInstructions.push(zg),this.endGeometry(e)}finish(){const t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(zg),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(zg),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Bg)}},Polygon:Vg,Text:class extends Yg{constructor(t,e,i,s){super(t,e,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const i=this.textFillState_,s=this.textStrokeState_,n=this.textState_;if(""===this.text_||!n||!i&&!s)return;const r=this.coordinates;let o=r.length;const a=t.getType();let h=null,l=t.getStride();if("line"!==n.placement||"LineString"!=a&&"MultiLineString"!=a&&"Polygon"!=a&&"MultiPolygon"!=a){let i=n.overflow?null:[];switch(a){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),l=2;break;case"Polygon":h=t.getFlatInteriorPoint(),n.overflow||i.push(h[2]/this.resolution),l=3;break;case"MultiPolygon":const e=t.getFlatInteriorPoints();h=[];for(let t=0,s=e.length;t<s;t+=3)n.overflow||i.push(e[t+2]/this.resolution),h.push(e[t],e[t+1]);if(0===h.length)return;l=2}const s=this.appendFlatPointCoordinates(h,l);if(s===o)return;if(i&&(s-o)/2!=h.length/l){let t=o/2;i=i.filter(((e,i)=>{const s=r[2*(t+i)]===h[i*l]&&r[2*(t+i)+1]===h[i*l+1];return s||--t,s}))}this.saveTextStates_(),(n.backgroundFill||n.backgroundStroke)&&(this.setFillStrokeStyle(n.backgroundFill,n.backgroundStroke),n.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),n.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);let c=n.padding;if(c!=Ge&&(n.scale[0]<0||n.scale[1]<0)){let t=n.padding[0],e=n.padding[1],i=n.padding[2],s=n.padding[3];n.scale[0]<0&&(e=-e,s=-s),n.scale[1]<0&&(t=-t,i=-i),c=[t,e,i,s]}const u=this.pixelRatio;this.instructions.push([qg.DRAW_IMAGE,o,s,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,c==Ge?Ge:c.map((function(t){return t*u})),!!n.backgroundFill,!!n.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,i]);const d=1/u;this.hitDetectionInstructions.push([qg.DRAW_IMAGE,o,s,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[d,d],NaN,void 0,this.declutterImageWithText_,c,!!n.backgroundFill,!!n.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,i]),this.endGeometry(e)}else{if(!Et(this.getBufferedMaxExtent(),t.getExtent()))return;let i;if(h=t.getFlatCoordinates(),"LineString"==a)i=[h.length];else if("MultiLineString"==a)i=t.getEnds();else if("Polygon"==a)i=t.getEnds().slice(0,1);else if("MultiPolygon"==a){const e=t.getEndss();i=[];for(let t=0,s=e.length;t<s;++t)i.push(e[t][0])}this.beginGeometry(t,e);const s=n.textAlign;let c,u=0;for(let t=0,e=i.length;t<e;++t){if(null==s){const e=Xg(n.maxAngle,h,u,i[t],l);u=e[0],c=e[1]}else c=i[t];for(let t=u;t<c;t+=l)r.push(h[t],h[t+1]);const e=r.length;u=i[t],this.drawChars_(o,e),o=e}this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const n=this.textKey_;n in this.textStates||(this.textStates[n]={font:e.font,textAlign:e.textAlign||De,justify:e.justify,textBaseline:e.textBaseline||ke,scale:e.scale});const r=this.fillKey_;i&&(r in this.fillStates||(this.fillStates[r]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,s=this.textState_,n=this.strokeKey_,r=this.textKey_,o=this.fillKey_;this.saveTextStates_();const a=this.pixelRatio,h=Wg[s.textBaseline],l=this.textOffsetY_*a,c=this.text_,u=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([qg.DRAW_CHARS,t,e,h,s.overflow,o,s.maxAngle,a,l,n,u*a,c,r,1]),this.hitDetectionInstructions.push([qg.DRAW_CHARS,t,e,h,s.overflow,o,s.maxAngle,1,l,n,u,c,r,1/a])}setTextStyle(t,e){let i,s,n;if(t){const e=t.getFill();e?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=nu(e.getColor()||Re)):(s=null,this.textFillState_=s);const r=t.getStroke();if(r){n=this.textStrokeState_,n||(n={},this.textStrokeState_=n);const t=r.getLineDash(),e=r.getLineDashOffset(),i=r.getWidth(),s=r.getMiterLimit();n.lineCap=r.getLineCap()||Pe,n.lineDash=t?t.slice():Oe,n.lineDashOffset=void 0===e?0:e,n.lineJoin=r.getLineJoin()||Ae,n.lineWidth=void 0===i?1:i,n.miterLimit=void 0===s?10:s,n.strokeStyle=nu(r.getColor()||Fe)}else n=null,this.textStrokeState_=n;i=this.textState_;const o=t.getFont()||Ne;Ue(o);const a=t.getScaleArray();i.overflow=t.getOverflow(),i.font=o,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||ke,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||Ge,i.scale=void 0===a?[1,1]:a;const h=t.getOffsetX(),l=t.getOffsetY(),c=t.getRotateWithView(),u=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===h?0:h,this.textOffsetY_=void 0===l?0:l,this.textRotateWithView_=void 0!==c&&c,this.textRotation_=void 0===u?0:u,this.strokeKey_=n?("string"==typeof n.strokeStyle?n.strokeStyle:E(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s?"string"==typeof s.fillStyle?s.fillStyle:"|"+E(s.fillStyle):""}else this.text_="";this.declutterImageWithText_=e}}},Hg=class{constructor(t,e,i,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const s in i){const n=i[s].finish();t[e][s]=n}}return t}getBuilder(t,e){const i=void 0!==t?t.toString():"0";let s=this.buildersByZIndex_[i];void 0===s&&(s={},this.buildersByZIndex_[i]=s);let n=s[e];return void 0===n&&(n=new(0,$g[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=n),n}},Kg=class extends v{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return w()}getData(t){return null}prepareFrame(t){return w()}renderFrame(t,e){return w()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(s,n)=>{const r=this.loadedTileCallback.bind(this,i,s);return t.forEachLoadedTile(e,s,n,r)}}forEachFeatureAtCoordinate(t,e,i,s,n){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){t.target.getState()===Xc.LOADED&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=Xc.LOADED&&e!=Xc.ERROR&&t.addEventListener(_.CHANGE,this.boundHandleImageChange_),e==Xc.IDLE&&(t.load(),e=t.getState()),e==Xc.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&"ready"===t.getSourceState()&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}},Zg=[];let Jg=null;const Qg=class extends Kg{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){let s;Jg||(Jg=Ee(1,1,void 0,{willReadFrequently:!0})),Jg.clearRect(0,0,1,1);try{Jg.drawImage(t,e,i,1,1,0,0,1,1),s=Jg.getImageData(0,0,1,1).data}catch(t){return Jg=null,null}return s}getBackground(t){let e=this.getLayer().getBackground();return"function"==typeof e&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,i){const s=this.getLayer().getClassName();let n,r;if(t&&t.className===s&&(!i||t&&t.style.backgroundColor&&h(jt(t.style.backgroundColor),jt(i)))){const e=t.firstElementChild;e instanceof HTMLCanvasElement&&(r=e.getContext("2d"))}if(r&&r.canvas.style.transform===e?(this.container=t,this.context=r,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){n=document.createElement("div"),n.className=s;let t=n.style;t.position="absolute",t.width="100%",t.height="100%",r=Ee();const e=r.canvas;n.appendChild(e),t=e.style,t.position="absolute",t.left="0",t.transformOrigin="top left",this.container=n,this.context=r}this.containerReused||!i||this.container.style.backgroundColor||(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const s=vt(i),n=wt(i),r=_t(i),o=pt(i);U(e.coordinateToPixelTransform,s),U(e.coordinateToPixelTransform,n),U(e.coordinateToPixelTransform,r),U(e.coordinateToPixelTransform,o);const a=this.inversePixelTransform;U(a,s),U(a,n),U(a,r),U(a,o),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()}dispatchRenderEvent_(t,e,i){const s=this.getLayer();if(s.hasListener(t)){const n=new _e(t,this.inversePixelTransform,i,e);s.dispatchEvent(n)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_("prerender",t,e)}postRender(t,e){this.dispatchRenderEvent_("postrender",t,e)}getRenderTransform(t,e,i,s,n,r,o){const a=n/2,h=r/2,l=s/e,c=-l,u=-t[0]+o,d=-t[1];return Y(this.tempTransform,a,h,l,c,-i,u,d)}disposeInternal(){delete this.frameState,super.disposeInternal()}};function tp(t,e,i,s,n,r,o,a,h,l,c,u){let d=t[e],g=t[e+1],p=0,_=0,f=0,m=0;function y(){p=d,_=g,d=t[e+=s],g=t[e+1],m+=f,f=Math.sqrt((d-p)*(d-p)+(g-_)*(g-_))}do{y()}while(e<i-s&&m+f<r);let x=0===f?0:(r-m)/f;const v=Pt(p,d,x),w=Pt(_,g,x),M=e-s,E=m,C=r+a*h(l,n,c);for(;e<i-s&&m+f<C;)y();x=0===f?0:(C-m)/f;const S=Pt(p,d,x),b=Pt(_,g,x);let I;if(u){const t=[v,w,S,b];ws(t,0,4,2,u,t,t),I=t[0]>t[2]}else I=v>S;const L=Math.PI,T=[],N=M+s===e;let R;if(f=0,m=E,d=t[e=M],g=t[e+1],N){y(),R=Math.atan2(g-_,d-p),I&&(R+=R>0?-L:L);const t=(S+v)/2,e=(b+w)/2;return T[0]=[t,e,(C-r)/2,R,n],T}for(let t=0,u=(n=n.replace(/\n/g," ")).length;t<u;){y();let v=Math.atan2(g-_,d-p);if(I&&(v+=v>0?-L:L),void 0!==R){let t=v-R;if(t+=t>L?-2*L:t<-L?2*L:0,Math.abs(t)>o)return null}R=v;const w=t;let M=0;for(;t<u;++t){const o=a*h(l,n[I?u-t-1:t],c);if(e+s<i&&m+f<r+M+o/2)break;M+=o}if(t===w)continue;const E=I?n.substring(u-w,u-t):n.substring(w,t);x=0===f?0:(r+M/2-m)/f;const C=Pt(p,d,x),S=Pt(_,g,x);T.push([C,S,M/2,v,E]),r+=M}return T}const ep=[1/0,1/0,-1/0,-1/0],ip=[],sp=[],np=[],rp=[];function op(t){return t[3].declutterBox}const ap=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function hp(t,e){return"start"!==e&&"end"!==e||ap.test(t)||(e="start"===e?"left":"right"),Wg[e]}function lp(t,e,i){return i>0&&t.push("\n",""),t.push(e,""),t}const cp=class{constructor(t,e,i,s){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,i,s){const n=t+e+i+s;if(this.labels_[n])return this.labels_[n];const r=s?this.strokeStates[s]:null,o=i?this.fillStates[i]:null,a=this.textStates[e],h=this.pixelRatio,l=[a.scale[0]*h,a.scale[1]*h],c=Array.isArray(t),u=a.justify?Wg[a.justify]:hp(Array.isArray(t)?t[0]:t,a.textAlign||De),d=s&&r.lineWidth?r.lineWidth:0,g=c?t:t.split("\n").reduce(lp,[]),{width:p,height:_,widths:f,heights:m,lineWidths:y}=function(t,e){const i=[],s=[],n=[];let r=0,o=0,a=0,h=0;for(let l=0,c=e.length;l<=c;l+=2){const u=e[l];if("\n"===u||l===c){r=Math.max(r,o),n.push(o),o=0,a+=h;continue}const d=e[l+1]||t.font,g=Xe(d,u);i.push(g),o+=g;const p=Ye(d);s.push(p),h=Math.max(h,p)}return{width:r,height:a,widths:i,heights:s,lineWidths:n}}(a,g),x=p+d,v=[],w=(x+2)*l[0],M=(_+d)*l[1],E={width:w<0?Math.floor(w):Math.ceil(w),height:M<0?Math.floor(M):Math.ceil(M),contextInstructions:v};1==l[0]&&1==l[1]||v.push("scale",l),s&&(v.push("strokeStyle",r.strokeStyle),v.push("lineWidth",d),v.push("lineCap",r.lineCap),v.push("lineJoin",r.lineJoin),v.push("miterLimit",r.miterLimit),v.push("setLineDash",[r.lineDash]),v.push("lineDashOffset",r.lineDashOffset)),i&&v.push("fillStyle",o.fillStyle),v.push("textBaseline","middle"),v.push("textAlign","center");const C=.5-u;let S=u*x+C*d;const b=[],I=[];let L,T=0,N=0,R=0,P=0;for(let t=0,e=g.length;t<e;t+=2){const e=g[t];if("\n"===e){N+=T,T=0,S=u*x+C*d,++P;continue}const n=g[t+1]||a.font;n!==L&&(s&&b.push("font",n),i&&I.push("font",n),L=n),T=Math.max(T,m[R]);const r=[e,S+C*f[R]+u*(f[R]-y[P]),.5*(d+T)+N];S+=f[R],s&&b.push("strokeText",r),i&&I.push("fillText",r),++R}return Array.prototype.push.apply(v,b),Array.prototype.push.apply(v,I),this.labels_[n]=E,E}replayTextBackground_(t,e,i,s,n,r,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,n),t.lineTo.apply(t,e),r&&(this.alignFill_=r[2],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,s,n,r,o,a,h,l,c,u,d,g,p,_){let f=i-(o*=u[0]),m=s-(a*=u[1]);const y=n+h>t?t-h:n,x=r+l>e?e-l:r,v=g[3]+y*u[0]+g[1],w=g[0]+x*u[1]+g[2],M=f-g[3],E=m-g[0];let C;return(p||0!==c)&&(ip[0]=M,rp[0]=M,ip[1]=E,sp[1]=E,sp[0]=M+v,np[0]=sp[0],np[1]=E+w,rp[1]=np[1]),0!==c?(C=Y([1,0,0,1,0,0],i,s,1,1,c,-i,-s),U(C,ip),U(C,sp),U(C,np),U(C,rp),nt(Math.min(ip[0],sp[0],np[0],rp[0]),Math.min(ip[1],sp[1],np[1],rp[1]),Math.max(ip[0],sp[0],np[0],rp[0]),Math.max(ip[1],sp[1],np[1],rp[1]),ep)):nt(Math.min(M,M+v),Math.min(E,E+w),Math.max(M,M+v),Math.max(E,E+w),ep),d&&(f=Math.round(f),m=Math.round(m)),{drawImageX:f,drawImageY:m,drawImageW:y,drawImageH:x,originX:h,originY:l,declutterBox:{minX:ep[0],minY:ep[1],maxX:ep[2],maxY:ep[3],value:_},canvasTransform:C,scale:u}}replayImageOrLabel_(t,e,i,s,n,r,o){const a=!(!r&&!o),h=s.declutterBox,l=t.canvas,c=o?o[2]*s.scale[0]/2:0;return h.minX-c<=l.width/e&&h.maxX+c>=0&&h.minY-c<=l.height/e&&h.maxY+c>=0&&(a&&this.replayTextBackground_(t,ip,sp,np,rp,r,o),function(t,e,i,s,n,r,o,a,h,l,c){t.save(),1!==i&&(t.globalAlpha*=i),e&&t.setTransform.apply(t,e),s.contextInstructions?(t.translate(h,l),t.scale(c[0],c[1]),function(t,e){const i=t.contextInstructions;for(let t=0,s=i.length;t<s;t+=2)Array.isArray(i[t+1])?e[i[t]].apply(e,i[t+1]):e[i[t]]=i[t+1]}(s,t)):c[0]<0||c[1]<0?(t.translate(h,l),t.scale(c[0],c[1]),t.drawImage(s,n,r,o,a,0,0,o,a)):t.drawImage(s,n,r,o,a,h,l,o*c[0],a*c[1]),t.restore()}(t,s.canvasTransform,n,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){if(this.alignFill_){const e=U(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,s){const n=this.textStates[e],r=this.createLabel(t,e,s,i),o=this.strokeStates[i],a=this.pixelRatio,h=hp(Array.isArray(t)?t[0]:t,n.textAlign||De),l=Wg[n.textBaseline||ke],c=o&&o.lineWidth?o.lineWidth:0;return{label:r,anchorX:h*(r.width/a-2*n.scale[0])+2*(.5-h)*c,anchorY:l*r.height/a+2*(.5-l)*c}}execute_(t,e,i,s,n,r,o,a){let l;var c,u;this.pixelCoordinates_&&h(i,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=vs(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),u=i,(c=this.renderedTransform_)[0]=u[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5]);let d=0;const g=s.length;let p,_,f,m,y,x,v,w,M,E,C,S,b=0,I=0,L=0,T=null,N=null;const R=this.coordinateCache_,P=this.viewRotation_,O=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,A={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:P},F=this.instructions!=s||this.overlaps?0:200;let D,k,G,z;for(;d<g;){const i=s[d];switch(i[0]){case qg.BEGIN_GEOMETRY:D=i[1],z=i[3],D.getGeometry()?void 0===o||Et(o,z.getExtent())?++d:d=i[2]+1:d=i[2];break;case qg.BEGIN_PATH:I>F&&(this.fill_(t),I=0),L>F&&(t.stroke(),L=0),I||L||(t.beginPath(),m=NaN,y=NaN),++d;break;case qg.CIRCLE:b=i[1];const s=l[b],h=l[b+1],c=l[b+2]-s,u=l[b+3]-h,g=Math.sqrt(c*c+u*u);t.moveTo(s+g,h),t.arc(s,h,g,0,2*Math.PI,!0),++d;break;case qg.CLOSE_PATH:t.closePath(),++d;break;case qg.CUSTOM:b=i[1],p=i[2];const B=i[3],j=i[4],q=6==i.length?i[5]:void 0;A.geometry=B,A.feature=D,d in R||(R[d]=[]);const U=R[d];q?q(l,b,p,2,U):(U[0]=l[b],U[1]=l[b+1],U.length=2),j(U,A),++d;break;case qg.DRAW_IMAGE:b=i[1],p=i[2],w=i[3],_=i[4],f=i[5];let Y=i[6];const V=i[7],X=i[8],W=i[9],$=i[10];let H=i[11];const K=i[12];let Z=i[13];const J=i[14],Q=i[15];if(!w&&i.length>=20){M=i[19],E=i[20],C=i[21],S=i[22];const t=this.drawLabelWithPointPlacement_(M,E,C,S);w=t.label,i[3]=w;const e=i[23];_=(t.anchorX-e)*this.pixelRatio,i[4]=_;const s=i[24];f=(t.anchorY-s)*this.pixelRatio,i[5]=f,Y=w.height,i[6]=Y,Z=w.width,i[13]=Z}let tt,et,it,st;i.length>25&&(tt=i[25]),i.length>17?(et=i[16],it=i[17],st=i[18]):(et=Ge,it=!1,st=!1),$&&O?H+=P:$||O||(H-=P);let nt=0;for(;b<p;b+=2){if(tt&&tt[nt++]<Z/this.pixelRatio)continue;const i=this.calculateImageOrLabelDimensions_(w.width,w.height,l[b],l[b+1],Z,Y,_,f,X,W,H,K,n,et,it||st,D),s=[t,e,w,i,V,it?T:null,st?N:null];if(a){if("none"===J)continue;if("obstacle"===J){a.insert(i.declutterBox);continue}{let t,e;if(Q){const i=p-b;if(!Q[i]){Q[i]=s;continue}if(t=Q[i],delete Q[i],e=op(t),a.collides(e))continue}if(a.collides(i.declutterBox))continue;t&&(a.insert(e),this.replayImageOrLabel_.apply(this,t)),a.insert(i.declutterBox)}}this.replayImageOrLabel_.apply(this,s)}++d;break;case qg.DRAW_CHARS:const rt=i[1],ot=i[2],at=i[3],ht=i[4];S=i[5];const lt=i[6],ct=i[7],ut=i[8];C=i[9];const dt=i[10];M=i[11],E=i[12];const gt=[i[13],i[13]],pt=this.textStates[E],_t=pt.font,ft=[pt.scale[0]*ct,pt.scale[1]*ct];let mt;_t in this.widths_?mt=this.widths_[_t]:(mt={},this.widths_[_t]=mt);const yt=gl(l,rt,ot,2),xt=Math.abs(ft[0])*We(_t,M,mt);if(ht||xt<=yt){const i=this.textStates[E].textAlign,s=tp(l,rt,ot,2,M,(yt-xt)*Wg[i],lt,Math.abs(ft[0]),We,_t,mt,O?0:this.viewRotation_);t:if(s){const i=[];let n,r,o,h,l;if(C)for(n=0,r=s.length;n<r;++n){l=s[n],o=l[4],h=this.createLabel(o,E,"",C),_=l[2]+(ft[0]<0?-dt:dt),f=at*h.height+2*(.5-at)*dt*ft[1]/ft[0]-ut;const r=this.calculateImageOrLabelDimensions_(h.width,h.height,l[0],l[1],h.width,h.height,_,f,0,0,l[3],gt,!1,Ge,!1,D);if(a&&a.collides(r.declutterBox))break t;i.push([t,e,h,r,1,null,null])}if(S)for(n=0,r=s.length;n<r;++n){l=s[n],o=l[4],h=this.createLabel(o,E,S,""),_=l[2],f=at*h.height-ut;const r=this.calculateImageOrLabelDimensions_(h.width,h.height,l[0],l[1],h.width,h.height,_,f,0,0,l[3],gt,!1,Ge,!1,D);if(a&&a.collides(r.declutterBox))break t;i.push([t,e,h,r,1,null,null])}a&&a.load(i.map(op));for(let t=0,e=i.length;t<e;++t)this.replayImageOrLabel_.apply(this,i[t])}}++d;break;case qg.END_GEOMETRY:if(void 0!==r){D=i[1];const t=r(D,z);if(t)return t}++d;break;case qg.FILL:F?I++:this.fill_(t),++d;break;case qg.MOVE_TO_LINE_TO:for(b=i[1],p=i[2],k=l[b],G=l[b+1],x=k+.5|0,v=G+.5|0,x===m&&v===y||(t.moveTo(k,G),m=x,y=v),b+=2;b<p;b+=2)k=l[b],G=l[b+1],x=k+.5|0,v=G+.5|0,b!=p-2&&x===m&&v===y||(t.lineTo(k,G),m=x,y=v);++d;break;case qg.SET_FILL_STYLE:T=i,this.alignFill_=i[2],I&&(this.fill_(t),I=0,L&&(t.stroke(),L=0)),t.fillStyle=i[1],++d;break;case qg.SET_STROKE_STYLE:N=i,L&&(t.stroke(),L=0),this.setStrokeStyle_(t,i),++d;break;case qg.STROKE:F?L++:t.stroke(),++d;break;default:++d}}I&&this.fill_(t),L&&t.stroke()}execute(t,e,i,s,n,r){this.viewRotation_=s,this.execute_(t,e,i,this.instructions,n,void 0,void 0,r)}executeHitDetection(t,e,i,s,n){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,s,n)}},up=["Polygon","Circle","LineString","Image","Text","Default"],dp={},gp=class{constructor(t,e,i,s,n,r){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=r,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(n)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t){for(const e in t){let i=this.executorsByZIndex_[e];void 0===i&&(i={},this.executorsByZIndex_[e]=i);const s=t[e];for(const t in s){const e=s[t];i[t]=new cp(this.resolution_,this.pixelRatio_,this.overlaps_,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let e=0,s=t.length;e<s;++e)if(t[e]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,s,r,o){const a=2*(s=Math.round(s))+1,h=Y(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-i,-t[0],-t[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=Ee(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;let u;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):l||c.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(u=[1/0,1/0,-1/0,-1/0],ct(u,t),Z(u,e*(this.renderBuffer_+s),u));const d=function(t){if(void 0!==dp[t])return dp[t];const e=2*t+1,i=t*t,s=new Array(i+1);for(let n=0;n<=t;++n)for(let r=0;r<=t;++r){const o=n*n+r*r;if(o>i)break;let a=s[o];a||(a=[],s[o]=a),a.push(4*((t+n)*e+(t+r))+3),n>0&&a.push(4*((t-n)*e+(t+r))+3),r>0&&(a.push(4*((t+n)*e+(t-r))+3),n>0&&a.push(4*((t-n)*e+(t-r))+3))}const n=[];for(let t=0,e=s.length;t<e;++t)s[t]&&n.push(...s[t]);return dp[t]=n,n}(s);let g;function p(t,e){const i=c.getImageData(0,0,a,a).data;for(let n=0,h=d.length;n<h;n++)if(i[d[n]]>0){if(!o||"Image"!==g&&"Text"!==g||o.includes(t)){const i=(d[n]-3)/4,o=s-i%a,h=s-(i/a|0),l=r(t,e,o*o+h*h);if(l)return l}c.clearRect(0,0,a,a);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);let f,m,y,x,v;for(_.sort(n),f=_.length-1;f>=0;--f){const t=_[f].toString();for(y=this.executorsByZIndex_[t],m=up.length-1;m>=0;--m)if(g=up[m],x=y[g],void 0!==x&&(v=x.executeHitDetection(c,h,i,p,u),v))return v}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],s=e[1],n=e[2],r=e[3],o=[i,s,i,r,n,r,n,s];return vs(o,0,8,2,t,o),o}isEmpty(){return g(this.executorsByZIndex_)}execute(t,e,i,s,r,o,a){const h=Object.keys(this.executorsByZIndex_).map(Number);let l,c,u,d,g,p;for(h.sort(n),this.maxExtent_&&(t.save(),this.clip(t,i)),o=o||up,a&&h.reverse(),l=0,c=h.length;l<c;++l){const n=h[l].toString();for(g=this.executorsByZIndex_[n],u=0,d=o.length;u<d;++u)p=g[o[u]],void 0!==p&&p.execute(t,e,i,s,r,a)}this.maxExtent_&&t.restore()}},pp=class extends Ug{constructor(t,e,i,s,n,r,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=s,this.transformRotation_=s?Ot(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=n,this.squaredTolerance_=r,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}drawImages_(t,e,i,s){if(!this.image_)return;const n=vs(t,e,i,s,this.transform_,this.pixelCoordinates_),r=this.context_,o=this.tmpLocalTransform_,a=r.globalAlpha;1!=this.imageOpacity_&&(r.globalAlpha=a*this.imageOpacity_);let h=this.imageRotation_;0===this.transformRotation_&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let t=0,e=n.length;t<e;t+=2){const e=n[t]-this.imageAnchorX_,i=n[t+1]-this.imageAnchorY_;if(0!==h||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const t=e+this.imageAnchorX_,s=i+this.imageAnchorY_;Y(o,t,s,1,1,h,-t,-s),r.setTransform.apply(r,o),r.translate(t,s),r.scale(this.imageScale_[0],this.imageScale_[1]),r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),r.setTransform(1,0,0,1,0,0)}else r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,e,i,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(r.globalAlpha=a)}drawText_(t,e,i,s){if(!this.textState_||""===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const n=vs(t,e,i,s,this.transform_,this.pixelCoordinates_),r=this.context_;let o=this.textRotation_;for(0===this.transformRotation_&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=s){const t=n[e]+this.textOffsetX_,i=n[e+1]+this.textOffsetY_;0!==o||1!=this.textScale_[0]||1!=this.textScale_[1]?(r.translate(t-this.textOffsetX_,i-this.textOffsetY_),r.rotate(o),r.translate(this.textOffsetX_,this.textOffsetY_),r.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&r.strokeText(this.text_,0,0),this.textFillState_&&r.fillText(this.text_,0,0),r.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&r.strokeText(this.text_,t,i),this.textFillState_&&r.fillText(this.text_,t,i))}}moveToLineTo_(t,e,i,s,n){const r=this.context_,o=vs(t,e,i,s,this.transform_,this.pixelCoordinates_);r.moveTo(o[0],o[1]);let a=o.length;n&&(a-=2);for(let t=2;t<a;t+=2)r.lineTo(o[t],o[t+1]);return n&&r.closePath(),i}drawRings_(t,e,i,s){for(let n=0,r=i.length;n<r;++n)e=this.moveToLineTo_(t,e,i[n],s,!0);return e}drawCircle(t){if(Et(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=function(t,e,i){const s=t.getFlatCoordinates();if(!s)return null;const n=t.getStride();return vs(s,0,s.length,n,e,i)}(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],s=e[3]-e[1],n=Math.sqrt(i*i+s*s),r=this.context_;r.beginPath(),r.arc(e[0],e[1],n,0,2*Math.PI),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&Et(this.extent_,i.getExtent())&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let t=0,i=e.length;t<i;++t)this.drawGeometry(e[t])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Et(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Et(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();let s=0;const n=t.getEnds(),r=t.getStride();e.beginPath();for(let t=0,e=n.length;t<e;++t)s=this.moveToLineTo_(i,s,n[t],r,!1);e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoints();this.drawText_(e,0,e.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Et(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Et(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let s=0;const n=t.getEndss(),r=t.getStride();e.beginPath();for(let t=0,e=n.length;t<e;++t){const e=n[t];s=this.drawRings_(i,s,e,r)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),h(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,s=t.textAlign?t.textAlign:De;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=s&&(i.textAlign=s,e.textAlign=s),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(t){const e=t.getColor();this.fillState_={fillStyle:nu(e||Re)}}else this.fillState_=null;if(e){const t=e.getColor(),i=e.getLineCap(),s=e.getLineDash(),n=e.getLineDashOffset(),r=e.getLineJoin(),o=e.getWidth(),a=e.getMiterLimit(),h=s||Oe;this.strokeState_={lineCap:void 0!==i?i:Pe,lineDash:1===this.pixelRatio_?h:h.map((t=>t*this.pixelRatio_)),lineDashOffset:(n||0)*this.pixelRatio_,lineJoin:void 0!==r?r:Ae,lineWidth:(void 0!==o?o:1)*this.pixelRatio_,miterLimit:void 0!==a?a:10,strokeStyle:nu(t||Fe)}}else this.strokeState_=null}setImageStyle(t){let e;if(!t||!(e=t.getSize()))return void(this.image_=null);const i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const r=t.getScaleArray();this.imageScale_=[r[0]*this.pixelRatio_/i,r[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(t){const e=t.getFill();if(e){const t=e.getColor();this.textFillState_={fillStyle:nu(t||Re)}}else this.textFillState_=null;const i=t.getStroke();if(i){const t=i.getColor(),e=i.getLineCap(),s=i.getLineDash(),n=i.getLineDashOffset(),r=i.getLineJoin(),o=i.getWidth(),a=i.getMiterLimit();this.textStrokeState_={lineCap:void 0!==e?e:Pe,lineDash:s||Oe,lineDashOffset:n||0,lineJoin:void 0!==r?r:Ae,lineWidth:void 0!==o?o:1,miterLimit:void 0!==a?a:10,strokeStyle:nu(t||Fe)}}else this.textStrokeState_=null;const s=t.getFont(),n=t.getOffsetX(),r=t.getOffsetY(),o=t.getRotateWithView(),a=t.getRotation(),h=t.getScaleArray(),l=t.getText(),c=t.getTextAlign(),u=t.getTextBaseline();this.textState_={font:void 0!==s?s:Ne,textAlign:void 0!==c?c:De,textBaseline:void 0!==u?u:ke},this.text_=void 0!==l?Array.isArray(l)?l.reduce(((t,e,i)=>t+(i%2?" ":e)),""):l:"",this.textOffsetX_=void 0!==n?this.pixelRatio_*n:0,this.textOffsetY_=void 0!==r?this.pixelRatio_*r:0,this.textRotateWithView_=void 0!==o&&o,this.textRotation_=void 0!==a?a:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}else this.text_=""}},_p=.5,fp=.5,mp={Point:function(t,e,i,s,n){const r=i.getImage(),o=i.getText();let a;if(r){if(r.getImageState()!=Xc.LOADED)return;let h=t;if(n){const l=r.getDeclutterMode();if("none"!==l)if(h=n,"obstacle"===l){const n=t.getBuilder(i.getZIndex(),"Image");n.setImageStyle(r,a),n.drawPoint(e,s)}else o&&o.getText()&&(a={})}const l=h.getBuilder(i.getZIndex(),"Image");l.setImageStyle(r,a),l.drawPoint(e,s)}if(o&&o.getText()){let r=t;n&&(r=n);const h=r.getBuilder(i.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(e,s)}},LineString:function(t,e,i,s,n){const r=i.getStroke();if(r){const n=t.getBuilder(i.getZIndex(),"LineString");n.setFillStrokeStyle(null,r),n.drawLineString(e,s)}const o=i.getText();if(o&&o.getText()){const r=(n||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(o),r.drawText(e,s)}},Polygon:function(t,e,i,s,n){const r=i.getFill(),o=i.getStroke();if(r||o){const n=t.getBuilder(i.getZIndex(),"Polygon");n.setFillStrokeStyle(r,o),n.drawPolygon(e,s)}const a=i.getText();if(a&&a.getText()){const r=(n||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(a),r.drawText(e,s)}},MultiPoint:function(t,e,i,s,n){const r=i.getImage(),o=i.getText();let a;if(r){if(r.getImageState()!=Xc.LOADED)return;let h=t;if(n){const l=r.getDeclutterMode();if("none"!==l)if(h=n,"obstacle"===l){const n=t.getBuilder(i.getZIndex(),"Image");n.setImageStyle(r,a),n.drawMultiPoint(e,s)}else o&&o.getText()&&(a={})}const l=h.getBuilder(i.getZIndex(),"Image");l.setImageStyle(r,a),l.drawMultiPoint(e,s)}if(o&&o.getText()){let r=t;n&&(r=n);const h=r.getBuilder(i.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(e,s)}},MultiLineString:function(t,e,i,s,n){const r=i.getStroke();if(r){const n=t.getBuilder(i.getZIndex(),"LineString");n.setFillStrokeStyle(null,r),n.drawMultiLineString(e,s)}const o=i.getText();if(o&&o.getText()){const r=(n||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(o),r.drawText(e,s)}},MultiPolygon:function(t,e,i,s,n){const r=i.getFill(),o=i.getStroke();if(o||r){const n=t.getBuilder(i.getZIndex(),"Polygon");n.setFillStrokeStyle(r,o),n.drawMultiPolygon(e,s)}const a=i.getText();if(a&&a.getText()){const r=(n||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(a),r.drawText(e,s)}},GeometryCollection:function(t,e,i,s,n){const r=e.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o)(0,mp[r[o].getType()])(t,r[o],i,s,n)},Circle:function(t,e,i,s,n){const r=i.getFill(),o=i.getStroke();if(r||o){const n=t.getBuilder(i.getZIndex(),"Circle");n.setFillStrokeStyle(r,o),n.drawCircle(e,s)}const a=i.getText();if(a&&a.getText()){const r=(n||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(a),r.drawText(e,s)}}};function yp(t,e){return parseInt(E(t),10)-parseInt(E(e),10)}function xp(t,e){return fp*t/e}function vp(t,e,i,s,n,r,o){let a=!1;const h=i.getImage();if(h){const t=h.getImageState();t==Xc.LOADED||t==Xc.ERROR?h.unlistenImageChange(n):(t==Xc.IDLE&&h.load(),h.listenImageChange(n),a=!0)}return function(t,e,i,s,n,r){const o=i.getGeometryFunction()(e);if(!o)return;const a=o.simplifyTransformed(s,n);i.getRenderer()?wp(t,a,i,e):(0,mp[a.getType()])(t,a,i,e,r)}(t,e,i,s,r,o),a}function wp(t,e,i,s){if("GeometryCollection"!=e.getType())t.getBuilder(i.getZIndex(),"Default").drawCustom(e,s,i.getRenderer(),i.getHitDetectionRenderer());else{const n=e.getGeometries();for(let e=0,r=n.length;e<r;++e)wp(t,n[e],i,s)}}const Mp=class extends Qg{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const s=e.extent,n=e.viewState,r=n.center,o=n.resolution,a=n.projection,h=n.rotation,l=a.getExtent(),c=this.getLayer().getSource(),u=e.pixelRatio,d=e.viewHints,g=!(d[0]||d[1]),p=this.compositionContext_,_=Math.round(e.size[0]*u),f=Math.round(e.size[1]*u),m=c.getWrapX()&&a.canWrapX(),y=m?Mt(l):null,x=m?Math.ceil((s[2]-l[2])/y)+1:1;let v=m?Math.floor((s[0]-l[0])/y):0;do{const e=this.getRenderTransform(r,o,h,u,_,f,v*y);t.execute(p,1,e,h,g,void 0,i)}while(++v<x)}setupCompositionContext_(){if(1!==this.opacity_){const t=Ee(this.context.canvas.width,this.context.canvas.height,Zg);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(1!==this.opacity_){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,Ce(this.compositionContext_),Zg.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const i=t.pixelRatio,s=t.layerStatesArray[t.layerIndex];!function(t,e,i){!function(t,e,i,s,n,r,o){t[0]=e,t[1]=i,t[2]=s,t[3]=n,t[4]=r,t[5]=o}(t,e,0,0,i,0,0)}(this.pixelTransform,1/i,1/i),V(this.inversePixelTransform,this.pixelTransform);const n=W(this.pixelTransform);this.useContainer(e,n,this.getBackground(t));const r=this.context,o=r.canvas,a=this.replayGroup_,h=this.declutterExecutorGroup;if((!a||a.isEmpty())&&(!h||h.isEmpty()))return null;const l=Math.round(t.size[0]*i),c=Math.round(t.size[1]*i);o.width!=l||o.height!=c?(o.width=l,o.height=c,o.style.transform!==n&&(o.style.transform=n)):this.containerReused||r.clearRect(0,0,l,c),this.preRender(r,t);const u=t.viewState,d=u.projection;this.opacity_=s.opacity,this.setupCompositionContext_();let g=!1,p=!0;if(s.extent&&this.clipping){const e=ns(s.extent,d);p=Et(e,t.extent),g=p&&!et(e,t.extent),g&&this.clipUnrotated(this.compositionContext_,t,e)}return p&&this.renderWorlds(a,t),g&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(r,t),this.renderedRotation_!==u.rotation&&(this.renderedRotation_=u.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise((e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const t=[this.context.canvas.width,this.context.canvas.height];U(this.pixelTransform,t);const e=this.renderedCenter_,i=this.renderedResolution_,s=this.renderedRotation_,r=this.renderedProjection_,o=this.wrappedRenderedExtent_,a=this.getLayer(),h=[],l=t[0]*_p,c=t[1]*_p;h.push(this.getRenderTransform(e,i,s,_p,l,c,0).slice());const u=a.getSource(),d=r.getExtent();if(u.getWrapX()&&r.canWrapX()&&!et(d,o)){let t=o[0];const n=Mt(d);let r,a=0;for(;t<d[0];)--a,r=n*a,h.push(this.getRenderTransform(e,i,s,_p,l,c,r).slice()),t+=n;for(a=0,t=o[2];t>d[2];)++a,r=n*a,h.push(this.getRenderTransform(e,i,s,_p,l,c,r).slice()),t-=n}this.hitDetectionImageData_=function(t,e,i,s,r,o,a){const h=Ee(t[0]*_p,t[1]*_p);h.imageSmoothingEnabled=!1;const l=h.canvas,c=new pp(h,_p,r,null,a),u=i.length,d=Math.floor(16777215/u),g={};for(let t=1;t<=u;++t){const e=i[t-1],n=e.getStyleFunction()||s;if(!s)continue;let a=n(e,o);if(!a)continue;Array.isArray(a)||(a=[a]);const h=(t*d).toString(16).padStart(7,"#00000");for(let t=0,i=a.length;t<i;++t){const i=a[t],s=i.getGeometryFunction()(e);if(!s||!Et(r,s.getExtent()))continue;const n=i.clone(),o=n.getFill();o&&o.setColor(h);const l=n.getStroke();l&&(l.setColor(h),l.setLineDash(null)),n.setText(void 0);const c=i.getImage();if(c&&0!==c.getOpacity()){const t=c.getImageSize();if(!t)continue;const e=Ee(t[0],t[1],void 0,{alpha:!1}),i=e.canvas;e.fillStyle=h,e.fillRect(0,0,i.width,i.height),n.setImage(new eu({img:i,imgSize:t,anchor:c.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:c.getOrigin(),opacity:1,size:c.getSize(),scale:c.getScale(),rotation:c.getRotation(),rotateWithView:c.getRotateWithView()}))}const u=n.getZIndex()||0;let d=g[u];d||(d={},g[u]=d,d.Polygon=[],d.Circle=[],d.LineString=[],d.Point=[]);const p=s.getType();if("GeometryCollection"===p){const t=s.getGeometriesArrayRecursive();for(let e=0,i=t.length;e<i;++e){const i=t[e];d[i.getType().replace("Multi","")].push(i,n)}}else d[p.replace("Multi","")].push(s,n)}}const p=Object.keys(g).map(Number).sort(n);for(let t=0,i=p.length;t<i;++t){const i=g[p[t]];for(const t in i){const s=i[t];for(let t=0,i=s.length;t<i;t+=2){c.setStyle(s[t+1]);for(let i=0,n=e.length;i<n;++i)c.setTransform(e[i]),c.drawGeometry(s[t])}}}return h.getImageData(0,0,l.width,l.height)}(t,h,this.renderedFeatures_,a.getStyleFunction(),o,i,s)}e(function(t,e,i){const s=[];if(i){const n=Math.floor(Math.round(t[0])*_p),r=Math.floor(Math.round(t[1])*_p),o=4*(bt(n,0,i.width-1)+bt(r,0,i.height-1)*i.width),a=i.data[o],h=i.data[o+1],l=i.data[o+2]+256*(h+256*a),c=Math.floor(16777215/e.length);l&&l%c==0&&s.push(e[l/c-1])}return s}(t,this.renderedFeatures_,this.hitDetectionImageData_))}))}forEachFeatureAtCoordinate(t,e,i,s,n){if(!this.replayGroup_)return;const r=e.viewState.resolution,o=e.viewState.rotation,a=this.getLayer(),h={},l=function(t,e,i){const r=E(t),o=h[r];if(o){if(!0!==o&&i<o.distanceSq){if(0===i)return h[r]=!0,n.splice(n.lastIndexOf(o),1),s(t,a,e);o.geometry=e,o.distanceSq=i}}else{if(0===i)return h[r]=!0,s(t,a,e);n.push(h[r]={feature:t,layer:a,geometry:e,distanceSq:i,callback:s})}};let c;const u=[this.replayGroup_];return this.declutterExecutorGroup&&u.push(this.declutterExecutorGroup),u.some((s=>c=s.forEachFeatureAtCoordinate(t,r,o,i,l,s===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map((t=>t.value)):null))),c}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const s=t.viewHints[0],n=t.viewHints[1],r=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(this.ready&&!r&&s||!o&&n)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const a=t.extent,l=t.viewState,c=l.projection,u=l.resolution,d=t.pixelRatio,g=e.getRevision(),p=e.getRenderBuffer();let _=e.getRenderOrder();void 0===_&&(_=yp);const f=l.center.slice(),m=Z(a,p*u),y=m.slice(),x=[m.slice()],v=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!et(v,t.extent)){const t=Mt(v),e=Math.max(Mt(m)/2,t);m[0]=v[0]-e,m[2]=v[2]+e,ue(f,c);const i=St(x[0],c);i[0]<v[0]&&i[2]<v[2]?x.push([i[0]+t,i[1],i[2]+t,i[3]]):i[0]>v[0]&&i[2]>v[2]&&x.push([i[0]-t,i[1],i[2]-t,i[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==g&&this.renderedRenderOrder_==_&&et(this.wrappedRenderedExtent_,m))return h(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=f,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const w=new Hg(xp(u,d),m,u,d);let M;this.getLayer().getDeclutter()&&(M=new Hg(xp(u,d),m,u,d));const E=ts();let C;if(E){for(let t=0,e=x.length;t<e;++t){const e=ss(x[t],c);i.loadFeatures(e,rs(u,c),E)}C=Hi(E,c)}else for(let t=0,e=x.length;t<e;++t)i.loadFeatures(x[t],u,c);const S=function(t,e){const i=xp(t,e);return i*i}(u,d);let b=!0;const I=t=>{let i;const s=t.getStyleFunction()||e.getStyleFunction();if(s&&(i=s(t,u)),i){const e=this.renderFeature(t,S,i,w,C,M);b=b&&!e}},L=ss(m,c),T=i.getFeaturesInExtent(L);_&&T.sort(_);for(let t=0,e=T.length;t<e;++t)I(T[t]);this.renderedFeatures_=T,this.ready=b;const N=w.finish(),R=new gp(m,u,d,i.getOverlaps(),N,e.getRenderBuffer());return M&&(this.declutterExecutorGroup=new gp(m,u,d,i.getOverlaps(),M.finish(),e.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=g,this.renderedRenderOrder_=_,this.renderedExtent_=y,this.wrappedRenderedExtent_=m,this.renderedCenter_=f,this.renderedProjection_=c,this.replayGroup_=R,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,s,n,r){if(!i)return!1;let o=!1;if(Array.isArray(i))for(let a=0,h=i.length;a<h;++a)o=vp(s,t,i[a],e,this.boundHandleStyleImageChange_,n,r)||o;else o=vp(s,t,i,e,this.boundHandleStyleImageChange_,n,r);return o}},Ep=class extends Dg{constructor(t){super(t)}createRenderer(){return new Mp(this)}};class Cp extends bs{constructor(t,e,i){super(),void 0!==i&&void 0===e?this.setFlatCoordinates(i,t):(e=e||0,this.setCenterAndRadius(t,e,i))}clone(){const t=new Cp(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){const n=this.flatCoordinates,r=t-n[0],o=e-n[1],a=r*r+o*o;if(a<s){if(0===a)for(let t=0;t<this.stride;++t)i[t]=n[t];else{const t=this.getRadius()/Math.sqrt(a);i[0]=n[0]+t*r,i[1]=n[1]+t*o;for(let t=2;t<this.stride;++t)i[t]=n[t]}return i.length=this.stride,a}return s}containsXY(t,e){const i=this.flatCoordinates,s=t-i[0],n=e-i[1];return s*s+n*n<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,i=e[this.stride]-e[0];return nt(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){if(Et(t,this.getExtent())){const e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||t[1]<=e[1]&&t[3]>=e[1]||gt(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],s=t.slice();s[e]=s[0]+i;for(let i=1;i<e;++i)s[e+i]=t[i];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let n=Ps(s,0,t,this.stride);s[n++]=s[0]+e;for(let t=1,e=this.stride;t<e;++t)s[n++]=s[t];s.length=n,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const i=this.getCenter(),s=this.getStride();this.setCenter(ws(i,0,i.length,s,t,e,i)),this.changed()}translate(t,e){const i=this.getCenter(),s=this.getStride();this.setCenter(Ms(i,0,i.length,s,t,e,i)),this.changed()}}Cp.prototype.transform;const Sp=Cp,bp="drawstart";class Ip extends t{constructor(t,e){super(t),this.feature=e}}function Lp(t,e){return Lt(t[0],t[1],e[0],e[1])}function Tp(t,e){const i=t.length;return e<0?t[e+i]:e>=i?t[e-i]:t[e]}function Np(t,e,i){let s,n;e<i?(s=e,n=i):(s=i,n=e);const r=Math.ceil(s),o=Math.floor(n);if(r>o)return Lp(Dp(t,s),Dp(t,n));let a=0;s<r&&(a+=Lp(Dp(t,s),Tp(t,r))),o<n&&(a+=Lp(Tp(t,o),Dp(t,n)));for(let e=r;e<o-1;++e)a+=Lp(Tp(t,e),Tp(t,e+1));return a}function Rp(t,e,i){if(e instanceof _l)Op(t,e.getCoordinates(),!1,i);else if(e instanceof ml){const s=e.getCoordinates();for(let e=0,n=s.length;e<n;++e)Op(t,s[e],!1,i)}else if(e instanceof hn){const s=e.getCoordinates();for(let e=0,n=s.length;e<n;++e)Op(t,s[e],!0,i)}else if(e instanceof xl){const s=e.getCoordinates();for(let e=0,n=s.length;e<n;++e){const n=s[e];for(let e=0,s=n.length;e<s;++e)Op(t,n[e],!0,i)}}else if(e instanceof Ml){const s=e.getGeometries();for(let e=0;e<s.length;++e)Rp(t,s[e],i)}}const Pp={index:-1,endIndex:NaN};function Op(t,e,i,s){const n=t[0],r=t[1];for(let t=0,o=e.length-1;t<o;++t){const o=Fp(n,r,e[t],e[t+1]);if(0===o.squaredDistance){const n=t+o.along;return void s.push({coordinates:e,ring:i,startIndex:n,endIndex:n})}}}const Ap={along:0,squaredDistance:0};function Fp(t,e,i,s){const n=i[0],r=i[1],o=s[0]-n,a=s[1]-r;let h=0,l=n,c=r;return 0===o&&0===a||(h=bt(((t-n)*o+(e-r)*a)/(o*o+a*a),0,1),l+=o*h,c+=a*h),Ap.along=h,Ap.squaredDistance=Ot(Lt(t,e,l,c),10),Ap}function Dp(t,e){const i=t.length;let s=Math.floor(e);const n=e-s;s>=i?s-=i:s<0&&(s+=i);let r=s+1;r>=i&&(r-=i);const o=t[s],a=o[0],h=o[1],l=t[r];return[a+(l[0]-a)*n,h+(l[1]-h)*n]}function kp(){const t=du();return function(e,i){return t[e.getGeometry().getType()]}}const Gp=class extends Cn{constructor(t){const e=t;e.stopDown||(e.stopDown=c),super(e),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=t.source?t.source:null,this.features_=t.features?t.features:null,this.snapTolerance_=t.snapTolerance?t.snapTolerance:12,this.type_=t.type,this.mode_=function(t){switch(t){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+t)}}(this.type_),this.stopClick_=!!t.stopClick,this.minPoints_=t.minPoints?t.minPoints:"Polygon"===this.mode_?3:2,this.maxPoints_="Circle"===this.mode_?2:t.maxPoints?t.maxPoints:1/0,this.finishCondition_=t.finishCondition?t.finishCondition:l,this.geometryLayout_=t.geometryLayout?t.geometryLayout:"XY";let i=t.geometryFunction;if(!i){const t=this.mode_;if("Circle"===t)i=function(t,e,i){const s=e||new Sp([NaN,NaN]),n=is(t[0],i),r=le(n,is(t[t.length-1],i));s.setCenterAndRadius(n,Math.sqrt(r),this.geometryLayout_);const o=ts();return o&&s.transform(i,o),s};else{let e;"Point"===t?e=Ws:"LineString"===t?e=_l:"Polygon"===t&&(e=hn),i=function(i,s,n){return s?"Polygon"===t?i[0].length?s.setCoordinates([i[0].concat([i[0][0]])],this.geometryLayout_):s.setCoordinates([],this.geometryLayout_):s.setCoordinates(i,this.geometryLayout_):s=new e(i,this.geometryLayout_),s}}}this.geometryFunction_=i,this.dragVertexDelay_=void 0!==t.dragVertexDelay?t.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,this.overlay_=new Ep({source:new Tg({useSpatialIndex:!1,wrapX:!!t.wrapX&&t.wrapX}),style:t.style?t.style:kp(),updateWhileInteracting:!0}),this.geometryName_=t.geometryName,this.condition_=t.condition?t.condition:Rn,this.freehandCondition_,t.freehand?this.freehandCondition_=Ln:this.freehandCondition_=t.freehandCondition?t.freehandCondition:Pn,this.traceCondition_,this.setTrace(t.trace||!1),this.traceState_={active:!1},this.traceSource_=t.traceSource||t.source||null,this.addChangeListener(xn,this.updateState_)}setTrace(t){let e;e=t?!0===t?Ln:t:Nn,this.traceCondition_=e}setMap(t){super.setMap(t),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(t){t.originalEvent.type===_.CONTEXTMENU&&t.originalEvent.preventDefault(),this.freehand_="Point"!==this.mode_&&this.freehandCondition_(t);let e=t.type===ei.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&t.type===ei.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,e=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&t.type===ei.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(t.coordinate),i=!1):this.freehand_&&t.type===ei.POINTERDOWN?i=!1:e&&this.getPointerCount()<2?(i=t.type===ei.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(t),this.shouldHandle_&&t.originalEvent.preventDefault()):("mouse"===t.originalEvent.pointerType||t.type===ei.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(t)):t.type===ei.DBLCLICK&&(i=!1),super.handleEvent(t)&&i}handleDownEvent(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t.coordinate),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout((()=>{this.handlePointerMove_(new ti(ei.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))}),this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(t){if(!this.traceSource_||!this.traceCondition_(t))return;if(this.traceState_.active)return void this.deactivateTrace_();const e=this.getMap(),i=K([e.getCoordinateFromPixel([t.pixel[0]-this.snapTolerance_,t.pixel[1]+this.snapTolerance_]),e.getCoordinateFromPixel([t.pixel[0]+this.snapTolerance_,t.pixel[1]-this.snapTolerance_])]),s=this.traceSource_.getFeaturesInExtent(i);if(0===s.length)return;const n=function(t,e){const i=[];for(let s=0;s<e.length;++s)Rp(t,e[s].getGeometry(),i);return i}(t.coordinate,s);n.length&&(this.traceState_={active:!0,startPx:t.pixel.slice(),targets:n,targetIndex:-1})}addOrRemoveTracedCoordinates_(t,e){const i=t.startIndex<=t.endIndex;i===t.startIndex<=e?i&&e>t.endIndex||!i&&e<t.endIndex?this.addTracedCoordinates_(t,t.endIndex,e):(i&&e<t.endIndex||!i&&e>t.endIndex)&&this.removeTracedCoordinates_(e,t.endIndex):(this.removeTracedCoordinates_(t.startIndex,t.endIndex),this.addTracedCoordinates_(t,t.startIndex,e))}removeTracedCoordinates_(t,e){if(t===e)return;let i=0;if(t<e){const s=Math.ceil(t);let n=Math.floor(e);n===e&&(n-=1),i=n-s+1}else{const s=Math.floor(t);let n=Math.ceil(e);n===e&&(n+=1),i=s-n+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(t,e,i){if(e===i)return;const s=[];if(e<i){const n=Math.ceil(e);let r=Math.floor(i);r===i&&(r-=1);for(let e=n;e<=r;++e)s.push(Tp(t.coordinates,e))}else{const n=Math.floor(e);let r=Math.ceil(i);r===i&&(r+=1);for(let e=n;e>=r;--e)s.push(Tp(t.coordinates,e))}s.length&&this.appendCoordinates(s)}updateTrace_(t){const e=this.traceState_;if(!e.active)return;if(-1===e.targetIndex&&ce(e.startPx,t.pixel)<this.snapTolerance_)return;const i=function(t,e,i,s){const n=t[0],r=t[1];let o=1/0,a=-1,h=NaN;for(let t=0;t<e.targets.length;++t){const i=e.targets[t],s=i.coordinates;let l,c=1/0;for(let t=0;t<s.length-1;++t){const e=Fp(n,r,s[t],s[t+1]);e.squaredDistance<c&&(c=e.squaredDistance,l=t+e.along)}c<o&&(o=c,i.ring&&e.targetIndex===t&&(i.endIndex>i.startIndex?l<i.startIndex&&(l+=s.length):i.endIndex<i.startIndex&&l>i.startIndex&&(l-=s.length)),h=l,a=t)}const l=e.targets[a];let c=l.ring;if(e.targetIndex===a&&c){const t=Dp(l.coordinates,h);ce(i.getPixelFromCoordinate(t),e.startPx)>s&&(c=!1)}if(c){const t=l.coordinates,e=t.length,i=l.startIndex,s=h;if(i<s){const n=Np(t,i,s);Np(t,i,s-e)<n&&(h-=e)}else{const n=Np(t,i,s);Np(t,i,s+e)<n&&(h+=e)}}return Pp.index=a,Pp.endIndex=h,Pp}(t.coordinate,e,this.getMap(),this.snapTolerance_);if(e.targetIndex!==i.index){if(-1!==e.targetIndex){const t=e.targets[e.targetIndex];this.removeTracedCoordinates_(t.startIndex,t.endIndex)}const t=e.targets[i.index];this.addTracedCoordinates_(t,t.startIndex,i.endIndex)}else{const t=e.targets[e.targetIndex];this.addOrRemoveTracedCoordinates_(t,i.endIndex)}e.targetIndex=i.index;const s=e.targets[e.targetIndex];s.endIndex=i.endIndex;const n=Dp(s.coordinates,s.endIndex),r=this.getMap().getPixelFromCoordinate(n);t.coordinate=n,t.pixel=[Math.round(r[0]),Math.round(r[1])]}handleUpEvent(t){let e=!0;if(0===this.getPointerCount()){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);const i=this.traceState_.active;if(this.toggleTraceState_(t),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(t.coordinate),!s&&this.freehand_?this.finishDrawing():this.freehand_||s&&"Point"!==this.mode_||(this.atFinish_(t.pixel,i)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate)),e=!1}else this.freehand_&&this.abortDrawing()}return!e&&this.stopClick_&&t.preventDefault(),e}handlePointerMove_(t){if(this.pointerType_=t.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const e=this.downPx_,i=t.pixel,s=e[0]-i[0],n=e[1]-i[1],r=s*s+n*n;if(this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(t),this.modifyDrawing_(t.coordinate)):this.createOrUpdateSketchPoint_(t.coordinate.slice())}atFinish_(t,e){let i=!1;if(this.sketchFeature_){let s=!1,n=[this.finishCoordinate_];const r=this.mode_;if("Point"===r)i=!0;else if("Circle"===r)i=2===this.sketchCoords_.length;else if("LineString"===r)s=!e&&this.sketchCoords_.length>this.minPoints_;else if("Polygon"===r){const t=this.sketchCoords_;s=t[0].length>this.minPoints_,n=[t[0][0],t[0][t[0].length-2]],n=e?[t[0][0]]:[t[0][0],t[0][t[0].length-2]]}if(s){const e=this.getMap();for(let s=0,r=n.length;s<r;s++){const r=n[s],o=e.getPixelFromCoordinate(r),a=t[0]-o[0],h=t[1]-o[1],l=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(a*a+h*h)<=l,i){this.finishCoordinate_=r;break}}}}return i}createOrUpdateSketchPoint_(t){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new hl(new Ws(t)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(t){this.sketchLine_||(this.sketchLine_=new hl);const e=t.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates()),i.changed()):(i=new _l(e.getFlatCoordinates(),e.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(t){const e=this.getMap().getView().getProjection(),i=Ss(this.geometryLayout_);for(;t.length<i;)t.push(0);this.finishCoordinate_=t,"Point"===this.mode_?this.sketchCoords_=t.slice():"Polygon"===this.mode_?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new hl(new _l(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,e);this.sketchFeature_=new hl,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new Ip(bp,this.sketchFeature_))}modifyDrawing_(t){const e=this.getMap(),i=this.sketchFeature_.getGeometry(),s=e.getView().getProjection(),n=Ss(this.geometryLayout_);let r,o;for(;t.length<n;)t.push(0);"Point"===this.mode_?o=this.sketchCoords_:"Polygon"===this.mode_?(r=this.sketchCoords_[0],o=r[r.length-1],this.atFinish_(e.getPixelFromCoordinate(t))&&(t=this.finishCoordinate_.slice())):(r=this.sketchCoords_,o=r[r.length-1]),o[0]=t[0],o[1]=t[1],this.geometryFunction_(this.sketchCoords_,i,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(t),"Polygon"===i.getType()&&"Polygon"!==this.mode_?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(t){const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let s,n;const r=this.mode_;"LineString"===r||"Circle"===r?(this.finishCoordinate_=t.slice(),n=this.sketchCoords_,n.length>=this.maxPoints_&&(this.freehand_?n.pop():s=!0),n.push(t.slice()),this.geometryFunction_(n,e,i)):"Polygon"===r&&(n=this.sketchCoords_[0],n.length>=this.maxPoints_&&(this.freehand_?n.pop():s=!0),n.push(t.slice()),s&&(this.finishCoordinate_=n[0]),this.geometryFunction_(this.sketchCoords_,e,i)),this.createOrUpdateSketchPoint_(t.slice()),this.updateSketchFeatures_(),s&&this.finishDrawing()}removeLastPoints_(t){if(!this.sketchFeature_)return;const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),s=this.mode_;for(let n=0;n<t;++n){let t;if("LineString"===s||"Circle"===s){if(t=this.sketchCoords_,t.splice(-2,1),t.length>=2){this.finishCoordinate_=t[t.length-2].slice();const e=this.finishCoordinate_.slice();t[t.length-1]=e,this.createOrUpdateSketchPoint_(e)}this.geometryFunction_(t,e,i),"Polygon"===e.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(e)}else if("Polygon"===s){t=this.sketchCoords_[0],t.splice(-2,1);const s=this.sketchLine_.getGeometry();if(t.length>=2){const e=t[t.length-2].slice();t[t.length-1]=e,this.createOrUpdateSketchPoint_(e)}s.setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e,i)}if(1===t.length){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const t=this.abortDrawing_();if(!t)return;let e=this.sketchCoords_;const i=t.getGeometry(),s=this.getMap().getView().getProjection();"LineString"===this.mode_?(e.pop(),this.geometryFunction_(e,i,s)):"Polygon"===this.mode_&&(e[0].pop(),this.geometryFunction_(e,i,s),e=i.getCoordinates()),"MultiPoint"===this.type_?t.setGeometry(new cl([e])):"MultiLineString"===this.type_?t.setGeometry(new ml([e])):"MultiPolygon"===this.type_&&t.setGeometry(new xl([e])),this.dispatchEvent(new Ip("drawend",t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}abortDrawing_(){this.finishCoordinate_=null;const t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),t}abortDrawing(){const t=this.abortDrawing_();t&&this.dispatchEvent(new Ip("drawabort",t))}appendCoordinates(t){const e=this.mode_,i=!this.sketchFeature_;let s;if(i&&this.startDrawing_(t[0]),"LineString"===e||"Circle"===e)s=this.sketchCoords_;else{if("Polygon"!==e)return;s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}i&&s.shift(),s.pop();for(let e=0;e<t.length;e++)this.addToDrawing_(t[e]);const n=t[t.length-1];this.addToDrawing_(n),this.modifyDrawing_(n)}extend(t){const e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();const i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.sketchPoint_=new hl(new Ws(i)),this.updateSketchFeatures_(),this.dispatchEvent(new Ip(bp,this.sketchFeature_))}updateSketchFeatures_(){const t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);const e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)}updateState_(){const t=this.getMap(),e=this.getActive();t&&e||this.abortDrawing(),this.overlay_.setMap(e?t:null)}},zp=1,Bp=[0,0,0,0],jp=[],qp="modifyend";class Up extends t{constructor(t,e,i){super(t),this.features=e,this.mapBrowserEvent=i}}function Yp(t,e){return t.index-e.index}function Vp(t,e,i){const s=e.geometry;if("Circle"===s.getType()){let n=s;if(e.index===zp){const e=ts();e&&(n=n.clone().transform(e,i));const s=le(n.getCenter(),is(t,i)),r=Math.sqrt(s)-n.getRadius();return r*r}}const n=is(t,i);return jp[0]=is(e.segment[0],i),jp[1]=is(e.segment[1],i),function(t,e){return le(t,oe(t,e))}(n,jp)}function Xp(t,e,i){const s=e.geometry;if("Circle"===s.getType()&&e.index===zp){let e=s;const n=ts();return n&&(e=e.clone().transform(n,i)),es(e.getClosestPoint(is(t,i)),i)}const n=is(t,i);return jp[0]=is(e.segment[0],i),jp[1]=is(e.segment[1],i),es(oe(n,jp),i)}function Wp(){const t=du();return function(e,i){return t.Point}}const $p=class extends Cn{constructor(t){let e;if(super(t),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=t.condition?t.condition:Fn,this.defaultDeleteCondition_=function(t){return function(t){const e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey}(t)&&function(t){return t.type==ei.SINGLECLICK}(t)},this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:Ln,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new vg,this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ep({source:new Tg({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:Wp(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null,t.features?e=t.features:t.source&&(this.source_=t.source,e=new O(this.source_.getFeatures()),this.source_.addEventListener(Eg,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Cg,this.handleSourceRemove_.bind(this))),!e)throw new Error("The modify interaction requires features, a source or a layer");t.hitDetection&&(this.hitDetection_=t.hitDetection),this.features_=e,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(T,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(N,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===t.snapToPointer?!this.hitDetection_:t.snapToPointer}addFeature_(t){const e=t.getGeometry();if(e){const i=this.SEGMENT_WRITERS_[e.getType()];i&&i(t,e)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),t.addEventListener(_.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(t,e){if(!this.featuresBeingModified_){this.featuresBeingModified_=new O;const i=this.featuresBeingModified_.getArray();for(let t=0,s=e.length;t<s;++t){const s=e[t];for(let t=0,e=s.length;t<e;++t){const e=s[t].feature;e&&!i.includes(e)&&this.featuresBeingModified_.push(e)}}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new Up("modifystart",this.featuresBeingModified_,t))}}removeFeature_(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(_.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(t){const e=this.rBush_,i=[];e.forEach((function(e){t===e.feature&&i.push(e)}));for(let t=i.length-1;t>=0;--t){const s=i[t];for(let t=this.dragSegments_.length-1;t>=0;--t)this.dragSegments_[t][0]===s&&this.dragSegments_.splice(t,1);e.remove(s)}}setActive(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(t)}setMap(t){this.overlay_.setMap(t),super.setMap(t)}getOverlay(){return this.overlay_}handleSourceAdd_(t){t.feature&&this.features_.push(t.feature)}handleSourceRemove_(t){t.feature&&this.features_.remove(t.feature)}handleFeatureAdd_(t){this.addFeature_(t.element)}handleFeatureChange_(t){if(!this.changingFeature_){const e=t.target;this.removeFeature_(e),this.addFeature_(e)}}handleFeatureRemove_(t){this.removeFeature_(t.element)}writePointGeometry_(t,e){const i=e.getCoordinates(),s={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),s)}writeMultiPointGeometry_(t,e){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s){const n=i[s],r={feature:t,geometry:e,depth:[s],index:s,segment:[n,n]};this.rBush_.insert(e.getExtent(),r)}}writeLineStringGeometry_(t,e){const i=e.getCoordinates();for(let s=0,n=i.length-1;s<n;++s){const n=i.slice(s,s+2),r={feature:t,geometry:e,index:s,segment:n};this.rBush_.insert(K(n),r)}}writeMultiLineStringGeometry_(t,e){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s){const n=i[s];for(let i=0,r=n.length-1;i<r;++i){const r=n.slice(i,i+2),o={feature:t,geometry:e,depth:[s],index:i,segment:r};this.rBush_.insert(K(r),o)}}}writePolygonGeometry_(t,e){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s){const n=i[s];for(let i=0,r=n.length-1;i<r;++i){const r=n.slice(i,i+2),o={feature:t,geometry:e,depth:[s],index:i,segment:r};this.rBush_.insert(K(r),o)}}}writeMultiPolygonGeometry_(t,e){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s){const n=i[s];for(let i=0,r=n.length;i<r;++i){const r=n[i];for(let n=0,o=r.length-1;n<o;++n){const o=r.slice(n,n+2),a={feature:t,geometry:e,depth:[i,s],index:n,segment:o};this.rBush_.insert(K(o),a)}}}}writeCircleGeometry_(t,e){const i=e.getCenter(),s={feature:t,geometry:e,index:0,segment:[i,i]},n={feature:t,geometry:e,index:zp,segment:[i,i]},r=[s,n];s.featureSegments=r,n.featureSegments=r,this.rBush_.insert(ot(i),s);let o=e;const a=ts();if(a&&this.getMap()){const t=this.getMap().getView().getProjection();o=o.clone().transform(a,t),o=cn(o).transform(t,a)}this.rBush_.insert(o.getExtent(),n)}writeGeometryCollectionGeometry_(t,e){const i=e.getGeometriesArray();for(let e=0;e<i.length;++e){const s=i[e];(0,this.SEGMENT_WRITERS_[s.getType()])(t,s)}}createOrUpdateVertexFeature_(t,e,i){let s=this.vertexFeature_;return s?s.getGeometry().setCoordinates(t):(s=new hl(new Ws(t)),this.vertexFeature_=s,this.overlay_.getSource().addFeature(s)),s.set("features",e),s.set("geometries",i),s}handleEvent(t){if(!t.originalEvent)return!0;let e;return this.lastPointerEvent_=t,t.map.getView().getInteracting()||t.type!=ei.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(e=!(t.type!=ei.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),t.type==ei.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(t)&&!e}handleDragEvent(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t,this.dragSegments_);const e=[t.coordinate[0]+this.delta_[0],t.coordinate[1]+this.delta_[1]],i=[],s=[];for(let n=0,r=this.dragSegments_.length;n<r;++n){const r=this.dragSegments_[n],o=r[0],a=o.feature;i.includes(a)||i.push(a);const h=o.geometry;s.includes(h)||s.push(h);const l=o.depth;let c;const u=o.segment,d=r[1];for(;e.length<h.getStride();)e.push(u[d][e.length]);switch(h.getType()){case"Point":c=e,u[0]=e,u[1]=e;break;case"MultiPoint":c=h.getCoordinates(),c[o.index]=e,u[0]=e,u[1]=e;break;case"LineString":c=h.getCoordinates(),c[o.index+d]=e,u[d]=e;break;case"MultiLineString":case"Polygon":c=h.getCoordinates(),c[l[0]][o.index+d]=e,u[d]=e;break;case"MultiPolygon":c=h.getCoordinates(),c[l[1]][l[0]][o.index+d]=e,u[d]=e;break;case"Circle":if(u[0]=e,u[1]=e,0===o.index)this.changingFeature_=!0,h.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0;const i=t.map.getView().getProjection();let s=ce(is(h.getCenter(),i),is(e,i));const n=ts();if(n){const t=h.clone().transform(n,i);t.setRadius(s),s=t.transform(i,n).getRadius()}h.setRadius(s),this.changingFeature_=!1}}c&&this.setGeometryCoordinates_(h,c)}this.createOrUpdateVertexFeature_(e,i,s)}handleDownEvent(t){if(!this.condition_(t))return!1;const e=t.coordinate;this.handlePointerAtPixel_(t.pixel,t.map,e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){const s=t.map.getView().getProjection(),n=[],r=i.getGeometry().getCoordinates(),o=K([r]),a=this.rBush_.getInExtent(o),h={};a.sort(Yp);for(let i=0,o=a.length;i<o;++i){const o=a[i],l=o.segment;let c=E(o.geometry);const u=o.depth;if(u&&(c+="-"+u.join("-")),h[c]||(h[c]=new Array(2)),"Circle"!==o.geometry.getType()||o.index!==zp)if(!ae(l[0],r)||h[c][0])if(!ae(l[1],r)||h[c][1])E(l)in this.vertexSegments_&&!h[c][0]&&!h[c][1]&&this.insertVertexCondition_(t)&&n.push(o);else{if(h[c][0]&&0===h[c][0].index){let t=o.geometry.getCoordinates();switch(o.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":t=t[u[1]];case"Polygon":if(o.index!==t[u[0]].length-2)continue}}this.dragSegments_.push([o,1]),h[c][1]=o}else this.dragSegments_.push([o,0]),h[c][0]=o;else ae(Xp(e,o,s),r)&&!h[c][0]&&(this.dragSegments_.push([o,0]),h[c][0]=o)}n.length&&this.willModifyFeatures_(t,[n]);for(let t=n.length-1;t>=0;--t)this.insertVertex_(n[t],r)}return!!this.vertexFeature_}handleUpEvent(t){for(let e=this.dragSegments_.length-1;e>=0;--e){const i=this.dragSegments_[e][0],s=i.geometry;if("Circle"===s.getType()){const e=s.getCenter(),n=i.featureSegments[0],r=i.featureSegments[1];n.segment[0]=e,n.segment[1]=e,r.segment[0]=e,r.segment[1]=e,this.rBush_.update(ot(e),n);let o=s;const a=ts();if(a){const e=t.map.getView().getProjection();o=o.clone().transform(a,e),o=cn(o).transform(e,a)}this.rBush_.update(o.getExtent(),r)}else this.rBush_.update(K(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Up(qp,this.featuresBeingModified_,t)),this.featuresBeingModified_=null),!1}handlePointerMove_(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map,t.coordinate)}handlePointerAtPixel_(t,e,i){const s=i||e.getCoordinateFromPixel(t),n=e.getView().getProjection(),r=function(t,e){return Vp(s,t,n)-Vp(s,e,n)};let o,a;if(this.hitDetection_){const i="object"==typeof this.hitDetection_?t=>t===this.hitDetection_:void 0;e.forEachFeatureAtPixel(t,((t,e,i)=>{const s=i||t.getGeometry();if("Point"===s.getType()&&t instanceof hl&&this.features_.getArray().includes(t)){a=s;const e=a.getFlatCoordinates().slice(0,2);o=[{feature:t,geometry:a,segment:[e,e]}]}return!0}),{layerFilter:i})}if(!o){const t=ss(Z(ns(ot(s,Bp),n),e.getView().getResolution()*this.pixelTolerance_,Bp),n);o=this.rBush_.getInExtent(t)}if(o&&o.length>0){const i=o.sort(r)[0],h=i.segment;let l=Xp(s,i,n);const c=e.getPixelFromCoordinate(l);let u=ce(t,c);if(a||u<=this.pixelTolerance_){const t={};if(t[E(h)]=!0,this.snapToPointer_||(this.delta_[0]=l[0]-s[0],this.delta_[1]=l[1]-s[1]),"Circle"===i.geometry.getType()&&i.index===zp)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(l,[i.feature],[i.geometry]);else{const s=e.getPixelFromCoordinate(h[0]),n=e.getPixelFromCoordinate(h[1]),r=le(c,s),a=le(c,n);u=Math.sqrt(Math.min(r,a)),this.snappedToVertex_=u<=this.pixelTolerance_,this.snappedToVertex_&&(l=r>a?h[1]:h[0]),this.createOrUpdateVertexFeature_(l,[i.feature],[i.geometry]);const d={};d[E(i.geometry)]=!0;for(let e=1,i=o.length;e<i;++e){const i=o[e].segment;if(!(ae(h[0],i[0])&&ae(h[1],i[1])||ae(h[0],i[1])&&ae(h[1],i[0])))break;{const s=E(o[e].geometry);s in d||(d[s]=!0,t[E(i)]=!0)}}}return void(this.vertexSegments_=t)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(t,e){const i=t.segment,s=t.feature,n=t.geometry,r=t.depth,o=t.index;let a;for(;e.length<n.getStride();)e.push(0);switch(n.getType()){case"MultiLineString":case"Polygon":a=n.getCoordinates(),a[r[0]].splice(o+1,0,e);break;case"MultiPolygon":a=n.getCoordinates(),a[r[1]][r[0]].splice(o+1,0,e);break;case"LineString":a=n.getCoordinates(),a.splice(o+1,0,e);break;default:return}this.setGeometryCoordinates_(n,a);const h=this.rBush_;h.remove(t),this.updateSegmentIndices_(n,o,r,1);const l={segment:[i[0],e],feature:s,geometry:n,depth:r,index:o};h.insert(K(l.segment),l),this.dragSegments_.push([l,1]);const c={segment:[e,i[1]],feature:s,geometry:n,depth:r,index:o+1};h.insert(K(c.segment),c),this.dragSegments_.push([c,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=ei.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_);const e=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Up(qp,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,e}return!1}removeVertex_(){const t=this.dragSegments_,e={};let i,s,n,r,o,a,h,l,c,u,d,g=!1;for(o=t.length-1;o>=0;--o)n=t[o],u=n[0],d=E(u.feature),u.depth&&(d+="-"+u.depth.join("-")),d in e||(e[d]={}),0===n[1]?(e[d].right=u,e[d].index=u.index):1==n[1]&&(e[d].left=u,e[d].index=u.index+1);for(d in e){switch(c=e[d].right,h=e[d].left,a=e[d].index,l=a-1,u=void 0!==h?h:c,l<0&&(l=0),r=u.geometry,s=r.getCoordinates(),i=s,g=!1,r.getType()){case"MultiLineString":s[u.depth[0]].length>2&&(s[u.depth[0]].splice(a,1),g=!0);break;case"LineString":s.length>2&&(s.splice(a,1),g=!0);break;case"MultiPolygon":i=i[u.depth[1]];case"Polygon":i=i[u.depth[0]],i.length>4&&(a==i.length-1&&(a=0),i.splice(a,1),g=!0,0===a&&(i.pop(),i.push(i[0]),l=i.length-1))}if(g){this.setGeometryCoordinates_(r,s);const e=[];if(void 0!==h&&(this.rBush_.remove(h),e.push(h.segment[0])),void 0!==c&&(this.rBush_.remove(c),e.push(c.segment[1])),void 0!==h&&void 0!==c){const t={depth:u.depth,feature:u.feature,geometry:u.geometry,index:l,segment:e};this.rBush_.insert(K(t.segment),t)}this.updateSegmentIndices_(r,a,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.length=0}}return g}setGeometryCoordinates_(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1}updateSegmentIndices_(t,e,i,s){this.rBush_.forEachInExtent(t.getExtent(),(function(n){n.geometry===t&&(void 0===i||void 0===n.depth||h(n.depth,i))&&n.index>e&&(n.index+=s)}))}};class Hp{constructor(){}init(t="Point",e=-1,i=!0,s){this._drawSource&&this.clear(),jy.newOlMap=!0,this._drawSource=new Tg,this._dispatchAddFeature=()=>{qy.dispatch("draw.addFeature")},this._dispatchModifyEnd=()=>{qy.dispatch("draw.modifyEnd")},this._drawSource.on("addfeature",this._dispatchAddFeature),this._drawLayer=new Ep({source:this._drawSource,style:void 0!==s?s:new pu({fill:new Vc({color:"rgba(255, 255, 255, 0.2)"}),stroke:new su({color:"#ffcc33",width:2}),image:new hu({radius:7,fill:new Vc({color:"#ffcc33"})})})}),jy.map.addLayer(this._drawLayer),this._drawInteraction=new Gp({source:this._drawSource,type:t}),this._drawInteraction.on("drawend",(()=>{-1!==e&&this._drawSource.getFeatures().length===e-1&&jy.map.removeInteraction(this._drawInteraction)})),jy.map.addInteraction(this._drawInteraction),i&&(this._modifyInteraction=new $p({source:this._drawSource}),this._modifyInteraction.on("modifyend",this._dispatchModifyEnd),jy.map.addInteraction(this._modifyInteraction))}clear(){this._drawSource.clear(!0),this._drawSource.un("addfeature",this._dispatchAddFeature),jy.map.removeLayer(this._drawLayer),jy.map.removeInteraction(this._drawInteraction),this._modifyInteraction.un("modifyend",this._dispatchModifyEnd),jy.map.removeInteraction(this._modifyInteraction)}set visible(t){this._drawLayer.setVisible(t),jy.newOlMap=t}get features(){return this._drawSource.getFeatures()}}function Kp(t){return"string"==typeof t?t:""}const Zp=class extends El{constructor(){super()}getType(){return"text"}readFeature(t,e){return this.readFeatureFromText(Kp(t),this.adaptOptions(e))}readFeatureFromText(t,e){return w()}readFeatures(t,e){return this.readFeaturesFromText(Kp(t),this.adaptOptions(e))}readFeaturesFromText(t,e){return w()}readGeometry(t,e){return this.readGeometryFromText(Kp(t),this.adaptOptions(e))}readGeometryFromText(t,e){return w()}readProjection(t){return this.readProjectionFromText(Kp(t))}readProjectionFromText(t){return this.dataProjection}writeFeature(t,e){return this.writeFeatureText(t,this.adaptOptions(e))}writeFeatureText(t,e){return w()}writeFeatures(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))}writeFeaturesText(t,e){return w()}writeGeometry(t,e){return this.writeGeometryText(t,this.adaptOptions(e))}writeGeometryText(t,e){return w()}},Jp={POINT:Ws,LINESTRING:_l,POLYGON:hn,MULTIPOINT:cl,MULTILINESTRING:ml,MULTIPOLYGON:xl},Qp="EMPTY",t_="Z",e_="M",i_={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class s_{constructor(t){this.wkt=t,this.index_=-1}isAlpha_(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}isNumeric_(t,e){return e=void 0!==e&&e,t>="0"&&t<="9"||"."==t&&!e}isWhiteSpace_(t){return" "==t||"\t"==t||"\r"==t||"\n"==t}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const t=this.nextChar_(),e=this.index_;let i,s=t;if("("==t)i=2;else if(","==t)i=5;else if(")"==t)i=3;else if(this.isNumeric_(t)||"-"==t)i=4,s=this.readNumber_();else if(this.isAlpha_(t))i=1,s=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(""!==t)throw new Error("Unexpected character: "+t);i=6}return{position:e,value:s,type:i}}readNumber_(){let t;const e=this.index_;let i=!1,s=!1;do{"."==t?i=!0:"e"!=t&&"E"!=t||(s=!0),t=this.nextChar_()}while(this.isNumeric_(t,i)||!s&&("e"==t||"E"==t)||s&&("-"==t||"+"==t));return parseFloat(this.wkt.substring(e,this.index_--))}readText_(){let t;const e=this.index_;do{t=this.nextChar_()}while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()}}class n_{constructor(t){this.lexer_=t,this.token_={position:0,type:0},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(t){return this.token_.type==t}match(t){const e=this.isTokenType(t);return e&&this.consume_(),e}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let t="XY";const e=this.token_;if(this.isTokenType(1)){const i=e.value;i===t_?t="XYZ":i===e_?t="XYM":"ZM"===i&&(t="XYZM"),"XY"!==t&&this.consume_()}return t}parseGeometryCollectionText_(){if(this.match(2)){const t=[];do{t.push(this.parseGeometry_())}while(this.match(5));if(this.match(3))return t}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(2)){const t=this.parsePoint_();if(this.match(3))return t}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(2)){const t=this.parsePointList_();if(this.match(3))return t}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(2)){const t=this.parseLineStringTextList_();if(this.match(3))return t}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(2)){let t;if(t=2==this.token_.type?this.parsePointTextList_():this.parsePointList_(),this.match(3))return t}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(2)){const t=this.parseLineStringTextList_();if(this.match(3))return t}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(2)){const t=this.parsePolygonTextList_();if(this.match(3))return t}throw new Error(this.formatErrorMessage_())}parsePoint_(){const t=[],e=this.layout_.length;for(let i=0;i<e;++i){const e=this.token_;if(!this.match(4))break;t.push(e.value)}if(t.length==e)return t;throw new Error(this.formatErrorMessage_())}parsePointList_(){const t=[this.parsePoint_()];for(;this.match(5);)t.push(this.parsePoint_());return t}parsePointTextList_(){const t=[this.parsePointText_()];for(;this.match(5);)t.push(this.parsePointText_());return t}parseLineStringTextList_(){const t=[this.parseLineStringText_()];for(;this.match(5);)t.push(this.parseLineStringText_());return t}parsePolygonTextList_(){const t=[this.parsePolygonText_()];for(;this.match(5);)t.push(this.parsePolygonText_());return t}isEmptyGeometry_(){const t=this.isTokenType(1)&&this.token_.value==Qp;return t&&this.consume_(),t}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const t=this.token_;if(this.match(1)){const e=t.value;this.layout_=this.parseGeometryLayout_();const i=this.isEmptyGeometry_();if("GEOMETRYCOLLECTION"==e){if(i)return new Ml([]);const t=this.parseGeometryCollectionText_();return new Ml(t)}const s=Jp[e];if(!s)throw new Error("Invalid geometry type: "+e);let n;if(i)n="POINT"==e?[NaN,NaN]:[];else switch(e){case"POINT":n=this.parsePointText_();break;case"LINESTRING":n=this.parseLineStringText_();break;case"POLYGON":n=this.parsePolygonText_();break;case"MULTIPOINT":n=this.parseMultiPointText_();break;case"MULTILINESTRING":n=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":n=this.parseMultiPolygonText_()}return new s(n,this.layout_)}throw new Error(this.formatErrorMessage_())}}function r_(t){const e=t.getCoordinates();return 0===e.length?"":e.join(" ")}function o_(t){const e=t.getCoordinates(),i=[];for(let t=0,s=e.length;t<s;++t)i.push(e[t].join(" "));return i.join(",")}function a_(t){const e=[],i=t.getLinearRings();for(let t=0,s=i.length;t<s;++t)e.push("("+o_(i[t])+")");return e.join(",")}const h_={Point:r_,LineString:o_,Polygon:a_,MultiPoint:function(t){const e=[],i=t.getPoints();for(let t=0,s=i.length;t<s;++t)e.push("("+r_(i[t])+")");return e.join(",")},MultiLineString:function(t){const e=[],i=t.getLineStrings();for(let t=0,s=i.length;t<s;++t)e.push("("+o_(i[t])+")");return e.join(",")},MultiPolygon:function(t){const e=[],i=t.getPolygons();for(let t=0,s=i.length;t<s;++t)e.push("("+a_(i[t])+")");return e.join(",")},GeometryCollection:function(t){const e=[],i=t.getGeometries();for(let t=0,s=i.length;t<s;++t)e.push(l_(i[t]));return e.join(",")}};function l_(t){const e=t.getType(),i=(0,h_[e])(t);let s=i_[e];if("function"==typeof t.getFlatCoordinates){const e=function(t){const e=t.getLayout();let i="";return"XYZ"!==e&&"XYZM"!==e||(i+=t_),"XYM"!==e&&"XYZM"!==e||(i+=e_),i}(t);e.length>0&&(s+=" "+e)}return 0===i.length?s+" "+Qp:s+"("+i+")"}const c_=class extends Zp{constructor(t){super(),t=t||{},this.splitCollection_=void 0!==t.splitCollection&&t.splitCollection}parse_(t){const e=new s_(t);return new n_(e).parse()}readFeatureFromText(t,e){const i=this.readGeometryFromText(t,e),s=new hl;return s.setGeometry(i),s}readFeaturesFromText(t,e){let i=[];const s=this.readGeometryFromText(t,e);i=this.splitCollection_&&"GeometryCollection"==s.getType()?s.getGeometriesArray():[s];const n=[];for(let t=0,e=i.length;t<e;++t){const e=new hl;e.setGeometry(i[t]),n.push(e)}return n}readGeometryFromText(t,e){return Cl(this.parse_(t),!1,e)}writeFeatureText(t,e){const i=t.getGeometry();return i?this.writeGeometryText(i,e):""}writeFeaturesText(t,e){if(1==t.length)return this.writeFeatureText(t[0],e);const i=[];for(let e=0,s=t.length;e<s;++e)i.push(t[e].getGeometry());const s=new Ml(i);return this.writeGeometryText(s,e)}writeGeometryText(t,e){return l_(Cl(t,!0,e))}};class u_{constructor(){}addLayerFromWKT(t,e="EPSG:4326",i){const s=(new c_).readFeature(t,{dataProjection:e,featureProjection:jy.projection}),n=new Ep({source:new Tg({features:[s]}),style:i});return jy.map.addLayer(n),n}addLayerFromGeoJSON(t,e="EPSG:4326",i){const s=new Ep({source:new Tg({features:(new Tl).readFeatures(t,{dataProjection:e,featureProjection:jy.projection})}),style:i});return jy.map.addLayer(s),s}removeLayer(t){for(const e of jy.map.getLayers().getArray())e===t&&jy.map.removeLayer(t)}}class d_{constructor(){this._defaultGetFeatureParameters={repository:lizUrls.params.repository,project:lizUrls.params.project,SERVICE:"WFS",REQUEST:"GetFeature",VERSION:"1.0.0",OUTPUTFORMAT:"GeoJSON"},this._defaultDescribeFeatureTypeParameters={repository:lizUrls.params.repository,project:lizUrls.params.project,SERVICE:"WFS",REQUEST:"DescribeFeatureType",VERSION:"1.0.0",OUTPUTFORMAT:"JSON"}}async getFeature(t){const e=await fetch(lizUrls.wms,{method:"POST",body:new URLSearchParams({...this._defaultGetFeatureParameters,...t})});return await e.json()}async describeFeatureType(t){const e=await fetch(lizUrls.wms,{method:"POST",body:new URLSearchParams({...this._defaultDescribeFeatureTypeParameters,...t})});return await e.json()}}class g_{constructor(){this._defaultGetFeatureInfoParameters={repository:lizUrls.params.repository,project:lizUrls.params.project,SERVICE:"WMS",REQUEST:"GetFeatureInfo",VERSION:"1.3.0",SRS:"EPSG:4326",INFO_FORMAT:"text/html"}}async getFeatureInfo(t){const e=await fetch(lizUrls.wms,{method:"POST",body:new URLSearchParams({...this._defaultGetFeatureInfoParameters,...t})});return await e.text()}}let p_=null;var __=1,f_=2,m_=3,y_=5,x_=6378137,v_=6356752.314,w_=.0066943799901413165,M_=484813681109536e-20,E_=Math.PI/2,C_=.16666666666666666,S_=.04722222222222222,b_=.022156084656084655,I_=1e-10,L_=.017453292519943295,T_=57.29577951308232,N_=Math.PI/4,R_=2*Math.PI,P_=3.14159265359,O_={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};const A_={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var F_=/[\s_\-\/\(\)]/g;function D_(t,e){if(t[e])return t[e];for(var i,s=Object.keys(t),n=e.toLowerCase().replace(F_,""),r=-1;++r<s.length;)if((i=s[r]).toLowerCase().replace(F_,"")===n)return t[i]}function k_(t){var e,i,s,n={},r=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,e){var i=e.split("=");return i.push(!0),t[i[0].toLowerCase()]=i[1],t}),{}),o={proj:"projName",datum:"datumCode",rf:function(t){n.rf=parseFloat(t)},lat_0:function(t){n.lat0=t*L_},lat_1:function(t){n.lat1=t*L_},lat_2:function(t){n.lat2=t*L_},lat_ts:function(t){n.lat_ts=t*L_},lon_0:function(t){n.long0=t*L_},lon_1:function(t){n.long1=t*L_},lon_2:function(t){n.long2=t*L_},alpha:function(t){n.alpha=parseFloat(t)*L_},gamma:function(t){n.rectified_grid_angle=parseFloat(t)},lonc:function(t){n.longc=t*L_},x_0:function(t){n.x0=parseFloat(t)},y_0:function(t){n.y0=parseFloat(t)},k_0:function(t){n.k0=parseFloat(t)},k:function(t){n.k0=parseFloat(t)},a:function(t){n.a=parseFloat(t)},b:function(t){n.b=parseFloat(t)},r_a:function(){n.R_A=!0},zone:function(t){n.zone=parseInt(t,10)},south:function(){n.utmSouth=!0},towgs84:function(t){n.datum_params=t.split(",").map((function(t){return parseFloat(t)}))},to_meter:function(t){n.to_meter=parseFloat(t)},units:function(t){n.units=t;var e=D_(A_,t);e&&(n.to_meter=e.to_meter)},from_greenwich:function(t){n.from_greenwich=t*L_},pm:function(t){var e=D_(O_,t);n.from_greenwich=(e||parseFloat(t))*L_},nadgrids:function(t){"@null"===t?n.datumCode="none":n.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&-1!==e.indexOf(t.substr(0,1))&&-1!==e.indexOf(t.substr(1,1))&&-1!==e.indexOf(t.substr(2,1))&&(n.axis=t)},approx:function(){n.approx=!0}};for(e in r)i=r[e],e in o?"function"==typeof(s=o[e])?s(i):n[s]=i:n[e]=i;return"string"==typeof n.datumCode&&"WGS84"!==n.datumCode&&(n.datumCode=n.datumCode.toLowerCase()),n}const G_=function(t){return new V_(t).output()};var z_=1,B_=/\s/,j_=/[A-Za-z]/,q_=/[A-Za-z84_]/,U_=/[,\]]/,Y_=/[\d\.E\-\+]/;function V_(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=z_}function X_(t,e,i){Array.isArray(e)&&(i.unshift(e),e=null);var s=e?{}:t,n=i.reduce((function(t,e){return W_(e,t),t}),s);e&&(t[e]=n)}function W_(t,e){if(Array.isArray(t)){var i=t.shift();if("PARAMETER"===i&&(i=t.shift()),1===t.length)return Array.isArray(t[0])?(e[i]={},void W_(t[0],e[i])):void(e[i]=t[0]);if(t.length)if("TOWGS84"!==i){if("AXIS"===i)return i in e||(e[i]=[]),void e[i].push(t);var s;switch(Array.isArray(i)||(e[i]={}),i){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[i]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&W_(t[2],e[i]));case"SPHEROID":case"ELLIPSOID":return e[i]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&W_(t[3],e[i]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void X_(e,i,t);default:for(s=-1;++s<t.length;)if(!Array.isArray(t[s]))return W_(t,e[i]);return X_(e,i,t)}}else e[i]=t;else e[i]=!0}else e[t]=!0}V_.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;B_.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case z_:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},V_.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(U_.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},V_.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=z_)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=z_,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},V_.prototype.number=function(t){if(!Y_.test(t)){if(U_.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},V_.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},V_.prototype.keyword=function(t){if(q_.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=z_)}if(!U_.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},V_.prototype.neutral=function(t){if(j_.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(Y_.test(t))return this.word=t,void(this.state=3);if(!U_.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},V_.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var $_=.017453292519943295;function H_(t){return t*$_}function K_(t){var e=G_(t),i=e.shift(),s=e.shift();e.unshift(["name",s]),e.unshift(["type",i]);var n={};return W_(e,n),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",i=0,s=t.AXIS.length;i<s;++i){var n=[t.AXIS[i][0].toLowerCase(),t.AXIS[i][1].toLowerCase()];-1!==n[0].indexOf("north")||("y"===n[0]||"lat"===n[0])&&"north"===n[1]?e+="n":-1!==n[0].indexOf("south")||("y"===n[0]||"lat"===n[0])&&"south"===n[1]?e+="s":-1!==n[0].indexOf("east")||("x"===n[0]||"lon"===n[0])&&"east"===n[1]?e+="e":-1===n[0].indexOf("west")&&("x"!==n[0]&&"lon"!==n[0]||"west"!==n[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var r=t.GEOGCS;function o(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(r=t),r&&(r.DATUM?t.datumCode=r.DATUM.name.toLowerCase():t.datumCode=r.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),r.DATUM&&r.DATUM.SPHEROID&&(t.ellps=r.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=r.DATUM.SPHEROID.a,t.rf=parseFloat(r.DATUM.SPHEROID.rf,10)),r.DATUM&&r.DATUM.TOWGS84&&(t.datum_params=r.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",H_],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",H_],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",H_],["lat0","latitude_of_origin",H_],["lat0","standard_parallel_1",H_],["lat1","standard_parallel_1",H_],["lat2","standard_parallel_2",H_],["azimuth","Azimuth"],["alpha","azimuth",H_],["srsCode","name"]].forEach((function(e){return function(t,e){var i=e[0],s=e[1];!(i in t)&&s in t&&(t[i]=t[s],3===e.length&&(t[i]=e[2](t[i])))}(t,e)})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=H_(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(n),n}function Z_(t){var e=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?Z_[t]=k_(arguments[1]):Z_[t]=K_(arguments[1]):Z_[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?Z_.apply(e,t):Z_(t)}));if("string"==typeof t){if(t in Z_)return Z_[t]}else"EPSG"in t?Z_["EPSG:"+t.EPSG]=t:"ESRI"in t?Z_["ESRI:"+t.ESRI]=t:"IAU2000"in t?Z_["IAU2000:"+t.IAU2000]=t:console.log(t);return}}!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(Z_);const J_=Z_;var Q_=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],tf=["3857","900913","3785","102113"];const ef=function(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in J_}(t))return J_[t];if(function(t){return Q_.some((function(e){return t.indexOf(e)>-1}))}(t)){var e=K_(t);if(function(t){var e=D_(t,"authority");if(e){var i=D_(e,"epsg");return i&&tf.indexOf(i)>-1}}(e))return J_["EPSG:3857"];var i=function(t){var e=D_(t,"extension");if(e)return D_(e,"proj4")}(e);return i?k_(i):e}return function(t){return"+"===t[0]}(t)?k_(t):void 0};function sf(t,e){var i,s;if(t=t||{},!e)return t;for(s in e)void 0!==(i=e[s])&&(t[s]=i);return t}function nf(t,e,i){var s=t*e;return i/Math.sqrt(1-s*s)}function rf(t){return t<0?-1:1}function of(t){return Math.abs(t)<=P_?t:t-rf(t)*R_}function af(t,e,i){var s=t*i,n=.5*t;return s=Math.pow((1-s)/(1+s),n),Math.tan(.5*(E_-e))/s}function hf(t,e){for(var i,s,n=.5*t,r=E_-2*Math.atan(e),o=0;o<=15;o++)if(i=t*Math.sin(r),r+=s=E_-2*Math.atan(e*Math.pow((1-i)/(1+i),n))-r,Math.abs(s)<=1e-10)return r;return-9999}const lf={init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=nf(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,i,s=t.x,n=t.y;if(n*T_>90&&n*T_<-90&&s*T_>180&&s*T_<-180)return null;if(Math.abs(Math.abs(n)-E_)<=I_)return null;if(this.sphere)e=this.x0+this.a*this.k0*of(s-this.long0),i=this.y0+this.a*this.k0*Math.log(Math.tan(N_+.5*n));else{var r=Math.sin(n),o=af(this.e,n,r);e=this.x0+this.a*this.k0*of(s-this.long0),i=this.y0-this.a*this.k0*Math.log(o)}return t.x=e,t.y=i,t},inverse:function(t){var e,i,s=t.x-this.x0,n=t.y-this.y0;if(this.sphere)i=E_-2*Math.atan(Math.exp(-n/(this.a*this.k0)));else{var r=Math.exp(-n/(this.a*this.k0));if(-9999===(i=hf(this.e,r)))return null}return e=of(this.long0+s/(this.a*this.k0)),t.x=e,t.y=i,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]};function cf(t){return t}var uf=[lf,{init:function(){},forward:cf,inverse:cf,names:["longlat","identity"]}],df={},gf=[];function pf(t,e){var i=gf.length;return t.names?(gf[i]=t,t.names.forEach((function(t){df[t.toLowerCase()]=i})),this):(console.log(e),!0)}const _f={start:function(){uf.forEach(pf)},add:pf,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==df[e]&&gf[df[e]]?gf[df[e]]:void 0}};var ff={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},mf=ff.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};ff.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var yf={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};const xf=function(t,e,i,s,n,r,o){var a={};return a.datum_type=void 0===t||"none"===t?y_:4,e&&(a.datum_params=e.map(parseFloat),0===a.datum_params[0]&&0===a.datum_params[1]&&0===a.datum_params[2]||(a.datum_type=__),a.datum_params.length>3&&(0===a.datum_params[3]&&0===a.datum_params[4]&&0===a.datum_params[5]&&0===a.datum_params[6]||(a.datum_type=f_,a.datum_params[3]*=M_,a.datum_params[4]*=M_,a.datum_params[5]*=M_,a.datum_params[6]=a.datum_params[6]/1e6+1))),o&&(a.datum_type=m_,a.grids=o),a.a=i,a.b=s,a.es=n,a.ep2=r,a};var vf={};function wf(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:vf[t]||null,isNull:!1}}function Mf(t){return t/3600*Math.PI/180}function Ef(t,e,i){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,i)))}function Cf(t){return t.map((function(t){return[Mf(t.longitudeShift),Mf(t.latitudeShift)]}))}function Sf(t,e,i){return{name:Ef(t,e+8,e+16).trim(),parent:Ef(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,i),upperLatitude:t.getFloat64(e+88,i),lowerLongitude:t.getFloat64(e+104,i),upperLongitude:t.getFloat64(e+120,i),latitudeInterval:t.getFloat64(e+136,i),longitudeInterval:t.getFloat64(e+152,i),gridNodeCount:t.getInt32(e+168,i)}}function bf(t,e,i,s){for(var n=e+176,r=[],o=0;o<i.gridNodeCount;o++){var a={latitudeShift:t.getFloat32(n+16*o,s),longitudeShift:t.getFloat32(n+16*o+4,s),latitudeAccuracy:t.getFloat32(n+16*o+8,s),longitudeAccuracy:t.getFloat32(n+16*o+12,s)};r.push(a)}return r}function If(t,e){if(!(this instanceof If))return new If(t);e=e||function(t){if(t)throw t};var i=ef(t);if("object"==typeof i){var s=If.projections.get(i.projName);if(s){if(i.datumCode&&"none"!==i.datumCode){var n=D_(yf,i.datumCode);n&&(i.datum_params=i.datum_params||(n.towgs84?n.towgs84.split(","):null),i.ellps=n.ellipse,i.datumName=n.datumName?n.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84",i.lat1=i.lat1||i.lat0;var r=function(t,e,i,s,n){if(!t){var r=D_(ff,s);r||(r=mf),t=r.a,e=r.b,i=r.rf}return i&&!e&&(e=(1-1/i)*t),(0===i||Math.abs(t-e)<I_)&&(n=!0,e=t),{a:t,b:e,rf:i,sphere:n}}(i.a,i.b,i.rf,i.ellps,i.sphere),o=function(t,e,i,s){var n=t*t,r=e*e,o=(n-r)/n,a=0;return s?(n=(t*=1-o*(C_+o*(S_+o*b_)))*t,o=0):a=Math.sqrt(o),{es:o,e:a,ep2:(n-r)/r}}(r.a,r.b,r.rf,i.R_A),a=function(t){return void 0===t?null:t.split(",").map(wf)}(i.nadgrids),h=i.datum||xf(i.datumCode,i.datum_params,r.a,r.b,o.es,o.ep2,a);sf(this,i),sf(this,s),this.a=r.a,this.b=r.b,this.rf=r.rf,this.sphere=r.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=h,this.init(),e(null,this)}else e(t)}else e(t)}If.projections=_f,If.projections.start();const Lf=If;function Tf(t,e,i){var s,n,r,o,a=t.x,h=t.y,l=t.z?t.z:0;if(h<-E_&&h>-1.001*E_)h=-E_;else if(h>E_&&h<1.001*E_)h=E_;else{if(h<-E_)return{x:-1/0,y:-1/0,z:t.z};if(h>E_)return{x:1/0,y:1/0,z:t.z}}return a>Math.PI&&(a-=2*Math.PI),n=Math.sin(h),o=Math.cos(h),r=n*n,{x:((s=i/Math.sqrt(1-e*r))+l)*o*Math.cos(a),y:(s+l)*o*Math.sin(a),z:(s*(1-e)+l)*n}}function Nf(t,e,i,s){var n,r,o,a,h,l,c,u,d,g,p,_,f,m,y,x=t.x,v=t.y,w=t.z?t.z:0;if(n=Math.sqrt(x*x+v*v),r=Math.sqrt(x*x+v*v+w*w),n/i<1e-12){if(m=0,r/i<1e-12)return y=-s,{x:t.x,y:t.y,z:t.z}}else m=Math.atan2(v,x);o=w/r,u=(a=n/r)*(1-e)*(h=1/Math.sqrt(1-e*(2-e)*a*a)),d=o*h,f=0;do{f++,l=e*(c=i/Math.sqrt(1-e*d*d))/(c+(y=n*u+w*d-c*(1-e*d*d))),_=(p=o*(h=1/Math.sqrt(1-l*(2-l)*a*a)))*u-(g=a*(1-l)*h)*d,u=g,d=p}while(_*_>1e-24&&f<30);return{x:m,y:Math.atan(p/Math.abs(g)),z:y}}function Rf(t){return t===__||t===f_}function Pf(t,e,i){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;for(var s={x:-i.x,y:i.y},n={x:Number.NaN,y:Number.NaN},r=[],o=0;o<t.grids.length;o++){var a=t.grids[o];if(r.push(a.name),a.isNull){n=s;break}if(a.mandatory,null!==a.grid){var h=a.grid.subgrids[0],l=(Math.abs(h.del[1])+Math.abs(h.del[0]))/1e4,c=h.ll[0]-l,u=h.ll[1]-l,d=h.ll[0]+(h.lim[0]-1)*h.del[0]+l,g=h.ll[1]+(h.lim[1]-1)*h.del[1]+l;if(!(u>s.y||c>s.x||g<s.y||d<s.x||(n=Of(s,e,h),isNaN(n.x))))break}else if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1}return isNaN(n.x)?(console.log("Failed to find a grid shift table for location '"+-s.x*T_+" "+s.y*T_+" tried: '"+r+"'"),-1):(i.x=-n.x,i.y=n.y,0)}function Of(t,e,i){var s={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return s;var n={x:t.x,y:t.y};n.x-=i.ll[0],n.y-=i.ll[1],n.x=of(n.x-Math.PI)+Math.PI;var r=Af(n,i);if(e){if(isNaN(r.x))return s;r.x=n.x-r.x,r.y=n.y-r.y;var o,a,h=9;do{if(a=Af(r,i),isNaN(a.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}o={x:n.x-(a.x+r.x),y:n.y-(a.y+r.y)},r.x+=o.x,r.y+=o.y}while(h--&&Math.abs(o.x)>1e-12&&Math.abs(o.y)>1e-12);if(h<0)return console.log("Inverse grid shift iterator failed to converge."),s;s.x=of(r.x+i.ll[0]),s.y=r.y+i.ll[1]}else isNaN(r.x)||(s.x=t.x+r.x,s.y=t.y+r.y);return s}function Af(t,e){var i,s={x:t.x/e.del[0],y:t.y/e.del[1]},n=Math.floor(s.x),r=Math.floor(s.y),o=s.x-1*n,a=s.y-1*r,h={x:Number.NaN,y:Number.NaN};if(n<0||n>=e.lim[0])return h;if(r<0||r>=e.lim[1])return h;i=r*e.lim[0]+n;var l=e.cvs[i][0],c=e.cvs[i][1];i++;var u=e.cvs[i][0],d=e.cvs[i][1];i+=e.lim[0];var g=e.cvs[i][0],p=e.cvs[i][1];i--;var _=e.cvs[i][0],f=e.cvs[i][1],m=o*a,y=o*(1-a),x=(1-o)*(1-a),v=(1-o)*a;return h.x=x*l+y*u+v*_+m*g,h.y=x*c+y*d+v*f+m*p,h}function Ff(t,e,i){var s,n,r,o=i.x,a=i.y,h=i.z||0,l={};for(r=0;r<3;r++)if(!e||2!==r||void 0!==i.z)switch(0===r?(s=o,n=-1!=="ew".indexOf(t.axis[r])?"x":"y"):1===r?(s=a,n=-1!=="ns".indexOf(t.axis[r])?"y":"x"):(s=h,n="z"),t.axis[r]){case"e":case"n":l[n]=s;break;case"w":case"s":l[n]=-s;break;case"u":void 0!==i[n]&&(l.z=s);break;case"d":void 0!==i[n]&&(l.z=-s);break;default:return null}return l}function Df(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function kf(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function Gf(t,e,i,s){var n,r=void 0!==(i=Array.isArray(i)?Df(i):{x:i.x,y:i.y,z:i.z,m:i.m}).z;if(function(t){kf(t.x),kf(t.y)}(i),t.datum&&e.datum&&function(t,e){return(t.datum.datum_type===__||t.datum.datum_type===f_||t.datum.datum_type===m_)&&"WGS84"!==e.datumCode||(e.datum.datum_type===__||e.datum.datum_type===f_||e.datum.datum_type===m_)&&"WGS84"!==t.datumCode}(t,e)&&(i=Gf(t,n=new Lf("WGS84"),i,s),t=n),s&&"enu"!==t.axis&&(i=Ff(t,!1,i)),"longlat"===t.projName)i={x:i.x*L_,y:i.y*L_,z:i.z||0};else if(t.to_meter&&(i={x:i.x*t.to_meter,y:i.y*t.to_meter,z:i.z||0}),!(i=t.inverse(i)))return;if(t.from_greenwich&&(i.x+=t.from_greenwich),i=function(t,e,i){if(function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(t.datum_type===__?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==f_||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e))return i;if(t.datum_type===y_||e.datum_type===y_)return i;var s=t.a,n=t.es;if(t.datum_type===m_){if(0!==Pf(t,!1,i))return;s=x_,n=w_}var r=e.a,o=e.b,a=e.es;return e.datum_type===m_&&(r=x_,o=v_,a=w_),n!==a||s!==r||Rf(t.datum_type)||Rf(e.datum_type)?(i=Tf(i,n,s),Rf(t.datum_type)&&(i=function(t,e,i){if(e===__)return{x:t.x+i[0],y:t.y+i[1],z:t.z+i[2]};if(e===f_){var s=i[0],n=i[1],r=i[2],o=i[3],a=i[4],h=i[5],l=i[6];return{x:l*(t.x-h*t.y+a*t.z)+s,y:l*(h*t.x+t.y-o*t.z)+n,z:l*(-a*t.x+o*t.y+t.z)+r}}}(i,t.datum_type,t.datum_params)),Rf(e.datum_type)&&(i=function(t,e,i){if(e===__)return{x:t.x-i[0],y:t.y-i[1],z:t.z-i[2]};if(e===f_){var s=i[0],n=i[1],r=i[2],o=i[3],a=i[4],h=i[5],l=i[6],c=(t.x-s)/l,u=(t.y-n)/l,d=(t.z-r)/l;return{x:c+h*u-a*d,y:-h*c+u+o*d,z:a*c-o*u+d}}}(i,e.datum_type,e.datum_params)),i=Nf(i,a,r,o),e.datum_type!==m_||0===Pf(e,!0,i)?i:void 0):i}(t.datum,e.datum,i))return e.from_greenwich&&(i={x:i.x-e.from_greenwich,y:i.y,z:i.z||0}),"longlat"===e.projName?i={x:i.x*T_,y:i.y*T_,z:i.z||0}:(i=e.forward(i),e.to_meter&&(i={x:i.x/e.to_meter,y:i.y/e.to_meter,z:i.z||0})),s&&"enu"!==e.axis?Ff(e,!0,i):(r||delete i.z,i)}var zf=Lf("WGS84");function Bf(t,e,i,s){var n,r,o;return Array.isArray(i)?(n=Gf(t,e,i,s)||{x:NaN,y:NaN},i.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof n.z?[n.x,n.y,n.z].concat(i.splice(3)):[n.x,n.y,i[2]].concat(i.splice(3)):[n.x,n.y].concat(i.splice(2)):[n.x,n.y]):(r=Gf(t,e,i,s),2===(o=Object.keys(i)).length||o.forEach((function(s){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===s||"y"===s||"z"===s)return}else if("x"===s||"y"===s)return;r[s]=i[s]})),r)}function jf(t){return t instanceof Lf?t:t.oProj?t.oProj:Lf(t)}const qf=function(t,e,i){t=jf(t);var s,n=!1;return void 0===e?(e=t,t=zf,n=!0):(void 0!==e.x||Array.isArray(e))&&(i=e,e=t,t=zf,n=!0),e=jf(e),i?Bf(t,e,i):(s={forward:function(i,s){return Bf(t,e,i,s)},inverse:function(i,s){return Bf(e,t,i,s)}},n&&(s.oProj=e),s)};var Uf=6,Yf="AJSAJS",Vf="AFAFAF",Xf=65,Wf=73,$f=79,Hf=86,Kf=90;const Zf={forward:Jf,inverse:function(t){var e=im(nm(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},toPoint:Qf};function Jf(t,e){return e=e||5,function(t,e){var i,s,n,r,o,a,h,l,c,u,d,g="00000"+t.easting,p="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(c=t.easting,u=t.northing,d=sm(t.zoneNumber),i=Math.floor(c/1e5),s=Math.floor(u/1e5)%20,n=d-1,r=Yf.charCodeAt(n),o=Vf.charCodeAt(n),l=!1,(a=r+i-1)>Kf&&(a=a-Kf+Xf-1,l=!0),(a===Wf||r<Wf&&a>Wf||(a>Wf||r<Wf)&&l)&&a++,(a===$f||r<$f&&a>$f||(a>$f||r<$f)&&l)&&++a===Wf&&a++,a>Kf&&(a=a-Kf+Xf-1),(h=o+s)>Hf?(h=h-Hf+Xf-1,l=!0):l=!1,(h===Wf||o<Wf&&h>Wf||(h>Wf||o<Wf)&&l)&&h++,(h===$f||o<$f&&h>$f||(h>$f||o<$f)&&l)&&++h===Wf&&h++,h>Hf&&(h=h-Hf+Xf-1),String.fromCharCode(a)+String.fromCharCode(h))+g.substr(g.length-5,e)+p.substr(p.length-5,e)}(function(t){var e,i,s,n,r,o,a,h=t.lat,l=t.lon,c=6378137,u=.00669438,d=.9996,g=tm(h),p=tm(l);a=Math.floor((l+180)/6)+1,180===l&&(a=60),h>=56&&h<64&&l>=3&&l<12&&(a=32),h>=72&&h<84&&(l>=0&&l<9?a=31:l>=9&&l<21?a=33:l>=21&&l<33?a=35:l>=33&&l<42&&(a=37)),o=tm(6*(a-1)-180+3),e=.006739496752268451,i=c/Math.sqrt(1-u*Math.sin(g)*Math.sin(g)),s=Math.tan(g)*Math.tan(g),n=e*Math.cos(g)*Math.cos(g);var _,f,m=d*i*((r=Math.cos(g)*(p-o))+(1-s+n)*r*r*r/6+(5-18*s+s*s+72*n-58*e)*r*r*r*r*r/120)+5e5,y=d*(c*(.9983242984503243*g-.002514607064228144*Math.sin(2*g)+2639046602129982e-21*Math.sin(4*g)-3.418046101696858e-9*Math.sin(6*g))+i*Math.tan(g)*(r*r/2+(5-s+9*n+4*n*n)*r*r*r*r/24+(61-58*s+s*s+600*n-2.2240339282485886)*r*r*r*r*r*r/720));return h<0&&(y+=1e7),{northing:Math.round(y),easting:Math.round(m),zoneNumber:a,zoneLetter:(_=h,f="Z",84>=_&&_>=72?f="X":72>_&&_>=64?f="W":64>_&&_>=56?f="V":56>_&&_>=48?f="U":48>_&&_>=40?f="T":40>_&&_>=32?f="S":32>_&&_>=24?f="R":24>_&&_>=16?f="Q":16>_&&_>=8?f="P":8>_&&_>=0?f="N":0>_&&_>=-8?f="M":-8>_&&_>=-16?f="L":-16>_&&_>=-24?f="K":-24>_&&_>=-32?f="J":-32>_&&_>=-40?f="H":-40>_&&_>=-48?f="G":-48>_&&_>=-56?f="F":-56>_&&_>=-64?f="E":-64>_&&_>=-72?f="D":-72>_&&_>=-80&&(f="C"),f)}}({lat:t[1],lon:t[0]}),e)}function Qf(t){var e=im(nm(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function tm(t){return t*(Math.PI/180)}function em(t){return t/Math.PI*180}function im(t){var e=t.northing,i=t.easting,s=t.zoneLetter,n=t.zoneNumber;if(n<0||n>60)return null;var r,o,a,h,l,c,u,d,g,p=.9996,_=6378137,f=.00669438,m=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),y=i-5e5,x=e;s<"N"&&(x-=1e7),u=6*(n-1)-180+3,r=.006739496752268451,g=(d=x/p/6367449.145945056)+(3*m/2-27*m*m*m/32)*Math.sin(2*d)+(21*m*m/16-55*m*m*m*m/32)*Math.sin(4*d)+151*m*m*m/96*Math.sin(6*d),o=_/Math.sqrt(1-f*Math.sin(g)*Math.sin(g)),a=Math.tan(g)*Math.tan(g),h=r*Math.cos(g)*Math.cos(g),l=.99330562*_/Math.pow(1-f*Math.sin(g)*Math.sin(g),1.5),c=y/(o*p);var v=g-o*Math.tan(g)/l*(c*c/2-(5+3*a+10*h-4*h*h-9*r)*c*c*c*c/24+(61+90*a+298*h+45*a*a-1.6983531815716497-3*h*h)*c*c*c*c*c*c/720);v=em(v);var w,M=(c-(1+2*a+h)*c*c*c/6+(5-2*h+28*a-3*h*h+8*r+24*a*a)*c*c*c*c*c/120)/Math.cos(g);if(M=u+em(M),t.accuracy){var E=im({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});w={top:E.lat,right:E.lon,bottom:v,left:M}}else w={lat:v,lon:M};return w}function sm(t){var e=t%Uf;return 0===e&&(e=Uf),e}function nm(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,i=t.length,s=null,n="",r=0;!/[A-Z]/.test(e=t.charAt(r));){if(r>=2)throw"MGRSPoint bad conversion from: "+t;n+=e,r++}var o=parseInt(n,10);if(0===r||r+3>i)throw"MGRSPoint bad conversion from: "+t;var a=t.charAt(r++);if(a<="A"||"B"===a||"Y"===a||a>="Z"||"I"===a||"O"===a)throw"MGRSPoint zone letter "+a+" not handled: "+t;s=t.substring(r,r+=2);for(var h=sm(o),l=function(t,e){for(var i=Yf.charCodeAt(e-1),s=1e5,n=!1;i!==t.charCodeAt(0);){if(++i===Wf&&i++,i===$f&&i++,i>Kf){if(n)throw"Bad character: "+t;i=Xf,n=!0}s+=1e5}return s}(s.charAt(0),h),c=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var i=Vf.charCodeAt(e-1),s=0,n=!1;i!==t.charCodeAt(0);){if(++i===Wf&&i++,i===$f&&i++,i>Hf){if(n)throw"Bad character: "+t;i=Xf,n=!0}s+=1e5}return s}(s.charAt(1),h);c<rm(a);)c+=2e6;var u=i-r;if(u%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var d,g,p,_=u/2,f=0,m=0;return _>0&&(d=1e5/Math.pow(10,_),g=t.substring(r,r+_),f=parseFloat(g)*d,p=t.substring(r+_),m=parseFloat(p)*d),{easting:f+l,northing:m+c,zoneLetter:a,zoneNumber:o,accuracy:d}}function rm(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function om(t,e,i){if(!(this instanceof om))return new om(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var s=t.split(",");this.x=parseFloat(s[0],10),this.y=parseFloat(s[1],10),this.z=parseFloat(s[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}om.fromMGRS=function(t){return new om(Qf(t))},om.prototype.toMGRS=function(t){return Jf([this.x,this.y],t)};const am=om;var hm=1,lm=.25,cm=.046875,um=.01953125,dm=.01068115234375,gm=.75,pm=.46875,_m=.013020833333333334,fm=.007120768229166667,mm=.3645833333333333,ym=.005696614583333333,xm=.3076171875;function vm(t){var e=[];e[0]=hm-t*(lm+t*(cm+t*(um+t*dm))),e[1]=t*(gm-t*(cm+t*(um+t*dm)));var i=t*t;return e[2]=i*(pm-t*(_m+t*fm)),i*=t,e[3]=i*(mm-t*ym),e[4]=i*t*xm,e}function wm(t,e,i,s){return i*=e,e*=e,s[0]*t-i*(s[1]+e*(s[2]+e*(s[3]+e*s[4])))}var Mm=20;function Em(t,e,i){for(var s=1/(1-e),n=t,r=Mm;r;--r){var o=Math.sin(n),a=1-e*o*o;if(n-=a=(wm(n,o,Math.cos(n),i)-t)*(a*Math.sqrt(a))*s,Math.abs(a)<I_)return n}return n}const Cm={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=vm(this.es),this.ml0=wm(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,i,s,n=t.x,r=t.y,o=of(n-this.long0),a=Math.sin(r),h=Math.cos(r);if(this.es){var l=h*o,c=Math.pow(l,2),u=this.ep2*Math.pow(h,2),d=Math.pow(u,2),g=Math.abs(h)>I_?Math.tan(r):0,p=Math.pow(g,2),_=Math.pow(p,2);e=1-this.es*Math.pow(a,2),l/=Math.sqrt(e);var f=wm(r,a,h,this.en);i=this.a*(this.k0*l*(1+c/6*(1-p+u+c/20*(5-18*p+_+14*u-58*p*u+c/42*(61+179*_-_*p-479*p)))))+this.x0,s=this.a*(this.k0*(f-this.ml0+a*o*l/2*(1+c/12*(5-p+9*u+4*d+c/30*(61+_-58*p+270*u-330*p*u+c/56*(1385+543*_-_*p-3111*p))))))+this.y0}else{var m=h*Math.sin(o);if(Math.abs(Math.abs(m)-1)<I_)return 93;if(i=.5*this.a*this.k0*Math.log((1+m)/(1-m))+this.x0,s=h*Math.cos(o)/Math.sqrt(1-Math.pow(m,2)),(m=Math.abs(s))>=1){if(m-1>I_)return 93;s=0}else s=Math.acos(s);r<0&&(s=-s),s=this.a*this.k0*(s-this.lat0)+this.y0}return t.x=i,t.y=s,t},inverse:function(t){var e,i,s,n,r=(t.x-this.x0)*(1/this.a),o=(t.y-this.y0)*(1/this.a);if(this.es)if(i=Em(e=this.ml0+o/this.k0,this.es,this.en),Math.abs(i)<E_){var a=Math.sin(i),h=Math.cos(i),l=Math.abs(h)>I_?Math.tan(i):0,c=this.ep2*Math.pow(h,2),u=Math.pow(c,2),d=Math.pow(l,2),g=Math.pow(d,2);e=1-this.es*Math.pow(a,2);var p=r*Math.sqrt(e)/this.k0,_=Math.pow(p,2);s=i-(e*=l)*_/(1-this.es)*.5*(1-_/12*(5+3*d-9*c*d+c-4*u-_/30*(61+90*d-252*c*d+45*g+46*c-_/56*(1385+3633*d+4095*g+1574*g*d)))),n=of(this.long0+p*(1-_/6*(1+2*d+c-_/20*(5+28*d+24*g+8*c*d+6*c-_/42*(61+662*d+1320*g+720*g*d))))/h)}else s=E_*rf(o),n=0;else{var f=Math.exp(r/this.k0),m=.5*(f-1/f),y=this.lat0+o/this.k0,x=Math.cos(y);e=Math.sqrt((1-Math.pow(x,2))/(1+Math.pow(m,2))),s=Math.asin(e),o<0&&(s=-s),n=0===m&&0===x?0:of(Math.atan2(m,x)+this.long0)}return t.x=n,t.y=s,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function Sm(t){var e=Math.exp(t);return(e-1/e)/2}function bm(t,e){t=Math.abs(t),e=Math.abs(e);var i=Math.max(t,e),s=Math.min(t,e)/(i||1);return i*Math.sqrt(1+Math.pow(s,2))}function Im(t,e){for(var i,s=2*Math.cos(2*e),n=t.length-1,r=t[n],o=0;--n>=0;)i=s*r-o+t[n],o=r,r=i;return e+i*Math.sin(2*e)}function Lm(t,e,i){for(var s,n,r=Math.sin(e),o=Math.cos(e),a=Sm(i),h=function(t){var e=Math.exp(t);return(e+1/e)/2}(i),l=2*o*h,c=-2*r*a,u=t.length-1,d=t[u],g=0,p=0,_=0;--u>=0;)s=p,n=g,d=l*(p=d)-s-c*(g=_)+t[u],_=c*p-n+l*g;return[(l=r*h)*d-(c=o*a)*_,l*_+c*d]}const Tm={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Cm.init.apply(this),this.forward=Cm.forward,this.inverse=Cm.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),i=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),i*=e,this.cgb[1]=i*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=i*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),i*=e,this.cgb[2]=i*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=i*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),i*=e,this.cgb[3]=i*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=i*(1237/630+e*(e*(-24832/14175)-2.4)),i*=e,this.cgb[4]=i*(4174/315+e*(-144838/6237)),this.cbg[4]=i*(-734/315+e*(109598/31185)),i*=e,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+i*(1/4+i*(1/64+i/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=i*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=i*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),i*=e,this.utg[2]=i*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=i*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),i*=e,this.utg[3]=i*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=i*(49561/161280+e*(-179/168+e*(6601661/7257600))),i*=e,this.utg[4]=i*(-4583/161280+e*(108847/3991680)),this.gtu[4]=i*(34729/80640+e*(-3418889/1995840)),i*=e,this.utg[5]=i*(-20648693/638668800),this.gtu[5]=.6650675310896665*i;var s=Im(this.cbg,this.lat0);this.Zb=-this.Qn*(s+function(t,e){for(var i,s=2*Math.cos(e),n=t.length-1,r=t[n],o=0;--n>=0;)i=s*r-o+t[n],o=r,r=i;return Math.sin(e)*i}(this.gtu,2*s))},forward:function(t){var e=of(t.x-this.long0),i=t.y;i=Im(this.cbg,i);var s=Math.sin(i),n=Math.cos(i),r=Math.sin(e),o=Math.cos(e);i=Math.atan2(s,o*n),e=Math.atan2(r*n,bm(s,n*o)),e=function(t){var e=Math.abs(t);return e=function(t){var e=1+t,i=e-1;return 0===i?t:t*Math.log(e)/i}(e*(1+e/(bm(1,e)+1))),t<0?-e:e}(Math.tan(e));var a,h,l=Lm(this.gtu,2*i,2*e);return i+=l[0],e+=l[1],Math.abs(e)<=2.623395162778?(a=this.a*(this.Qn*e)+this.x0,h=this.a*(this.Qn*i+this.Zb)+this.y0):(a=1/0,h=1/0),t.x=a,t.y=h,t},inverse:function(t){var e,i,s=(t.x-this.x0)*(1/this.a),n=(t.y-this.y0)*(1/this.a);if(n=(n-this.Zb)/this.Qn,s/=this.Qn,Math.abs(s)<=2.623395162778){var r=Lm(this.utg,2*n,2*s);n+=r[0],s+=r[1],s=Math.atan(Sm(s));var o=Math.sin(n),a=Math.cos(n),h=Math.sin(s),l=Math.cos(s);n=Math.atan2(o*l,bm(h,l*a)),e=of((s=Math.atan2(h,l*a))+this.long0),i=Im(this.cgb,n)}else e=1/0,i=1/0;return t.x=e,t.y=i,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]},Nm={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(of(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*L_,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Tm.init.apply(this),this.forward=Tm.forward,this.inverse=Tm.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function Rm(t,e){return Math.pow((1-t)/(1+t),e)}const Pm={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+N_)/(Math.pow(Math.tan(.5*this.lat0+N_),this.C)*Rm(this.e*t,this.ratexp))},forward:function(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+N_),this.C)*Rm(this.e*Math.sin(i),this.ratexp))-E_,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,i=t.y,s=Math.pow(Math.tan(.5*i+N_)/this.K,1/this.C),n=20;n>0&&(i=2*Math.atan(s*Rm(this.e*Math.sin(t.y),-.5*this.e))-E_,!(Math.abs(i-t.y)<1e-14));--n)t.y=i;return n?(t.x=e,t.y=i,t):null},names:["gauss"]},Om={init:function(){Pm.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,i,s,n;return t.x=of(t.x-this.long0),Pm.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),s=Math.cos(t.x),n=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*s),t.x=n*i*Math.sin(t.x),t.y=n*(this.cosc0*e-this.sinc0*i*s),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,i,s,n,r;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,r=Math.sqrt(t.x*t.x+t.y*t.y)){var o=2*Math.atan2(r,this.R2);e=Math.sin(o),i=Math.cos(o),n=Math.asin(i*this.sinc0+t.y*e*this.cosc0/r),s=Math.atan2(t.x*e,r*this.cosc0*i-t.y*this.sinc0*e)}else n=this.phic0,s=0;return t.x=s,t.y=n,Pm.inverse.apply(this,[t]),t.x=of(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},Am={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=I_&&(this.k0=.5*(1+rf(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=I_&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=I_&&(this.k0=.5*this.cons*nf(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/af(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=nf(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-E_,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,i,s,n,r,o,a=t.x,h=t.y,l=Math.sin(h),c=Math.cos(h),u=of(a-this.long0);return Math.abs(Math.abs(a-this.long0)-Math.PI)<=I_&&Math.abs(h+this.lat0)<=I_?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*l+this.coslat0*c*Math.cos(u)),t.x=this.a*e*c*Math.sin(u)+this.x0,t.y=this.a*e*(this.coslat0*l-this.sinlat0*c*Math.cos(u))+this.y0,t):(i=2*Math.atan(this.ssfn_(h,l,this.e))-E_,n=Math.cos(i),s=Math.sin(i),Math.abs(this.coslat0)<=I_?(r=af(this.e,h*this.con,this.con*l),o=2*this.a*this.k0*r/this.cons,t.x=this.x0+o*Math.sin(a-this.long0),t.y=this.y0-this.con*o*Math.cos(a-this.long0),t):(Math.abs(this.sinlat0)<I_?(e=2*this.a*this.k0/(1+n*Math.cos(u)),t.y=e*s):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*s+this.cosX0*n*Math.cos(u))),t.y=e*(this.cosX0*s-this.sinX0*n*Math.cos(u))+this.y0),t.x=e*n*Math.sin(u)+this.x0,t))},inverse:function(t){var e,i,s,n,r;t.x-=this.x0,t.y-=this.y0;var o=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var a=2*Math.atan(o/(2*this.a*this.k0));return e=this.long0,i=this.lat0,o<=I_?(t.x=e,t.y=i,t):(i=Math.asin(Math.cos(a)*this.sinlat0+t.y*Math.sin(a)*this.coslat0/o),e=Math.abs(this.coslat0)<I_?this.lat0>0?of(this.long0+Math.atan2(t.x,-1*t.y)):of(this.long0+Math.atan2(t.x,t.y)):of(this.long0+Math.atan2(t.x*Math.sin(a),o*this.coslat0*Math.cos(a)-t.y*this.sinlat0*Math.sin(a))),t.x=e,t.y=i,t)}if(Math.abs(this.coslat0)<=I_){if(o<=I_)return i=this.lat0,e=this.long0,t.x=e,t.y=i,t;t.x*=this.con,t.y*=this.con,s=o*this.cons/(2*this.a*this.k0),i=this.con*hf(this.e,s),e=this.con*of(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else n=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,o<=I_?r=this.X0:(r=Math.asin(Math.cos(n)*this.sinX0+t.y*Math.sin(n)*this.cosX0/o),e=of(this.long0+Math.atan2(t.x*Math.sin(n),o*this.cosX0*Math.cos(n)-t.y*this.sinX0*Math.sin(n)))),i=-1*hf(this.e,Math.tan(.5*(E_+r)));return t.x=e,t.y=i,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,i){return e*=i,Math.tan(.5*(E_+t))*Math.pow((1-e)/(1+e),.5*i)}},Fm={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),i=this.a,s=1/this.rf,n=2*s-Math.pow(s,2),r=this.e=Math.sqrt(n);this.R=this.k0*i*Math.sqrt(1-n)/(1-n*Math.pow(e,2)),this.alpha=Math.sqrt(1+n/(1-n)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),a=Math.log(Math.tan(Math.PI/4+t/2)),h=Math.log((1+r*e)/(1-r*e));this.K=o-this.alpha*a+this.alpha*r/2*h},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),s=-this.alpha*(e+i)+this.K,n=2*(Math.atan(Math.exp(s))-Math.PI/4),r=this.alpha*(t.x-this.lambda0),o=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(r))),a=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(r));return t.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,t.x=this.R*o+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,i=t.y-this.y0,s=e/this.R,n=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(n)+Math.sin(this.b0)*Math.cos(n)*Math.cos(s)),o=Math.atan(Math.sin(s)/(Math.cos(this.b0)*Math.cos(s)-Math.sin(this.b0)*Math.tan(n))),a=this.lambda0+o/this.alpha,h=0,l=r,c=-1e3,u=0;Math.abs(l-c)>1e-7;){if(++u>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),c=l,l=2*Math.atan(Math.exp(h))-Math.PI/2}return t.x=a,t.y=l,t},names:["somerc"]};var Dm=1e-7;const km={init:function(){var t,e,i,s,n,r,o,a,h,l,c,u=0,d=0,g=0,p=0,_=0,f=0,m=0;this.no_off=function(t){var e="object"==typeof t.PROJECTION?Object.keys(t.PROJECTION)[0]:t.PROJECTION;return"no_uoff"in t||"no_off"in t||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(e)}(this),this.no_rot="no_rot"in this;var y=!1;"alpha"in this&&(y=!0);var x=!1;if("rectified_grid_angle"in this&&(x=!0),y&&(m=this.alpha),x&&(u=this.rectified_grid_angle*L_),y||x)d=this.longc;else if(g=this.long1,_=this.lat1,p=this.long2,f=this.lat2,Math.abs(_-f)<=Dm||(t=Math.abs(_))<=Dm||Math.abs(t-E_)<=Dm||Math.abs(Math.abs(this.lat0)-E_)<=Dm||Math.abs(Math.abs(f)-E_)<=Dm)throw new Error;var v=1-this.es;e=Math.sqrt(v),Math.abs(this.lat0)>I_?(a=Math.sin(this.lat0),i=Math.cos(this.lat0),t=1-this.es*a*a,this.B=i*i,this.B=Math.sqrt(1+this.es*this.B*this.B/v),this.A=this.B*this.k0*e/t,(n=(s=this.B*e/(i*Math.sqrt(t)))*s-1)<=0?n=0:(n=Math.sqrt(n),this.lat0<0&&(n=-n)),this.E=n+=s,this.E*=Math.pow(af(this.e,this.lat0,a),this.B)):(this.B=1/e,this.A=this.k0,this.E=s=n=1),y||x?(y?(c=Math.asin(Math.sin(m)/s),x||(u=m)):(c=u,m=Math.asin(s*Math.sin(c))),this.lam0=d-Math.asin(.5*(n-1/n)*Math.tan(c))/this.B):(r=Math.pow(af(this.e,_,Math.sin(_)),this.B),o=Math.pow(af(this.e,f,Math.sin(f)),this.B),n=this.E/r,h=(o-r)/(o+r),l=((l=this.E*this.E)-o*r)/(l+o*r),(t=g-p)<-Math.pi?p-=R_:t>Math.pi&&(p+=R_),this.lam0=of(.5*(g+p)-Math.atan(l*Math.tan(.5*this.B*(g-p))/h)/this.B),c=Math.atan(2*Math.sin(this.B*of(g-this.lam0))/(n-1/n)),u=m=Math.asin(s*Math.sin(c))),this.singam=Math.sin(c),this.cosgam=Math.cos(c),this.sinrot=Math.sin(u),this.cosrot=Math.cos(u),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(s*s-1)/Math.cos(m))),this.lat0<0&&(this.u_0=-this.u_0)),n=.5*c,this.v_pole_n=this.ArB*Math.log(Math.tan(N_-n)),this.v_pole_s=this.ArB*Math.log(Math.tan(N_+n))},forward:function(t){var e,i,s,n,r,o,a,h,l={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-E_)>I_){if(e=.5*((r=this.E/Math.pow(af(this.e,t.y,Math.sin(t.y)),this.B))-(o=1/r)),i=.5*(r+o),n=Math.sin(this.B*t.x),s=(e*this.singam-n*this.cosgam)/i,Math.abs(Math.abs(s)-1)<I_)throw new Error;h=.5*this.ArB*Math.log((1-s)/(1+s)),o=Math.cos(this.B*t.x),a=Math.abs(o)<Dm?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+n*this.singam,o)}else h=t.y>0?this.v_pole_n:this.v_pole_s,a=this.ArB*t.y;return this.no_rot?(l.x=a,l.y=h):(a-=this.u_0,l.x=h*this.cosrot+a*this.sinrot,l.y=a*this.cosrot-h*this.sinrot),l.x=this.a*l.x+this.x0,l.y=this.a*l.y+this.y0,l},inverse:function(t){var e,i,s,n,r,o,a,h={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(i=t.y,e=t.x):(i=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),n=.5*((s=Math.exp(-this.BrA*i))-1/s),r=.5*(s+1/s),a=((o=Math.sin(this.BrA*e))*this.cosgam+n*this.singam)/r,Math.abs(Math.abs(a)-1)<I_)h.x=0,h.y=a<0?-E_:E_;else{if(h.y=this.E/Math.sqrt((1+a)/(1-a)),h.y=hf(this.e,Math.pow(h.y,1/this.B)),h.y===1/0)throw new Error;h.x=-this.rB*Math.atan2(n*this.cosgam-o*this.singam,Math.cos(this.BrA*e))}return h.x+=this.lam0,h},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},Gm={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<I_)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),s=nf(this.e,e,i),n=af(this.e,this.lat1,e),r=Math.sin(this.lat2),o=Math.cos(this.lat2),a=nf(this.e,r,o),h=af(this.e,this.lat2,r),l=af(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>I_?this.ns=Math.log(s/a)/Math.log(n/h):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=s/(this.ns*Math.pow(n,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=I_&&(i=rf(i)*(E_-2*I_));var s,n,r=Math.abs(Math.abs(i)-E_);if(r>I_)s=af(this.e,i,Math.sin(i)),n=this.a*this.f0*Math.pow(s,this.ns);else{if((r=i*this.ns)<=0)return null;n=0}var o=this.ns*of(e-this.long0);return t.x=this.k0*(n*Math.sin(o))+this.x0,t.y=this.k0*(this.rh-n*Math.cos(o))+this.y0,t},inverse:function(t){var e,i,s,n,r,o=(t.x-this.x0)/this.k0,a=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(o*o+a*a),i=1):(e=-Math.sqrt(o*o+a*a),i=-1);var h=0;if(0!==e&&(h=Math.atan2(i*o,i*a)),0!==e||this.ns>0){if(i=1/this.ns,s=Math.pow(e/(this.a*this.f0),i),-9999===(n=hf(this.e,s)))return null}else n=-E_;return r=of(h/this.ns+this.long0),t.x=r,t.y=n,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},zm={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,i,s,n,r,o,a,h=t.x,l=t.y,c=of(h-this.long0);return e=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/e)-this.s45),s=-c*this.alfa,n=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(s)),r=Math.asin(Math.cos(i)*Math.sin(s)/Math.cos(n)),o=this.n*r,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(n/2+this.s45),this.n),t.y=a*Math.cos(o)/1,t.x=a*Math.sin(o)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,i,s,n,r,o,a,h=t.x;t.x=t.y,t.y=h,this.czech||(t.y*=-1,t.x*=-1),r=Math.sqrt(t.x*t.x+t.y*t.y),n=Math.atan2(t.y,t.x)/Math.sin(this.s0),s=2*(Math.atan(Math.pow(this.ro0/r,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(s)-Math.sin(this.ad)*Math.cos(s)*Math.cos(n)),i=Math.asin(Math.cos(s)*Math.sin(n)/Math.cos(e)),t.x=this.long0-i/this.alfa,o=e,a=0;var l=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-t.y)<1e-10&&(a=1),o=t.y,l+=1}while(0===a&&l<15);return l>=15?null:t},names:["Krovak","krovak"]};function Bm(t,e,i,s,n){return t*n-e*Math.sin(2*n)+i*Math.sin(4*n)-s*Math.sin(6*n)}function jm(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function qm(t){return.375*t*(1+.25*t*(1+.46875*t))}function Um(t){return.05859375*t*t*(1+.75*t)}function Ym(t){return t*t*t*(35/3072)}function Vm(t,e,i){var s=e*i;return t/Math.sqrt(1-s*s)}function Xm(t){return Math.abs(t)<E_?t:t-rf(t)*Math.PI}function Wm(t,e,i,s,n){var r,o;r=t/e;for(var a=0;a<15;a++)if(r+=o=(t-(e*r-i*Math.sin(2*r)+s*Math.sin(4*r)-n*Math.sin(6*r)))/(e-2*i*Math.cos(2*r)+4*s*Math.cos(4*r)-6*n*Math.cos(6*r)),Math.abs(o)<=1e-10)return r;return NaN}const $m={init:function(){this.sphere||(this.e0=jm(this.es),this.e1=qm(this.es),this.e2=Um(this.es),this.e3=Ym(this.es),this.ml0=this.a*Bm(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,i,s=t.x,n=t.y;if(s=of(s-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(n)*Math.sin(s)),i=this.a*(Math.atan2(Math.tan(n),Math.cos(s))-this.lat0);else{var r=Math.sin(n),o=Math.cos(n),a=Vm(this.a,this.e,r),h=Math.tan(n)*Math.tan(n),l=s*Math.cos(n),c=l*l,u=this.es*o*o/(1-this.es);e=a*l*(1-c*h*(1/6-(8-h+8*u)*c/120)),i=this.a*Bm(this.e0,this.e1,this.e2,this.e3,n)-this.ml0+a*r/o*c*(.5+(5-h+6*u)*c/24)}return t.x=e+this.x0,t.y=i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,s=t.x/this.a,n=t.y/this.a;if(this.sphere){var r=n+this.lat0;e=Math.asin(Math.sin(r)*Math.cos(s)),i=Math.atan2(Math.tan(s),Math.cos(r))}else{var o=Wm(this.ml0/this.a+n,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-E_)<=I_)return t.x=this.long0,t.y=E_,n<0&&(t.y*=-1),t;var a=Vm(this.a,this.e,Math.sin(o)),h=a*a*a/this.a/this.a*(1-this.es),l=Math.pow(Math.tan(o),2),c=s*this.a/a,u=c*c;e=o-a*Math.tan(o)/h*c*c*(.5-(1+3*l)*c*c/24),i=c*(1-u*(l/3+(1+3*l)*l*u/15))/Math.cos(o)}return t.x=of(i+this.long0),t.y=Xm(e),t},names:["Cassini","Cassini_Soldner","cass"]};function Hm(t,e){var i;return t>1e-7?(1-t*t)*(e/(1-(i=t*e)*i)-.5/t*Math.log((1-i)/(1+i))):2*e}const Km={init:function(){var t,e=Math.abs(this.lat0);if(Math.abs(e-E_)<I_?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<I_?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=Hm(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,i=[];return i[0]=.3333333333333333*t,e=t*t,i[0]+=.17222222222222222*e,i[1]=.06388888888888888*e,e*=t,i[0]+=.10257936507936508*e,i[1]+=.0664021164021164*e,i[2]=.016415012942191543*e,i}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Hm(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,i,s,n,r,o,a,h,l,c,u=t.x,d=t.y;if(u=of(u-this.long0),this.sphere){if(r=Math.sin(d),c=Math.cos(d),s=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+c*s:1+this.sinph0*r+this.cosph0*c*s)<=I_)return null;e=(i=Math.sqrt(2/i))*c*Math.sin(u),i*=this.mode===this.EQUIT?r:this.cosph0*r-this.sinph0*c*s}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(s=-s),Math.abs(d+this.lat0)<I_)return null;i=N_-.5*d,e=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(u),i*=s}}else{switch(a=0,h=0,l=0,s=Math.cos(u),n=Math.sin(u),r=Math.sin(d),o=Hm(this.e,r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(a=o/this.qp,h=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:l=1+this.sinb1*a+this.cosb1*h*s;break;case this.EQUIT:l=1+h*s;break;case this.N_POLE:l=E_+d,o=this.qp-o;break;case this.S_POLE:l=d-E_,o=this.qp+o}if(Math.abs(l)<I_)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),i=this.mode===this.OBLIQ?this.ymf*l*(this.cosb1*a-this.sinb1*h*s):(l=Math.sqrt(2/(1+h*s)))*a*this.ymf,e=this.xmf*l*h*n;break;case this.N_POLE:case this.S_POLE:o>=0?(e=(l=Math.sqrt(o))*n,i=s*(this.mode===this.S_POLE?l:-l)):e=i=0}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,s,n,r,o,a,h=t.x/this.a,l=t.y/this.a;if(this.sphere){var c,u=0,d=0;if((i=.5*(c=Math.sqrt(h*h+l*l)))>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(d=Math.sin(i),u=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(c)<=I_?0:Math.asin(l*d/c),h*=d,l=u*c;break;case this.OBLIQ:i=Math.abs(c)<=I_?this.lat0:Math.asin(u*this.sinph0+l*d*this.cosph0/c),h*=d*this.cosph0,l=(u-Math.sin(i)*this.sinph0)*c;break;case this.N_POLE:l=-l,i=E_-i;break;case this.S_POLE:i-=E_}e=0!==l||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(h,l):0}else{if(a=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(h/=this.dd,l*=this.dd,(o=Math.sqrt(h*h+l*l))<I_)return t.x=this.long0,t.y=this.lat0,t;n=2*Math.asin(.5*o/this.rq),s=Math.cos(n),h*=n=Math.sin(n),this.mode===this.OBLIQ?(a=s*this.sinb1+l*n*this.cosb1/o,r=this.qp*a,l=o*this.cosb1*s-l*this.sinb1*n):(a=l*n/o,r=this.qp*a,l=o*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(l=-l),!(r=h*h+l*l))return t.x=this.long0,t.y=this.lat0,t;a=1-r/this.qp,this.mode===this.S_POLE&&(a=-a)}e=Math.atan2(h,l),i=function(t,e){var i=t+t;return t+e[0]*Math.sin(i)+e[1]*Math.sin(i+i)+e[2]*Math.sin(i+i+i)}(Math.asin(a),this.apa)}return t.x=of(this.long0+e),t.y=i,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function Zm(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}const Jm={init:function(){Math.abs(this.lat1+this.lat2)<I_||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=nf(this.e3,this.sin_po,this.cos_po),this.qs1=Hm(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=nf(this.e3,this.sin_po,this.cos_po),this.qs2=Hm(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Hm(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>I_?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var s=Hm(this.e3,this.sin_phi),n=this.a*Math.sqrt(this.c-this.ns0*s)/this.ns0,r=this.ns0*of(e-this.long0),o=n*Math.sin(r)+this.x0,a=this.rh-n*Math.cos(r)+this.y0;return t.x=o,t.y=a,t},inverse:function(t){var e,i,s,n,r,o;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),s=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),s=-1),n=0,0!==e&&(n=Math.atan2(s*t.x,s*t.y)),s=e*this.ns0/this.a,this.sphere?o=Math.asin((this.c-s*s)/(2*this.ns0)):(i=(this.c-s*s)/this.ns0,o=this.phi1z(this.e3,i)),r=of(n/this.ns0+this.long0),t.x=r,t.y=o,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var i,s,n,r,o=Zm(.5*e);if(t<I_)return o;for(var a=t*t,h=1;h<=25;h++)if(o+=r=.5*(n=1-(s=t*(i=Math.sin(o)))*s)*n/Math.cos(o)*(e/(1-a)-i/n+.5/t*Math.log((1-s)/(1+s))),Math.abs(r)<=1e-7)return o;return null}},Qm={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,i,s,n,r,o,a,h=t.x,l=t.y;return s=of(h-this.long0),e=Math.sin(l),i=Math.cos(l),n=Math.cos(s),(r=this.sin_p14*e+this.cos_p14*i*n)>0||Math.abs(r)<=I_?(o=this.x0+1*this.a*i*Math.sin(s)/r,a=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*i*n)/r):(o=this.x0+this.infinity_dist*i*Math.sin(s),a=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*n)),t.x=o,t.y=a,t},inverse:function(t){var e,i,s,n,r,o;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(n=Math.atan2(e,this.rc),i=Math.sin(n),o=Zm((s=Math.cos(n))*this.sin_p14+t.y*i*this.cos_p14/e),r=Math.atan2(t.x*i,e*this.cos_p14*s-t.y*this.sin_p14*i),r=of(this.long0+r)):(o=this.phic0,r=0),t.x=r,t.y=o,t},names:["gnom"]},ty={init:function(){this.sphere||(this.k0=nf(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,i,s=t.x,n=t.y,r=of(s-this.long0);if(this.sphere)e=this.x0+this.a*r*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(n)/Math.cos(this.lat_ts);else{var o=Hm(this.e,Math.sin(n));e=this.x0+this.a*this.k0*r,i=this.y0+this.a*o*.5/this.k0}return t.x=e,t.y=i,t},inverse:function(t){var e,i;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=of(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=function(t,e){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-i)<1e-6)return e<0?-1*E_:E_;for(var s,n,r,o,a=Math.asin(.5*e),h=0;h<30;h++)if(n=Math.sin(a),r=Math.cos(a),o=t*n,a+=s=Math.pow(1-o*o,2)/(2*r)*(e/(1-t*t)-n/(1-o*o)+.5/t*Math.log((1-o)/(1+o))),Math.abs(s)<=1e-10)return a;return NaN}(this.e,2*t.y*this.k0/this.a),e=of(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t},names:["cea"]},ey={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,i=t.y,s=of(e-this.long0),n=Xm(i-this.lat0);return t.x=this.x0+this.a*s*this.rc,t.y=this.y0+this.a*n,t},inverse:function(t){var e=t.x,i=t.y;return t.x=of(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=Xm(this.lat0+(i-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};const iy={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=jm(this.es),this.e1=qm(this.es),this.e2=Um(this.es),this.e3=Ym(this.es),this.ml0=this.a*Bm(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,i,s,n=t.x,r=t.y,o=of(n-this.long0);if(s=o*Math.sin(r),this.sphere)Math.abs(r)<=I_?(e=this.a*o,i=-1*this.a*this.lat0):(e=this.a*Math.sin(s)/Math.tan(r),i=this.a*(Xm(r-this.lat0)+(1-Math.cos(s))/Math.tan(r)));else if(Math.abs(r)<=I_)e=this.a*o,i=-1*this.ml0;else{var a=Vm(this.a,this.e,Math.sin(r))/Math.tan(r);e=a*Math.sin(s),i=this.a*Bm(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+a*(1-Math.cos(s))}return t.x=e+this.x0,t.y=i+this.y0,t},inverse:function(t){var e,i,s,n,r,o,a,h,l;if(s=t.x-this.x0,n=t.y-this.y0,this.sphere)if(Math.abs(n+this.a*this.lat0)<=I_)e=of(s/this.a+this.long0),i=0;else{var c;for(o=this.lat0+n/this.a,a=s*s/this.a/this.a+o*o,h=o,r=20;r;--r)if(h+=l=-1*(o*(h*(c=Math.tan(h))+1)-h-.5*(h*h+a)*c)/((h-o)/c-1),Math.abs(l)<=I_){i=h;break}e=of(this.long0+Math.asin(s*Math.tan(h)/this.a)/Math.sin(i))}else if(Math.abs(n+this.ml0)<=I_)i=0,e=of(this.long0+s/this.a);else{var u,d,g,p,_;for(o=(this.ml0+n)/this.a,a=s*s/this.a/this.a+o*o,h=o,r=20;r;--r)if(_=this.e*Math.sin(h),u=Math.sqrt(1-_*_)*Math.tan(h),d=this.a*Bm(this.e0,this.e1,this.e2,this.e3,h),g=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),h-=l=(o*(u*(p=d/this.a)+1)-p-.5*u*(p*p+a))/(this.es*Math.sin(2*h)*(p*p+a-2*o*p)/(4*u)+(o-p)*(u*g-2/Math.sin(2*h))-g),Math.abs(l)<=I_){i=h;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=of(this.long0+Math.asin(s*u/this.a)/Math.sin(i))}return t.x=e,t.y=i,t},names:["Polyconic","poly"]},sy={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,i=t.x,s=t.y-this.lat0,n=i-this.long0,r=s/M_*1e-5,o=n,a=1,h=0;for(e=1;e<=10;e++)a*=r,h+=this.A[e]*a;var l,c=h,u=o,d=1,g=0,p=0,_=0;for(e=1;e<=6;e++)l=g*c+d*u,d=d*c-g*u,g=l,p=p+this.B_re[e]*d-this.B_im[e]*g,_=_+this.B_im[e]*d+this.B_re[e]*g;return t.x=_*this.a+this.x0,t.y=p*this.a+this.y0,t},inverse:function(t){var e,i,s=t.x,n=t.y,r=s-this.x0,o=(n-this.y0)/this.a,a=r/this.a,h=1,l=0,c=0,u=0;for(e=1;e<=6;e++)i=l*o+h*a,h=h*o-l*a,l=i,c=c+this.C_re[e]*h-this.C_im[e]*l,u=u+this.C_im[e]*h+this.C_re[e]*l;for(var d=0;d<this.iterations;d++){var g,p=c,_=u,f=o,m=a;for(e=2;e<=6;e++)g=_*c+p*u,p=p*c-_*u,_=g,f+=(e-1)*(this.B_re[e]*p-this.B_im[e]*_),m+=(e-1)*(this.B_im[e]*p+this.B_re[e]*_);p=1,_=0;var y=this.B_re[1],x=this.B_im[1];for(e=2;e<=6;e++)g=_*c+p*u,p=p*c-_*u,_=g,y+=e*(this.B_re[e]*p-this.B_im[e]*_),x+=e*(this.B_im[e]*p+this.B_re[e]*_);var v=y*y+x*x;c=(f*y+m*x)/v,u=(m*y-f*x)/v}var w=c,M=u,E=1,C=0;for(e=1;e<=9;e++)E*=w,C+=this.D[e]*E;var S=this.lat0+C*M_*1e5,b=this.long0+M;return t.x=b,t.y=S,t},names:["New_Zealand_Map_Grid","nzmg"]},ny={init:function(){},forward:function(t){var e=t.x,i=t.y,s=of(e-this.long0),n=this.x0+this.a*s,r=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=n,t.y=r,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=of(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t},names:["Miller_Cylindrical","mill"]};const ry={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=vm(this.es)},forward:function(t){var e,i,s=t.x,n=t.y;if(s=of(s-this.long0),this.sphere){if(this.m)for(var r=this.n*Math.sin(n),o=20;o;--o){var a=(this.m*n+Math.sin(n)-r)/(this.m+Math.cos(n));if(n-=a,Math.abs(a)<I_)break}else n=1!==this.n?Math.asin(this.n*Math.sin(n)):n;e=this.a*this.C_x*s*(this.m+Math.cos(n)),i=this.a*this.C_y*n}else{var h=Math.sin(n),l=Math.cos(n);i=this.a*wm(n,h,l,this.en),e=this.a*s*l/Math.sqrt(1-this.es*h*h)}return t.x=e,t.y=i,t},inverse:function(t){var e,i,s;return t.x-=this.x0,i=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,i/=this.C_x*(this.m+Math.cos(e)),this.m?e=Zm((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=Zm(Math.sin(e)/this.n)),i=of(i+this.long0),e=Xm(e)):(e=Em(t.y/this.a,this.es,this.en),(s=Math.abs(e))<E_?(s=Math.sin(e),i=of(this.long0+t.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(e)))):s-I_<E_&&(i=this.long0)),t.x=i,t.y=e,t},names:["Sinusoidal","sinu"]},oy={init:function(){},forward:function(t){for(var e=t.x,i=t.y,s=of(e-this.long0),n=i,r=Math.PI*Math.sin(i);;){var o=-(n+Math.sin(n)-r)/(1+Math.cos(n));if(n+=o,Math.abs(o)<I_)break}n/=2,Math.PI/2-Math.abs(i)<I_&&(s=0);var a=.900316316158*this.a*s*Math.cos(n)+this.x0,h=1.4142135623731*this.a*Math.sin(n)+this.y0;return t.x=a,t.y=h,t},inverse:function(t){var e,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var s=of(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));s<-Math.PI&&(s=-Math.PI),s>Math.PI&&(s=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var n=Math.asin(i);return t.x=s,t.y=n,t},names:["Mollweide","moll"]},ay={init:function(){Math.abs(this.lat1+this.lat2)<I_||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=jm(this.es),this.e1=qm(this.es),this.e2=Um(this.es),this.e3=Ym(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=nf(this.e,this.sinphi,this.cosphi),this.ml1=Bm(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<I_?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=nf(this.e,this.sinphi,this.cosphi),this.ml2=Bm(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Bm(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,i=t.x,s=t.y;if(this.sphere)e=this.a*(this.g-s);else{var n=Bm(this.e0,this.e1,this.e2,this.e3,s);e=this.a*(this.g-n)}var r=this.ns*of(i-this.long0),o=this.x0+e*Math.sin(r),a=this.y0+this.rh-e*Math.cos(r);return t.x=o,t.y=a,t},inverse:function(t){var e,i,s,n;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var r=0;return 0!==i&&(r=Math.atan2(e*t.x,e*t.y)),this.sphere?(n=of(this.long0+r/this.ns),s=Xm(this.g-i/this.a),t.x=n,t.y=s,t):(s=Wm(this.g-i/this.a,this.e0,this.e1,this.e2,this.e3),n=of(this.long0+r/this.ns),t.x=n,t.y=s,t)},names:["Equidistant_Conic","eqdc"]},hy={init:function(){this.R=this.a},forward:function(t){var e,i,s=t.x,n=t.y,r=of(s-this.long0);Math.abs(n)<=I_&&(e=this.x0+this.R*r,i=this.y0);var o=Zm(2*Math.abs(n/Math.PI));(Math.abs(r)<=I_||Math.abs(Math.abs(n)-E_)<=I_)&&(e=this.x0,i=n>=0?this.y0+Math.PI*this.R*Math.tan(.5*o):this.y0+Math.PI*this.R*-Math.tan(.5*o));var a=.5*Math.abs(Math.PI/r-r/Math.PI),h=a*a,l=Math.sin(o),c=Math.cos(o),u=c/(l+c-1),d=u*u,g=u*(2/l-1),p=g*g,_=Math.PI*this.R*(a*(u-p)+Math.sqrt(h*(u-p)*(u-p)-(p+h)*(d-p)))/(p+h);r<0&&(_=-_),e=this.x0+_;var f=h+u;return _=Math.PI*this.R*(g*f-a*Math.sqrt((p+h)*(h+1)-f*f))/(p+h),i=n>=0?this.y0+_:this.y0-_,t.x=e,t.y=i,t},inverse:function(t){var e,i,s,n,r,o,a,h,l,c,u,d;return t.x-=this.x0,t.y-=this.y0,u=Math.PI*this.R,r=(s=t.x/u)*s+(n=t.y/u)*n,u=3*(n*n/(h=-2*(o=-Math.abs(n)*(1+r))+1+2*n*n+r*r)+(2*(a=o-2*n*n+s*s)*a*a/h/h/h-9*o*a/h/h)/27)/(l=(o-a*a/3/h)/h)/(c=2*Math.sqrt(-l/3)),Math.abs(u)>1&&(u=u>=0?1:-1),d=Math.acos(u)/3,i=t.y>=0?(-c*Math.cos(d+Math.PI/3)-a/3/h)*Math.PI:-(-c*Math.cos(d+Math.PI/3)-a/3/h)*Math.PI,e=Math.abs(s)<I_?this.long0:of(this.long0+Math.PI*(r-1+Math.sqrt(1+2*(s*s-n*n)+r*r))/2/s),t.x=e,t.y=i,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},ly={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,i,s,n,r,o,a,h,l,c,u,d,g,p,_,f,m,y,x,v,w,M,E=t.x,C=t.y,S=Math.sin(t.y),b=Math.cos(t.y),I=of(E-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=I_?(t.x=this.x0+this.a*(E_-C)*Math.sin(I),t.y=this.y0-this.a*(E_-C)*Math.cos(I),t):Math.abs(this.sin_p12+1)<=I_?(t.x=this.x0+this.a*(E_+C)*Math.sin(I),t.y=this.y0+this.a*(E_+C)*Math.cos(I),t):(y=this.sin_p12*S+this.cos_p12*b*Math.cos(I),m=(f=Math.acos(y))?f/Math.sin(f):1,t.x=this.x0+this.a*m*b*Math.sin(I),t.y=this.y0+this.a*m*(this.cos_p12*S-this.sin_p12*b*Math.cos(I)),t):(e=jm(this.es),i=qm(this.es),s=Um(this.es),n=Ym(this.es),Math.abs(this.sin_p12-1)<=I_?(r=this.a*Bm(e,i,s,n,E_),o=this.a*Bm(e,i,s,n,C),t.x=this.x0+(r-o)*Math.sin(I),t.y=this.y0-(r-o)*Math.cos(I),t):Math.abs(this.sin_p12+1)<=I_?(r=this.a*Bm(e,i,s,n,E_),o=this.a*Bm(e,i,s,n,C),t.x=this.x0+(r+o)*Math.sin(I),t.y=this.y0+(r+o)*Math.cos(I),t):(a=S/b,h=Vm(this.a,this.e,this.sin_p12),l=Vm(this.a,this.e,S),c=Math.atan((1-this.es)*a+this.es*h*this.sin_p12/(l*b)),x=0===(u=Math.atan2(Math.sin(I),this.cos_p12*Math.tan(c)-this.sin_p12*Math.cos(I)))?Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.abs(Math.abs(u)-Math.PI)<=I_?-Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.asin(Math.sin(I)*Math.cos(c)/Math.sin(u)),d=this.e*this.sin_p12/Math.sqrt(1-this.es),f=h*x*(1-(v=x*x)*(_=(g=this.e*this.cos_p12*Math.cos(u)/Math.sqrt(1-this.es))*g)*(1-_)/6+(w=v*x)/8*(p=d*g)*(1-2*_)+(M=w*x)/120*(_*(4-7*_)-3*d*d*(1-7*_))-M*x/48*p),t.x=this.x0+f*Math.sin(u),t.y=this.y0+f*Math.cos(u),t))},inverse:function(t){var e,i,s,n,r,o,a,h,l,c,u,d,g,p,_,f,m,y,x,v,w,M,E;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*E_*this.a)return;return i=e/this.a,s=Math.sin(i),n=Math.cos(i),r=this.long0,Math.abs(e)<=I_?o=this.lat0:(o=Zm(n*this.sin_p12+t.y*s*this.cos_p12/e),a=Math.abs(this.lat0)-E_,r=Math.abs(a)<=I_?this.lat0>=0?of(this.long0+Math.atan2(t.x,-t.y)):of(this.long0-Math.atan2(-t.x,t.y)):of(this.long0+Math.atan2(t.x*s,e*this.cos_p12*n-t.y*this.sin_p12*s))),t.x=r,t.y=o,t}return h=jm(this.es),l=qm(this.es),c=Um(this.es),u=Ym(this.es),Math.abs(this.sin_p12-1)<=I_?(o=Wm(((d=this.a*Bm(h,l,c,u,E_))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,h,l,c,u),r=of(this.long0+Math.atan2(t.x,-1*t.y)),t.x=r,t.y=o,t):Math.abs(this.sin_p12+1)<=I_?(d=this.a*Bm(h,l,c,u,E_),o=Wm(((e=Math.sqrt(t.x*t.x+t.y*t.y))-d)/this.a,h,l,c,u),r=of(this.long0+Math.atan2(t.x,t.y)),t.x=r,t.y=o,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),_=Math.atan2(t.x,t.y),g=Vm(this.a,this.e,this.sin_p12),f=Math.cos(_),y=-(m=this.e*this.cos_p12*f)*m/(1-this.es),x=3*this.es*(1-y)*this.sin_p12*this.cos_p12*f/(1-this.es),M=1-y*(w=(v=e/g)-y*(1+y)*Math.pow(v,3)/6-x*(1+3*y)*Math.pow(v,4)/24)*w/2-v*w*w*w/6,p=Math.asin(this.sin_p12*Math.cos(w)+this.cos_p12*Math.sin(w)*f),r=of(this.long0+Math.asin(Math.sin(_)*Math.sin(w)/Math.cos(p))),E=Math.sin(p),o=Math.atan2((E-this.es*M*this.sin_p12)*Math.tan(p),E*(1-this.es)),t.x=r,t.y=o,t)},names:["Azimuthal_Equidistant","aeqd"]},cy={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,i,s,n,r,o,a,h=t.x,l=t.y;return s=of(h-this.long0),e=Math.sin(l),i=Math.cos(l),n=Math.cos(s),((r=this.sin_p14*e+this.cos_p14*i*n)>0||Math.abs(r)<=I_)&&(o=1*this.a*i*Math.sin(s),a=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*i*n)),t.x=o,t.y=a,t},inverse:function(t){var e,i,s,n,r,o,a;return t.x-=this.x0,t.y-=this.y0,i=Zm((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),s=Math.sin(i),n=Math.cos(i),o=this.long0,Math.abs(e)<=I_?(a=this.lat0,t.x=o,t.y=a,t):(a=Zm(n*this.sin_p14+t.y*s*this.cos_p14/e),r=Math.abs(this.lat0)-E_,Math.abs(r)<=I_?(o=this.lat0>=0?of(this.long0+Math.atan2(t.x,-t.y)):of(this.long0-Math.atan2(-t.x,t.y)),t.x=o,t.y=a,t):(o=of(this.long0+Math.atan2(t.x*s,e*this.cos_p14*n-t.y*this.sin_p14*s)),t.x=o,t.y=a,t))},names:["ortho"]};var uy=1,dy=2,gy=3,py=4,_y=5,fy=6,my={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function yy(t,e,i,s){var n;return t<I_?(s.value=my.AREA_0,n=0):(n=Math.atan2(e,i),Math.abs(n)<=N_?s.value=my.AREA_0:n>N_&&n<=E_+N_?(s.value=my.AREA_1,n-=E_):n>E_+N_||n<=-(E_+N_)?(s.value=my.AREA_2,n=n>=0?n-P_:n+P_):(s.value=my.AREA_3,n+=E_)),n}function xy(t,e){var i=t+e;return i<-P_?i+=R_:i>+P_&&(i-=R_),i}const vy={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=E_-N_/2?this.face=_y:this.lat0<=-(E_-N_/2)?this.face=fy:Math.abs(this.long0)<=N_?this.face=uy:Math.abs(this.long0)<=E_+N_?this.face=this.long0>0?dy:py:this.face=gy,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,i,s,n,r,o,a={x:0,y:0},h={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,i=t.x,this.face===_y)n=E_-e,i>=N_&&i<=E_+N_?(h.value=my.AREA_0,s=i-E_):i>E_+N_||i<=-(E_+N_)?(h.value=my.AREA_1,s=i>0?i-P_:i+P_):i>-(E_+N_)&&i<=-N_?(h.value=my.AREA_2,s=i+E_):(h.value=my.AREA_3,s=i);else if(this.face===fy)n=E_+e,i>=N_&&i<=E_+N_?(h.value=my.AREA_0,s=-i+E_):i<N_&&i>=-N_?(h.value=my.AREA_1,s=-i):i<-N_&&i>=-(E_+N_)?(h.value=my.AREA_2,s=-i-E_):(h.value=my.AREA_3,s=i>0?-i+P_:-i-P_);else{var l,c,u,d,g,p;this.face===dy?i=xy(i,+E_):this.face===gy?i=xy(i,+P_):this.face===py&&(i=xy(i,-E_)),d=Math.sin(e),g=Math.cos(e),p=Math.sin(i),l=g*Math.cos(i),c=g*p,u=d,this.face===uy?s=yy(n=Math.acos(l),u,c,h):this.face===dy?s=yy(n=Math.acos(c),u,-l,h):this.face===gy?s=yy(n=Math.acos(-l),u,-c,h):this.face===py?s=yy(n=Math.acos(-c),u,l,h):(n=s=0,h.value=my.AREA_0)}return o=Math.atan(12/P_*(s+Math.acos(Math.sin(s)*Math.cos(N_))-E_)),r=Math.sqrt((1-Math.cos(n))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(s))))),h.value===my.AREA_1?o+=E_:h.value===my.AREA_2?o+=P_:h.value===my.AREA_3&&(o+=1.5*P_),a.x=r*Math.cos(o),a.y=r*Math.sin(o),a.x=a.x*this.a+this.x0,a.y=a.y*this.a+this.y0,t.x=a.x,t.y=a.y,t},inverse:function(t){var e,i,s,n,r,o,a,h,l,c,u,d,g={lam:0,phi:0},p={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,i=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?p.value=my.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(p.value=my.AREA_1,e-=E_):t.x<0&&-t.x>=Math.abs(t.y)?(p.value=my.AREA_2,e=e<0?e+P_:e-P_):(p.value=my.AREA_3,e+=E_),l=P_/12*Math.tan(e),r=Math.sin(l)/(Math.cos(l)-1/Math.sqrt(2)),o=Math.atan(r),(a=1-(s=Math.cos(e))*s*(n=Math.tan(i))*n*(1-Math.cos(Math.atan(1/Math.cos(o)))))<-1?a=-1:a>1&&(a=1),this.face===_y)h=Math.acos(a),g.phi=E_-h,p.value===my.AREA_0?g.lam=o+E_:p.value===my.AREA_1?g.lam=o<0?o+P_:o-P_:p.value===my.AREA_2?g.lam=o-E_:g.lam=o;else if(this.face===fy)h=Math.acos(a),g.phi=h-E_,p.value===my.AREA_0?g.lam=-o+E_:p.value===my.AREA_1?g.lam=-o:p.value===my.AREA_2?g.lam=-o-E_:g.lam=o<0?-o-P_:-o+P_;else{var _,f,m;l=(_=a)*_,f=(l+=(m=l>=1?0:Math.sqrt(1-l)*Math.sin(o))*m)>=1?0:Math.sqrt(1-l),p.value===my.AREA_1?(l=f,f=-m,m=l):p.value===my.AREA_2?(f=-f,m=-m):p.value===my.AREA_3&&(l=f,f=m,m=-l),this.face===dy?(l=_,_=-f,f=l):this.face===gy?(_=-_,f=-f):this.face===py&&(l=_,_=f,f=-l),g.phi=Math.acos(-m)-E_,g.lam=Math.atan2(f,_),this.face===dy?g.lam=xy(g.lam,-E_):this.face===gy?g.lam=xy(g.lam,-P_):this.face===py&&(g.lam=xy(g.lam,+E_))}return 0!==this.es&&(c=g.phi<0?1:0,u=Math.tan(g.phi),d=this.b/Math.sqrt(u*u+this.one_minus_f_squared),g.phi=Math.atan(Math.sqrt(this.a*this.a-d*d)/(this.one_minus_f*d)),c&&(g.phi=-g.phi)),g.lam+=this.long0,t.x=g.lam,t.y=g.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var wy=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],My=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Ey=.8487,Cy=1.3523,Sy=T_/5,by=1/Sy,Iy=18,Ly=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))};const Ty={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=of(t.x-this.long0),i=Math.abs(t.y),s=Math.floor(i*Sy);s<0?s=0:s>=Iy&&(s=17);var n={x:Ly(wy[s],i=T_*(i-by*s))*e,y:Ly(My[s],i)};return t.y<0&&(n.y=-n.y),n.x=n.x*this.a*Ey+this.x0,n.y=n.y*this.a*Cy+this.y0,n},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*Ey),y:Math.abs(t.y-this.y0)/(this.a*Cy)};if(e.y>=1)e.x/=wy[18][0],e.y=t.y<0?-E_:E_;else{var i=Math.floor(e.y*Iy);for(i<0?i=0:i>=Iy&&(i=17);;)if(My[i][0]>e.y)--i;else{if(!(My[i+1][0]<=e.y))break;++i}var s=My[i],n=5*(e.y-s[0])/(My[i+1][0]-s[0]);n=function(t,e,i,s){for(var n=e;s;--s){var r=t(n);if(n-=r,Math.abs(r)<i)break}return n}((function(t){return(Ly(s,t)-e.y)/function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])}(s,t)}),n,I_,100),e.x/=Ly(wy[i],n),e.y=(5*i+n)*L_,t.y<0&&(e.y=-e.y)}return e.x=of(e.x+this.long0),e},names:["Robinson","robin"]},Ny={init:function(){this.name="geocent"},forward:function(t){return Tf(t,this.es,this.a)},inverse:function(t){return Nf(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var Ry=0,Py=1,Oy=2,Ay=3,Fy={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const Dy={init:function(){if(Object.keys(Fy).forEach(function(t){if(void 0===this[t])this[t]=Fy[t].def;else{if(Fy[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);Fy[t].num&&(this[t]=parseFloat(this[t]))}Fy[t].degrees&&(this[t]=this[t]*L_)}.bind(this)),Math.abs(Math.abs(this.lat0)-E_)<I_?this.mode=this.lat0<0?Py:Ry:Math.abs(this.lat0)<I_?this.mode=Oy:(this.mode=Ay,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,i,s,n,r=Math.sin(t.y),o=Math.cos(t.y),a=Math.cos(t.x);switch(this.mode){case Ay:i=this.sinph0*r+this.cosph0*o*a;break;case Oy:i=o*a;break;case Py:i=-r;break;case Ry:i=r}switch(e=(i=this.pn1/(this.p-i))*o*Math.sin(t.x),this.mode){case Ay:i*=this.cosph0*r-this.sinph0*o*a;break;case Oy:i*=r;break;case Ry:i*=-o*a;break;case Py:i*=o*a}return n=1/((s=i*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-i*this.sg)*this.cw*n,i=s*n,t.x=e*this.a,t.y=i*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,i,s,n={x:t.x,y:t.y};s=1/(this.pn1-t.y*this.sw),e=this.pn1*t.x*s,i=this.pn1*t.y*this.cw*s,t.x=e*this.cg+i*this.sg,t.y=i*this.cg-e*this.sg;var r=bm(t.x,t.y);if(Math.abs(r)<I_)n.x=0,n.y=t.y;else{var o,a;switch(a=1-r*r*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/r+r/this.pn1),o=Math.sqrt(1-a*a),this.mode){case Ay:n.y=Math.asin(o*this.sinph0+t.y*a*this.cosph0/r),t.y=(o-this.sinph0*Math.sin(n.y))*r,t.x*=a*this.cosph0;break;case Oy:n.y=Math.asin(t.y*a/r),t.y=o*r,t.x*=a;break;case Ry:n.y=Math.asin(o),t.y=-t.y;break;case Py:n.y=-Math.asin(o)}n.x=Math.atan2(t.x,t.y)}return t.x=n.x+this.long0,t.y=n.y,t},names:["Tilted_Perspective","tpers"]},ky={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(t){var e,i,s,n,r=t.x,o=t.y;if(r-=this.long0,"ellipse"===this.shape){o=Math.atan(this.radius_p2*Math.tan(o));var a=this.radius_p/bm(this.radius_p*Math.cos(o),Math.sin(o));if(i=a*Math.cos(r)*Math.cos(o),s=a*Math.sin(r)*Math.cos(o),n=a*Math.sin(o),(this.radius_g-i)*i-s*s-n*n*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=this.radius_g-i,this.flip_axis?(t.x=this.radius_g_1*Math.atan(s/bm(n,e)),t.y=this.radius_g_1*Math.atan(n/e)):(t.x=this.radius_g_1*Math.atan(s/e),t.y=this.radius_g_1*Math.atan(n/bm(s,e)))}else"sphere"===this.shape&&(e=Math.cos(o),i=Math.cos(r)*e,s=Math.sin(r)*e,n=Math.sin(o),e=this.radius_g-i,this.flip_axis?(t.x=this.radius_g_1*Math.atan(s/bm(n,e)),t.y=this.radius_g_1*Math.atan(n/e)):(t.x=this.radius_g_1*Math.atan(s/e),t.y=this.radius_g_1*Math.atan(n/bm(s,e))));return t.x=t.x*this.a,t.y=t.y*this.a,t},inverse:function(t){var e,i,s,n,r=-1,o=0,a=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(a=Math.tan(t.y/this.radius_g_1),o=Math.tan(t.x/this.radius_g_1)*bm(1,a)):(o=Math.tan(t.x/this.radius_g_1),a=Math.tan(t.y/this.radius_g_1)*bm(1,o));var h=a/this.radius_p;if(e=o*o+h*h+r*r,(s=(i=2*this.radius_g*r)*i-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;n=(-i-Math.sqrt(s))/(2*e),r=this.radius_g+n*r,o*=n,a*=n,t.x=Math.atan2(o,r),t.y=Math.atan(a*Math.cos(t.x)/r),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if("sphere"===this.shape){if(this.flip_axis?(a=Math.tan(t.y/this.radius_g_1),o=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+a*a)):(o=Math.tan(t.x/this.radius_g_1),a=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+o*o)),e=o*o+a*a+r*r,(s=(i=2*this.radius_g*r)*i-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;n=(-i-Math.sqrt(s))/(2*e),r=this.radius_g+n*r,o*=n,a*=n,t.x=Math.atan2(o,r),t.y=Math.atan(a*Math.cos(t.x)/r)}return t.x=t.x+this.long0,t},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};var Gy;qf.defaultDatum="WGS84",qf.Proj=Lf,qf.WGS84=new qf.Proj("WGS84"),qf.Point=am,qf.toPoint=Df,qf.defs=J_,qf.nadgrid=function(t,e){var i=new DataView(e),s=function(t){var e=t.getInt32(8,!1);return 11!==e&&(11!==(e=t.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}(i),n=function(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:Ef(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}(i,s);n.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var r=function(t,e,i){for(var s=[],n=0;n<e.nSubgrids;n++){var r=Sf(t,176,i),o=bf(t,176,r,i),a=Math.round(1+(r.upperLongitude-r.lowerLongitude)/r.longitudeInterval),h=Math.round(1+(r.upperLatitude-r.lowerLatitude)/r.latitudeInterval);s.push({ll:[Mf(r.lowerLongitude),Mf(r.lowerLatitude)],del:[Mf(r.longitudeInterval),Mf(r.latitudeInterval)],lim:[a,h],count:r.gridNodeCount,cvs:Cf(o)})}return s}(i,n,s),o={header:n,subgrids:r};return vf[t]=o,o},qf.transform=Gf,qf.mgrs=Zf,qf.version="__VERSION__",(Gy=qf).Proj.projections.add(Cm),Gy.Proj.projections.add(Tm),Gy.Proj.projections.add(Nm),Gy.Proj.projections.add(Om),Gy.Proj.projections.add(Am),Gy.Proj.projections.add(Fm),Gy.Proj.projections.add(km),Gy.Proj.projections.add(Gm),Gy.Proj.projections.add(zm),Gy.Proj.projections.add($m),Gy.Proj.projections.add(Km),Gy.Proj.projections.add(Jm),Gy.Proj.projections.add(Qm),Gy.Proj.projections.add(ty),Gy.Proj.projections.add(ey),Gy.Proj.projections.add(iy),Gy.Proj.projections.add(sy),Gy.Proj.projections.add(ny),Gy.Proj.projections.add(ry),Gy.Proj.projections.add(oy),Gy.Proj.projections.add(ay),Gy.Proj.projections.add(hy),Gy.Proj.projections.add(ly),Gy.Proj.projections.add(cy),Gy.Proj.projections.add(vy),Gy.Proj.projections.add(Ty),Gy.Proj.projections.add(Ny),Gy.Proj.projections.add(Dy),Gy.Proj.projections.add(ky);const zy=qf;class By{constructor(){lizMap.events.on({layerSelectionChanged:t=>{qy.dispatch({type:"selection.changed",properties:t})},layerFilteredFeaturesChanged:t=>{qy.dispatch({type:"filteredFeatures.changed",properties:t})}})}}const jy=new class{constructor(){lizMap.events.on({uicreated:()=>{if(this._lizmap3=lizMap,!qi(this.projection)){const t=this.config.options.projection;zy.defs(t.ref,t.proj4)}if(!qi(this.config.options.qgisProjectProjection.ref)){const t=this.config.options.qgisProjectProjection;zy.defs(t.ref,t.proj4)}(function(t){p_=t;const e=Object.keys(t.defs),i=e.length;let s,n;for(s=0;s<i;++s){const i=e[s];if(!qi(i)){const e=t.defs(i);let s=e.units;s||"longlat"!==e.projName||(s="degrees"),ji(new fi({code:i,axisOrientation:e.axis,metersPerUnit:e.to_meter,units:s}))}}for(s=0;s<i;++s){const r=e[s],o=qi(r);for(n=0;n<i;++n){const i=e[n],s=qi(i);if(!Ri(r,i))if(t.defs[r]===t.defs[i])Yi([o,s]);else{const e=t(r,i);Wi(o,s,os(o,s,e.forward),os(s,o,e.inverse))}}}})(zy),qi(this.projection).setGetPointResolution((t=>t)),qi(this.config.options.qgisProjectProjection.ref).setGetPointResolution((t=>t)),this.map=new tr,this.edition=new er,this.geolocation=new pr,this.geolocationSurvey=new _r,this.selectionTool=new rl,this.digitizing=new mg,this.snapping=new yg,this.draw=new Hp,this.layers=new u_,this.proxyEvents=new By,this.wfs=new d_,this.wms=new g_,this.utils=ol}})}set newOlMap(t){this.map._newOlMap=t,document.getElementById("newOlMap").style.zIndex=t?750:"auto"}get lizmap3(){return this._lizmap3}get config(){return this._lizmap3.config}get projection(){return this._lizmap3.map.getProjection()}get qgisProjectProjection(){return this.config.options.qgisProjectProjection.ref}get vectorLayerFeatureTypes(){return this._lizmap3.getVectorLayerFeatureTypes()}get vectorLayerResultFormat(){return this._lizmap3.getVectorLayerResultFormat()}get serviceURL(){return lizUrls.wms+"?"+new URLSearchParams(lizUrls.params).toString()}get hasOverview(){return this._lizmap3.config.layers.hasOwnProperty("Overview")}set center(t){this.map.getView().setCenter(t)}set extent(t){this.map.getView().fit(t)}getNameByTypeName(t){return this._lizmap3.getNameByTypeName(t)}getLayerNameByCleanName(t){return this._lizmap3.getLayerNameByCleanName(t)}displayMessage(t,e,i){this._lizmap3.addMessage(t,e,i)}transform(t,e,i){return Zi(t,e,i)}transformExtent(t,e,i){return Ji(t,e,i)}},qy=new class{constructor(){this._listeners={}}addListener(t,e){void 0===e&&(e="*");const i=e=>{"string"==typeof e&&(e={type:e}),e.type in this._listeners||(this._listeners[e.type]=[]),this._listeners[e.type].push([t,e])};Array.isArray(e)?e.forEach((t=>{"*"!==t&&i(t)})):i(e)}removeListener(t,e){void 0===e&&(e="*");const i=e=>{if("string"==typeof e&&(e={type:e}),e.type in this._listeners){const i=Object.getOwnPropertyNames(e);this._listeners[e.type]=this._listeners[e.type].filter((s=>{const[n,r]=s;let o=!0;return i.forEach((t=>{o&&"type"!=t&&(t in r&&e[t]==r[t]||(o=!1))})),!o||n!==t}))}};Array.isArray(e)?e.forEach(i):"*"==e?Object.getOwnPropertyNames(this._listeners).forEach(i):i(e)}dispatch(t){if("string"==typeof t&&(t={type:t}),"*"==t.type)throw Error("Notification for all events is not allowed");t.type in this._listeners&&this._listeners[t.type].forEach((e=>{const[i,s]=e;let n=!0;Object.getOwnPropertyNames(s).forEach((e=>{n&&"type"!=e&&(e in t&&t[e]==s[e]||(n=!1))})),n&&i(t)})),"*"in this._listeners&&this._listeners["*"].forEach((e=>e(t)))}};var Uy;const Yy=window,Vy=Yy.trustedTypes,Xy=Vy?Vy.createPolicy("lit-html",{createHTML:t=>t}):void 0,Wy=`lit$${(Math.random()+"").slice(9)}$`,$y="?"+Wy,Hy=`<${$y}>`,Ky=document,Zy=(t="")=>Ky.createComment(t),Jy=t=>null===t||"object"!=typeof t&&"function"!=typeof t,Qy=Array.isArray,tx=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,ex=/-->/g,ix=/>/g,sx=RegExp(">|[ \t\n\f\r](?:([^\\s\"'>=/]+)([ \t\n\f\r]*=[ \t\n\f\r]*(?:[^ \t\n\f\r\"'`<>=]|(\"|')|))|$)","g"),nx=/'/g,rx=/"/g,ox=/^(?:script|style|textarea|title)$/i,ax=t=>(e,...i)=>({_$litType$:t,strings:e,values:i}),hx=ax(1),lx=(ax(2),Symbol.for("lit-noChange")),cx=Symbol.for("lit-nothing"),ux=new WeakMap,dx=Ky.createTreeWalker(Ky,129,null,!1),gx=(t,e)=>{const i=t.length-1,s=[];let n,r=2===e?"<svg>":"",o=tx;for(let e=0;e<i;e++){const i=t[e];let a,h,l=-1,c=0;for(;c<i.length&&(o.lastIndex=c,h=o.exec(i),null!==h);)c=o.lastIndex,o===tx?"!--"===h[1]?o=ex:void 0!==h[1]?o=ix:void 0!==h[2]?(ox.test(h[2])&&(n=RegExp("</"+h[2],"g")),o=sx):void 0!==h[3]&&(o=sx):o===sx?">"===h[0]?(o=null!=n?n:tx,l=-1):void 0===h[1]?l=-2:(l=o.lastIndex-h[2].length,a=h[1],o=void 0===h[3]?sx:'"'===h[3]?rx:nx):o===rx||o===nx?o=sx:o===ex||o===ix?o=tx:(o=sx,n=void 0);const u=o===sx&&t[e+1].startsWith("/>")?" ":"";r+=o===tx?i+Hy:l>=0?(s.push(a),i.slice(0,l)+"$lit$"+i.slice(l)+Wy+u):i+Wy+(-2===l?(s.push(void 0),e):u)}const a=r+(t[i]||"<?>")+(2===e?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==Xy?Xy.createHTML(a):a,s]};class px{constructor({strings:t,_$litType$:e},i){let s;this.parts=[];let n=0,r=0;const o=t.length-1,a=this.parts,[h,l]=gx(t,e);if(this.el=px.createElement(h,i),dx.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(s=dx.nextNode())&&a.length<o;){if(1===s.nodeType){if(s.hasAttributes()){const t=[];for(const e of s.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(Wy)){const i=l[r++];if(t.push(e),void 0!==i){const t=s.getAttribute(i.toLowerCase()+"$lit$").split(Wy),e=/([.?@])?(.*)/.exec(i);a.push({type:1,index:n,name:e[2],strings:t,ctor:"."===e[1]?xx:"?"===e[1]?wx:"@"===e[1]?Mx:yx})}else a.push({type:6,index:n})}for(const e of t)s.removeAttribute(e)}if(ox.test(s.tagName)){const t=s.textContent.split(Wy),e=t.length-1;if(e>0){s.textContent=Vy?Vy.emptyScript:"";for(let i=0;i<e;i++)s.append(t[i],Zy()),dx.nextNode(),a.push({type:2,index:++n});s.append(t[e],Zy())}}}else if(8===s.nodeType)if(s.data===$y)a.push({type:2,index:n});else{let t=-1;for(;-1!==(t=s.data.indexOf(Wy,t+1));)a.push({type:7,index:n}),t+=Wy.length-1}n++}}static createElement(t,e){const i=Ky.createElement("template");return i.innerHTML=t,i}}function _x(t,e,i=t,s){var n,r,o,a;if(e===lx)return e;let h=void 0!==s?null===(n=i._$Co)||void 0===n?void 0:n[s]:i._$Cl;const l=Jy(e)?void 0:e._$litDirective$;return(null==h?void 0:h.constructor)!==l&&(null===(r=null==h?void 0:h._$AO)||void 0===r||r.call(h,!1),void 0===l?h=void 0:(h=new l(t),h._$AT(t,i,s)),void 0!==s?(null!==(o=(a=i)._$Co)&&void 0!==o?o:a._$Co=[])[s]=h:i._$Cl=h),void 0!==h&&(e=_x(t,h._$AS(t,e.values),h,s)),e}class fx{constructor(t,e){this.u=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(t){var e;const{el:{content:i},parts:s}=this._$AD,n=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:Ky).importNode(i,!0);dx.currentNode=n;let r=dx.nextNode(),o=0,a=0,h=s[0];for(;void 0!==h;){if(o===h.index){let e;2===h.type?e=new mx(r,r.nextSibling,this,t):1===h.type?e=new h.ctor(r,h.name,h.strings,this,t):6===h.type&&(e=new Ex(r,this,t)),this.u.push(e),h=s[++a]}o!==(null==h?void 0:h.index)&&(r=dx.nextNode(),o++)}return n}p(t){let e=0;for(const i of this.u)void 0!==i&&(void 0!==i.strings?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class mx{constructor(t,e,i,s){var n;this.type=2,this._$AH=cx,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=s,this._$Cm=null===(n=null==s?void 0:s.isConnected)||void 0===n||n}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cm}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=_x(this,t,e),Jy(t)?t===cx||null==t||""===t?(this._$AH!==cx&&this._$AR(),this._$AH=cx):t!==this._$AH&&t!==lx&&this.g(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):(t=>Qy(t)||"function"==typeof(null==t?void 0:t[Symbol.iterator]))(t)?this.k(t):this.g(t)}O(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}g(t){this._$AH!==cx&&Jy(this._$AH)?this._$AA.nextSibling.data=t:this.T(Ky.createTextNode(t)),this._$AH=t}$(t){var e;const{values:i,_$litType$:s}=t,n="number"==typeof s?this._$AC(t):(void 0===s.el&&(s.el=px.createElement(s.h,this.options)),s);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===n)this._$AH.p(i);else{const t=new fx(n,this),e=t.v(this.options);t.p(i),this.T(e),this._$AH=t}}_$AC(t){let e=ux.get(t.strings);return void 0===e&&ux.set(t.strings,e=new px(t)),e}k(t){Qy(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,s=0;for(const n of t)s===e.length?e.push(i=new mx(this.O(Zy()),this.O(Zy()),this,this.options)):i=e[s],i._$AI(n),s++;s<e.length&&(this._$AR(i&&i._$AB.nextSibling,s),e.length=s)}_$AR(t=this._$AA.nextSibling,e){var i;for(null===(i=this._$AP)||void 0===i||i.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$Cm=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}}class yx{constructor(t,e,i,s,n){this.type=1,this._$AH=cx,this._$AN=void 0,this.element=t,this.name=e,this._$AM=s,this.options=n,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=cx}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,i,s){const n=this.strings;let r=!1;if(void 0===n)t=_x(this,t,e,0),r=!Jy(t)||t!==this._$AH&&t!==lx,r&&(this._$AH=t);else{const s=t;let o,a;for(t=n[0],o=0;o<n.length-1;o++)a=_x(this,s[i+o],e,o),a===lx&&(a=this._$AH[o]),r||(r=!Jy(a)||a!==this._$AH[o]),a===cx?t=cx:t!==cx&&(t+=(null!=a?a:"")+n[o+1]),this._$AH[o]=a}r&&!s&&this.j(t)}j(t){t===cx?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class xx extends yx{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===cx?void 0:t}}const vx=Vy?Vy.emptyScript:"";class wx extends yx{constructor(){super(...arguments),this.type=4}j(t){t&&t!==cx?this.element.setAttribute(this.name,vx):this.element.removeAttribute(this.name)}}class Mx extends yx{constructor(t,e,i,s,n){super(t,e,i,s,n),this.type=5}_$AI(t,e=this){var i;if((t=null!==(i=_x(this,t,e,0))&&void 0!==i?i:cx)===lx)return;const s=this._$AH,n=t===cx&&s!==cx||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,r=t!==cx&&(s===cx||n);n&&this.element.removeEventListener(this.name,this,s),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,i;"function"==typeof this._$AH?this._$AH.call(null!==(i=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==i?i:this.element,t):this._$AH.handleEvent(t)}}class Ex{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){_x(this,t)}}const Cx=Yy.litHtmlPolyfillSupport;null==Cx||Cx(px,mx),(null!==(Uy=Yy.litHtmlVersions)&&void 0!==Uy?Uy:Yy.litHtmlVersions=[]).push("2.6.1");const Sx=(t,e,i)=>{var s,n;const r=null!==(s=null==i?void 0:i.renderBefore)&&void 0!==s?s:e;let o=r._$litPart$;if(void 0===o){const t=null!==(n=null==i?void 0:i.renderBefore)&&void 0!==n?n:null;r._$litPart$=o=new mx(e.insertBefore(Zy(),t),t,void 0,null!=i?i:{})}return o._$AI(t),o};class bx extends HTMLElement{constructor(){super()}connectedCallback(){const t=()=>hx`
        <div class="menu-content">
            <div class="button-bar">
                <button class="btn btn-small ${jy.geolocation.isTracking?"active btn-success":""}" @click=${()=>jy.geolocation.toggleTracking()} ?disabled=${jy.geolocation.isTracking&&jy.geolocation.firstGeolocation}><span class="icon"></span>${jy.geolocation.isTracking?jy.geolocation.firstGeolocation?lizDict["geolocate.toolbar.waiting"]:lizDict["geolocate.toolbar.stop"]:lizDict["geolocate.toolbar.start"]}</button>
                <button class="btn btn-small" @click=${()=>jy.geolocation.center()} ?disabled=${!jy.geolocation.isTracking|jy.geolocation.isBind|jy.geolocation.firstGeolocation}><span class="icon"></span>${lizDict["geolocate.toolbar.center"]}</button>
                <div class="input-prepend input-append">
                    <button class="btn btn-small ${jy.geolocation.isBind?"active btn-success":""}" @click=${()=>jy.geolocation.toggleBind()} ?disabled=${!jy.geolocation.isTracking|jy.geolocation.firstGeolocation}><span class="icon"></span>${lizDict["geolocate.toolbar.bind"]}</button>
                    <input class="input-mini" type="number" min="1" ?disabled=${!jy.geolocation.isBind||!jy.geolocation.isTracking} value="${jy.geolocation.bindIntervalInSecond}" @input=${t=>jy.geolocation.bindIntervalInSecond=parseInt(t.target.value)}>
                    <span class="add-on">s</span>
                </div>
            </div>
            <div class="geolocation-infos">
                <div>
                    <small class="geolocation-coords">
                        <div>X : ${jy.geolocation.position?jy.geolocation.position[0].toString():""}</div>
                        <div>Y : ${jy.geolocation.position?jy.geolocation.position[1].toString():""}</div>
                    </small>
                </div>
                <div>
                    <small class="geolocation-accuracy">
                        <div>${lizDict["geolocate.infos.accuracy"]} : ${jy.geolocation.accuracy}</div>
                    </small>
                </div>
            </div>
        </div>`;Sx(t(),this),qy.addListener((()=>{Sx(t(),this)}),["geolocation.isTracking","geolocation.firstGeolocation","geolocation.isBind","geolocation.position","geolocation.accuracy"])}disconnectedCallback(){}}var Ix=i(854),Lx=i.n(Ix),Tx=i(348),Nx=i.n(Tx),Rx=new(Lx())({id:"device-mobile-vibration",use:"device-mobile-vibration-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icon-tabler-device-mobile-vibration" viewBox="0 0 24 24" id="device-mobile-vibration"><path stroke="none" d="M0 0h24v24H0z" /><g transform="rotate(20 12 12)"><rect width="10" height="16" x="7" y="4" rx="1" /><path d="M11 5h2M12 17v.01M3 8v8M21 8v8" /></g></symbol>'});Nx().add(Rx);class Px extends HTMLElement{constructor(){super()}connectedCallback(){const t=()=>hx`
        <div class="${jy.geolocation.isTracking&&jy.geolocation.isLinkedToEdition?"":"hide"}">
            <h3>${lizDict["geolocation.survey.title"]}</h3>
            ${["line","polygon"].includes(jy.edition.layerGeometry)?hx`
                <div class="control-group" style="text-align:center">
                    <div class="btn-group">
                        <button class="btn ${jy.geolocationSurvey.beepMode?"active btn-success":""}" @click=${()=>jy.geolocationSurvey.toggleBeepMode()}><i class="icon-music"></i></button>
                        <button class="btn ${jy.geolocationSurvey.vibrateMode?"active btn-success":""}" @click=${()=>jy.geolocationSurvey.toggleVibrateMode()}>
                            <svg width="14" height="14">
                                <use xlink:href="#device-mobile-vibration"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="control-group">
                    <div><button class="btn ${jy.geolocationSurvey.distanceMode?"active btn-success":""}" @click=${()=>jy.geolocationSurvey.toggleDistanceMode()}>${lizDict["geolocation.survey.distance"]}</button></div>
                    <div class="controls">
                        <div class="input-append">
                            <input class="input-mini" type="number" min="0" @change=${t=>jy.geolocationSurvey.distanceLimit=parseInt(t.target.value)}><span class="add-on">m</span>
                        </div>
                        ${jy.geolocationSurvey.distanceMode?hx`${jy.edition.lastSegmentLength}`:""}
                    </div>
                </div>
                <div class="control-group">
                    <div><button class="btn ${jy.geolocationSurvey.timeMode?"active btn-success":""}" @click=${()=>jy.geolocationSurvey.toggleTimeMode()}>${lizDict["geolocation.survey.time"]}</button></div>
                    <div class="controls">
                        <div class="input-append">
                            <input class="input-mini" type="number" min="0" @change=${t=>jy.geolocationSurvey.timeLimit=parseInt(t.target.value)}><span class="add-on">s</span>
                        </div>
                        ${jy.geolocationSurvey.timeMode?hx`<div class="input-append">
                                    <input class="input-mini" type="text" disabled="disabled" value="${jy.geolocationSurvey.timeCount}">
                                    <button class="btn ${jy.geolocationSurvey.timePauseMode?"active btn-success":""}" @click=${()=>jy.geolocationSurvey.toggleTimePauseMode()}><i class="icon-pause"></i></button>
                                </div>`:""}
                    </div>
                </div>
                <div class="control-group">
                    <div><button class="btn ${jy.geolocationSurvey.accuracyMode?"active btn-success":""}" @click=${()=>jy.geolocationSurvey.toggleAccuracyMode()}>${lizDict["geolocation.survey.accuracy"]}</button></div>
                    <div class="controls">
                        <div class="input-append">
                            <input class="input-mini" type="number" min="0" @change=${t=>jy.geolocationSurvey.accuracyLimit=parseInt(t.target.value)}><span class="add-on">m</span>
                        </div>
                        ${jy.geolocationSurvey.accuracyMode?hx`${jy.geolocation.accuracy}`:""}
                    </div>
                </div>
            `:""}
            <div class="control-group">
                <div><button class="btn ${jy.geolocationSurvey.averageRecordMode?"active btn-success":""}" @click=${()=>jy.geolocationSurvey.toggleAverageRecordMode()}>${lizDict["geolocation.survey.average"]}</button></div>
                <div class="controls">
                    <div class="input-append">
                        <input class="input-mini" type="number" min="0" @change=${t=>jy.geolocationSurvey.averageRecordLimit=parseInt(t.target.value)}><span class="add-on">s</span>
                    </div>
                </div>
            </div>
        </div>`;Sx(t(),this),qy.addListener((()=>{Sx(t(),this)}),["geolocation.isLinkedToEdition","geolocation.isTracking","geolocationSurvey.distanceMode","geolocationSurvey.timeMode","geolocationSurvey.timePauseMode","geolocationSurvey.timeCount","geolocationSurvey.accuracyMode","geolocationSurvey.averageRecordMode","geolocationSurvey.beepMode","geolocationSurvey.vibrateMode"]),qy.addListener((()=>{jy.geolocationSurvey.distanceMode&&Sx(t(),this)}),"edition.lastSegmentLength"),qy.addListener((()=>{jy.geolocationSurvey.accuracyMode&&Sx(t(),this)}),"geolocation.accuracy")}disconnectedCallback(){}}class Ox extends HTMLElement{constructor(){super()}connectedCallback(){const t=()=>hx`
        <div class="selectiontool">
            <h3>
                <span class="title">
                    <button class="btn-selectiontool-clear btn btn-mini btn-error btn-link" type="button" @click=${()=>jy.selectionTool.disable()} title="${lizDict["toolbar.content.stop"]}">×</button>
                    <span class="icon-star icon-white"></span>
                    <span class="text">&nbsp;${lizDict["selectiontool.toolbar.title"]}&nbsp;</span>
                </span>
            </h3>
            <div class="menu-content">
                <div>${lizDict["selectiontool.toolbar.layer"]}</div>
                <div>
                    <select class="selectiontool-layer-list" @change=${t=>jy.selectionTool.allFeatureTypeSelected=t.target.value}>
                        <optgroup label="${lizDict["selectiontool.toolbar.layers.single"]}">
                            ${jy.selectionTool.layers.map((t=>hx`<option value="${t.name}">${t.title}</option>`))}
                        </optgroup>
                        <optgroup label="${lizDict["selectiontool.toolbar.layers.multiple"]}">
                            <option value="selectable-visible-layers">${lizDict["selectiontool.toolbar.layers.selectableAndVisible"]}</option>
                            <option selected value="selectable-layers">${lizDict["selectiontool.toolbar.layers.selectable"]}</option>
                        </optgroup>
                    </select>
                </div>
                <lizmap-digitizing import-export></lizmap-digitizing>
                <div class="selectiontool-buffer">
                    <label><span>${lizDict["selectiontool.toolbar.buffer"]}</span>
                        <div class="input-append">
                            <input class="input-mini" type="number" min="0" .value="${jy.selectionTool.bufferValue}" @input=${t=>jy.selectionTool.bufferValue=parseInt(t.target.value)}><span class="add-on">m</span>
                        </div>
                    </label>
                </div>
                <div>
                    <select class="selection-geom-operator" @change=${t=>jy.selectionTool.geomOperator=t.target.value} data-original-title="${lizDict["selectiontool.toolbar.geomOperator"]}">
                        <option value="intersects">${lizDict["selectiontool.toolbar.geomOperator.intersects"]}</option>
                        <option value="within">${lizDict["selectiontool.toolbar.geomOperator.within"]}</option>
                        <option value="overlaps">${lizDict["selectiontool.toolbar.geomOperator.overlaps"]}</option>
                        <option value="contains">${lizDict["selectiontool.toolbar.geomOperator.contains"]}</option>
                        <option value="crosses">${lizDict["selectiontool.toolbar.geomOperator.crosses"]}</option>
                        <option value="disjoint">${lizDict["selectiontool.toolbar.geomOperator.disjoint"]}</option>
                        <option value="touches">${lizDict["selectiontool.toolbar.geomOperator.touches"]}</option>
                    </select>
                </div>
                <div class="selectiontool-results" style="padding:2px">${jy.selectionTool.selectedFeaturesCount>1?lizDict["selectiontool.results.more"].replace("%s",jy.selectionTool.selectedFeaturesCount):1===jy.selectionTool.selectedFeaturesCount?lizDict["selectiontool.results.one"]:lizDict["selectiontool.results.none"]}</div>
                <div class="selectiontool-actions">
                    <div class="selectiontool-type-buttons btn-group">
                        <button type="button" class="selectiontool-type-refresh btn btn-mini ${"new"===jy.selectionTool.newAddRemoveSelected?"active":""}" @click=${()=>jy.selectionTool.newAddRemoveSelected="new"} data-original-title="${lizDict["selectiontool.toolbar.action.type.refresh"]}" value="refresh">
                            <i class="icon-refresh"></i>
                        </button>
                        <button type="button" class="selectiontool-type-plus btn btn-mini ${"add"===jy.selectionTool.newAddRemoveSelected?"active":""}" @click=${()=>jy.selectionTool.newAddRemoveSelected="add"} data-original-title="${lizDict["selectiontool.toolbar.action.type.plus"]}" value="plus">
                            <i class="icon-plus"></i>
                        </button>
                        <button type="button" class="selectiontool-type-minus btn btn-mini ${"remove"===jy.selectionTool.newAddRemoveSelected?"active":""}" @click=${()=>jy.selectionTool.newAddRemoveSelected="remove"} data-original-title="${lizDict["selectiontool.toolbar.action.type.minus"]}" value="minus">
                            <i class="icon-minus"></i>
                        </button>
                    </div>
                    <button type="button" class="selectiontool-unselect btn btn-mini" ?disabled=${0===jy.selectionTool.selectedFeaturesCount} @click=${()=>jy.selectionTool.unselect()}  data-original-title="${lizDict["selectiontool.toolbar.action.unselect"]}">
                        <i class="icon-star-empty"></i>
                    </button>
                    <button type="button" class="selectiontool-filter btn btn-mini ${0!==jy.selectionTool.filteredFeaturesCount?"active":""}" ?disabled=${0===jy.selectionTool.selectedFeaturesCount&&0===jy.selectionTool.filteredFeaturesCount} @click=${()=>jy.selectionTool.filter()}  data-original-title="${lizDict["selectiontool.toolbar.action.filter"]}">
                        <i class="icon-filter"></i>
                    </button>
                    <lizmap-selection-invert></lizmap-selection-invert>
                    ${this.hasAttribute("layer-export")?hx`
                        <div class="btn-group dropup selectiontool-export" role="group" data-original-title="${jy.selectionTool.isExportable?"":lizDict["switcher.layer.export.warn"]}">
                            <button type="button" class="btn btn-mini dropdown-toggle" ?disabled=${!jy.selectionTool.isExportable} data-toggle="dropdown" aria-expanded="false">
                                ${lizDict["switcher.layer.export.title"]}
                            <span class="caret"></span>
                            </button>
                            <ul class="selectiontool-export-formats dropdown-menu dropdown-menu-right" role="menu">
                                <li><a href="#" class="btn-export-selection">GeoJSON</a></li>
                                <li><a href="#" class="btn-export-selection">GML</a></li>
                                ${jy.selectionTool.exportFormats.map((t=>hx`<li><a href="#" class="btn-export-selection">${t}</a></li>`))}
                            </ul>
                        </div>`:""}
                </div>
            </div>
        </div>`;Sx(t(),this),$(".menu-content button, .menu-content .selectiontool-export, .selection-geom-operator",this).tooltip({placement:"top"}),this.querySelectorAll(".btn-export-selection").forEach((t=>{t.addEventListener("click",(t=>{jy.selectionTool.export(t.target.text)}))})),qy.addListener((()=>{Sx(t(),this)}),["selectionTool.newAddRemoveSelected","selectionTool.allFeatureTypeSelected","selection.changed","filteredFeatures.changed","selection.bufferValue"])}disconnectedCallback(){}}var Ax=new(Lx())({id:"mActionInvertSelection",use:"mActionInvertSelection-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="mActionInvertSelection"><g fill-rule="evenodd"><path fill="#fce94f" stroke="#c4a000" d="M2.5 21.5V4.146L19.854 21.5z" /><path fill="#ebebeb" stroke="#898989" d="M21.5 2.5v17.354L4.146 2.5z" /></g></symbol>'});Nx().add(Ax);class Fx extends HTMLElement{constructor(){super()}connectedCallback(){const t=()=>hx`
        <button type="button" class="selectiontool-invert btn btn-mini ${this.getAttribute("feature-type")&&0===jy.config.layers[jy.getLayerNameByCleanName(this.getAttribute("feature-type"))].selectedFeatures.length?"hide":""}" ?disabled=${this.getAttribute("feature-type")?0===jy.config.layers[jy.getLayerNameByCleanName(this.getAttribute("feature-type"))].selectedFeatures.length:0===jy.selectionTool.selectedFeaturesCount||jy.selectionTool.allFeatureTypeSelected.length>1} @click=${()=>jy.selectionTool.invert(jy.getLayerNameByCleanName(this.getAttribute("feature-type")))}  data-original-title="${lizDict["selectiontool.toolbar.action.invert"]}">
            <svg class="icon-">
                <use xlink:href="#mActionInvertSelection"></use>
            </svg>
        </button>`;Sx(t(),this),$("button",this).tooltip({placement:this.hasAttribute("tooltip-placement")?this.getAttribute("tooltip-placement"):"top"}),qy.addListener((()=>{Sx(t(),this)}),["selectionTool.allFeatureTypeSelected","selection.changed"])}disconnectedCallback(){}}var Dx=new(Lx())({id:"refresh",use:"refresh-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icon-tabler-refresh" viewBox="0 0 24 24" id="refresh"><path stroke="none" d="M0 0h24v24H0z" /><path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 4v5h5M4 13a8.1 8.1 0 0 0 15.5 2m.5 5v-5h-5" /></symbol>'});Nx().add(Dx);class kx extends HTMLElement{constructor(){super()}connectedCallback(){const t=()=>hx`
        <div class="${void 0!==jy.snapping.config?"":"hide"}">
            <h3>${lizDict["snapping.title"]}</h3>
            <div class="control-group">
                <div class="controls">
                    <div class="btn-group">
                        <button class="btn ${jy.snapping.active?"active btn-success":""}" @click=${()=>jy.snapping.toggle()}>${jy.snapping.active?lizDict["geolocate.toolbar.stop"]:lizDict["geolocate.toolbar.start"]}</button>
                        <button class="btn ${jy.snapping._snapLayersRefreshable?"btn-warning":""}" ?disabled=${!jy.snapping._snapLayersRefreshable} @click=${()=>jy.snapping.getSnappingData()}>
                            <svg width="14" height="14">
                                <use xlink:href="#refresh"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        <div>`;Sx(t(),this),qy.addListener((()=>{Sx(t(),this)}),["snapping.config","snapping.active","snapping.refreshable"])}disconnectedCallback(){}}const Gx="units",zx=[1,2,5],Bx=25.4/.28,jx=class extends _n{constructor(t){t=t||{};const e=document.createElement("div");e.style.pointerEvents="none",super({element:e,render:t.render,target:t.target}),this.on,this.once,this.un;const i=void 0!==t.className?t.className:t.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+me,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=void 0!==t.minWidth?t.minWidth:64,this.maxWidth_=t.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(Gx,this.handleUnitsChanged_),this.setUnits(t.units||"metric"),this.scaleBar_=t.bar||!1,this.scaleBarSteps_=t.steps||4,this.scaleBarText_=t.text||!1,this.dpi_=t.dpi||void 0}getUnits(){return this.get(Gx)}handleUnitsChanged_(){this.updateElement_()}setUnits(t){this.set(Gx,t)}setDpi(t){this.dpi_=t}updateElement_(){const t=this.viewState_;if(!t)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const e=t.center,i=t.projection,s=this.getUnits(),n="degrees"==s?"degrees":"m";let r=Ui(i,t.resolution,e,n);const o=this.minWidth_*(this.dpi_||Bx)/Bx,a=void 0!==this.maxWidth_?this.maxWidth_*(this.dpi_||Bx)/Bx:void 0;let h=o*r,l="";if("degrees"==s){const t=_i.degrees;h*=t,h<t/60?(l="″",r*=3600):h<t?(l="′",r*=60):l="°"}else"imperial"==s?h<.9144?(l="in",r/=.0254):h<1609.344?(l="ft",r/=.3048):(l="mi",r/=1609.344):"nautical"==s?(r/=1852,l="NM"):"metric"==s?h<.001?(l="μm",r*=1e6):h<1?(l="mm",r*=1e3):h<1e3?l="m":(l="km",r/=1e3):"us"==s?h<.9144?(l="in",r*=39.37):h<1609.344?(l="ft",r/=.30480061):(l="mi",r/=1609.3472):q(!1,33);let c,u,d,g,p,_,f=3*Math.floor(Math.log(o*r)/Math.log(10));for(;;){d=Math.floor(f/3);const t=Math.pow(10,d);if(c=zx[(f%3+3)%3]*t,u=Math.round(c/r),isNaN(u))return this.element.style.display="none",void(this.renderedVisible_=!1);if(void 0!==a&&u>=a){c=g,u=p,d=_;break}if(u>=o)break;g=c,p=u,_=d,++f}const m=this.scaleBar_?this.createScaleBar(u,c,l):c.toFixed(d<0?-d:0)+" "+l;this.renderedHTML_!=m&&(this.innerElement_.innerHTML=m,this.renderedHTML_=m),this.renderedWidth_!=u&&(this.innerElement_.style.width=u+"px",this.renderedWidth_=u),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(t,e,i){const s=this.getScaleForResolution(),n=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),r=this.scaleBarSteps_,o=t/r,a=[this.createMarker("absolute")];for(let s=0;s<r;++s){const n=s%2==0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";a.push(`<div><div class="ol-scale-singlebar ${n}" style="width: ${o}px;"></div>`+this.createMarker("relative")+(s%2==0||2===r?this.createStepText(s,t,!1,e,i):"")+"</div>")}return a.push(this.createStepText(r,t,!0,e,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${t}px;">`+n+"</div>":"")+a.join("")}createMarker(t){return`<div class="ol-scale-step-marker" style="position: ${t}; top: ${"absolute"===t?3:-10}px;"></div>`}createStepText(t,e,i,s,n){const r=(0===t?0:Math.round(s/this.scaleBarSteps_*t*100)/100)+(0===t?"":" "+n);return`<div class="ol-scale-step-text" style="margin-left: ${0===t?-3:e/this.scaleBarSteps_*-1}px;text-align: ${0===t?"left":"center"};min-width: ${0===t?0:e/this.scaleBarSteps_*2}px;left: ${i?e+"px":"unset"};">`+r+"</div>"}getScaleForResolution(){return Ui(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m")*(1e3/25.4)*(this.dpi_||Bx)}render(t){const e=t.frameState;this.viewState_=e?e.viewState:null,this.updateElement_()}};class qx extends HTMLElement{constructor(){super()}connectedCallback(){this._olScaleline=new jx({target:this,minWidth:76,bar:!0,text:!0,dpi:95.999808}),jy.map.addControl(this._olScaleline)}disconnectedCallback(){jy.map.removeControl(this._olScaleline)}}class Ux extends HTMLElement{constructor(){super(),this._numDigits=0,this._displayUnit="m",this._qgisProjectProjectionUnits,this._longitude,this._latitude,this._lonInput,this._latInput}mainTemplate(t,e){return hx`
            <div class="mouse-position">
                <div class="editable-position ${["dm","dms"].includes(this._displayUnit)?"hide":""}">
                    <input type="number" step="any" placeholder="longitude" @input=${t=>this._lonInput=parseFloat(t.target.value)} @keydown=${t=>{"Enter"===t.key&&this._centerToCoords()}} .value=${isNaN(t)?0:t}><input type="number" step="any" placeholder="latitude" @input=${t=>this._latInput=parseFloat(t.target.value)} @keydown=${t=>{"Enter"===t.key&&this._centerToCoords()}} .value=${isNaN(e)?0:e}>
                </div>
                <div class="readonly-position ${["dm","dms"].includes(this._displayUnit)?"":"hide"}">
                    <span>${t}</span>
                    <span>${e}</span>
                </div>
                <button class="btn btn-mini" title="${lizDict["mouseposition.removeCenterPoint"]}" @click=${()=>this._removeCenterPoint()}><i class="icon-refresh"></i></button>
            </div>
            <div class="coords-unit">
                <select title="${lizDict["mouseposition.select"]}" @change=${t=>{this.displayUnit=t.target.value}}>
                    ${"m"===this._qgisProjectProjectionUnits?hx`
                    <option selected value="m">${lizDict["mouseposition.units.m"]}</option>`:""}
                    ${["ft","us-ft"].includes(this._qgisProjectProjectionUnits)?hx`
                    <option selected value="f">${lizDict["mouseposition.units.f"]}</option>`:""}
                
                    <option value="degrees">${lizDict["mouseposition.units.d"]}</option>
                    <option value="dm">${lizDict["mouseposition.units.dm"]}</option>
                    <option value="dms">${lizDict["mouseposition.units.dms"]}</option>
                </select>
            </div>`}_centerToCoords(){if(this._lonInput&&this._latInput){let t;t="degrees"===this._displayUnit&&"degrees"!==jy.lizmap3.map.projection.getUnits()?Zi([this._lonInput,this._latInput],"EPSG:4326",jy.projection):Zi([this._lonInput,this._latInput],jy.qgisProjectProjection,jy.projection),jy.center=t;const e=new OpenLayers.Geometry.Point(t[0],t[1]),i=jy.lizmap3.map.getLayersByName("locatelayer")[0];i.removeAllFeatures(),i.addFeatures(new OpenLayers.Feature.Vector(e))}}_removeCenterPoint(){jy.lizmap3.map.getLayersByName("locatelayer")[0].removeAllFeatures()}set displayUnit(t){this._numDigits="m"===t?0:5,this._displayUnit=t,this._longitude&&this._latitude&&this.redraw(this._longitude,this._latitude)}_mousemove(t){if(null!=t){let e,i;t.xy?({lon:e,lat:i}=jy.lizmap3.map.getLonLatFromPixel(t.xy)):t.pixel&&([e,i]=jy.map.getCoordinateFromPixel(t.pixel)),e&&i&&(this._longitude=e,this._latitude=i,this.redraw(e,i))}}redraw(t,e){let i=[t,e];["degrees","dm","dms"].includes(this._displayUnit)?("degrees"!==jy.lizmap3.map.projection.getUnits()&&(i=Zi(i,jy.projection,"EPSG:4326")),"degrees"===this._displayUnit?Sx(this.mainTemplate(i[0].toFixed(this._numDigits),i[1].toFixed(this._numDigits)),this):(i[0]=this.getFormattedLonLat(i[0],"lon",this._displayUnit),i[1]=this.getFormattedLonLat(i[1],"lat",this._displayUnit),Sx(this.mainTemplate(i[0],i[1]),this))):(i=Zi(i,jy.projection,jy.qgisProjectProjection),Sx(this.mainTemplate(i[0].toFixed(this._numDigits),i[1].toFixed(this._numDigits)),this)),this._lonInput=i[0],this._latInput=i[1]}getFormattedLonLat(t,e,i){i||(i="dms"),t=(t+540)%360-180;var s=Math.abs(t),n=Math.floor(s),r=(s-n)/(1/60),o=r,a=(o-(r=Math.floor(r)))/(1/60);a=Math.round(10*a),(a/=10)>=60&&(a-=60,(r+=1)>=60&&(r-=60,n+=1)),n<10&&(n="0"+n);var h=n+"°";return i.indexOf("dms")>=0?(r<10&&(r="0"+r),h+=r+"'",a<10&&(a="0"+a),h+=a+'"'):i.indexOf("dm")>=0&&(r=Math.round(1e3*o),(r/=1e3)<10&&(r="0"+r),h+=r+"'"),h+("lon"==e?t<0?"W":"E":t<0?"S":"N")}connectedCallback(){this._qgisProjectProjectionUnits=qi(jy.qgisProjectProjection).getUnits(),this.displayUnit=this._qgisProjectProjectionUnits,jy.lizmap3.map.events.register("mousemove",this,this._mousemove),jy.map.on("pointermove",(t=>this._mousemove(t))),Sx(this.mainTemplate(null,null),this)}disconnectedCallback(){jy.lizmap3.map.events.unregister("mousemove",this,this._mousemove),jy.map.un("pointermove",(t=>this._mousemove(t)))}}var Yx=new(Lx())({id:"point",use:"point-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="point"><g transform="translate(5.382 -1022.62)"><ellipse cx="6.227" cy="1034.8" rx="2.532" ry="2.558" style="fill:currentColor;stroke:currentColor;stroke-width:.45078;stroke-linejoin:round;stroke-dashoffset:5.06459999" /></g></symbol>'});Nx().add(Yx);var Vx=new(Lx())({id:"line",use:"line-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="line"><path d="m12.38 1033.8-8.775-.661 2.12 7.858" style="fill:none;stroke:currentColor;stroke-width:.7;stroke-linejoin:round;stroke-dasharray:2.44,.61;stroke-dashoffset:6.00390005" transform="matrix(1.9204 0 0 2.01316 -3.252 -2075.456)" /></symbol>'});Nx().add(Vx);var Xx=new(Lx())({id:"polygon",use:"polygon-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="polygon"><path fill="#e5e5e5" d="m.758.64 4.23 10.86.733 2.948.087 2.228 16.163 5.051-3.22-11.048 4.04-9.723-10.83 4.017z" /><path fill="none" stroke="currentColor" stroke-dasharray="4 1" d="m.758.64 4.23 10.86.82 5.176 16.163 5.051-3.22-11.048 4.04-9.723-10.695 4.106z" /></symbol>'});Nx().add(Xx);var Wx=new(Lx())({id:"box",use:"box-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="box"><path d="M1.48 1029.842h21.04v19.04H1.48Z" style="fill:#e5e5e5;stroke:currentColor;stroke-width:.95975173;stroke-dasharray:1.91950336,.95975168" transform="translate(.05 -1027.676)" /></symbol>'});Nx().add(Wx);var $x=new(Lx())({id:"circle",use:"circle-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="circle"><g transform="translate(0 -1028.362)"><circle cx="12.1" cy="1040.272" r="10.509" fill="#ebebeb" /><circle cx="12" cy="1040.362" r="10.5" fill="none" stroke="currentColor" stroke-dasharray="1.99829691 .99914846" stroke-dashoffset=".168" stroke-width=".999" /></g></symbol>'});Nx().add($x);var Hx=new(Lx())({id:"freehand",use:"freehand-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="freehand"><path d="M1.136 1030.013c-2.237 1.3 3.89 5.49 1.968 8.398-1.4 3.001-2.518 6.262-2.404 9.598.016 2.615 3.54 4.828 5.259 2.228 1.317-1.72 2.71-3.9 5.16-3.877 3.013-.123 6.461 1.533 9.107-.612 2.525-2.842-11.418-6.535 2.238-10.197 1.312-2.992-1.738-6.706-4.936-5.742-3.587 1.398-5.597 4.006-9.253 1.946-1.436-.866-5.37-2.544-7.139-1.742z" style="fill:#ebebeb" transform="translate(.396 -1028.326)" /><path d="M1.136 1030.013c-2.237 1.3 3.89 5.49 1.968 8.398-1.4 3.001-2.518 6.262-2.404 9.598.016 2.615 3.54 4.828 5.259 2.228 1.317-1.72 2.71-3.9 5.16-3.877 3.013-.123 6.461 1.533 9.107-.612 2.525-2.842-11.418-6.535 2.238-10.197 1.312-2.992-1.738-6.706-4.936-5.742-3.587 1.398-5.597 4.006-9.253 1.946-1.436-.866-5.37-2.544-7.139-1.742z" style="fill:none;stroke:currentColor;stroke-width:1.20000005;stroke-dasharray:2.4,1.2" transform="translate(.396 -1028.326)" /></symbol>'});Nx().add(Hx);var Kx=new(Lx())({id:"pencil",use:"pencil-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icon-tabler-pencil" viewBox="0 0 24 24" id="pencil"><path stroke="none" d="M0 0h24v24H0z" /><path d="M4 20h4L18.5 9.5a1.5 1.5 0 0 0-4-4L4 16v4M13.5 6.5l4 4" /></symbol>'});Nx().add(Kx);var Zx=new(Lx())({id:"edit",use:"edit-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icon-tabler-edit" viewBox="0 0 24 24" id="edit"><path stroke="none" d="M0 0h24v24H0z" /><path d="M9 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-3" /><path d="M9 15h3l8.5-8.5a1.5 1.5 0 0 0-3-3L9 12v3M16 5l3 3" /></symbol>'});Nx().add(Zx);var Jx=new(Lx())({id:"eraser",use:"eraser-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icon-tabler-eraser" viewBox="0 0 24 24" id="eraser"><path stroke="none" d="M0 0h24v24H0z" /><path d="M19 19H8l-4-4a1 1 0 0 1 0-1.41l10-10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9 9M18 12.3 11.7 6" /></symbol>'});Nx().add(Jx);var Qx=new(Lx())({id:"save",use:"save-usage",viewBox:"0 0 16 16",content:'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-save" viewBox="0 0 16 16" id="save"><path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z" /></symbol>'});Nx().add(Qx);var tv=new(Lx())({id:"file-download",use:"file-download-usage",viewBox:"0 0 16 16",content:'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-file-earmark-arrow-down" viewBox="0 0 16 16" id="file-download"><path d="M4 1h5v1H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6h1v7a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2z" /><path d="M9 4.5V1l5 5h-3.5A1.5 1.5 0 0 1 9 4.5z" /><path fill-rule="evenodd" d="M5.646 9.146a.5.5 0 0 1 .708 0L8 10.793l1.646-1.647a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 0-.708z" /><path fill-rule="evenodd" d="M8 6a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0v-4A.5.5 0 0 1 8 6z" /></symbol>'});Nx().add(tv);var ev=new(Lx())({id:"file-upload",use:"file-upload-usage",viewBox:"0 0 16 16",content:'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16" id="file-upload"><path d="M4 1h5v1H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6h1v7a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2z" /><path d="M9 4.5V1l5 5h-3.5A1.5 1.5 0 0 1 9 4.5z" /><path fill-rule="evenodd" d="M5.646 8.854a.5.5 0 0 0 .708 0L8 7.207l1.646 1.647a.5.5 0 0 0 .708-.708l-2-2a.5.5 0 0 0-.708 0l-2 2a.5.5 0 0 0 0 .708z" /><path fill-rule="evenodd" d="M8 12a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-1 0v4a.5.5 0 0 0 .5.5z" /></symbol>'});Nx().add(ev);class iv extends HTMLElement{constructor(){super()}connectedCallback(){const t=()=>hx`
        <div class="digitizing">
            <div class="digitizing-buttons btn-group" data-original-title="${lizDict["digitizing.toolbar.drawTools"]}">
                <a class="btn dropdown-toggle ${"deactivate"!==jy.digitizing.toolSelected?"active btn-primary":""}" @click=${t=>{"deactivate"!==jy.digitizing.toolSelected&&(jy.digitizing.toolSelected="deactivate",t.stopPropagation())}} data-toggle="dropdown" href="#">
                    <svg>
                        <use xlink:href="#pencil"></use>
                    </svg>
                    <!-- Display selected tool -->
                    <svg class="digitizing-selected-tool ${"point"===jy.digitizing.toolSelected?"":"hidden"}">
                        <use xlink:href="#point"></use>
                    </svg>
                    <svg class="digitizing-selected-tool ${"line"===jy.digitizing.toolSelected?"":"hidden"}">
                        <use xlink:href="#line"></use>
                    </svg>
                    <svg class="digitizing-selected-tool ${"polygon"===jy.digitizing.toolSelected?"":"hidden"}">
                        <use xlink:href="#polygon"></use>
                    </svg>
                    <svg class="digitizing-selected-tool ${"box"===jy.digitizing.toolSelected?"":"hidden"}">
                        <use xlink:href="#box"></use>
                    </svg>
                    <svg class="digitizing-selected-tool ${"circle"===jy.digitizing.toolSelected?"":"hidden"}">
                        <use xlink:href="#circle"></use>
                    </svg>
                    <svg class="digitizing-selected-tool ${"freehand"===jy.digitizing.toolSelected?"":"hidden"}">
                        <use xlink:href="#freehand"></use>
                    </svg>
                </a>
                <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                    <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                    <li class="digitizing-point btn ${"point"===jy.digitizing.toolSelected?"active btn-primary":""}" @click=${()=>jy.digitizing.toolSelected="point"} data-original-title="${lizDict["digitizing.toolbar.point"]}">
                        <svg>
                            <use xlink:href="#point"></use>
                        </svg>
                    </li>
                    <li class="digitizing-line btn ${"line"===jy.digitizing.toolSelected?"active btn-primary":""}" @click=${()=>jy.digitizing.toolSelected="line"} data-original-title="${lizDict["digitizing.toolbar.line"]}">
                        <svg>
                            <use xlink:href="#line"></use>
                        </svg>
                    </li>
                    <li class="digitizing-polygon btn ${"polygon"===jy.digitizing.toolSelected?"active btn-primary":""}" @click=${()=>jy.digitizing.toolSelected="polygon"} data-original-title="${lizDict["digitizing.toolbar.polygon"]}">
                        <svg>
                            <use xlink:href="#polygon"></use>
                        </svg>
                    </li>
                    <br>
                    <li class="digitizing-box btn ${"box"===jy.digitizing.toolSelected?"active btn-primary":""}" @click=${()=>jy.digitizing.toolSelected="box"} data-original-title="${lizDict["digitizing.toolbar.box"]}">
                        <svg>
                            <use xlink:href="#box"></use>
                        </svg>
                    </li>
                    <li class="digitizing-circle btn ${"circle"===jy.digitizing.toolSelected?"active btn-primary":""}" @click=${()=>jy.digitizing.toolSelected="circle"} data-original-title="${lizDict["digitizing.toolbar.circle"]}">
                        <svg>
                            <use xlink:href="#circle"></use>
                        </svg>
                    </li>
                    <li class="digitizing-freehand btn ${"freehand"===jy.digitizing.toolSelected?"active btn-primary":""}" @click=${()=>jy.digitizing.toolSelected="freehand"} data-original-title="${lizDict["digitizing.toolbar.freehand"]}">
                        <svg>
                            <use xlink:href="#freehand"></use>
                        </svg>
                    </li>
                </ul>
            </div>
            <input type="color" class="digitizing-color btn" .value="${jy.digitizing.drawColor}" @input=${t=>jy.digitizing.drawColor=t.target.value} data-original-title="${lizDict["digitizing.toolbar.color"]}">
            <button type="button" class="digitizing-edit btn ${jy.digitizing.isEdited?"active btn-primary":""}" ?disabled=${!jy.digitizing.featureDrawn} @click=${()=>jy.digitizing.toggleEdit()} data-original-title="${lizDict["attributeLayers.btn.edit.title"]}">
                <svg>
                    <use xlink:href="#edit"/>
                </svg>
            </button>
            <button type="button" class="digitizing-erase btn" ?disabled=${!jy.digitizing.featureDrawn} @click=${()=>jy.digitizing.erase()} data-original-title="${lizDict["digitizing.toolbar.erase"]}">
                <svg>
                    <use xlink:href="#eraser"/>
                </svg>
            </button>
            <button type="button" class="digitizing-toggle-visibility btn" ?disabled=${!jy.digitizing.featureDrawn} @click=${()=>jy.digitizing.toggleFeatureDrawnVisibility()}  data-original-title="${lizDict["tree.button.checkbox"]}">
                <i class="icon-eye-${jy.digitizing._featureDrawnVisibility?"open":"close"}"></i>
            </button>
            <button type="button" class="digitizing-save btn ${jy.digitizing.isSaved?"active btn-primary":""} ${this.hasAttribute("save")?"":"hide"}" @click=${()=>jy.digitizing.toggleSave()} data-original-title="${lizDict["digitizing.toolbar.save"]}">
                <svg>
                    <use xlink:href="#save" />
                </svg>
            </button>
            <div class="${this.hasAttribute("import-export")?"":"hide"}">
                <div class="btn-group digitizing-export">
                    <button class="btn dropdown-toggle" ?disabled=${!jy.digitizing.featureDrawn} data-toggle="dropdown" data-original-title="${lizDict["attributeLayers.toolbar.btn.data.export.title"]}">
                        <svg>
                            <use xlink:href="#file-download"></use>
                        </svg>
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="#" @click=${()=>jy.digitizing.download("geojson")}>GeoJSON</a>
                        </li>
                        <li>
                            <a href="#" @click=${()=>jy.digitizing.download("gpx")}>GPX</a>
                        </li>
                        <li>
                            <a href="#" @click=${()=>jy.digitizing.download("kml")}>KML</a>
                        </li>
                    </ul>
                </div>
                <div class="digitizing-import">
                    <label class="btn" data-original-title="${lizDict["digitizing.toolbar.import"]}">
                        <svg>
                            <use xlink:href="#file-upload"></use>
                        </svg>
                        <input class="hide" type="file" accept=".kml, .geojson, .json, .gpx" @change=${t=>{t.target.files.length>0&&(t.target.parentElement.parentElement.querySelector(".file-name").textContent=t.target.files[0].name,jy.digitizing.import(t.target.files[0]))}}>
                    </label>
                    <span class="file-name"></span>
                </div>
            </div>
        </div>`;Sx(t(),this),$(".digitizing-buttons, .digitizing .btn",this).tooltip({placement:"top"}),qy.addListener((()=>{Sx(t(),this)}),["digitizing.featureDrawn","digitizing.featureDrawnVisibility","digitizing.toolSelected","digitizing.editionBegins","digitizing.editionEnds","digitizing.erase","digitizing.drawColor","digitizing.save"])}disconnectedCallback(){}}const sv="element",nv="map",rv="offset",ov="position",av="positioning",hv=class extends S{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=void 0===t.insertFirst||t.insertFirst,this.stopEvent=void 0===t.stopEvent||t.stopEvent,this.element=document.createElement("div"),this.element.className=void 0!==t.className?t.className:"ol-overlay-container ol-selectable",this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=!0===t.autoPan?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(sv,this.handleElementChanged),this.addChangeListener(nv,this.handleMapChanged),this.addChangeListener(rv,this.handleOffsetChanged),this.addChangeListener(ov,this.handlePositionChanged),this.addChangeListener(av,this.handlePositioningChanged),void 0!==t.element&&this.setElement(t.element),this.setOffset(void 0!==t.offset?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),void 0!==t.position&&this.setPosition(t.position)}getElement(){return this.get(sv)}getId(){return this.id}getMap(){return this.get(nv)||null}getOffset(){return this.get(rv)}getPosition(){return this.get(ov)}getPositioning(){return this.get(av)}handleElementChanged(){Te(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(Le(this.element),y(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=f(t,ni,this.render,this),this.updatePixelPosition();const e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(sv,t)}setMap(t){this.set(nv,t)}setOffset(t){this.set(rv,t)}setPosition(t){this.set(ov,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get(ov))return;const i=this.getRect(e.getTargetElement(),e.getSize()),s=this.getElement(),n=this.getRect(s,[Se(s),be(s)]),r=void 0===(t=t||{}).margin?20:t.margin;if(!et(i,n)){const s=n[0]-i[0],o=i[2]-n[2],a=n[1]-i[1],h=i[3]-n[3],l=[0,0];if(s<0?l[0]=s-r:o<0&&(l[0]=Math.abs(o)+r),a<0?l[1]=a-r:h<0&&(l[1]=Math.abs(h)+r),0!==l[0]||0!==l[1]){const i=e.getView().getCenterInternal(),s=e.getPixelFromCoordinateInternal(i);if(!s)return;const n=[s[0]+l[0],s[1]+l[1]],r=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(n),duration:r.duration,easing:r.easing})}}}getRect(t,e){const i=t.getBoundingClientRect(),s=i.left+window.pageXOffset,n=i.top+window.pageYOffset;return[s,n,s+e[0],n+e[1]]}setPositioning(t){this.set(av,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e)return void this.setVisible(!1);const i=t.getPixelFromCoordinate(e),s=t.getSize();this.updateRenderedPosition(i,s)}updateRenderedPosition(t,e){const i=this.element.style,s=this.getOffset(),n=this.getPositioning();this.setVisible(!0);let r="0%",o="0%";"bottom-right"==n||"center-right"==n||"top-right"==n?r="-100%":"bottom-center"!=n&&"center-center"!=n&&"top-center"!=n||(r="-50%"),"bottom-left"==n||"bottom-center"==n||"bottom-right"==n?o="-100%":"center-left"!=n&&"center-center"!=n&&"center-right"!=n||(o="-50%");const a=`translate(${r}, ${o}) translate(${Math.round(t[0]+s[0])+"px"}, ${Math.round(t[1]+s[1])+"px"})`;this.rendered.transform_!=a&&(this.rendered.transform_=a,i.transform=a)}getOptions(){return this.options}},lv=class extends _n{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=void 0===t.collapsed||t.collapsed,this.collapsible_=void 0===t.collapsible||t.collapsible,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=void 0!==t.rotateWithView&&t.rotateWithView,this.viewExtent_=void 0;const e=void 0!==t.className?t.className:"ol-overviewmap",i=void 0!==t.tipLabel?t.tipLabel:"Overview map",s=void 0!==t.collapseLabel?t.collapseLabel:"‹";"string"==typeof s?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s):this.collapseLabel_=s;const n=void 0!==t.label?t.label:"›";"string"==typeof n?(this.label_=document.createElement("span"),this.label_.textContent=n):this.label_=n;const r=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,o=document.createElement("button");o.setAttribute("type","button"),o.title=i,o.appendChild(r),o.addEventListener(_.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=t.view;const a=new Qn({view:t.view,controls:new O,interactions:new O});this.ovmap_=a,t.layers&&t.layers.forEach((function(t){a.addLayer(t)}));const h=document.createElement("div");h.className="ol-overviewmap-box",h.style.boxSizing="border-box",this.boxOverlay_=new hv({position:[0,0],positioning:"center-center",element:h}),this.ovmap_.addOverlay(this.boxOverlay_);const l=e+" "+me+" "+ye+(this.collapsed_&&this.collapsible_?" "+xe:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=l,c.appendChild(this.ovmapDiv_),c.appendChild(o);const u=this,d=this.boxOverlay_,g=this.boxOverlay_.getElement(),p=function(t){const e={clientX:(i=t).clientX,clientY:i.clientY};var i;const s=a.getEventCoordinateInternal(e);d.setPosition(s)},f=function(t){const e=a.getEventCoordinateInternal(t);u.getMap().getView().setCenterInternal(e),window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",f)};g.addEventListener("mousedown",(function(){window.addEventListener("mousemove",p),window.addEventListener("mouseup",f)}))}setMap(t){const i=this.getMap();if(t!==i){if(i){const t=i.getView();t&&this.unbindView_(t),this.ovmap_.setTarget(null)}if(super.setMap(t),t){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(f(t,e,this.handleMapPropertyChange_,this));const i=t.getView();i&&(this.bindView_(i),i.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(t){if(t.key===ci){const e=t.oldValue;e&&this.unbindView_(e);const i=this.getMap().getView();this.bindView_(i)}else this.ovmap_.isRendered()||t.key!==li&&t.key!==hi||this.ovmap_.updateSize()}bindView_(t){if(!this.view_){const e=new pn({projection:t.getProjection()});this.ovmap_.setView(e)}t.addChangeListener(pi.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(t){t.removeChangeListener(pi.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const t=this.getMap(),e=this.ovmap_;if(!t.isRendered()||!e.isRendered())return;const i=t.getSize(),s=t.getView().calculateExtentInternal(i);if(this.viewExtent_&&ht(s,this.viewExtent_))return;this.viewExtent_=s;const n=e.getSize(),r=e.getView().calculateExtentInternal(n),o=e.getPixelFromCoordinateInternal(vt(s)),a=e.getPixelFromCoordinateInternal(_t(s)),h=Math.abs(o[0]-a[0]),l=Math.abs(o[1]-a[1]),c=n[0],u=n[1];h<.1*c||l<.1*u||h>.75*c||l>.75*u?this.resetExtent_():et(r,s)||this.recenter_()}resetExtent_(){const t=this.getMap(),e=this.ovmap_,i=t.getSize(),s=t.getView().calculateExtentInternal(i),n=e.getView(),r=Math.log(7.5)/Math.LN2;!function(t,e){const i=(t[2]-t[0])/2*(e-1),s=(t[3]-t[1])/2*(e-1);t[0]-=i,t[2]+=i,t[1]-=s,t[3]+=s}(s,1/(.1*Math.pow(2,r/2))),n.fitInternal(ln(s))}recenter_(){const t=this.getMap(),e=this.ovmap_,i=t.getView();e.getView().setCenterInternal(i.getCenterInternal())}updateBox_(){const t=this.getMap(),e=this.ovmap_;if(!t.isRendered()||!e.isRendered())return;const i=t.getSize(),s=t.getView(),n=e.getView(),r=this.rotateWithView_?0:-s.getRotation(),o=this.boxOverlay_,a=this.boxOverlay_.getElement(),h=s.getCenterInternal(),l=s.getResolution(),c=n.getResolution(),u=i[0]*l/c,d=i[1]*l/c;if(o.setPosition(h),a){a.style.width=u+"px",a.style.height=d+"px";const t="rotate("+r+"rad)";a.style.transform=t}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=m(this.ovmap_,ni,(function(t){delete this.ovmapPostrenderKey_,this.updateBox_()}),this))}handleClick_(t){t.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(xe),this.collapsed_?Ie(this.collapseLabel_,this.label_):Ie(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const t=this.ovmap_;if(!this.collapsed_){if(t.isRendered())return this.viewExtent_=void 0,void t.render();t.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),!t&&this.collapsed_&&this.handleToggle_())}setCollapsed(t){this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(t){this.rotateWithView_!==t&&(this.rotateWithView_=t,0!==this.getMap().getView().getRotation()&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(t){this.validateExtent_(),this.updateBox_()}};let cv;const uv=[];function dv(t,e,i,s,n){t.beginPath(),t.moveTo(0,0),t.lineTo(e,i),t.lineTo(s,n),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,s)+1,Math.max(i,n)),t.restore()}function gv(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function pv(t,e,i,s){const n=Zi(i,e,t);let r=Ui(e,s,i);const o=e.getMetersPerUnit();void 0!==o&&(r*=o);const a=t.getMetersPerUnit();void 0!==a&&(r/=a);const h=t.getExtent();if(!h||tt(h,n)){const e=Ui(t,r,n)/r;isFinite(e)&&e>0&&(r/=e)}return r}const _v=class extends Hc{constructor(t,e,i,s,n,r,o){const a=t.getExtent(),h=e.getExtent(),l=h?xt(i,h):i,c=pv(t,e,ft(l),s),u=new class{constructor(t,e,i,s,n,r){this.sourceProj_=t,this.targetProj_=e;let o={};const a=Ki(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){const e=t[0]+"/"+t[1];return o[e]||(o[e]=a(t)),o[e]},this.maxSourceExtent_=s,this.errorThresholdSquared_=n*n,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&Mt(s)==Mt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Mt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Mt(this.targetProj_.getExtent()):null;const h=vt(i),l=wt(i),c=_t(i),u=pt(i),d=this.transformInv_(h),g=this.transformInv_(l),p=this.transformInv_(c),_=this.transformInv_(u),f=10+(r?Math.max(0,Math.ceil(Math.log2(function(t){let e=0;return Ct(t)||(e=Mt(t)*yt(t)),e}(i)/(r*r*256*256)))):0);if(this.addQuad_(h,l,c,u,d,g,p,_,f),this.wrapsXInSource_){let t=1/0;this.triangles_.forEach((function(e,i,s){t=Math.min(t,e.source[0][0],e.source[1][0],e.source[2][0])})),this.triangles_.forEach((e=>{if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-t>this.sourceWorldWidth_/2){const i=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];i[0][0]-t>this.sourceWorldWidth_/2&&(i[0][0]-=this.sourceWorldWidth_),i[1][0]-t>this.sourceWorldWidth_/2&&(i[1][0]-=this.sourceWorldWidth_),i[2][0]-t>this.sourceWorldWidth_/2&&(i[2][0]-=this.sourceWorldWidth_);const s=Math.min(i[0][0],i[1][0],i[2][0]);Math.max(i[0][0],i[1][0],i[2][0])-s<this.sourceWorldWidth_/2&&(e.source=i)}}))}o={}}addTriangle_(t,e,i,s,n,r){this.triangles_.push({source:[s,n,r],target:[t,e,i]})}addQuad_(t,e,i,s,n,r,o,a,h){const l=K([n,r,o,a]),c=this.sourceWorldWidth_?Mt(l)/this.sourceWorldWidth_:null,u=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&c>.5&&c<1;let g=!1;if(h>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(g=Mt(K([t,e,i,s]))/this.targetWorldWidth_>.25||g),!d&&this.sourceProj_.isGlobal()&&c&&(g=c>.25||g)),!g&&this.maxSourceExtent_&&isFinite(l[0])&&isFinite(l[1])&&isFinite(l[2])&&isFinite(l[3])&&!Et(l,this.maxSourceExtent_))return;let p=0;if(!(g||isFinite(n[0])&&isFinite(n[1])&&isFinite(r[0])&&isFinite(r[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])))if(h>0)g=!0;else if(p=(isFinite(n[0])&&isFinite(n[1])?0:8)+(isFinite(r[0])&&isFinite(r[1])?0:4)+(isFinite(o[0])&&isFinite(o[1])?0:2)+(isFinite(a[0])&&isFinite(a[1])?0:1),1!=p&&2!=p&&4!=p&&8!=p)return;if(h>0){if(!g){const e=[(t[0]+i[0])/2,(t[1]+i[1])/2],s=this.transformInv_(e);let r;r=d?(Rt(n[0],u)+Rt(o[0],u))/2-Rt(s[0],u):(n[0]+o[0])/2-s[0];const a=(n[1]+o[1])/2-s[1];g=r*r+a*a>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const l=[(e[0]+i[0])/2,(e[1]+i[1])/2],c=this.transformInv_(l),u=[(s[0]+t[0])/2,(s[1]+t[1])/2],d=this.transformInv_(u);this.addQuad_(t,e,l,u,n,r,c,d,h-1),this.addQuad_(u,l,i,s,d,c,o,a,h-1)}else{const l=[(t[0]+e[0])/2,(t[1]+e[1])/2],c=this.transformInv_(l),u=[(i[0]+s[0])/2,(i[1]+s[1])/2],d=this.transformInv_(u);this.addQuad_(t,l,u,s,n,c,d,a,h-1),this.addQuad_(l,e,i,u,c,r,o,d,h-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&p)&&this.addTriangle_(t,i,s,n,o,a),0==(14&p)&&this.addTriangle_(t,i,e,n,o,r),p&&(0==(13&p)&&this.addTriangle_(e,s,t,r,a,n),0==(7&p)&&this.addTriangle_(e,s,i,r,a,o))}calculateSourceExtent(){const t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach((function(e,i,s){const n=e.source;ct(t,n[0]),ct(t,n[1]),ct(t,n[2])})),t}getTriangles(){return this.triangles_}}(t,e,l,a,.5*c,s),d=r(u.calculateSourceExtent(),c,n),g=d?Xc.IDLE:Xc.EMPTY,p=d?d.getPixelRatio():1;super(i,s,p,g),this.targetProj_=e,this.maxSourceExtent_=a,this.triangulation_=u,this.targetResolution_=s,this.targetExtent_=i,this.sourceImage_=d,this.sourcePixelRatio_=p,this.interpolate_=o,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==Xc.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==Xc.LOADED){const t=Mt(this.targetExtent_)/this.targetResolution_,e=yt(this.targetExtent_)/this.targetResolution_;this.canvas_=function(t,e,i,s,n,r,o,a,h,l,c,u){const d=Ee(Math.round(i*t),Math.round(i*e),uv);if(u||(d.imageSmoothingEnabled=!1),0===h.length)return d.canvas;function g(t){return Math.round(t*i)/i}d.scale(i,i),d.globalCompositeOperation="lighter";const p=[1/0,1/0,-1/0,-1/0];h.forEach((function(t,e,i){lt(p,t.extent)}));const _=Mt(p),f=yt(p),m=Ee(Math.round(i*_/s),Math.round(i*f/s),uv);u||(m.imageSmoothingEnabled=!1);const y=i/s;h.forEach((function(t,e,i){const s=t.extent[0]-p[0],n=-(t.extent[3]-p[3]),r=Mt(t.extent),o=yt(t.extent);t.image.width>0&&t.image.height>0&&m.drawImage(t.image,l,l,t.image.width-2*l,t.image.height-2*l,s*y,n*y,r*y,o*y)}));const x=vt(o);return a.getTriangles().forEach((function(t,e,n){const o=t.source,a=t.target;let h=o[0][0],l=o[0][1],c=o[1][0],_=o[1][1],f=o[2][0],y=o[2][1];const v=g((a[0][0]-x[0])/r),w=g(-(a[0][1]-x[1])/r),M=g((a[1][0]-x[0])/r),E=g(-(a[1][1]-x[1])/r),C=g((a[2][0]-x[0])/r),S=g(-(a[2][1]-x[1])/r),b=h,I=l;h=0,l=0,c-=b,_-=I,f-=b,y-=I;const L=function(t){const e=t.length;for(let i=0;i<e;i++){let s=i,n=Math.abs(t[i][i]);for(let r=i+1;r<e;r++){const e=Math.abs(t[r][i]);e>n&&(n=e,s=r)}if(0===n)return null;const r=t[s];t[s]=t[i],t[i]=r;for(let s=i+1;s<e;s++){const n=-t[s][i]/t[i][i];for(let r=i;r<e+1;r++)i==r?t[s][r]=0:t[s][r]+=n*t[i][r]}}const i=new Array(e);for(let s=e-1;s>=0;s--){i[s]=t[s][e]/t[s][s];for(let n=s-1;n>=0;n--)t[n][e]-=t[n][s]*i[s]}return i}([[c,_,0,0,M-v],[f,y,0,0,C-v],[0,0,c,_,E-w],[0,0,f,y,S-w]]);if(L){if(d.save(),d.beginPath(),function(){if(void 0===cv){const t=Ee(6,6,uv);t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",dv(t,4,5,4,0),dv(t,4,5,0,5);const e=t.getImageData(0,0,3,3).data;cv=gv(e,0)||gv(e,4)||gv(e,8),Ce(t),uv.push(t.canvas)}return cv}()||!u){d.moveTo(M,E);const t=4,e=v-M,i=w-E;for(let s=0;s<t;s++)d.lineTo(M+g((s+1)*e/t),E+g(s*i/(t-1))),s!=t-1&&d.lineTo(M+g((s+1)*e/t),E+g((s+1)*i/(t-1)));d.lineTo(C,S)}else d.moveTo(M,E),d.lineTo(v,w),d.lineTo(C,S);d.clip(),d.transform(L[0],L[2],L[1],L[3],v,w),d.translate(p[0]-b,p[3]-I),d.scale(s/i,-s/i),d.drawImage(m.canvas,0,0),d.restore()}})),Ce(m),uv.push(m.canvas),c&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,a.getTriangles().forEach((function(t,e,i){const s=t.target,n=(s[0][0]-x[0])/r,o=-(s[0][1]-x[1])/r,a=(s[1][0]-x[0])/r,h=-(s[1][1]-x[1])/r,l=(s[2][0]-x[0])/r,c=-(s[2][1]-x[1])/r;d.beginPath(),d.moveTo(a,h),d.lineTo(n,o),d.lineTo(l,c),d.closePath(),d.stroke()})),d.restore()),d.canvas}(t,e,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=t,this.changed()}load(){if(this.state==Xc.IDLE){this.state=Xc.LOADING,this.changed();const t=this.sourceImage_.getState();t==Xc.LOADED||t==Xc.ERROR?this.reproject_():(this.sourceListenerKey_=f(this.sourceImage_,_.CHANGE,(function(t){const e=this.sourceImage_.getState();e!=Xc.LOADED&&e!=Xc.ERROR||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}}unlistenSource_(){y(this.sourceListenerKey_),this.sourceListenerKey_=null}};class fv extends t{constructor(t,e){super(t),this.image=e}}function mv(t,e){t.getImage().src=e}const yv=class extends Mg{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:void 0===t.interpolate||t.interpolate}),this.on,this.once,this.un,this.resolutions_=void 0!==t.resolutions?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();return e&&(t=e[r(e,t,0)]),t}getImage(t,e,i,s){const n=this.getProjection();if(!n||!s||$i(n,s))return n&&(s=n),this.getImageInternal(t,e,i,s);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&$i(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==e&&ht(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new _v(n,s,t,e,i,((t,e,i)=>this.getImageInternal(t,e,i,n)),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,i,s){return w()}handleImageChange(t){const e=t.target;let i;switch(e.getState()){case Xc.LOADING:this.loading=!0,i="imageloadstart";break;case Xc.LOADED:this.loading=!1,i="imageloadend";break;case Xc.ERROR:this.loading=!1,i="imageloaderror";break;default:return}this.hasListener(i)&&this.dispatchEvent(new fv(i,e))}},xv="1.3.0";function vv(t,e){const i=[];Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&i.push(t+"="+encodeURIComponent(e[t]))}));const s=i.join("&");return t=t.replace(/[?&]$/,""),(t+=t.includes("?")?"&":"?")+s}const wv=[101,101],Mv=class extends yv{constructor(t){super({attributions:(t=t||{}).attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null,this.url_=t.url,this.imageLoadFunction_=void 0!==t.imageLoadFunction?t.imageLoadFunction:mv,this.params_=Object.assign({},t.params),this.v13_=!0,this.updateV13_(),this.serverType_=t.serverType,this.hidpi_=void 0===t.hidpi||t.hidpi,this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=void 0!==t.ratio?t.ratio:1.5}getFeatureInfoUrl(t,e,i,s){if(void 0===this.url_)return;const n=qi(i),r=this.getProjection();r&&r!==n&&(e=pv(r,n,t,e),t=Zi(t,n,r));const o=mt(t,e,0,wv),a={SERVICE:"WMS",VERSION:xv,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object.assign(a,this.params_,s);const h=Ft((t[0]-o[0])/e,4),l=Ft((o[3]-t[1])/e,4);return a[this.v13_?"I":"X"]=h,a[this.v13_?"J":"Y"]=l,this.getRequestUrl_(o,wv,1,r||n,a)}getLegendUrl(t,e){if(void 0===this.url_)return;const i={SERVICE:"WMS",VERSION:xv,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e||void 0===e.LAYER){const t=this.params_.LAYERS;if(Array.isArray(t)&&1!==t.length)return;i.LAYER=t}if(void 0!==t){const e=this.getProjection()?this.getProjection().getMetersPerUnit():1,s=28e-5;i.SCALE=t*e/s}return Object.assign(i,e),vv(this.url_,i)}getParams(){return this.params_}getImageInternal(t,e,i,s){if(void 0===this.url_)return null;e=this.findNearestResolution(e),1==i||this.hidpi_&&void 0!==this.serverType_||(i=1);const n=e/i,r=ft(t),o=mt(r,n,0,[Dt(Mt(t)/n,4),Dt(yt(t)/n,4)]),a=mt(r,n,0,[Dt(this.ratio_*Mt(t)/n,4),Dt(this.ratio_*yt(t)/n,4)]),h=this.image_;if(h&&this.renderedRevision_==this.getRevision()&&h.getResolution()==e&&h.getPixelRatio()==i&&et(h.getExtent(),o))return h;const l={SERVICE:"WMS",VERSION:xv,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};Object.assign(l,this.params_),this.imageSize_[0]=At(Mt(a)/n,4),this.imageSize_[1]=At(yt(a)/n,4);const c=this.getRequestUrl_(a,this.imageSize_,i,s,l);return this.image_=new Zc(a,e,i,c,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(_.CHANGE,this.handleImageChange.bind(this)),this.image_}getImageLoadFunction(){return this.imageLoadFunction_}getRequestUrl_(t,e,i,s,n){if(q(void 0!==this.url_,9),n[this.v13_?"CRS":"SRS"]=s.getCode(),"STYLES"in this.params_||(n.STYLES=""),1!=i)switch(this.serverType_){case"geoserver":const t=90*i+.5|0;"FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+=";dpi:"+t:n.FORMAT_OPTIONS="dpi:"+t;break;case"mapserver":n.MAP_RESOLUTION=90*i;break;case"carmentaserver":case"qgis":n.DPI=90*i;break;default:q(!1,8)}n.WIDTH=e[0],n.HEIGHT=e[1];const r=s.getAxisOrientation();let o;return o=this.v13_&&"ne"==r.substr(0,2)?[t[1],t[0],t[3],t[2]]:t,n.BBOX=o.join(","),vv(this.url_,n)}getUrl(){return this.url_}setImageLoadFunction(t){this.image_=null,this.imageLoadFunction_=t,this.changed()}setUrl(t){t!=this.url_&&(this.url_=t,this.image_=null,this.changed())}updateParams(t){Object.assign(this.params_,t),this.updateV13_(),this.image_=null,this.changed()}updateV13_(){const t=this.params_.VERSION||xv;this.v13_=function(t,e){const i=(""+t).split("."),s="1.3".split(".");for(let t=0;t<Math.max(i.length,s.length);t++){const e=parseInt(i[t]||"0",10),n=parseInt(s[t]||"0",10);if(e>n)return 1;if(n>e)return-1}return 0}(t)>=0}},Ev=class extends re{constructor(t){super(t=t||{})}},Cv=class extends Qg{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],i=t.pixelRatio,s=t.viewState,n=s.resolution,r=this.getLayer().getSource(),o=t.viewHints;let a=t.extent;if(void 0!==e.extent&&(a=xt(a,ns(e.extent,s.projection))),!o[0]&&!o[1]&&!Ct(a))if(r){const t=s.projection,e=r.getImage(a,n,i,t);e&&(this.loadImage(e)?this.image_=e:e.getState()===Xc.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),s=U(e.pixelToCoordinateTransform,t.slice()),n=i.getExtent();if(n&&!tt(n,s))return null;const r=this.image_.getExtent(),o=this.image_.getImage(),a=Mt(r),h=Math.floor(o.width*((s[0]-r[0])/a));if(h<0||h>=o.width)return null;const l=yt(r),c=Math.floor(o.height*((r[3]-s[1])/l));return c<0||c>=o.height?null:this.getImageData(o,h,c)}renderFrame(t,e){const i=this.image_,s=i.getExtent(),n=i.getResolution(),r=i.getPixelRatio(),o=t.layerStatesArray[t.layerIndex],a=t.pixelRatio,h=t.viewState,l=h.center,c=a*n/(h.resolution*r),u=t.extent,d=h.resolution,g=h.rotation,p=Math.round(Mt(u)/d*a),_=Math.round(yt(u)/d*a);Y(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/a,1/a,g,-p/2,-_/2),V(this.inversePixelTransform,this.pixelTransform);const f=W(this.pixelTransform);this.useContainer(e,f,this.getBackground(t));const m=this.context,y=m.canvas;y.width!=p||y.height!=_?(y.width=p,y.height=_):this.containerReused||m.clearRect(0,0,p,_);let x=!1,v=!0;if(o.extent){const e=ns(o.extent,h.projection);v=Et(e,t.extent),x=v&&!et(e,t.extent),x&&this.clipUnrotated(m,t,e)}const w=i.getImage(),M=Y(this.tempTransform,p/2,_/2,c,c,0,r*(s[0]-l[0])/n,r*(l[1]-s[3])/n);this.renderedResolution=n*a/r;const E=w.width*M[0],C=w.height*M[3];if(this.getLayer().getSource().getInterpolate()||(m.imageSmoothingEnabled=!1),this.preRender(m,t),v&&E>=.5&&C>=.5){const t=M[4],e=M[5],i=o.opacity;let s;1!==i&&(s=m.globalAlpha,m.globalAlpha=i),m.drawImage(w,0,0,+w.width,+w.height,t,e,E,C),1!==i&&(m.globalAlpha=s)}return this.postRender(m,t),x&&m.restore(),m.imageSmoothingEnabled=!0,f!==y.style.transform&&(y.style.transform=f),this.container}},Sv=class extends Ev{constructor(t){super(t)}createRenderer(){return new Cv(this)}getData(t){return super.getData(t)}};class bv extends HTMLElement{constructor(){super()}connectedCallback(){const t=new Sv({source:new Mv({url:jy.serviceURL,params:{LAYERS:"Overview"},ratio:1,serverType:"qgis"})});this._isCollapsedAtInit=lizMap.checkMobile()||document.URL.includes("view/embed");const e=!1===jy.config.options?.fixed_scale_overview_map;this._olOverviewMap=new lv({layers:[t],collapsed:this._isCollapsedAtInit,target:this,tipLabel:lizDict["overviewbar.displayoverview.hover"],collapseLabel:"»",label:"«",view:e?void 0:new pn({resolutions:[jy.map.getView().getResolutionForExtent(jy.config.options.initialExtent,[220,100])],projection:"EPSG:900913"===jy.projection?"EPSG:3857":jy.projection})}),jy.map.addControl(this._olOverviewMap)}disconnectedCallback(){jy.map.removeControl(this._olOverviewMap)}}class Iv extends HTMLElement{constructor(){super(),[this._layerId,this._fid]=this.getAttribute("value").split("."),[this._featureType,this._layerConfig]=lizMap.getLayerConfigById(this.layerId),this._typeName=this._layerConfig?.shortname||this._layerConfig?.typename||this._layerConfig?.name,this._parentLayerId=this.getAttribute("parent-layer-id"),this._isFeatureEditable=!0,this.hasEditionRestricted&&(this._isFeatureEditable=!this.hasEditionRestricted),this._downloadFormats=["GeoJSON","GPX","KML"],this._mainTemplate=()=>hx`
        <div class="feature-toolbar">
            <button type="button" class="btn btn-mini feature-select ${this.attributeTableConfig?"":"hide"} ${this.isSelected?"btn-primary":""}" @click=${()=>this.select()} title="${lizDict["attributeLayers.btn.select.title"]}"><i class="icon-ok"></i></button>
            <button type="button" class="btn btn-mini feature-filter ${this.attributeTableConfig&&this.hasFilter?"":"hide"} ${this.isFiltered?"btn-primary":""}" @click=${()=>this.filter()} title="${lizDict["attributeLayers.toolbar.btn.data.filter.title"]}"><i class="icon-filter"></i></button>
            <button type="button" class="btn btn-mini feature-zoom ${this.getAttribute("crs")||this.attributeTableConfig&&this.hasGeometry?"":"hide"}" @click=${()=>this.zoom()} title="${lizDict["attributeLayers.btn.zoom.title"]}"><i class="icon-zoom-in"></i></button>
            <button type="button" class="btn btn-mini feature-center ${this.getAttribute("crs")||this.attributeTableConfig&&this.hasGeometry?"":"hide"}"  @click=${()=>this.center()} title="${lizDict["attributeLayers.btn.center.title"]}"><i class="icon-screenshot"></i></button>
            <button type="button" class="btn btn-mini feature-edit ${this.isLayerEditable&&this._isFeatureEditable?"":"hide"}" @click=${()=>this.edit()} title="${lizDict["attributeLayers.btn.edit.title"]}"><i class="icon-pencil"></i></button>
            <button type="button" class="btn btn-mini feature-delete ${this.isDeletable?"":"hide"}" @click=${()=>this.delete()} title="${lizDict["attributeLayers.btn.delete.title"]}"><i class="icon-trash"></i></button>
            <button type="button" class="btn btn-mini feature-unlink ${this.isUnlinkable?"":"hide"}" @click=${()=>this.isLayerPivot?this.delete():this.unlink()} title="${lizDict["attributeLayers.btn.remove.link.title"]}"><i class="icon-minus"></i></button>

            ${this.isFeatureExportable?hx`<div class="btn-group feature-export">
                        <button type="button" class="btn btn-mini dropdown-toggle" data-toggle="dropdown" title="${lizDict["attributeLayers.toolbar.btn.data.export.title"]}">
                            <i class="icon-download"></i>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu pull-right" role="menu">
                            ${this._downloadFormats.map((t=>hx`<li><a href="#" @click=${()=>this.export(t)}>${t}</a></li>`))}
                        </ul>
                    </div>`:""}

        </div>`,Sx(this._mainTemplate(),this),$(".btn",this).tooltip({placement:"top"}),this._editableFeaturesCallBack=t=>{this.updateIsFeatureEditable(t.properties),Sx(this._mainTemplate(),this)}}connectedCallback(){qy.addListener((()=>{Sx(this._mainTemplate(),this)}),["selection.changed","filteredFeatures.changed"]),qy.addListener(this._editableFeaturesCallBack,"edition.editableFeatures")}disconnectedCallback(){qy.removeListener((()=>{Sx(this._mainTemplate(),this)}),"selection.changed"),qy.removeListener(this._editableFeaturesCallBack,"edition.editableFeatures")}get fid(){return this._fid}get layerId(){return this._layerId}get featureType(){return this._featureType}get parentLayerId(){return this._parentLayerId}get isSelected(){const t=this._layerConfig?.selectedFeatures;return t&&t.includes(this.fid)}get isFiltered(){const t=this._layerConfig?.filteredFeatures;return t&&t.includes(this.fid)}get hasFilter(){return!("undefined"!=typeof lizLayerFilter||lizMap.lizmapLayerFilterActive!==this.featureType&&lizMap.lizmapLayerFilterActive)}get hasGeometry(){const t=lizMap.getLayerConfigById(this.layerId)[1].geometryType;return"none"!=t&&"unknown"!=t}get attributeTableConfig(){return lizMap.getLayerConfigById(this.layerId,lizMap.config.attributeLayers,"layerId")?.[1]}get isLayerEditable(){return"True"===lizMap.config?.editionLayers?.[this.featureType]?.capabilities?.modifyAttribute||"True"===lizMap.config?.editionLayers?.[this.featureType]?.capabilities?.modifyGeometry}get isLayerPivot(){return"True"===this.attributeTableConfig?.pivot}get isUnlinkable(){return this.parentLayerId&&this.isLayerEditable&&!this.isLayerPivot||"True"===lizMap.config?.editionLayers?.[this.featureType]?.capabilities?.deleteFeature&&this.isLayerPivot}get isDeletable(){return this._isFeatureEditable&&"True"===lizMap.config?.editionLayers?.[this.featureType]?.capabilities?.deleteFeature&&!this.isLayerPivot}get hasEditionRestricted(){return"true"===this.getAttribute("edition-restricted")}get hasRelation(){return lizMap.config?.relations?.[this.parentLayerId]?.some((t=>t.referencingLayer===this.layerId))}get isFeatureExportable(){return this.attributeTableConfig&&this.hasGeometry&&this._layerConfig?.popup_allow_download}updateIsFeatureEditable(t){this._isFeatureEditable=!1;for(const e of t){const[t,i]=e.id.split(".");if(t===this.featureType&&i===this.fid){this._isFeatureEditable=!0;break}}}select(){lizMap.events.triggerEvent("layerfeatureselected",{featureType:this.featureType,fid:this.fid,updateDrawing:!0})}zoom(){0!=lizMap.map.popups.length&&lizMap.map.removePopup(lizMap.map.popups[0]),this.getAttribute("crs")?lizMap.mainLizmap.extent=Ji([this.getAttribute("bbox-minx"),this.getAttribute("bbox-miny"),this.getAttribute("bbox-maxx"),this.getAttribute("bbox-maxy")],this.getAttribute("crs"),lizMap.mainLizmap.projection):lizMap.zoomToFeature(this.featureType,this.fid,"zoom")}center(){this.getAttribute("crs")?lizMap.mainLizmap.center=ft(Ji([this.getAttribute("bbox-minx"),this.getAttribute("bbox-miny"),this.getAttribute("bbox-maxx"),this.getAttribute("bbox-maxy")],this.getAttribute("crs"),lizMap.mainLizmap.projection)):lizMap.zoomToFeature(this.featureType,this.fid,"center")}edit(){const t=this.getAttribute("parent-feature-id");if(t&&this.hasRelation){const e=lizMap.getLayerConfigById(this.parentLayerId)?.[0];lizMap.getLayerFeature(e,t,(t=>{lizMap.launchEdition(this.layerId,this.fid,{layerId:this.parentLayerId,feature:t})}))}else lizMap.launchEdition(this.layerId,this.fid)}delete(){lizMap.deleteEditionFeature(this.layerId,this.fid)}unlink(){const t=this.parentLayerId,e=lizMap.config;let i=null;if(!(t in e.relations))return!1;for(const s in e.relations[t]){const n=e.relations[t][s];n.referencingLayer==this.layerId&&(i=n.referencingField)}if(!i)return!1;const s=e.layers[this.featureType].features;if(!s||Object.keys(s).length<=0)return!1;const n=this.attributeTableConfig?.primaryKey;if(!n)return!1;const r=s[this.fid];if(!r)return!1;let o=r.properties[n];Number.isInteger(o)||(o=" '"+o+"' "),fetch(lizUrls.edition.replace("getFeature","unlinkChild"),{method:"POST",body:new URLSearchParams({repository:lizUrls.params.repository,project:lizUrls.params.project,lid:this.layerId,pkey:n,pkeyval:o,fkey:i})}).then((t=>t.text())).then((t=>{$("#lizmap-edition-message").remove(),lizMap.addMessage(t,"info",!0).attr("id","lizmap-edition-message"),lizMap.events.triggerEvent("lizmapeditionfeaturemodified",{layerId:this.layerId})}))}filter(){const t=this.isFiltered;lizMap.events.triggerEvent("layerfeatureunselectall",{featureType:this.featureType,updateDrawing:!1}),t?(lizMap.events.triggerEvent("layerfeatureremovefilter",{featureType:this.featureType}),lizMap.lizmapLayerFilterActive=null):(lizMap.events.triggerEvent("layerfeatureselected",{featureType:this.featureType,fid:this.fid,updateDrawing:!1}),lizMap.events.triggerEvent("layerfeaturefilterselected",{featureType:this.featureType}),lizMap.lizmapLayerFilterActive=this.featureType)}export(t){lizMap.mainLizmap.wfs.getFeature({TYPENAME:this._typeName,FEATUREID:this._typeName+"."+this._fid}).then((e=>{if("GeoJSON"==t)ol.downloadFileFromString(JSON.stringify(e),"application/geo+json",this.featureType+".json");else{const i=(new Tl).readFeatures(e);if("GPX"==t){const t=(new Uc).writeFeatures(i);ol.downloadFileFromString(t,"application/gpx+xml",this.featureType+".gpx")}else{const t=(new fg).writeFeatures(i);ol.downloadFileFromString(t,"application/vnd.google-earth.kml+xml",this.featureType+".kml")}}}))}}var Lv=new(Lx())({id:"mActionReverseLine",use:"mActionReverseLine-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="mActionReverseLine"><path fill="none" stroke="#8cbe8c" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.5 2.5 9 15l6-10h6" /><g fill="#bebebe" stroke="#8c8c8c"><path d="M1.5 1.5h3v3h-3zM7.5 13.5h3v3h-3zM13.5 3.5h3v3h-3zM19.5 3.5h3v3h-3z" /></g><rect width="11" height="11" x="13" y="13" fill="#3c5a6e" rx="2.011" /><path fill="#fcffff" fill-rule="evenodd" d="m14 19 9-.01v-2C23 14 22 14 18.5 14S14 14 14 17v2z" opacity=".3" /><g fill="none" stroke="#fff" stroke-width="1.5"><path stroke-linecap="square" d="M22.33 16.75c0-1.522-1.164-2.167-2.923-2.153-1.899-.016-2.77.434-2.77 2.186" /><path stroke-linecap="round" stroke-linejoin="round" d="m18.679 16.88-2 1.5-2-1.5" /></g><g fill="none" stroke="#fff" stroke-width="1.5"><path stroke-linecap="square" d="M14.67 20.25c0 1.522 1.164 2.167 2.923 2.153 1.899.016 2.77-.434 2.77-2.186" /><path stroke-linecap="round" stroke-linejoin="round" d="m18.321 20.12 2-1.5 2 1.5" /></g></symbol>'});Nx().add(Lv);class Tv extends HTMLElement{constructor(){super(),this.insertAdjacentHTML("afterbegin",'<svg>\n                <use xlink:href="#mActionReverseLine"></use>\n            </svg>')}_reverse(){if(!jy.edition.modifyFeatureControl||!jy.edition.modifyFeatureControl.active||0==jy.edition.modifyFeatureControl.vertices.length)return;const t=[];for(const e of jy.edition.modifyFeatureControl.vertices)t.push([e.geometry.x,e.geometry.y]);t.reverse();for(let e=0;e<t.length;e++)jy.edition.modifyFeatureControl.vertices[e].move(new OpenLayers.LonLat(t[e][0],t[e][1]));jy.edition.modifyFeatureControl.layer.events.triggerEvent("featuremodified",{feature:jy.edition.modifyFeatureControl.feature}),lizMap.addMessage(lizDict["edition.revertgeom.success"],"success",!0).attr("id","lizmap-edition-message")}connectedCallback(){this.addEventListener("click",this._reverse)}disconnectedCallback(){this.removeEventListener("click",this._reverse)}}var Nv=new(Lx())({id:"fullscreen",use:"fullscreen-usage",viewBox:"0 0 16 16",content:'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-fullscreen" viewBox="0 0 16 16" id="fullscreen"><path stroke="currentColor" d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zM.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5z" /></symbol>'});Nx().add(Nv);var Rv=new(Lx())({id:"fullscreen-exit",use:"fullscreen-exit-usage",viewBox:"0 0 16 16",content:'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-fullscreen-exit" viewBox="0 0 16 16" id="fullscreen-exit"><path stroke="currentColor" d="M5.5 0a.5.5 0 0 1 .5.5v4A1.5 1.5 0 0 1 4.5 6h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5zm5 0a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 10 4.5v-4a.5.5 0 0 1 .5-.5zM0 10.5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 6 11.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zm10 1a1.5 1.5 0 0 1 1.5-1.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4z" /></symbol>'});Nx().add(Rv);class Pv extends HTMLElement{constructor(){super()}connectedCallback(){if(!this.requestFullscreen)return void console.log("Your browser does not support the Fullscreen API");const t=this.getAttribute("selector");t?(this._elementFullscreened=document.querySelector(t),this._elementFullscreened?(this._template=()=>hx`
        <button @click=${()=>document.fullscreenElement?document.exitFullscreen():this._elementFullscreened.requestFullscreen()}>
            ${document.fullscreenElement?hx`<svg><use xlink:href="#fullscreen-exit"></use></svg>`:hx`<svg><use xlink:href="#fullscreen"></use></svg>`}
        </button>`,this._fullscreenchangeCallBack=()=>Sx(this._template(),this),this._elementFullscreened.addEventListener("fullscreenchange",this._fullscreenchangeCallBack),Sx(this._template(),this)):console.log("The selected element does not exist")):console.log("A selector must be provided")}disconnectedCallback(){this._elementFullscreened.removeEventListener("fullscreenchange",this._fullscreenchangeCallBack)}}lizMap.events.on({uicreated:()=>{window.customElements.define("lizmap-geolocation",bx),window.customElements.define("lizmap-geolocation-survey",Px),window.customElements.define("lizmap-selection-tool",Ox),window.customElements.define("lizmap-selection-invert",Fx),window.customElements.define("lizmap-snapping",kx),window.customElements.define("lizmap-scaleline",qx),window.customElements.define("lizmap-mouse-position",Ux),window.customElements.define("lizmap-digitizing",iv),jy.hasOverview&&window.customElements.define("lizmap-overviewmap",bv),window.customElements.define("lizmap-feature-toolbar",Iv),window.customElements.define("lizmap-reverse-geom",Tv),window.customElements.define("lizmap-fullscreen",Pv),lizMap.mainLizmap=jy,lizMap.mainEventDispatcher=qy}})})()})();
//# sourceMappingURL=lizmap.js.map