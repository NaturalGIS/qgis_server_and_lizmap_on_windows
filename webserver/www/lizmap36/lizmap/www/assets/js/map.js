/*! For license information please see map.js.LICENSE.txt */
(()=>{"use strict";class e{constructor(){this._defaultGetFeatureParameters={repository:lizUrls.params.repository,project:lizUrls.params.project,SERVICE:"WFS",REQUEST:"GetFeature",VERSION:"1.0.0",OUTPUTFORMAT:"GeoJSON"},this._defaultDescribeFeatureTypeParameters={repository:lizUrls.params.repository,project:lizUrls.params.project,SERVICE:"WFS",REQUEST:"DescribeFeatureType",VERSION:"1.0.0",OUTPUTFORMAT:"JSON"}}async getFeature(e){const t=await fetch(lizUrls.wms,{method:"POST",body:new URLSearchParams({...this._defaultGetFeatureParameters,...e})});return await t.json()}async describeFeatureType(e){const t=await fetch(lizUrls.wms,{method:"POST",body:new URLSearchParams({...this._defaultDescribeFeatureTypeParameters,...e})});return await t.json()}}class t{constructor(){this._defaultGetFeatureInfoParameters={repository:lizUrls.params.repository,project:lizUrls.params.project,SERVICE:"WMS",REQUEST:"GetFeatureInfo",VERSION:"1.3.0",SRS:"EPSG:4326",INFO_FORMAT:"text/html"}}async getFeatureInfo(e){const t=await fetch(lizUrls.wms,{method:"POST",body:new URLSearchParams({...this._defaultGetFeatureInfoParameters,...e})});return await t.text()}}window.lizMap=function(){var a=null,n=null,i=null,o=null,r=null,l=null,s=[],p=[],m={},u={scales:[],layouts:[]},c={config:{type:"group"}},f={FI_POINT_TOLERANCE:25,FI_LINE_TOLERANCE:10,FI_POLYGON_TOLERANCE:5},d={osm:"osm-mapnik","osm-toner":"osm-stamen-toner",opentopomap:"open-topo-map","osm-cycle":"osm-cyclemap",gsat:"google-satellite",ghyb:"google-hybrid",gphy:"google-terrain",gmap:"google-street",bmap:"bing-road",baerial:"bing-aerial",bhybrid:"bing-hybrid",ignmap:"ign-scan",ignplan:"ign-plan",ignphoto:"ign-photo",igncadastral:"ign-cadastral"},y={"osm-mapnik":"osm","osm-stamen-toner":"osm-toner","open-topo-map":"opentopomap","osm-cyclemap":"osm-cycle","google-satellite":"gsat","google-hybrid":"ghyb","google-terrain":"gphy","google-street":"gmap","bing-road":"bmap","bing-aerial":"baerial","bing-hybrid":"bhybrid","ign-scan":"ignmap","ign-plan":"ignplan","ign-photo":"ignphoto","ign-cadastral":"igncadastral",empty:"emptyBaselayer"},g={},v={},h={},b={},L=null,z={},O=null;function S(){var e={lizmap_plugin_version_str:"3.1.8",lizmap_plugin_version:30108,lizmap_web_client_target_version:30200,project_valid:null,qgis_desktop_version:3e4};return"metadata"in a?("lizmap_plugin_version"in a.metadata&&(e.lizmap_plugin_version=a.metadata.lizmap_plugin_version),"lizmap_web_client_target_version"in a.metadata&&(e.lizmap_web_client_target_version=a.metadata.lizmap_web_client_target_version),"project_valid"in a.metadata&&(e.project_valid=a.metadata.project_valid),"qgis_desktop_version"in a.metadata&&(e.qgis_desktop_version=a.metadata.qgis_desktop_version),e):e}function T(e){if(e in g)return e;if(null==e)return console.log("An undefined name has been clean"),"";var t=function(e){var t={à:"a",á:"a",â:"a",ã:"a",ä:"a",ç:"c",è:"e",é:"e",ê:"e",ë:"e",ì:"i",í:"i",î:"i",ï:"i",ñ:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ù:"u",ú:"u",û:"u",ü:"u",ý:"y",ÿ:"y",À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Ç:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ñ:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ý:"Y","-":" ","'":" ","(":" ",")":" "},a=function(e){for(var a="",n=0;n<e.length;n++)a+=t[e.charAt(n)]||e.charAt(n);return a}(e),n=new RegExp("\\W","g");return a.replace(n,"_")}(e);if(t in g&&g[t]!=e){for(var a=1,n=t+a;n in g&&g[n]!=e;)n=t+(a+=1);t=n}return g[t]=e,t}function x(e){var t=null;return e in z&&(t=z[e]),null==t&&e in g&&(t=g[e],z[e]=t),t}function E(){var e;(e=ie())!=$("#content").hasClass("mobile")&&(e?($("#content, #headermenu").addClass("mobile"),$("#button-switcher").parent().hasClass("active")&&$("#button-switcher").click(),$("#button-tooltip-layer").parent().hasClass("active")&&$("#button-tooltip-layer").click(),$("#menu").is(":visible")&&$("#menu").hide(),$("#map-content").append($("#toolbar")),$("#toggleLegend").attr("data-original-title",$("#toggleLegendOn").attr("value")).parent().attr("class","legend"),$("div.locate-layer select").show(),$("span.custom-combobox").hide()):($("#content, #headermenu").removeClass("mobile"),$("#button-switcher").parent().hasClass("active")||$("#button-switcher").click(),$("#menu").is(":visible")?$("#map-content").show():$("#content span.ui-icon-open-menu").click(),$("#toolbar").insertBefore($("#switcher-menu")),$("#toggleLegend").attr("data-original-title",$("#toggleMapOnlyOn").attr("value")).parent().attr("class","map"),$("div.locate-layer select").hide(),$("span.custom-combobox").show()));var t=$(window).innerHeight();t-=$("#header").height(),$("#map").height(t),$("body").css("padding-top",$("#header").outerHeight());var n=$("body").parent()[0].offsetWidth;n-=parseInt($("#map-content").css("margin-left")),n-=parseInt($("#map-content").css("margin-right")),$("#menu").is(":hidden")||$("#map-content").hasClass("fullscreen")?$("#map-content").css("margin-left","auto"):(n-=$("#menu").width(),$("#map-content").css("margin-left",$("#menu").width())),$("#map").width(n),$("#right-dock-tabs").is(":visible")&&$("#right-dock-content").css("max-height",$("#right-dock").height()-$("#right-dock-tabs").height()),l&&function(){var e=3e3,t=3e3;"wmsMaxWidth"in a.options&&a.options.wmsMaxWidth&&(e=Number(a.options.wmsMaxWidth)),"wmsMaxHeight"in a.options&&a.options.wmsMaxHeight&&(t=Number(a.options.wmsMaxHeight));var n=!1,i=l.getCurrentSize(),o=i.clone();if(i.w>e||i.h>t){n=!0;var r=Math.max(e,t),s=Math.min(e,t),p=Math.max(i.w,i.h),m=Math.min(i.w,i.h);o=p/2>m?new OpenLayers.Size(Math.round(p/2),Math.round(p/2)):r/2>m?new OpenLayers.Size(Math.round(r/2),Math.round(r/2)):new OpenLayers.Size(Math.round(s/2),Math.round(s/2))}for(var u=0,c=l.layers.length;u<c;++u){var f=l.layers[u];if(f instanceof OpenLayers.Layer.WMS){var d=null;f.name in g&&(d=x(f.name));var y=null;d&&(y=a.layers[d]),y||(y=a.layers[f.params.LAYERS]),y||(y=a.layers[f.name]),y&&"True"==y.singleTile&&(n&&f.singleTile?f.addOptions({singleTile:!1,tileSize:o}):n||f.singleTile||(o.h=parseInt(o.h*f.ratio,10),o.w=parseInt(o.w*f.ratio,10),f.addOptions({singleTile:!0,tileSize:o})))}}var v=l.getCenter();l.updateSize(),l.setCenter(v),l.baseLayer.redraw(),C()}()}function C(){if(0==$("#mini-dock .tab-pane:visible").length)return 0;var e=$("#mini-dock .tab-pane:visible h3 ~ .menu-content:first");e.css("max-height","100%");var t=$("#mini-dock").height();t-=$("#mini-dock .tab-pane:visible h3").height(),t-=parseInt(e.css("margin-top"))?parseInt(e.css("margin-top")):0,t-=parseInt(e.css("margin-bottom"))?parseInt(e.css("margin-bottom")):0,t-=parseInt(e.css("padding-top"))?parseInt(e.css("padding-top")):0,t-=parseInt(e.css("padding-bottom"))?parseInt(e.css("padding-bottom")):0,e.css("max-height",t).css("overflow-x","hidden").css("overflow-y","auto")}function w(e,t){var n=null;if($.each(p,(function(t,a){null==n&&a.name==e&&(n=a)})),null==n)return null;var i=null;e in g&&(i=x(e));var o=null;if(i&&(o=a.layers[i]),o||(o=a.layers[n.params.LAYERS]),o||(o=a.layers[n.name]),!o)return null;if("externalWmsToggle"in o&&"True"==o.externalWmsToggle&&"externalAccess"in o&&o.externalAccess&&"layers"in o.externalAccess&&"url"in o.externalAccess){var r=o.externalAccess,s={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetLegendGraphic",LAYER:r.layers,STYLE:r.styles,SLD_VERSION:"1.1.0",EXCEPTIONS:"application/vnd.ogc.se_inimage",FORMAT:"image/png",TRANSPARENT:"TRUE",WIDTH:150,DPI:96},m=OpenLayers.Util.getParameterString(s);return OpenLayers.Util.urlAppend(r.url,m)}s={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetLegendGraphic",LAYER:n.params.LAYERS,STYLE:n.params.STYLES,EXCEPTIONS:"application/vnd.ogc.se_inimage",FORMAT:"image/png",TRANSPARENT:"TRUE",WIDTH:150,LAYERFONTSIZE:9,ITEMFONTSIZE:9,SYMBOLSPACE:1,ICONLABELSPACE:2,DPI:96,RULELABEL:"AUTO"},o.id==o.name?s.LAYERFONTBOLD="TRUE":(s.LAYERFONTSIZE=0,s.LAYERSPACE=0,s.LAYERFONTBOLD="FALSE",s.LAYERTITLE="FALSE"),t&&(s.SCALE=l.getScale()),m=OpenLayers.Util.getParameterString(s);var u=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));return OpenLayers.Util.urlAppend(u,m)}function k(e,t,n){for(var i=0,o=e.nestedLayers.length;i<o;i++){var r=e.nestedLayers[i],l=r.name;"useLayerIDs"in a.options&&"True"==a.options.useLayerIDs?l=v[r.name]:r.name in h&&(l=h[r.name]);var s=a.layers[l];if(0!=r.nestedLayers.length)return k(r,t,n);s&&((null==t||s.minScale<t)&&(t=s.minScale),(null==n||s.maxScale>n)&&(n=s.maxScale))}return t<1&&(t=1),{minScale:t,maxScale:n}}function M(e){if(!("layersOrder"in a))return-1;if(0==e.nestedLayers.length){var t=e.name;return"useLayerIDs"in a.options&&"True"==a.options.useLayerIDs?t=v[e.name]:e.name in h&&(t=h[e.name]),t in a.layersOrder?a.layersOrder[e.name]:-1}for(var n=-1,i=0,o=e.nestedLayers.length;i<o;i++){var r=e.nestedLayers[i];t=r.name,"useLayerIDs"in a.options&&"True"==a.options.useLayerIDs?t=v[r.name]:r.name in h&&(t=h[r.name]);var l;-1!=(l=0!=r.nestedLayers.length?k(r):t in a.layersOrder?a.layersOrder[t]:-1)&&(-1==n||l<n)&&(n=l)}return n}function P(e,t){t.children=[];var n=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));if(lizUrls.publicUrlList&&lizUrls.publicUrlList.length>1){n=[];for(var i=0,r=lizUrls.publicUrlList.length;i<r;i++)n.push(OpenLayers.Util.urlAppend(lizUrls.publicUrlList[i],OpenLayers.Util.getParameterString(lizUrls.params)))}for(var l=new OpenLayers.Format.WMTSCapabilities({}),m=0,u=e.nestedLayers.length;m<u;m++){var c=n,f=e.nestedLayers[m],d=f.name;if("useLayerIDs"in a.options&&"True"==a.options.useLayerIDs?d=v[f.name]:f.name in h&&(d=h[f.name]),d in a.layers){var y=a.layers[d],g=T(d);if(z[g]=d,"hidden"!=d.toLowerCase())if("Overview"!=d){if(y){"True"==y.groupAsLayer&&(y.type="layer");var b=$.map(f.styles,(function(e){return e.name}));0!=b.length?y.styles=b:"qgisServerVersion"in a.options&&a.options.qgisServerVersion.startsWith("3.")?y.styles=[""]:y.styles=["default"];var L={name:g,config:y,parent:t},O="styles"in y?y.styles[0]:"default";"undefined"!=typeof lizLayerStyles&&g in lizLayerStyles&&lizLayerStyles[g]&&(O=lizLayerStyles[g]);var S={layers:f.name,styles:O,version:"1.3.0",exceptions:"application/vnd.ogc.se_inimage",format:y.imageFormat?y.imageFormat:"image/png",dpi:96};"image/jpeg"!=S.format&&(S.transparent=!0),"object"==typeof f.attribution&&("href"in f.attribution&&""!=f.attribution.href&&-1==f.attribution.href.indexOf("://")&&(f.attribution.href="http://"+f.attribution.href),"title"in f.attribution&&""!=f.attribution.title?"href"in f.attribution&&""!=f.attribution.href||(f.attribution=f.attribution.title):f.attribution.title=f.attribution.href.split("://")[1]);var x=null;"True"==y.cached&&o&&$.each(o.contents.layers,(function(e,t){if(t.identifier!=f.name)return!0;var n={layer:f.name,matrixSet:a.options.projection.ref,name:g,params:S,attribution:f.attribution,isBaseLayer:"True"==y.baseLayer,alwaysInRange:!1,url:c};if(-1!=$.inArray(a.options.projection.ref.toUpperCase(),["EPSG:3857","EPSG:900913"])&&"resolutions"in a.options&&0!=a.options.resolutions.length){for(var i=a.options.resolutions,r=i[0],s=i.length,p=0,m=156543.03390625;m>r;)p+=1,m=156543.03390625/Math.pow(2,p);n.zoomOffset=p,n.maxResolution=r,n.numZoomLevels=s,n.minZoomLevel=p,n.resolutions=i}return(x=l.createLayer(o,n)).yx={},x.reverseAxisOrder=function(){var e=this.projection.getCode();return parseFloat("1.3.0")>=1.3&&!!(this.yx[e]||OpenLayers.Projection.defaults[e]&&OpenLayers.Projection.defaults[e].yx)},!1}));var E=null;if("externalAccess"in y&&y.externalAccess&&"layers"in y.externalAccess&&"url"in y.externalAccess&&((E=y.externalAccess).layers=decodeURI(E.layers),c=E.url,S={layers:E.layers,styles:E.styles?E.styles:"",crs:E.crs?E.crs:"EPSG:3857",format:E.format?E.format:"image/png",transparent:E.transparent?E.transparent:"true",exceptions:"application/vnd.ogc.se_inimage"}),"undefined"!=typeof lizLayerFilter&&d in lizLayerFilter&&lizLayerFilter[d]&&(S.FILTER=d+":"+lizLayerFilter[d]),"True"==y.baseLayer&&null!=x)s.push(x);else if("layer"==y.type&&null!=x){if(x.options.minScale=y.maxScale,x.options.maxScale=null!=y.minScale&&y.minScale<1?1:y.minScale,0!=f.nestedLayers.length){var C=k(f,null,null);x.options.minScale=C.maxScale,x.options.maxScale=C.minScale}x.isVisible="True"==y.toggled,x.visibility=!1,x.transitionEffect=null,x.removeBackBufferDelay=250,x.order=M(f),p.push(x)}else if("True"==y.baseLayer)s.push(new OpenLayers.Layer.WMS(g,c,S,{isBaseLayer:!0,gutter:"True"==y.cached?0:5,buffer:0,singleTile:"True"==y.singleTile,ratio:1,attribution:f.attribution}));else if("layer"==y.type){var w=new OpenLayers.Layer.WMS(g,c,S,{isBaseLayer:!1,minScale:y.maxScale,maxScale:null!=y.minScale&&y.minScale<1?1:y.minScale,isVisible:"True"==y.toggled,visibility:!1,gutter:"True"==y.cached?0:5,buffer:0,transitionEffect:"True"==y.singleTile?"resize":null,removeBackBufferDelay:250,singleTile:"True"==y.singleTile||"True"==y.cached&&!o,ratio:1,order:M(f),attribution:f.attribution});0!=f.nestedLayers.length&&(C=k(f,null,null),w.minScale=C.maxScale,w.options.minScale=C.maxScale,w.maxScale=C.minScale,w.options.maxScale=C.minScale),E&&"format"in S&&"params"in w&&w.params.FORMAT!=S.format&&(w.params.FORMAT=S.format),p.push(w)}"group"==y.type&&0!=f.nestedLayers.length&&"False"==y.baseLayer&&P(f,L),"True"!=y.baseLayer&&t.children.push(L),y.bbox=f.bbox}}else a.options.hasOverview=!0}}}function N(e){var t=e.config;if("layer"==t.type&&"True"!=t.baseLayer)return!0;if("layer"==t.type)return!1;if(!("children"in e))return!1;for(var a=e.children,n=!1,i=[],o=0,r=a.length;o<r;o++){var l=N(a[o]);l||i.push(o),n=n||l}for(i.reverse(),o=0,r=i.length;o<r;o++)a.splice(i[o],1);return n}function R(e,t){var n,i="",o=e.config,r=null;if(t&&(r=t.config),!("geometryType"in o)||"none"!=o.geometryType&&"unknown"!=o.geometryType&&""!=o.geometryType||(o.displayInLegend="False"),i+='<tr id="'+o.type+"-"+e.name+'"',i+=' class="liz-'+o.type,t&&(i+=" child-of-group-"+t.name),"children"in e&&0!=e.children.length&&(i+=" expanded parent"),S().lizmap_web_client_target_version>=30600)var l=o.legend_image_option;else l="hide_at_startup",o.noLegendImage&&"True"==o.noLegendImage&&(l="disabled");"layer"==o.type&&"expand_at_startup"==l&&(i+=" expanded "),("displayInLegend"in o&&"False"==o.displayInLegend||r&&"displayInLegend"in r&&"False"==r.displayInLegend)&&(i+=" liz-hidden"),r&&"mutuallyExclusive"in r&&"True"==r.mutuallyExclusive&&(i+=" mutually-exclusive"),i+='">',i+='<td><button class="btn checkbox" name="'+o.type+'" value="'+e.name+'" title="'+lizDict["tree.button.checkbox"]+'"></button>',i+='<span class="label" title="'+(50,((n=$("<div>"+o.abstract+"</div>").text()).length>50?n.substr(0,49)+"&hellip;":n)+'">')+o.title+"</span>",i+="</td>",i+='<td class="loading">',"layer"==o.type&&(i+='<span class="loading">&nbsp;</span>'),i+="</td>";var s="";if(o.link&&(s=o.link),i+=""!=s?'<td><button class="btn link" name="link" title="'+lizDict["tree.button.link"]+'" value="'+s+'"/></td>':"<td></td>",o.cached&&"True"==o.cached&&"layer"==o.type&&"removeCache"in a.options?i+='<td><button class="btn removeCache" name="removeCache" title="'+lizDict["tree.button.removeCache"]+'" value="'+e.name+'"/></td>':i+="<td></td>",i+="</tr>","layer"==o.type&&"disabled"!=l&&"displayInLegend"in o&&"True"==o.displayInLegend){var p=w(e.name,!1);null!=p&&""!=p&&(i+='<tr id="legend-'+e.name+'" class="child-of-layer-'+e.name+' legendGraphics">',i+='<td colspan="2"><div class="legendGraphics">',i+='<img data-src="'+p+'" src="'+lizUrls.basepath+'assets/css/images/download_layer.gif"/>',i+="</div></td>",i+="</tr>")}return i}function F(e,t){var a="";0==t&&(a+='<div class="without-blocks no-group">',a+='<table class="tree">');for(var n=e.children,i=0,o=n.length;i<o;i++){var r=n[i];a+=0==t?R(r):R(r,e),"children"in r&&0!=r.children.length&&(a+=F(r,t+1))}return 0==t&&(a+="</table>",a+="</div>"),a}function j(e){var t=a.locateByLayer[e],n={};for(var i in t.features)n[i]=t.features[i];if("filterFieldName"in t){var o=$("#locate-layer-"+T(e)+"-"+t.filterFieldName).val();if("-1"!=o)for(var i in n)(y=n[i]).properties[t.filterFieldName]!=o&&delete n[i];else n={}}if("vectorjoins"in t&&0!=t.vectorjoins.length)for(var r=t.vectorjoins,l=0,s=r.length;l<s;l++){var p=r[l],m=p.joinLayer;if(m in a.locateByLayer){var u=a.locateByLayer[m],c=$("#locate-layer-"+T(m)).val();if("-1"==c)continue;var f=u.features[c];for(var i in n)(y=n[i]).properties[p.targetFieldName]!=f.properties[p.joinFieldName]&&delete n[i]}}var d='<option value="-1" label="'+a.layers[e].title+'"></option>';for(var i in n){var y;d+='<option value="'+(y=n[i]).id+'">'+y.properties[t.fieldName]+"</option>"}$("#locate-layer-"+T(e)).html(d)}function I(e){var t=l.getLayersByName(e);0!=t.length&&t[0].destroyFeatures()}function A(e){I("locatelayer");var t=a.locateByLayer[e],n=T(e),i=new OpenLayers.Projection(t.crs),o=$("#locate-layer-"+n).val();if("-1"==o)lizMap.events.triggerEvent("lizmaplocatefeaturecanceled",{featureType:e});else{var r=t.features[o],s=new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0});if(null!=(r=s.read(r)[0]).geometry){if(r.geometry.transform(i,l.getProjection()),"True"==t.displayGeom){var p=l.getLayersByName("locatelayer")[0];if(void 0===p)return;var m=se(e,null,null,null);m.options.PROPERTYNAME=["geometry",t.fieldName].join(","),m.options.FEATUREID=o,$.post(m.url,m.options,(function(e){e.features||(e=JSON.parse(e)),0!=e.features.length&&(r=s.read(e.features[0])[0]).geometry.transform(i,l.getProjection()),p.addFeatures([r])})).fail((function(){p.addFeatures([r])}))}l.zoomToExtent(r.geometry.getBounds())}var u=o.split(".")[1];lizMap.events.triggerEvent("lizmaplocatefeaturechanged",{featureType:e,featureId:u})}}function U(e){var t=a.locateByLayer[e],n=["geometry",t.fieldName];if("filterFieldName"in t&&n.push(t.filterFieldName),"filterjoins"in t)for(var i=t.filterjoins,o=0,r=i.length;o<r;o++){var l=i[o];n.push(l.targetFieldName)}if("vectorjoins"in t){var s=t.vectorjoins;for(o=0,r=s.length;o<r;o++){var p=s[o];n.push(p.targetFieldName)}}var m=se(e,null,null,"extent");m.options.PROPERTYNAME=n.join(",");var u=T(e);$.post(m.url,m.options,(function(n){var i=a.layers[e];t.features={},n.features||(n=JSON.parse(n));var o=n.features;if("EPSG:4326"!=t.crs&&0!=o.length&&ne(t.crs,(function(){"qgisServerVersion"in a.options&&"2.14"!=a.options.qgisServerVersion&&(t.crs="EPSG:4326")})),"filterFieldName"in t){o.sort((function(e,a){var n=e.properties[t.filterFieldName],i=a.properties[t.filterFieldName];return isNaN(n)?isNaN(i)?n.localeCompare(i):1:isNaN(i)?-1:parseFloat(n)-parseFloat(i)}));var r="";"filterFieldAlias"in t&&""!=t.filterFieldAlias?r+=t.filterFieldAlias+" ":r+=t.filterFieldName,r+=" ("+i.title+")";for(var l='<option value="-1"></option>',s="-1",p=0,m=o.length;p<m;p++)s!=(d=o[p]).properties[t.filterFieldName]&&(l+='<option value="'+(s=d.properties[t.filterFieldName])+'">'+s+"</option>");$("#locate-layer-"+u).parent().before('<div class="locate-layer"><select id="locate-layer-'+u+"-"+t.filterFieldName+'">'+l+"</select></div><br/>"),$("#locate-layer-"+u+"-"+t.filterFieldName).change((function(){var a=$(this).children(":selected").val();j(e),"-1"==a&&$("#locate-layer-"+u+"-"+t.filterFieldName+" ~ span > input").val(""),$("#locate-layer-"+u+" ~ span > input").val(""),$("#locate-layer-"+u).val("-1"),A(e)})),$("#locate-layer-"+u+"-"+t.filterFieldName).combobox({position:{my:"right top",at:"right bottom"},selected:function(e,t){if(t.item){var a=$(this),n=$(t.item);window.setTimeout((function(){a.val(n.val()).change()}),1)}}}),$("#locate-layer-"+u+"-"+t.filterFieldName+" ~ span > input").attr("placeholder",r).val(""),$("#locate-layer-"+u+"-"+t.filterFieldName+" ~ span > input").autocomplete("close"),C()}o.sort((function(e,a){var n=e.properties[t.fieldName],i=a.properties[t.fieldName];return isNaN(n)?isNaN(i)?n.localeCompare(i):1:isNaN(i)?-1:parseFloat(n)-parseFloat(i)}));var c="";"filterFieldName"in t?("fieldAlias"in t&&""!=t.fieldAlias?c+=t.fieldAlias+" ":c+=t.fieldName+" ",c+="("+i.title+")"):c=i.title;var f='<option value="-1"></option>';for(p=0,m=o.length;p<m;p++){var d=o[p];t.features[d.id.toString()]=d,"filterFieldName"in t||(f+='<option value="'+d.id+'">'+d.properties[t.fieldName]+"</option>")}$("#locate-layer-"+u).html(f).change((function(){if("-1"==$(this).children(":selected").val()){if($("#locate-layer-"+u+" ~ span > input").val(""),"filterjoins"in t&&0!=t.filterjoins.length)for(var n=0,i=(r=t.filterjoins).length;n<i;n++)if((l=r[n].joinLayer)in a.locateByLayer){var o=$("#locate-layer-"+T(l)).val();return j(l),void $("#locate-layer-"+T(l)).val(o)}if("vectorjoins"in t&&1==t.vectorjoins.length&&(l=t.vectorjoins[0].joinLayer)in a.locateByLayer)return void A(l);A(e)}else if(A(e),"filterjoins"in t&&0!=t.filterjoins.length){var r;for(n=0,i=(r=t.filterjoins).length;n<i;n++){var l;(l=r[n].joinLayer)in a.locateByLayer&&(j(l),$("#locate-layer-"+T(l)).val("-1"),$("#locate-layer-"+T(l)+" ~ span > input").val(""))}}$(this).blur()})),$("#locate-layer-"+u).combobox({minLength:"minLength"in t?t.minLength:0,position:{my:"right top",at:"right bottom"},selected:function(e,t){if(t.item){var a=$(this),n=$(t.item);window.setTimeout((function(){a.val(n.val()).change()}),1)}}}),$("#locate-layer-"+u+" ~ span > input").attr("placeholder",c).val(""),$("#locate-layer-"+u+" option[value=-1]").attr("label",c),$("#locate-layer-"+u+" ~ span > input").autocomplete("close"),"minLength"in t&&t.minLength>0&&$("#locate-layer-"+u).parent().addClass("no-toggle"),ie()&&($("div.locate-layer select").show(),$("span.custom-combobox").hide())}),"json")}function _(){$("#switcher-layers").html(F(c,0)),$("#switcher table.tree").treeTable({stringExpand:lizDict["tree.button.expand"],stringCollapse:lizDict["tree.button.collapse"],onNodeShow:function(){var e=$(this);if(e.addClass("visible"),0!=e.find("div.legendGraphics").length){var t=w(e.attr("id").replace("legend-",""),!0);if(null!=t&&""!=t){var a=e.find("div.legendGraphics img");a.attr("data-src",t),a.attr("src",a.attr("data-src"))}}},onNodeHide:function(){$(this).removeClass("visible")}}),$("#switcher table.tree tbody").on("mousedown","tr td span",(function(e){if(1===e.which){var t=!$(this).parents("tr:first").hasClass("selected");$("#switcher table.tree tbody tr").removeClass("selected"),$(this).parents("tr:first").toggleClass("selected",t),$("#switcher-layers-actions").toggleClass("active",t);var a=$(this).parents("tr:first").attr("id"),n=a.split("-")[0],i=a.split("-")[1];lizMap.events.triggerEvent("lizmapswitcheritemselected",{name:i,type:n,selected:t})}}));var e={childPrefix:"child-of-"};function t(t){return $(t).siblings("tr."+e.childPrefix+t[0].id)}function n(e){var a=[],i=[];e&&e[0]&&(i=t(e));for(var o=0,r=i.length;o<r;o++)a.push(i[o]),a=a.concat(n([i[o]]));return a}function i(t){if(0==t.length)return null;for(var a=t[0].className.split(" "),n=0;n<a.length;n++)if(a[n].match(e.childPrefix))return $(t).siblings("#"+a[n].substring(e.childPrefix.length));return null}function o(e){for(var t=[];e=i(e);)t[t.length]=e[0];return t}$("#switcher button.checkbox").click((function(){var e=$(this);if(e.hasClass("disabled"))return!1;var a=e.parents("tr").first(),r=i(a),s=[];if(r&&0!=r.length)for(var p=0,m=t(r);p<m.length;p++)(d=$(m[p])).attr("id")!=a.attr("id")&&s.push(d);var u=[];if(a.hasClass("liz-layer"))if(e.hasClass("checked")?(e.removeClass("partial").removeClass("checked"),a.find('button.checkbox[name="layer"]').each((function(e,t){var a=$(t).val(),n=l.getLayersByName(a)[0];void 0!==n&&n.setVisibility(!1)}))):(e.removeClass("partial").addClass("checked"),a.find('button.checkbox[name="layer"]').each((function(e,t){var a=$(t).val(),n=l.getLayersByName(a)[0];void 0!==n&&n.setVisibility(!0)}))),a.hasClass("mutually-exclusive")){if(e.hasClass("checked")){for(var c=0,f=s.length;c<f;c++){var d,y=(d=$(s[c])).find("button.checkbox");if(y.hasClass("checked")&&(y.removeClass("partial").removeClass("checked"),"layer"==y.attr("name"))){var g=$(y).val(),v=l.getLayersByName(g)[0];void 0!==v&&v.setVisibility(!1)}}r&&0!=r.length&&r.find("button.checkbox").removeClass("partial").addClass("checked")}else r&&0!=r.length&&r.find("button.checkbox").removeClass("partial").removeClass("checked");u=o(r)}else u=o(a);else{var h=n(a),b=[];$.each(h,(function(t,a){var n=(a=$(a)).find("button.checkbox");if(e.hasClass("checked"))n.removeClass("partial").removeClass("checked"),a.hasClass("liz-layer")&&"layer"==n.attr("name")&&(s=$(n).val(),void 0!==(r=l.getLayersByName(s)[0])&&r.setVisibility(!1));else if(n.removeClass("partial").addClass("checked"),a.hasClass("liz-layer")&&"layer"==n.attr("name")){if(a.hasClass("mutually-exclusive")){var o=i(a).attr("id");if(-1!=b.indexOf(o))return void n.removeClass("partial").removeClass("checked");b.push(o)}var r,s=$(n).val();void 0!==(r=l.getLayersByName(s)[0])&&r.setVisibility(!0)}})),e.hasClass("checked")?e.removeClass("partial").removeClass("checked"):e.removeClass("partial").addClass("checked"),u=o(a)}$.each(u,(function(e,a){a=$(a);var n=0,i=0,o=0,r=t(a);$.each(r,(function(e,t){$(t).find("button.checkbox").each((function(e,t){(t=$(t)).hasClass("checked")?i++:t.hasClass("partial")&&t.hasClass("checked")&&o++,n++}))}));var l=a.find("button.checkbox");n==i?l.removeClass("partial").addClass("checked"):0==i&&0==o?l.removeClass("partial").removeClass("checked"):l.addClass("partial").addClass("checked")}))})),$("#switcher button.link").click((function(){var e=$(this);if(e.hasClass("disabled"))return!1;var t=e.val();/^(\/)?media\//.test(t)&&(t=OpenLayers.Util.urlAppend(lizUrls.media,OpenLayers.Util.getParameterString(lizUrls.params))+"&path=/"+t),window.open(t)})),$("#switcher button.removeCache").click((function(){var e=$(this);if(e.hasClass("disabled"))return!1;var t=OpenLayers.Util.urlAppend(lizUrls.removeCache,OpenLayers.Util.getParameterString(lizUrls.params))+"&layer="+e.val();confirm(lizDict["tree.button.removeCache"]+" ?")&&window.open(t)}));var r=l.projection,m=3e3,u=3e3;"wmsMaxWidth"in a.options&&a.options.wmsMaxWidth&&(m=Number(a.options.wmsMaxWidth)),"wmsMaxHeight"in a.options&&a.options.wmsMaxHeight&&(u=Number(a.options.wmsMaxHeight));var f=!1,d=l.size,v=new OpenLayers.Size(m,u);if(d.w>m||d.h>u){f=!0;var b=Math.max(m,u),L=Math.min(m,u),z=Math.max(d.w,d.h),O=Math.min(d.w,d.h);v=z/2>O?new OpenLayers.Size(Math.round(z/2),Math.round(z/2)):b/2>O?new OpenLayers.Size(Math.round(b/2),Math.round(b/2)):new OpenLayers.Size(Math.round(L/2),Math.round(L/2))}var S=[];s.reverse();for(var E=0,C=s.length;E<C;E++){var k=s[E];k.units=r.proj.units,f&&k instanceof OpenLayers.Layer.WMS&&k.singleTile&&k.addOptions({singleTile:!1,tileSize:v});try{l.addLayer(k);var M=k.name;k.name in g&&(M=x(k.name));var P=a.layers[M];S+=P?'<option value="'+k.name+'">'+P.title+"</option>":'<option value="'+k.name+'">'+k.name+"</option>"}catch(e){M=k.name,k.name in g&&(M=x(k.name)),console.log(M+" can't be added to the map!")}}if(0!=s.length){if($("#switcher-baselayer-select").append(S),$("#switcher-baselayer-select").change((function(){var e=$(this).val(),t=l.getLayersByName(e)[0];l.setBaseLayer(t),lizMap.events.triggerEvent("lizmapbaselayerchanged",{layer:t}),$(this).blur()})),1==s.length)$("#switcher-baselayer").hide();else if("startupBaselayer"in a.options){var N=a.options.startupBaselayer;N in y?N=y[N]:N in a.layers&&(N=T(N)),0!=$('#switcher-baselayer-select option[value="'+N+'"]').length&&$("#switcher-baselayer-select").val(N).change()}}else $("#switcher-baselayer").hide(),l.addLayer(new OpenLayers.Layer.Vector("baselayer",{maxExtent:l.maxExtent,maxScale:l.maxScale,minScale:l.minScale,numZoomLevels:l.numZoomLevels,scales:l.scales,projection:l.projection,units:l.projection.proj.units}));for(p.sort((function(e,t){return e.order==t.order?0:e.order>t.order?1:-1})),p.reverse(),E=0,C=p.length;E<C;E++){(B=p[E]).units=r.proj.units,B.events.on({loadstart:function(e){$("#layer-"+e.object.name+" span.loading").addClass("loadstart")},loadend:function(e){$("#layer-"+e.object.name+" span.loading").removeClass("loadstart")}}),M=null,B.name in g&&(M=x(B.name));var R=null;M&&(R=a.layers[M]),R||(R=a.layers[B.params.LAYERS]),R||(R=a.layers[B.name]),R&&(!("geometryType"in R)||"none"!=R.geometryType&&"unknown"!=R.geometryType&&""!=R.geometryType)&&(f&&B instanceof OpenLayers.Layer.WMS&&B.singleTile&&B.addOptions({singleTile:!1,tileSize:v}),l.addLayer(B))}if("locateByLayer"in a){var j=[];for(var A in a.locateByLayer)"order"in a.locateByLayer[A]?j[a.locateByLayer[A].order]=A:j.push(A);var _=[];for(var B in j){A=j[B];var Z=a.layers[A],D='<div class="locate-layer">';D+='<select id="locate-layer-'+T(A)+'" class="label">',D+="<option>"+Z.title+"...</option>",D+="</select>",D+="</div>",_.push(D)}$("#locate .menu-content").html(_.join("<hr/>")),l.addLayer(new OpenLayers.Layer.Vector("locatelayer",{styleMap:new OpenLayers.StyleMap({pointRadius:6,fill:!1,stroke:!0,strokeWidth:3,strokeColor:"yellow",strokeOpacity:.8})}));var G=fe();if(0==G.length)a.locateByLayer={},$("#button-locate").parent().remove(),$("#locate-menu").remove();else{for(const e of G){var q=e.getElementsByTagName("Name")[0].textContent;if(!(A=lizMap.getNameByTypeName(q)))if(q in a.locateByLayer)A=q;else if(q in h&&h[q]in a.locateByLayer)A=h[q];else for(var V in a.locateByLayer)if(V.split(" ").join("_")==q){A=V;break}if(A in a.locateByLayer){(Y=a.locateByLayer[A]).crs=e.getElementsByTagName("SRS")[0].textContent,ne(Y.crs,(function(){new OpenLayers.Projection(Y.crs)}));var W=e.getElementsByTagName("LatLongBoundingBox")[0];Y.bbox=[parseFloat(W.getAttribute("minx")),parseFloat(W.getAttribute("miny")),parseFloat(W.getAttribute("maxx")),parseFloat(W.getAttribute("maxy"))]}}for(var H in a.locateByLayer){var Y;if("vectorjoins"in(Y=a.locateByLayer[H])&&0!=Y.vectorjoins.length){var K=Y.vectorjoins[0];for(var X in Y.joinFieldName=K.targetFieldName,a.locateByLayer){var Q=a.locateByLayer[X];Q.layerId==K.joinLayerId&&(K.joinLayer=X,Y.joinLayer=X,Q.joinFieldName=K.joinFieldName,Q.joinLayer=H,Q.filterjoins=[{targetFieldName:K.joinFieldName,joinFieldName:K.targetFieldName,joinLayerId:Y.layerId,joinLayer:H}])}}}for(var A in a.locateByLayer)U(A);$(".btn-locate-clear").click((function(){return I("locatelayer"),$("#locate select").val("-1"),$("div.locate-layer span > input").val(""),lizMap.lizmapLayerFilterActive&&lizMap.events.triggerEvent("lizmaplocatefeaturecanceled",{featureType:lizMap.lizmapLayerFilterActive}),!1})),$("#locate-close").click((function(){return $(".btn-locate-clear").click(),$("#button-locate").click(),!1}))}}$("#switcher span.label").tooltip({viewport:"#dock"})}function B(e){for(var t in m){var a=m[t];if(a){if(e&&"object"in e&&a==e.object)continue;a.type==OpenLayers.Control.TYPE_TOOL&&a.deactivate()}}return!0}function Z(e,t){var n=l.getLonLatFromPixel(t);0!=l.popups.length&&l.removePopup(l.popups[0]);var i=null,o=null;if("popupLocation"in a.options&&"map"!=a.options.popupLocation){o="popupcontent";var r=new RegExp("lizmapPopupTable","g"),s='<div class="lizmapPopupContent">'+(e=e.replace(r,"table table-condensed table-striped table-bordered lizmapPopupTable"))+"</div>",p=!(!e||null==e||""==e);$("#popupcontent div.menu-content").html(s),$("#mapmenu .nav-list > li.popupcontent").is(":visible")||$("#mapmenu .nav-list > li.popupcontent").show(),p||(s='<div class="lizmapPopupContent"><h4>'+lizDict["popup.msg.no.result"]+"</h4></div>",$("#popupcontent div.menu-content").html(s),window.setTimeout((function(){$("#mapmenu .nav-list > li.popupcontent").hasClass("active")&&"right-dock"!=a.options.popupLocation&&$("#button-popupcontent").click()}),2e3)),$("#mapmenu .nav-list > li.popupcontent").hasClass("active")||!(!ie()||ie()&&p)||null!=O&&n.lon==O.lon&&n.lat==O.lat?$("#mapmenu .nav-list > li.popupcontent").hasClass("active")&&ie()&&p&&$("#button-popupcontent").click():$("#button-popupcontent").click(),$("#mapmenu .nav-list > li.popupcontent").hasClass("active")&&"minidock"==a.options.popupLocation&&C()}else{if(!e||null==e||""==e)return!1;o="liz_layer_popup",(i=new OpenLayers.Popup.LizmapAnchored(o,n,null,e,null,!0,(function(){return l.removePopup(this),ie()&&($("#navbar").show(),$("#overview-box").show()),I("locatelayer"),!1}))).panMapIfOutOfView=!0,l.addPopup(i),$("#"+o+' a[data-toggle="tab"]').on("click",(function(e){e.preventDefault(),$(this).tab("show")})),i.verifySize(),ie()&&($("#navbar").hide(),$("#overview-box").hide())}O=n,Q(0,o),K(0,o),X(0,o),lizMap.events.triggerEvent("lizmappopupdisplayed",{popup:i,containerId:o})}function D(){var e=OpenLayers.Control.Permalink.prototype.createParams.apply(this,arguments);delete e.zoom,delete e.lat,delete e.lon,e.bbox=l.getExtent().toBBOX(),e.crs=l.projection.projCode;var t=[],n=[],i=[];for(var o in a.layers){var r=a.layers[o];"request_params"in r&&null!=r.request_params&&"filter"in r.request_params&&null!=r.request_params.filter&&""!=r.request_params.filter&&t.push(r.request_params.filter)}t.length>0&&(e.filter=t.join(";"));for(var s=0,m=p.length;s<m;s++){var u=p[s];!u.isVisible||"default"==u.params.STYLES&&""==u.params.STYLES||n.push(u.name+":"+u.params.STYLES),u.opacity&&1!=u.opacity&&i.push(u.name+":"+u.opacity)}return n.length>0&&(e.layerStyles=n.join(";")),i.length>0&&(e.layerOpacities=i.join(";")),L=e,e}function G(){const e={};if(window.location.search.length>1)for(const t of window.location.search.slice(1).split("&")){const[a,n]=t.split("=");e[decodeURIComponent(a)]=decodeURIComponent(n)}return e}function q(){if($("#permaLink").hasClass("active")){var e=$("#permalink").attr("href");$("#input-share-permalink").val(e);var t=$("#select-embed-permalink").val();e=$("#permalink-embed").attr("href");var a="";"s"==t?a='<iframe width="400" height="300" frameborder="0" style="border:0" src="'+e+'" allowfullscreen></iframe>':"m"==t?a='<iframe width="600" height="450" frameborder="0" style="border:0" src="'+e+'" allowfullscreen></iframe>':"l"==t?a='<iframe width="800" height="600" frameborder="0" style="border:0" src="'+e+'" allowfullscreen></iframe>':"p"==t&&(a='<iframe width="'+$("#input-embed-width-permalink").val()+'" height="'+$("#input-embed-height-permalink").val()+'" frameborder="0" style="border:0" src="'+e+'" allowfullscreen></iframe>'),$("#input-embed-permalink").val(a)}}function V(e){if(q(),"visibility"==e.property){var t=x(e.layer.name),n=a.layers[t];lizMap.events.triggerEvent("lizmaplayerchangevisibility",{name:t,config:n,visibility:e.layer.visibility})}}function W(){$(".btn-geobookmark-del").click((function(){var e,t,a;confirm(lizDict["geobookmark.confirm.delete"])&&(e=$(this).val(),t=lizUrls.geobookmark,a={id:e,q:"del",repository:lizUrls.params.repository,project:lizUrls.params.project},$.get(t,a,(function(e){H(e)}),"text"));return!1})),$(".btn-geobookmark-run").click((function(){return e=$(this).val(),t=lizUrls.geobookmark,a={id:e,q:"get"},$.get(t,a,(function(e){Y(e)}),"json"),!1;var e,t,a}))}function H(e){$("div#geobookmark-container").html(e),$("div#geobookmark-container button").unbind("click"),W(),$('#geobookmark-form input[name="bname"]').val("").blur()}function Y(e){var t=e.layers,a={};if("layerStyles"in e&&""!=e.layerStyles){var n=e.layerStyles.split(";");for(var i in n)2==(s=n[i].split(":")).length&&(a[s[0]]=s[1])}var o={};if("layerOpacities"in e&&""!=e.layerOpacities){var r=e.layerOpacities.split(";");for(var i in r){var s;2==(s=r[i].split(":")).length&&(o[s[0]]=parseFloat(s[1]))}}for(i=0;i<l.layers.length;i++){var p=l.layers[i];if(p.isBaseLayer)"B"==t[i]&&$("#switcher-baselayer-select").val(p.name).change();else{var m=$('#switcher button.checkbox[name="layer"][value="'+p.name+'"]');"T"==t[i]!=m.hasClass("checked")&&$('#switcher button.checkbox[name="layer"][value="'+p.name+'"]').click()}p.name in a&&(p.params.STYLES=a[p.name],p.redraw(!0),lizMap.events.triggerEvent("layerstylechanged",{featureType:p.name})),p.name in o&&p.setOpacity(o[p.name])}if("filter"in e&&""!=e.filter){var u=e.filter.split(":");if(2==u.length){var c=u[0],f=u[1].split();lizMap.events.triggerEvent("layerfeatureselected",{featureType:c,fid:f,updateDrawing:!1}),lizMap.events.triggerEvent("layerfeaturefilterselected",{featureType:c})}}else lizMap.lizmapLayerFilterActive&&lizMap.events.triggerEvent("layerfeatureremovefilter",{featureType:lizMap.lizmapLayerFilterActive});var d=OpenLayers.Bounds.fromString(e.bbox);l.zoomToExtent(d,!0)}function K(e,t){I("locatelayer");var a=l.getLayersByName("locatelayer")[0];if(void 0!==a){var n="div.lizmapPopupContent div.lizmapPopupDiv > input.lizmap-popup-layer-feature-geometry";t&&(n="#"+t+" "+n);var i=[];$(n).each((function(){var e=$(this),t=e.val();if(""!=t){var a=e.parent().find("input.lizmap-popup-layer-feature-crs").val();if(""!=a){var n=e.parent().find("input.lizmap-popup-layer-feature-id").val(),o=e.parent().find("input.lizmap-popup-layer-feature-bbox-minx").val(),r=e.parent().find("input.lizmap-popup-layer-feature-bbox-miny").val(),l=e.parent().find("input.lizmap-popup-layer-feature-bbox-maxx").val(),s=e.parent().find("input.lizmap-popup-layer-feature-bbox-maxy").val();i.push({fid:n,geom:t,crs:a,bbox:[o,r,l,s]})}}}));for(var o=[],r=0,s=i.length;r<s;r++)ne(i[r].crs,(function(e){if(o.push(e),o.length==i.length){var t=[];for(const e of i){var n=OpenLayers.Geometry.fromWKT(e.geom);n.transform(e.crs,l.getProjection()),t.push(new OpenLayers.Feature.Vector(n))}a.addFeatures(t)}}))}}function X(e,t){if(!("datavizLayers"in lizMap.config))return!1;var a="div.lizmapPopupContent div.lizmapPopupDiv";t&&(a="#"+t+" "+a),$(a).each((function(){var e=$(this);if($(this).find("div.lizdataviz").length>0)return!0;if($(this).find("input.lizmap-popup-layer-feature-id:first").val()){var t=$(this).find("input.lizmap-popup-layer-feature-id:first").val().split("."),a=t[0]+"_"+t[1],n=t[0],i=t[1],o=lizMap.getLayerConfigById(n);if(!o)return!0;var r=o[0];if(!("relations"in lizMap.config)||!(n in lizMap.config.relations))return!0;if(!("datavizLayers"in lizMap.config))return!0;lizMap.getLayerFeature(r,i,(function(i){var o=lizMap.config.datavizLayers.layers,r=lizMap.config.relations[n],l=1;for(var s in o)for(var p in r){var m=r[p],u=m.referencingLayer,c='"'+m.referencingField+"\" IN ('"+i.properties[m.referencedField]+"')";if(o[s].layer_id==u){var f=o[s];if("popup_display_child_plot"in f&&"True"==f.popup_display_child_plot){var d=o[s].plot_id;a=t[0]+"_"+t[1]+"_"+String(l),a+="_"+(new Date).valueOf()+btoa(Math.random()).substring(0,12);var y=lizDataviz.buildPlotContainerHtml(f.title,f.abstract,a,!1),g='<div class="lizmapPopupChildren lizdataviz">';g+="<h4>"+f.title+"</h4>",g+=y,g+="</div>";var v=$(e).find("div.lizmapPopupChildren:last");v.length>0?$(v).after(g):$(e).append(g),lizDataviz.getPlot(d,c,a),l++}}}}))}}))}function Q(e,t){var n="div.lizmapPopupContent input.lizmap-popup-layer-feature-id";t&&(n="#"+t+" "+n),$(n).each((function(){var e=$(this),t=e.val(),n=t.split(".").pop(),i=t.replace("."+n,""),o=ae(i);if(!o)return!0;var r=o[1],l=o[0];if(!("popupDisplayChildren"in r)||"True"!=r.popupDisplayChildren)return!0;if(!("relations"in a)||!(i in a.relations))return!0;var s=a.relations[i],p=10;"popupMaxFeatures"in r&&!isNaN(parseInt(r.popupMaxFeatures))&&(p=parseInt(r.popupMaxFeatures)),ce(l,n,(function(t){const a=[],n=[];for(const r of s){const l=ae(r.referencingLayer);if(l){const s=l[1];let m=s?.shortname||s.cleanname;if(void 0===m&&(m=T(s.name),s.cleanname=m),"True"==s.popup&&0==e.parent().find("div.lizmapPopupChildren."+m).length){let l=s?.shortname||s.name;const m={LAYERS:l,QUERY_LAYERS:l,STYLES:"",SERVICE:"WMS",VERSION:"1.3.0",CRS:"crs"in s&&""!=s.crs?s.crs:"EPSG:4326",REQUEST:"GetFeatureInfo",EXCEPTIONS:"application/vnd.ogc.se_inimage",FEATURE_COUNT:p,INFO_FORMAT:"text/html"};"popupMaxFeatures"in s&&!isNaN(parseInt(s.popupMaxFeatures))&&(m.FEATURE_COUNT=parseInt(s.popupMaxFeatures)),0==m.FEATURE_COUNT&&(m.FEATURE_COUNT=p),s.request_params&&s.request_params.filter&&""!==s.request_params.filter?m.FILTER=s.request_params.filter+' AND "'+r.referencingField+"\" = '"+t.properties[r.referencedField]+"'":m.FILTER=l+':"'+r.referencingField+"\" = '"+t.properties[r.referencedField]+"'";var i=e.parent(),o=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));n.push(s),a.push(fetch(o,{method:"POST",body:new URLSearchParams(m)}).then((function(e){return e.text()})))}}}Promise.allSettled(a).then((t=>{const a=[];for(let e=0;e<t.length;e++){let m=t[e].value;if(m&&null!=m&&""!=m){var o=new RegExp("lizmapPopupTable","g");m=m.replace(o,"table table-condensed table-striped lizmapPopupTable");const t=n[e];var r=t.cleanname;void 0===r&&(r=T(t.name),t.cleanname=r);const u='<button class="compact-tables btn btn-small" data-original-title="'+lizDict["popup.table.compact"]+'"><i class="icon-resize-small"></i></button><button class="explode-tables btn btn-small hide" data-original-title="'+lizDict["popup.table.explode"]+'"><i class="icon-resize-full"></i></button>';var l=$('<div class="lizmapPopupChildren '+r+'" data-layername="'+r+'" data-title="'+t.title+'">'+u+m+"</div>");if(-1!==["qgis","form"].indexOf(t.popupSource)&&0!=l.find(".lizmap_merged").length){l.find(".lizmapPopupDiv").each((function(e,t){var a=$(t);"TR"==a.find(".lizmapPopupHeader").prop("tagName")?(a.find(".lizmapPopupHeader").prepend("<th></th>"),a.find(".lizmapPopupHeader").next().prepend("<td></td>")):a.find(".lizmapPopupHeader").next().prepend("<span></span>"),a.find(".lizmapPopupHeader").next().children().first().append(a.find("input"))})),l.find("h4").each((function(e,t){0!=e&&$(t).remove()})),l.find(".lizmapPopupHeader").each((function(e,t){0!=e&&$(t).remove()})),l.find(".lizmapPopupDiv").contents().unwrap(),l.find(".lizmap_merged").contents().unwrap(),l.find(".lizmapPopupDiv").remove(),l.find(".lizmap_merged").remove(),l.find(".lizmapPopupHidden").hide();var s=$("<table class='lizmap_merged'></table>");l.append(s),l.find("tr").appendTo(s),l.children("tbody").remove()}var p=i.find("div.lizmapPopupChildren."+r);0!=p.length&&p.remove(),i.append(l),a.push(l),lizMap.events.triggerEvent("lizmappopupchildrendisplayed",{html:l.html()})}}$(".lizmapPopupChildren .popupAllFeaturesCompact table").DataTable(),$(".lizmapPopupChildren .compact-tables, .lizmapPopupChildren .explode-tables").tooltip(),$(".lizmapPopupChildren .compact-tables").off("click").on("click",(function(){$(this).addClass("hide").siblings(".explode-tables").removeClass("hide").siblings(".popupAllFeaturesCompact, .lizmapPopupSingleFeature").toggle()})),$(".lizmapPopupChildren .explode-tables").off("click").on("click",(function(){$(this).addClass("hide").siblings(".compact-tables").removeClass("hide").siblings(".popupAllFeaturesCompact, .lizmapPopupSingleFeature").toggle()})),lizMap.events.triggerEvent("lizmappopupallchildrendisplayed",{parentPopupElement:e.parents(".lizmapPopupSingleFeature"),childPopupElements:a})}))}))}))}function J(e){for(var t=[],a=0,n=e.length;a<n;a++)t.push(parseFloat(e[a]));t.sort((function(e,t){return t-e}));var i=l.getScale(),o=$.inArray(i,t);if(-1==o){for(var r=0,s=t.length;-1==o&&r<s;)i>t[r]?o=r:r++;i=r==s?t[s-1]:t[o]}return i}function ee(e,t,a){var n=e.size,i=l.getUnits(),o=OpenLayers.INCHES_PER_UNIT[i],r=n.width/72/o*a/2,s=n.height/72/o*a/2,p=!0;if("printInProjectProjection"in lizMap.config.options&&"True"!=lizMap.config.options.printInProjectProjection&&(p=!1),p&&lizMap.config.options.qgisProjectProjection.ref!=lizMap.config.options.projection.ref&&(r=96*r/72,s=96*s/72),0==t.features.length){var m=l.getCenter(),u=new OpenLayers.Bounds(m.lon-r,m.lat-s,m.lon+r,m.lat+s).toGeometry();t.addFeatures([new OpenLayers.Feature.Vector(u)])}else{var c=t.features[0];m=c.geometry.getBounds().getCenterLonLat(),(u=new OpenLayers.Bounds(m.lon-r,m.lat-s,m.lon+r,m.lat+s).toGeometry()).id=c.geometry.id,c.geometry=u,t.drawFeature(c)}return!0}function te(e,t,a){var n=e.size,i=l.getUnits(),o=OpenLayers.INCHES_PER_UNIT[i],r=n.width/72/o*t,s=n.height/72/o*t,p=!0;"printInProjectProjection"in lizMap.config.options&&"True"!=lizMap.config.options.printInProjectProjection&&(p=!1),p&&lizMap.config.options.qgisProjectProjection.ref!=lizMap.config.options.projection.ref&&(r=96*r/72,s=96*s/72);for(var m=r>s?r:s,u=[],c=0,f=a.length;c<f;c++)u.push(parseFloat(a[c]));u.sort((function(e,t){return t-e}));var d=u[0];for(c=0,f=u.length;c<f;c++){var y=u[c];if(y>m&&(d=y),y<m)break}return d/10}function ae(e,t,n){for(var i in n=void 0!==n?n:"id",t=void 0!==t?t:a.layers)if(t[i][n]==e)return[i,t[i]];return null}function ne(e,t){var a=e.replace(/^\s+|\s+$/g,"");a in Proj4js.defs?t(a):$.get(OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params)),{REQUEST:"GetProj4",authid:a},(function(e){Proj4js.defs[a]=e,new OpenLayers.Projection(a),t(a)}))}function ie(){var e=$("body").parent()[0].offsetWidth;return e-450<450||e<450}function oe(e,t,a){var n="info",i=!1;-1!=$.inArray(t,["info","error","success"])&&(n=t),a&&(i=!0);var o='<div class="alert alert-block alert-'+n+' fade in" data-alert="alert">';i&&(o+='<a class="close" data-dismiss="alert" href="#">×</a>'),o+="<p>"+e+"</p>",o+="</div>";var r=$(o);return $("#message").append(r),r}function re(e,t,a){var n=new XMLHttpRequest;n.open("POST",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200===this.status){var e="",i=n.getResponseHeader("Content-Disposition");if(i&&-1!==i.indexOf("attachment")){var o=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(i);null!=o&&o[1]&&(e=o[1].replace(/['"]/g,""))}let t=n.getResponseHeader("Content-Type");navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"application/pdf"==t&&(t="application/octet-stream");const a=new File([this.response],e,{type:t}),r=URL.createObjectURL(a);if(e){const t=document.createElement("a");t.href=r,t.download=e,t.dispatchEvent(new MouseEvent("click"))}else window.open(r);setTimeout((()=>URL.revokeObjectURL(r)),100)}if(400==this.status){const e=/[\(\)]/g;if(t.TYPENAME.match(e)){var r="The selected features cannot be exported due to a known bug in QGIS Server.";r+="<br/>Please ask the map editor to remove the parenthesis in the layer name."}else r=lizDict["layer.export.unknown.export.error"];return oe(r,"error",!0),!1}"function"==typeof a&&a()},n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send($.param(t,!0))}function le(e){var t="";if(e in a.layers&&a.layers[e].selectedFeatures){var n=[],i=a.layers[e],o=e.split(" ").join("_");for(var r in"shortname"in i&&""!=i.shortname&&(o=i.shortname),i.selectedFeatures)n.push(o+"."+i.selectedFeatures[r]);n.length&&(t=n.join())}return t}function se(e,t,n,i,o,r,s){var p={};if(t=void 0!==t?t:null,n=void 0!==n?n:null,i=void 0!==i?i:null,o=void 0!==o&&o,r=void 0!==r?r:null,s=void 0!==s?s:null,!(e in a.layers)){var m=lizMap.getNameByCleanName(e);if(m&&m in a.layers||(m=lizMap.getNameByShortName(e)),m&&m in a.layers||(m=lizMap.getNameByTypeName(e)),!m||!(m in a.layers))return console.log('getVectorLayerWfsUrl: "'+e+'" and "'+m+'" not found in config'),!1;e=m}var u=a.layers[e],c=e.split(" ").join("_");"shortname"in u&&""!=u.shortname?c=u.shortname:"typename"in u&&""!=u.typename&&(c=u.typename);var f={SERVICE:"WFS",VERSION:"1.0.0",REQUEST:"GetFeature",TYPENAME:c,OUTPUTFORMAT:"GeoJSON"};r&&(f.STARTINDEX=r),s&&(f.MAXFEATURES=s);var d=[];if(t?""!=(t=t.replace(e+":",""))&&d.push(t):"request_params"in a.layers[e]&&"filter"in a.layers[e].request_params&&(t=a.layers[e].request_params.filter)&&(t=t.replace(e+":",""),d.push(t)),n?f.FEATUREID=n.replace(new RegExp(e,"g"),c):d.length&&(f.EXP_FILTER=d.join(" AND ")),o){var y=l.getExtent().clone(),g=new OpenLayers.Projection(a.layers[e].crs),v=(y=y.transform(l.getProjection(),g)).toBBOX();f.BBOX=v}return i&&-1!=$.inArray(i.toLowerCase(),["none","extent","centroid"])&&(f.GEOMETRYNAME=i),p.url=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params)),p.options=f,p}var pe={};function me(e,t){var a=pe[e];delete pe[e],a.callbacks.forEach((function(e){e&&e(a.layerName,a.filter,t,a.alias,a.types)}))}function ue(e,t,n,i,o,r,l,s){if(t=void 0!==t?t:null,n=void 0!==n?n:null,i=void 0!==i?i:null,o=void 0!==o&&o,r=void 0!==r?r:null,l=void 0!==l?l:null,!(e in a.layers)){var p=lizMap.getNameByCleanName(e);if(p&&p in a.layers||(p=lizMap.getNameByShortName(e)),p&&p in a.layers||(p=lizMap.getNameByTypeName(e)),!p||!(p in a.layers))return console.log('getFeatureData: "'+e+'" and "'+p+'" not found in config'),!1;e=p}var m=a.layers[e];$("body").css("cursor","wait");var u=lizMap.getVectorLayerWfsUrl(e,t,n,i,o,r,l),c=u.url+"|"+JSON.stringify(u.options);if(!(c in pe))return pe[c]={callbacks:[s],layerName:e,filter:t,alias:m.alias,types:m.types},$.post(u.url,u.options,(function(t){if(m.featureCrs="EPSG:4326",m?.alias&&m?.types)me(c,t.features),$("body").css("cursor","auto");else{var a=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));$.post(a,{SERVICE:"WFS",VERSION:"1.0.0",REQUEST:"DescribeFeatureType",TYPENAME:"typename"in m?m.typename:e,OUTPUTFORMAT:"JSON"},(function(e){m.alias=e.aliases,m.types=e.types,m.columns=e.columns,me(c,t.features),$("body").css("cursor","auto")}),"json")}}),"json"),!0;s&&pe[c].callbacks.push(s)}function ce(e,t,n,i,o){if(n&&e in a.layers){var r=a.layers[e],l=e+"."+t;!o&&r.features&&t in r.features?n(r.features[t]):ue(e,null,l,"extent",!1,null,null,(function(a,o,l,s){if(1==l.length){var p=l[0];r.features||(r.features={}),r.features[t]=p,n(p)}else i&&i(e,t)}))}}function fe(){return null==r?[]:r.getElementsByTagName("FeatureType")}function de(e,t,a,n,i){if($("#mapmenu .nav-list > li."+e+" > a").length)console.log(e+" menu item already exists");else{var o="";o+='<li class="'+e+" nav-"+a+'">',o+='   <a id="button-'+e+'" rel="tooltip" data-original-title="'+t+'" data-placement="right" href="#'+e+'" data-container="#content">',o+='       <span class="icon"><i class="'+i+' icon-white"></i></span><span class="menu-title">'+e+"</span>",o+="   </a>",o+="</li>",$("#mapmenu div ul li.nav-"+a+":last").after(o),0==$("#mapmenu div ul li.nav-"+a+"."+e).length&&$("#mapmenu div ul li:last").after(o),$("#mapmenu .nav-list > li."+e+" > a .icon").css("background-image","none"),$("#mapmenu .nav-list > li."+e+" > a .icon >i ").css("margin-left","4px"),$("#mapmenu .nav-list > li."+e+" > a").tooltip();var r="";r+='<div class="tab-pane" id="'+e+'">',"minidock"==a&&(r+='<div class="mini-dock-close" title="'+lizDict["toolbar.content.stop"]+'" style="padding:7px;float:right;cursor:pointer;"><i class="icon-remove icon-white"></i></div>',r+='    <div class="'+e+'">',r+="        <h3>",r+='            <span class="title">',r+='              <i class="'+i+' icon-white"></i>',r+='              <span class="text">&nbsp;'+t+"&nbsp;</span>",r+="            </span>",r+="        </h3>"),r+='        <div class="menu-content">',r+=n,r+="        </div>",r+="    </div>",r+="</div>","minidock"==a?($("#mini-dock-content").append(r),$("#"+e+" div.mini-dock-close").click((function(){$("#mapmenu .nav-list > li."+e).hasClass("active")&&$("#button-"+e).click()}))):"right-dock"==a?$("#right-dock-content").append(r):"dock"==a?$("#dock-content").append(r):"bottomdock"==a&&$("#bottom-dock-content").append(r);var l="";l+='<li id="nav-tab-'+e+'"><a href="#'+e+'" data-toggle="tab">'+t+"</a></li>","minidock"==a?$("#mini-dock-tabs").append(l):"right-dock"==a?$("#right-dock-tabs").append(l):"dock"==a?$("#dock-tabs").append(l):"bottomdock"==a&&$("#bottom-dock-tabs").append(l)}}var ye={map:null,layers:null,baselayers:null,events:null,config:null,dictionary:null,tree:null,lizmapLayerFilterActive:null,getLizmapDesktopPluginMetadata:function(){return S()},checkMobile:function(){return ie()},cleanName:function(e){return T(e)},getNameByCleanName:function(e){return function(e){var t=null;return e in g&&(t=g[e]),t}(e)},getNameByShortName:function(e){return function(e){var t=null;return e in h&&(t=h[e]),t}(e)},getNameByTypeName:function(e){return function(e){var t=null;return e in b&&(t=b[e]),t}(e)},getLayerNameByCleanName:function(e){return x(e)},addMessage:function(e,t,a){return oe(e,t,a)},updateMiniDockSize:function(){return C()},loadProjDefinition:function(e,t){return ne(e,t)},updateContentSize:function(){return E()},clearDrawLayer:function(e){return I(e)},getLayerFeature:function(e,t,a,n,i){ce(e,t,a,n,i)},getFeatureData:function(e,t,a,n,i,o,r,l){ue(e,t,a,n,i,o,r,l)},translateWfsFieldValues:function(e,t,a,n){return translateWfsFieldValues(e,t,a,n)},zoomToFeature:function(e,t,n){!function(e,t,n){n=void 0!==n?n:"zoom",ce(e,t,(function(t){var i=new OpenLayers.Projection(a.layers[e].crs);a.layers[e].featureCrs&&(i=new OpenLayers.Projection(a.layers[e].featureCrs)),function(e,t,a){a=void 0!==a?a:"zoom";var n=new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0}).read(e)[0];if(n&&"geometry"in n&&(n.geometry.transform(t,lizMap.map.getProjection()),"zoom"==a&&l.zoomToExtent(n.geometry.getBounds()),"center"==a)){var i=n.geometry.getBounds().getCenterLonLat();l.setCenter(i)}}(t,i,n)}))}(e,t,n)},getPrintGridInterval:function(e,t,a){return te(e,t,a)},getPrintCapabilities:function(){return u},getExternalBaselayersReplacement:function(){return d},launchTooltipLayer:function(e){var t=$('#tooltip-layer-list option[value="'+e+'"]');return 1==t.length&&$("#tooltip-layer-list").val()!=e?$("#tooltip-layer-list").val(e).change():1!=t.length&&""!=$("#tooltip-layer-list").val()&&$("#tooltip-layer-list").val("").change(),$("#tooltip-layer-list").val()==e},launchEdition:function(){return!1},deleteEditionFeature:function(){return!1},deactivateToolControls:function(e){return B(e)},displayGetFeatureInfo:function(e,t){return Z(e,t)},exportVectorLayer:function(e,t,a){return function(e,t,a){if(a=void 0!==a?a:null,!("exportLayers"in lizMap.config.options)||"True"!=lizMap.config.options.exportLayers)return oe(lizDict["layer.export.right.required"],"error",!0),!1;t=void 0!==t?t:"GeoJSON";var n=x(lizMap.cleanName(e));n||(n=e);var i=lizMap.config.layers[n];const o=!(!i.geometryType||"none"==i.geometryType||"unknown"==i),r="request_params"in i&&"selectiontoken"in i.request_params&&null!=i.request_params.selectiontoken&&""!=i.request_params.selectiontoken,l=n.match(/[\(\)]/g);if(o&&r&&!l){var s=se(e,null,null,null,a),p=i.request_params.selectiontoken;s.options.SELECTIONTOKEN=p}else s=se(e,null,le(n),null,a);return s.options.dl=1,s.options.OUTPUTFORMAT=t,re(s.url,s.options),!1}(e,t,a)},getVectorLayerWfsUrl:function(e,t,a,n,i){return se(e,t,a,n,i)},getVectorLayerFeatureTypes:function(){return fe()},getVectorLayerResultFormat:function(){return function(){let e=[];if(null==r)return e;for(const t of r.getElementsByTagName("ResultFormat")[0].children)e.push(t.tagName);return e}()},getLayerConfigById:function(e,t,a){return ae(e,t,a)},getFeaturePopupContent:function(e,t,a){return function(e,t,a){if(a){if(!t)return!1;0!=lizMap.map.popups.length&&lizMap.map.removePopup(lizMap.map.popups[0]);var n,i=e;lizMap.getLayerNameByCleanName(e)&&(i=lizMap.getLayerNameByCleanName(e));var o=null;if(i in lizMap.config.attributeLayers&&(o=lizMap.config.attributeLayers[i].primaryKey),!o&&"atlasLayer"in lizMap.config.options&&"atlasPrimaryKey"in lizMap.config.options&&lizMap.config.layers[i].id==lizMap.config.options.atlasLayer&&""!=lizMap.config.options.atlasPrimaryKey&&(o=lizMap.config.options.atlasPrimaryKey),!o&&"atlas"in lizMap.config&&"layers"in lizMap.config.atlas&&Array.isArray(lizMap.config.atlas.layers)&&lizMap.config.atlas.layers.length>0){const e=lizMap.config.layers[i];for(let t=0;t<lizMap.config.atlas.layers.length;t++){const a=lizMap.config.atlas.layers[t];if(e.id===a.layer){o=a.primaryKey;break}}}if(!o)return!1;n=i+':"'+o+"\" = '"+t.properties[o]+"'";var r="EPSG:4326";"crs"in lizMap.config.layers[i]&&""!=lizMap.config.layers[i].crs&&(r=lizMap.config.layers[i].crs);var l={LAYERS:e,QUERY_LAYERS:e,STYLES:"",SERVICE:"WMS",VERSION:"1.3.0",CRS:r,REQUEST:"GetFeatureInfo",EXCEPTIONS:"application/vnd.ogc.se_inimage",INFO_FORMAT:"text/html",FEATURE_COUNT:1,FILTER:n},s=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));$.post(s,l,(function(e){a(e)}))}}(e,t,a)},getFeaturePopupContentByFeatureIntersection:function(e,t,a){return function(e,t,a){var n=lizMap.map.getUnits(),i=lizMap.config.layers[e];if("auto"==lizMap.map.maxScale)var o=i.minScale;else o=Math.max(lizMap.map.maxScale,i.minScale);o*=2;var r=OpenLayers.Util.getResolutionFromScale(o,n),l=t.geometry.CLASS_NAME;if("OpenLayers.Geometry.Polygon"==l||"OpenLayers.Geometry.MultiPolygon"==l||"OpenLayers.Geometry.Point"==l)var s=t.geometry.getBounds().getCenterLonLat();else{var p=t.geometry.getVertices(),m=p[Math.floor(p.length/2)];s=new OpenLayers.LonLat(m.x,m.y)}var u=new OpenLayers.Bounds(s.lon-5*r,s.lat-5*r,s.lon+5*r,s.lat+5*r),c=lizMap.map.getProjectionObject().toString();"EPSG:900913"==c&&(c="EPSG:3857");var f={LAYERS:e,QUERY_LAYERS:e,STYLES:"",SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",EXCEPTIONS:"application/vnd.ogc.se_inimage",BBOX:u.toBBOX(),FEATURE_COUNT:10,HEIGHT:100,WIDTH:100,INFO_FORMAT:"text/html",CRS:c,I:50,J:50},d=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));$.post(d,f,(function(e){a&&a(d,f,e)}))}(e,t,a)},selectLayerFeaturesFromSelectionFeature:function(e,t,n="intersects"){return function(e,t,n="intersects"){var i=a.layers[e];lizMap.loadProjDefinition(i.crs,(function(o){var r=new OpenLayers.Format.GML.v3({internalProjection:lizMap.map.getProjection(),externalProjection:o,srsName:o}),l=r.writeNode("feature:_geometry",t.geometry),s=n+"($geometry, geom_from_gml('";if(s+=OpenLayers.Format.XML.prototype.write.apply(r,l.children),s+="'))","request_params"in i&&"filter"in i.request_params){var p=i.request_params.filter;p&&(s=(p=p.replace(e+":",""))+" AND "+s)}if("request_params"in i&&"exp_filter"in i.request_params){var m=i.request_params.exp_filter;m&&(s=m+" AND "+s)}var u=!1;"limitDataToBbox"in a.options&&"True"==a.options.limitDataToBbox&&(u=!0);var c=lizMap.getVectorLayerWfsUrl(e,s,null,null,u);if("disjoint"!==n){var f=t.geometry.clone().transform(lizMap.map.getProjection(),o).getBounds();0!=f.getWidth()&&0!=f.getHeight()||f.extend(new OpenLayers.Bounds(f.left-1e-6,f.bottom-1e-6,f.right+1e-6,f.top+1e-6)),c.options.BBOX=f.toBBOX(),c.options.SRSNAME=i.crs}$.post(c.url,c.options,(function(t){var n=new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0,externalProjection:i.crs,internalProjection:lizMap.map.getProjection()}).read(t),o=$.map(n,(function(e){return e.fid.split(".")[1]}));if("add"===lizMap.mainLizmap.selectionTool.newAddRemoveSelected){o=a.layers[e].selectedFeatures.concat(o);for(var r=0;r<o.length;++r)for(var l=r+1;l<o.length;++l)o[r]===o[l]&&o.splice(l--,1)}else if("remove"===lizMap.mainLizmap.selectionTool.newAddRemoveSelected){var s=a.layers[e].selectedFeatures.concat([]);for(r=0;r<o.length;++r){var p=s.indexOf(o[r]);-1!=p&&s.splice(p,1)}o=s}a.layers[e].selectedFeatures=o,lizMap.events.triggerEvent("layerSelectionChanged",{featureType:e,featureIds:a.layers[e].selectedFeatures,updateDrawing:!0})}))}))}(e,t,n)},addGeometryFeatureInfo:function(e,t){return K(0,t)},addChildrenFeatureInfo:function(e,t){return Q(0,t)},addChildrenDatavizFilteredByPopupFeature:function(e,t){return X(0,t)},addDock:function(e,t,a,n,i){return de(e,t,a,n,i)},getHashParamFromUrl:function(e){var t=location.hash.replace("#","").split(",");for(var a in t){var n=t[a].split(":");if(2==n.length){var i=n[0],o=n[1];if(i==e)return o}}return null},triggerLayerFilter:function(e,t){return function(e,t){var n=e,i=null,o=l.getLayersByName(T(e));if(1==o.length&&(i=o[0]),!i)return!1;if(i.params&&(n=i.params.LAYERS),t&&""!=t)r=n+":"+t;else{t=null;var r=null}i.params.FILTER=r,"request_params"in a.layers[e]||(a.layers[e].request_params={}),a.layers[e].request_params.exp_filter=t;var s=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params)),p={service:"WMS",request:"GETFILTERTOKEN",typename:e,filter:r};return $.post(s,p,(function(t){var n=t.token;delete i.params.FILTER,i.params.FILTERTOKEN=n,a.layers[e].request_params.filtertoken=n,a.layers[e].geometryType&&"none"!=a.layers[e].geometryType&&"unknown"!=a.layers[e].geometryType&&i.redraw(),lizMap.events.triggerEvent("layerFilterParamChanged",{featureType:e,filter:r,updateDrawing:!1})})),!0}(e,t)},deactivateMaplayerFilter:function(e){return function(e){var t=null,n=l.getLayersByName(T(e));1==n.length&&(t=n[0]),delete t.params.FILTER,delete t.params.FILTERTOKEN,delete t.params.EXP_FILTER,"request_params"in a.layers[e]||(a.layers[e].request_params={}),a.layers[e].request_params.exp_filter=null,a.layers[e].request_params.filtertoken=null,a.layers[e].request_params.filter=null,t.redraw()}(e)},init:function(){var y=this,z=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));const S=fetch(OpenLayers.Util.urlAppend(lizUrls.config,OpenLayers.Util.getParameterString(lizUrls.params))).then((function(e){if(!e.ok)throw"Config not loaded: "+e.status+" "+e.statusText;return e.json()})),k=fetch(OpenLayers.Util.urlAppend(lizUrls.keyValueConfig,OpenLayers.Util.getParameterString(lizUrls.params))).then((function(e){if(!e.ok)throw"Key/value config not loaded: "+e.status+" "+e.statusText;return e.json()})),M=fetch(OpenLayers.Util.urlAppend(z,OpenLayers.Util.getParameterString({SERVICE:"WMS",REQUEST:"GetCapabilities",VERSION:"1.3.0"}))).then((function(e){if(!e.ok)throw"WMS GetCapabilities not loaded: "+e.status+" "+e.statusText;return e.text()})),R=fetch(OpenLayers.Util.urlAppend(z,OpenLayers.Util.getParameterString({SERVICE:"WMTS",REQUEST:"GetCapabilities",VERSION:"1.0.0"}))).then((function(e){if(!e.ok)throw"WMTS GetCapabilities not loaded: "+e.status+" "+e.statusText;return e.text()})),F=fetch(OpenLayers.Util.urlAppend(z,OpenLayers.Util.getParameterString({SERVICE:"WFS",REQUEST:"GetCapabilities",VERSION:"1.0.0"}))).then((function(e){if(!e.ok)throw"WFS GetCapabilities not loaded: "+e.status+" "+e.statusText;return e.text()}));let j,A,U;const K=new URL(document.location).searchParams,X=K.get("layer"),Q=K.get("filter");if(X&&Q){const a={TYPENAME:X,EXP_FILTER:Q};if(j=(new e).getFeature(a),"true"===K.get("popup")){const e={QUERY_LAYERS:X,LAYERS:X,FEATURE_COUNT:50,FILTER:`${X}:${Q}`};A=(new t).getFeatureInfo(e)}}Promise.all([S,k,M,R,F,j,A]).then((e=>{a=e[0],n=e[1];const t=e[2],z=e[3],S=e[4];let k=e[5]?.features?.[0]?.bbox,M=e[5]?.features;if(k)for(const t of e[5].features)R=k,(F=t.bbox)[0]<R[0]&&(R[0]=F[0]),F[2]>R[2]&&(R[2]=F[2]),F[1]<R[1]&&(R[1]=F[1]),F[3]>R[3]&&(R[3]=F[3]),k=R;var R,F;U=e[6];const j=new DOMParser;if(a.options.hasOverview=!1,"useLayerIDs"in a.options&&"True"==a.options.useLayerIDs)for(var A in a.layers){var K=a.layers[A];v[K.id]=A}for(var A in a.layers)"shortname"in(K=a.layers[A])&&""!=K.shortname&&(h[K.shortname]=A),K.cleanname=T(A);const X=new OpenLayers.Format.WMSCapabilities({version:"1.3.0"});if(!(i=X.read(t)).capability)throw"WMS Capabilities error";const Q=new OpenLayers.Format.WMTSCapabilities({});if("exceptionReport"in(o=Q.read(z))){var ie=$("#metadata-wmts-getcapabilities-url");0!=ie.length&&ie.before('<i title="'+o.exceptionReport.exceptions[0].texts[0]+'" class="icon-warning-sign"></i>&nbsp;'),o=null}r=j.parseFromString(S,"application/xml");var se=fe();for(const e of se){var pe=e.getElementsByTagName("Name")[0].textContent;if(!(A=lizMap.getNameByTypeName(pe)))if(pe in a.layers)A=pe;else if(pe in h&&h[pe]in a.layers)A=h[pe];else for(ke in a.layers)if(ke.split(" ").join("_")==pe){A=ke;break}A in a.layers&&((K=a.layers[A]).typename=pe,b[pe]=A)}$("#abstract").html(i.abstract?i.abstract:"");var me=i.capability;a.options.qgisProjectProjection=Object.assign({},a.options.projection),y.config=a,y.events.triggerEvent("beforetreecreated",y),function(){if("osmMapnik"in a.options&&"True"==a.options.osmMapnik||"osmStamenToner"in a.options&&"True"==a.options.osmStamenToner||"openTopoMap"in a.options&&"True"==a.options.openTopoMap||"osmCyclemap"in a.options&&"True"==a.options.osmCyclemap&&"OCMKey"in a.options||"googleStreets"in a.options&&"True"==a.options.googleStreets||"googleSatellite"in a.options&&"True"==a.options.googleSatellite||"googleHybrid"in a.options&&"True"==a.options.googleHybrid||"googleTerrain"in a.options&&"True"==a.options.googleTerrain||"bingStreets"in a.options&&"True"==a.options.bingStreets&&"bingKey"in a.options||"bingSatellite"in a.options&&"True"==a.options.bingSatellite&&"bingKey"in a.options||"bingHybrid"in a.options&&"True"==a.options.bingHybrid&&"bingKey"in a.options||"ignTerrain"in a.options&&"True"==a.options.ignTerrain||"ignStreets"in a.options&&"True"==a.options.ignStreets||"ignSatellite"in a.options&&"True"==a.options.ignSatellite||"ignCadastral"in a.options&&"True"==a.options.ignCadastral){Proj4js.defs["EPSG:3857"]=Proj4js.defs["EPSG:900913"];var e=a.options.projection;e.ref in Proj4js.defs||(Proj4js.defs[e.ref]=e.proj4);var t=new OpenLayers.Projection(e.ref),n=new OpenLayers.Projection("EPSG:3857");e.ref="EPSG:3857",e.proj4=Proj4js.defs["EPSG:3857"];var i=a.options.bbox,o=new OpenLayers.Bounds(Number(i[0]),Number(i[1]),Number(i[2]),Number(i[3]));i=(o=o.transform(t,n)).toArray();var r=[];if("mapScales"in a.options&&(r=a.options.mapScales),0==r.length&&(r=[a.options.maxScale,a.options.minScale]),a.options.projection=e,a.options.bbox=i,a.options.zoomLevelNumber=16,"initialExtent"in a.options&&4==a.options.initialExtent.length){var l=a.options.initialExtent,s=new OpenLayers.Bounds(Number(l[0]),Number(l[1]),Number(l[2]),Number(l[3]));s=s.transform(t,n),a.options.initialExtent=s.toArray()}("osmMapnik"in a.options&&"True"==a.options.osmMapnik||"osmStamenToner"in a.options&&"True"==a.options.osmStamenToner||"openTopoMap"in a.options&&"True"==a.options.openTopoMap||"osmCyclemap"in a.options&&"True"==a.options.osmCyclemap&&"OCMKey"in a.options||"bingStreets"in a.options&&"True"==a.options.bingStreets&&"bingKey"in a.options||"bingSatellite"in a.options&&"True"==a.options.bingSatellite&&"bingKey"in a.options||"bingHybrid"in a.options&&"True"==a.options.bingHybrid&&"bingKey"in a.options||"ignTerrain"in a.options&&"True"==a.options.ignTerrain||"ignStreets"in a.options&&"True"==a.options.ignStreets)&&(a.options.zoomLevelNumber=23),("googleStreets"in a.options&&"True"==a.options.googleStreets||"googleHybrid"in a.options&&"True"==a.options.googleHybrid||"ignCadastral"in a.options&&"True"==a.options.ignCadastral)&&(a.options.zoomLevelNumber=20),"googleSatellite"in a.options&&"True"==a.options.googleSatellite&&(a.options.zoomLevelNumber=21),"ignSatellite"in a.options&&"True"==a.options.ignSatellite&&(a.options.zoomLevelNumber=22),a.options.maxScale=591659030.3224756,a.options.minScale=2257.0000851534865;var p="emptyBaselayer"in a.options&&"True"==a.options.emptyBaselayer;if(!p)for(var m in a.layers)if("True"==a.layers[m].baseLayer){p=!0;break}p&&(a.options.zoomLevelNumber=24);var u=[];if(0!=r.length){r.sort((function(e,t){return Number(t)-Number(e)}));for(var c=r[0],f=OpenLayers.Util.getResolutionFromScale(c,n.proj.units),d=r[r.length-1],y=OpenLayers.Util.getResolutionFromScale(d,n.proj.units),g=156543.03390625,v=1;g>y&&v<a.options.zoomLevelNumber;)g<f&&u.push(g),g/=2,v++;f=u[0],y=u[u.length-1],c=OpenLayers.Util.getScaleFromResolution(f,n.proj.units),d=OpenLayers.Util.getScaleFromResolution(y,n.proj.units)}a.options.resolutions=u,0!=u.length&&(a.options.zoomLevelNumber=u.length,a.options.maxScale=c,a.options.minScale=d)}}();var ce=me.nestedLayers[0];P(ce,c),N(c),y.config=a,y.keyValueConfig=n,y.tree=c,y.events.triggerEvent("treecreated",y),function(e){if(lizProj4)for(var t in lizProj4)t in Proj4js.defs||(Proj4js.defs[t]=lizProj4[t]);var n=a.options.projection;n.ref in Proj4js.defs||(Proj4js.defs[n.ref]=n.proj4);var i=new OpenLayers.Projection(n.ref);if(!(n.ref in OpenLayers.Projection.defaults)&&(OpenLayers.Projection.defaults[n.ref]=i,n.ref in e.bbox)){var o=e.bbox[n.ref].bbox,r=OpenLayers.Bounds.fromArray(o);OpenLayers.Bounds.fromArray(a.options.initialExtent).intersectsBounds(r)||(OpenLayers.Projection.defaults[n.ref].yx=!0)}}(ce),function(e){var t=a.options.projection,n=new OpenLayers.Projection(t.ref),i=a.options.bbox,o=new OpenLayers.Bounds(Number(i[0]),Number(i[1]),Number(i[2]),Number(i[3])),r=o.scale(3);if(e)(e=new OpenLayers.Bounds(e)).transform(new OpenLayers.Projection("EPSG:4326"),n);else if(e=o.clone(),"initialExtent"in a.options&&4==a.options.initialExtent.length){var m=a.options.initialExtent;e=new OpenLayers.Bounds(Number(m[0]),Number(m[1]),Number(m[2]),Number(m[3]))}var u=$("body").parent()[0].clientHeight;u||(u=$("window").innerHeight()),u-=$("#header").height(),u-=$("#headermenu").height(),$("#map").height(u),E();var c=[],f=[];"resolutions"in a.options?f=a.options.resolutions:"mapScales"in a.options&&(c=a.options.mapScales),c.sort((function(e,t){return Number(t)-Number(e)}));for(var d=[];0!=c.length;){var y=c.pop(0);-1==$.inArray(y,d)&&d.push(y)}c=d,OpenLayers.Util.IMAGE_RELOAD_ATTEMPTS=3,OpenLayers.IMAGE_RELOAD_ATTEMPTS=3,OpenLayers.Util.DEFAULT_PRECISION=20,(l=new OpenLayers.Map("map",{controls:[new OpenLayers.Control.Navigation({mouseWheelOptions:{interval:100}})],tileManager:null,eventListeners:{zoomend:function(){var e={childPrefix:"child-of-"};function t(t){if(0==t.length)return null;for(var a=t[0].className.split(" "),n=0;n<a.length;n++)if(a[n].match(e.childPrefix))return $(t).siblings("#"+a[n].substring(e.childPrefix.length));return null}function a(e){for(var a=[];e=t(e);)a[a.length]=e[0];return a}for(var n=0,i=p.length;n<i;n++){var o=p[n],r=$('#switcher button[name="layer"][value="'+o.name+'"]').first();if(o.inRange&&r.hasClass("disabled")){(s=r.parents("tr").first()).removeClass("disabled").find("button").removeClass("disabled");var l=a(s);$.each(l,(function(e,t){$(t).removeClass("disabled").find("button").removeClass("disabled")})),s.find('button[name="layer"]').hasClass("checked")&&o.setVisibility(!0)}else if(!o.inRange&&!r.hasClass("disabled")){var s;(s=r.parents("tr").first()).addClass("disabled").find("button").addClass("disabled"),s.hasClass("liz-layer")&&s.collapse(),l=a(s),$.each(l,(function(t,a){a=$(a);var n,i=0,o=0,r=(n=a,$(n).siblings("tr."+e.childPrefix+n[0].id));$.each(r,(function(e,t){$(t).find("button.checkbox").each((function(e,t){$(t).hasClass("disabled")&&o++,i++}))})),i==o?a.addClass("disabled").find("button").addClass("disabled"):a.removeClass("disabled").find("button").removeClass("disabled")}))}}$("#navbar button.pan").click()}},maxExtent:o,restrictedExtent:r,initialExtent:e,maxScale:0==c.length?a.options.minScale:"auto",minScale:0==c.length?a.options.maxScale:"auto",numZoomLevels:0==c.length?a.options.zoomLevelNumber:c.length,scales:0==c.length?null:c,resolutions:0==f.length?null:f,projection:n,units:null!==n.proj.units?n.proj.units:"degrees",allOverlays:0==s.length})).addControl(new OpenLayers.Control.Attribution({div:document.getElementById("attribution")})),window.addEventListener("resize",E)}(k),y.map=l,y.layers=p,y.baselayers=s,y.controls=m,y.events.triggerEvent("mapcreated",y),_(),y.events.triggerEvent("layersadded",y);var ye=l.layers[l.layers.length-1].getZIndex();ye>l.Z_INDEX_BASE.Feature-100&&(l.Z_INDEX_BASE.Feature=ye+100,l.Z_INDEX_BASE.Popup=l.Z_INDEX_BASE.Feature+25,l.Z_INDEX_BASE.Popup>l.Z_INDEX_BASE.Control-25&&(l.Z_INDEX_BASE.Control=l.Z_INDEX_BASE.Popup+25));var ge,ve,he=!0,be=OpenLayers.Util.getParameters(window.location.href);if(!l.getCenter()){if(be.bbox||be.BBOX){var Le=null;if(be.bbox&&(Le=OpenLayers.Bounds.fromArray(be.bbox)),be.BBOX&&(Le=OpenLayers.Bounds.fromArray(be.BBOX)),be.crs&&be.crs!=l.getProjection()&&Le.transform(be.crs,l.getProjection()),be.CRS&&be.CRS!=l.getProjection()&&Le.transform(be.CRS,l.getProjection()),l.restrictedExtent.containsBounds(Le))l.zoomToExtent(Le,!0);else{var ze=$("#metadata .bbox").text();(ze=OpenLayers.Bounds.fromString(ze)).containsBounds(Le)?ne($("#metadata .proj").text(),(function(e){Le.transform(e,l.getProjection()),l.zoomToExtent(Le,!0)})):l.zoomToExtent(l.initialExtent)}}else l.zoomToExtent(l.initialExtent);if(k){var Oe=new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0}),Se=l.getLayersByName("locatelayer")[0];for(const e of M)if(null!=e.geometry){var Te=Oe.read(e)[0];Te.geometry.transform("EPSG:4326",l.getProjection()),Se.addFeatures([Te]),Se.setVisibility(!0)}}he=!1}E(),l.events.triggerEvent("zoomend",{zoomChanged:!0}),function(){if($("#navbar div.slider").height(Math.max(50,5*l.numZoomLevels)).slider({orientation:"vertical",min:0,max:l.numZoomLevels-1,change:function(e,t){t.value>l.baseLayer.numZoomLevels-1?($("#navbar div.slider").slider("value",l.getZoom()),$("#zoom-in-max-msg").show("slow",(function(){window.setTimeout((function(){$("#zoom-in-max-msg").hide("slow")}),1e3)}))):t.value!=l.zoom&&l.zoomTo(t.value)}}),$("#navbar button.pan").click((function(){var e=$(this);if(e.hasClass("active"))return!1;$("#navbar button.zoom").removeClass("active"),e.addClass("active");var t=l.getControlsByClass("OpenLayers.Control.Navigation")[0];t.zoomBox.keyMask=t.zoomBoxKeyMask,t.zoomBox.handler.keyMask=t.zoomBoxKeyMask,t.zoomBox.handler.dragHandler.keyMask=t.zoomBoxKeyMask,t.handlers.wheel.activate(),"edition"in m&&m.edition.active||!("featureInfo"in m)||null===m.featureInfo||m.featureInfo.activate()})),$("#navbar button.zoom").click((function(){var e=$(this);if(e.hasClass("active"))return!1;$("#navbar button.pan").removeClass("active"),e.addClass("active"),"featureInfo"in m&&null!==m.featureInfo&&m.featureInfo.deactivate();var t=l.getControlsByClass("OpenLayers.Control.Navigation")[0];t.handlers.wheel.deactivate(),t.zoomBox.keyMask=null,t.zoomBox.handler.keyMask=null,t.zoomBox.handler.dragHandler.keyMask=null})),$("#navbar button.zoom-extent").click((function(){var e=G();"layers"in e?Y(e):l.zoomToExtent(l.initialExtent)})),$("#navbar button.zoom-in").click((function(){l.getZoom()==l.baseLayer.numZoomLevels-1?$("#zoom-in-max-msg").show("slow",(function(){window.setTimeout((function(){$("#zoom-in-max-msg").hide("slow")}),1e3)})):l.zoomIn()})),$("#navbar button.zoom-out").click((function(){l.zoomOut()})),"zoomHistory"in a.options&&"True"==a.options.zoomHistory){var e=new OpenLayers.Control.NavigationHistory;l.addControls([e]),$("#navbar button.previous").click((function(){var e=l.getControlsByClass("OpenLayers.Control.NavigationHistory")[0];e&&0!=e.previousStack.length&&e.previousTrigger(),e&&e.previous.active?$(this).removeClass("disabled"):$(this).addClass("disabled"),e&&e.next.active?$("#navbar button.next").removeClass("disabled"):$("#navbar button.next").addClass("disabled")})),$("#navbar button.next").click((function(){var e=l.getControlsByClass("OpenLayers.Control.NavigationHistory")[0];e&&0!=e.nextStack.length&&e.nextTrigger(),e&&e.next.active?$(this).removeClass("disabled"):$(this).addClass("disabled"),e&&e.previous.active?$("#navbar button.previous").removeClass("disabled"):$("#navbar button.previous").addClass("disabled")})),l.events.on({moveend:function(){var e=l.getControlsByClass("OpenLayers.Control.NavigationHistory")[0];e&&0!=e.previousStack.length?$("#navbar button.previous").removeClass("disabled"):$("#navbar button.previous").addClass("disabled"),e&&0!=e.nextStack.length?$("#navbar button.next").removeClass("disabled"):$("#navbar button.next").addClass("disabled")}})}else $("#navbar > .history").remove()}(),ge=a.options,ve=function(){var e=!1;for(var t in a.layers){var n=a.layers[t],i=null;if("editionLayers"in a&&t in a.editionLayers&&(i=a.editionLayers[t]),n&&n.popup&&"True"==n.popup||i&&("True"==i.capabilities.modifyGeometry||"True"==i.capabilities.modifyAttribute||"True"==i.capabilities.deleteFeature)){e=!0;break}}if(!e)return null;if("popupLocation"in a.options&&"map"!=a.options.popupLocation&&!$("#mapmenu .nav-list > li.popupcontent > a").length){"popup.msg.start"in lizDict||(lizDict["popup.msg.start"]="Click to the map to get informations.");var o='<div class="lizmapPopupContent"><h4>'+lizDict["popup.msg.start"]+"</h4></div>";de("popupcontent","Popup",a.options.popupLocation,o,"icon-comment"),$("#button-popupcontent").click((function(){$(this).parent().hasClass("active")&&(I("locatelayer"),$("#popupcontent div.menu-content").html('<div class="lizmapPopupContent"><h4>'+lizDict["popup.msg.start"]+"</h4></div>"))}))}var r,s=new OpenLayers.Control.WMSGetFeatureInfo({url:lizUrls.service,title:"Identify features by clicking",type:OpenLayers.Control.TYPE_TOGGLE,queryVisible:!0,infoFormat:"text/html",vendorParams:(r=f,"pointTolerance"in a.options&&"lineTolerance"in a.options&&"polygonTolerance"in a.options&&(r={FI_POINT_TOLERANCE:a.options.pointTolerance,FI_LINE_TOLERANCE:a.options.lineTolerance,FI_POLYGON_TOLERANCE:a.options.polygonTolerance}),r),handlerOptions:{click:{pixelTolerance:10}},eventListeners:{getfeatureinfo:function(e){Z(e.text,e.xy)}}});if(lizUrls.publicUrlList&&0!=lizUrls.publicUrlList.length){for(var p=[],m=0,u=lizUrls.publicUrlList.length;m<u;m++)p.push(OpenLayers.Util.urlAppend(lizUrls.publicUrlList[m],OpenLayers.Util.getParameterString(lizUrls.params)));s.layerUrls=p}function c(e){if(e.updateDrawing){if(null==O)return!0;var t=l.getPixelFromLonLat(O);if(!($("#liz_layer_popup  div.lizmapPopupContent").length<1&&$("#popupcontent div.menu-content div.lizmapPopupContent").length<1)){var a="liz_layer_popup";0==$("#"+a+" div.lizmapPopupContent input.lizmap-popup-layer-feature-id").length&&(a="popupcontent");var n=!1;$("#"+a+" div.lizmapPopupContent input.lizmap-popup-layer-feature-id").each((function(){var t=$(this).val(),a=t.split(".").pop(),i=t.replace("."+a,""),o=lizMap.getLayerConfigById(i);if(o&&o[0]==e.featureType)return n=!0,!1})),n&&($("#"+a+' div.lizmapPopupContent input.lizmap-popup-layer-feature-id[value="'+e.layerId+"."+e.featureId+'"]').parent().remove(),s.request(t,{}))}}}return s.findLayers=function(){var e,t,n=this.layers||this.map.layers,i=[],o=0;const r=[];for(var l=0,s=n.length;l<s;++l)if(((e=n[l])instanceof OpenLayers.Layer.WMS||e instanceof OpenLayers.Layer.WMTS)&&(!this.queryVisible||e.getVisibility()&&e.calculateInRange())){var p=null;e.name in g&&(p=x(e.name));var m=null;p&&(m=a.layers[p]),m||(m=a.layers[e.params.LAYERS]),m||(m=a.layers[e.name]);var u=null;if("editionLayers"in a&&((u=a.editionLayers[p])||(u=a.editionLayers[e.params.LAYERS]),u||(u=a.editionLayers[e.name])),m&&m.popup&&"True"==m.popup||u&&("True"==u.capabilities.modifyGeometry||"True"==u.capabilities.modifyAttribute||"True"==u.capabilities.deleteFeature)){t=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url,!1!==this.drillDown||this.url||(this.url=t);const a=m?.request_params?.filtertoken;a&&r.push(a),i.push(e),"popupMaxFeatures"in m&&!isNaN(parseInt(m.popupMaxFeatures))?o+=parseInt(m.popupMaxFeatures):o+=10}}return this.maxFeatures=0==o?10:o,r.length&&(this.vendorParams.filtertoken=r.join(";")),i},lizMap.events.on({layerFilterParamChanged:function(e){let t=document.querySelectorAll("input.lizmap-popup-layer-feature-id").length;if(0!=t)for(var n in a.layers){var i=a.layers[n];if("True"==i.popup&&"request_params"in i&&null!=i.request_params&&(t=document.querySelectorAll(`input.lizmap-popup-layer-feature-id[value^=${i.id}]`).length,0!=t)){var o=i.request_params;if("filter"in i.request_params&&null!=i.request_params.filter&&""!=i.request_params.filter){OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));var r={service:"WMS",request:"GETFILTERTOKEN",typename:n,filter:i.request_params.filter};$.post(lizUrls.service,r,(function(){c(e)}))}else s.vendorParams.filtertoken=o.filtertoken,s.vendorParams.filter=o.filter}}},layerSelectionChanged:function(e){c(e)},lizmapeditionfeaturedeleted:function(e){if($("div.lizmapPopupContent input.lizmap-popup-layer-feature-id").length>1)c(e);else if(0!=l.popups.length&&l.removePopup(l.popups[0]),"popupLocation"in a.options&&"map"!=a.options.popupLocation){var t='<div class="lizmapPopupContent"><h4>'+lizDict["popup.msg.no.result"]+"</h4></div>";$("#popupcontent div.menu-content").html(t),$("#mapmenu .nav-list > li.popupcontent").hasClass("active")&&$("#button-popupcontent").click(),$("#mapmenu .nav-list > li.popupcontent").hasClass("active")||$("#mapmenu .nav-list > li.popupcontent").hide()}}}),l.addControl(s),s.activate(),s}(),m.featureInfo=ve,"print"in ge&&"True"==ge.print?function(){if(!a.printTemplates||0==a.printTemplates.length)return $("#button-print").parent().remove(),!1;for(var e=[],t=0,n=a.printTemplates.length;t<n;t++)"atlas"in(y=a.printTemplates[t])&&"enabled"in y.atlas&&("1"===y.atlas.enabled||"true"===y.atlas.enabled)||e.push(y);if(0==e.length)return $("#button-print").parent().remove(),!1;var i=.35277,o=l.scales;if(a.options.mapScales.length>2&&(o=a.options.mapScales),null==o&&null!=l.resolutions)for(o=[],t=0,n=l.resolutions.length;t<n;t++){var r=l.getUnits(),s=l.resolutions[t],p=OpenLayers.Util.getScaleFromResolution(s,r);o.push(p)}if(null==o)return $("#button-print").parent().remove(),!1;o[0]<o[o.length-1]&&o.reverse();var c="";for(t=0,n=o.length;t<n;t++){p=o[t],u.scales.push(p);var f=p;f=(f=f>10?Math.round(f):Math.round(100*f)/100).toLocaleString(),c+='<option value="'+p+'">'+f+"</option>"}for($("#print-scale").html(c),t=0,n=e.length;t<n;t++){for(var y=e[t],v=null,h=0,b=null;null==v&&h<y.maps.length;)(v=y.maps[h]).overviewMap&&(b=y.maps[h],v=null,h+=1);if(null!=v){var L=Number(v.width)/i,z=Number(v.height)/i;u.layouts.push({name:y.title,map:{width:L,height:z},size:{width:L,height:z},rotation:!1,template:y,mapId:v.id,overviewId:null!=b?b.id:null,grid:"grid"in v&&"True"==v.grid})}}if(0==u.layouts.length)return $("#button-print").parent().remove(),!1;var O=l.getLayersByName("Print");for(0==O.length?(O=new OpenLayers.Layer.Vector("Print",{styleMap:new OpenLayers.StyleMap({default:new OpenLayers.Style({fillColor:"#D43B19",fillOpacity:.2,strokeColor:"#CE1F2D",strokeWidth:1})})}),l.addLayer(O),O.setVisibility(!1)):O=O[0],t=0,n=u.layouts.length;t<n;t++){var S=u.layouts[t];$("#print-template").append('<option value="'+t+'">'+S.name+"</option>")}var T=new OpenLayers.Control.DragFeature(O,{geometryTypes:["OpenLayers.Geometry.Polygon"],type:OpenLayers.Control.TYPE_TOOL,layout:null,eventListeners:{activate:function(e){if(null==this.layout)return!1;B(e);var t=this.layout,a=J(u.scales);$("#print-scale").val(a),ee(t,O,a),oe(lizDict["print.activate"],"info",!0).addClass("print"),O.setVisibility(!0)},deactivate:function(){O.setVisibility(!1),$("#message .print").remove(),this.layout=null,O.destroyFeatures()}}});l.addControls([T]),m.printDrag=T,$("#print-template").change((function(){var e=$(this),t=u.layouts[parseInt(e.val())];if(0!=t.template.labels.length){for(var a="",n=0,i=t.template.labels.length;n<i;n++){var o=t.template.labels[n];a+=0==o.htmlState?'<input type="text" name="'+o.id+'" class="print-label" placeholder="'+o.text+'" value="'+o.text+'"><br>':'<textarea name="'+o.id+'" class="print-label" placeholder="'+o.text+'">'+o.text+"</textarea><br>"}$("#print .print-labels").html(a),$("#print .print-labels").show()}else $("#print .print-labels").html(""),$("#print .print-labels").hide();return C(),T.active?(T.deactivate(),T.layout=t,T.activate()):(T.layout=t,T.activate()),!1})),$("#print button.btn-print-clear").click((function(){return $("#button-print").click(),!1})),$("#print-scale").change((function(){if(T.active&&O.getVisibility()){var e=$(this),t=parseFloat(e.val());ee(T.layout,O,t)}})),$("#print-launch").click((function(){var e=T.layout.template,t=[];"tables"in e&&(t=$.map(e.tables,(function(e){if(-1==e.composerMap||"map"+e.composerMap==T.layout.mapId)return e.vectorLayer})));var n=new OpenLayers.Bounds(T.layer.features[0].geometry.getBounds().toArray()),i=l.projection.getCode(),o=null,r=!0;if("printInProjectProjection"in lizMap.config.options&&"True"!=lizMap.config.options.printInProjectProjection&&(r=!1),r&&lizMap.config.options.qgisProjectProjection.ref!=lizMap.config.options.projection.ref){var s=a.options.qgisProjectProjection;s.ref in Proj4js.defs||(Proj4js.defs[s.ref]=s.proj4),i=(o=new OpenLayers.Projection(s.ref)).getCode(),n.transform(l.projection,o)}var m=OpenLayers.Projection.defaults[i]&&OpenLayers.Projection.defaults[i].yx,c=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));let f={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetPrint"};if(f.FORMAT=document.querySelector("#print-format").value,f.EXCEPTIONS="application/vnd.ogc.se_inimage",f.TRANSPARENT="true",f.SRS=i,f.DPI=document.querySelector("#print-dpi").value,f.TEMPLATE=e.title,f[T.layout.mapId+":extent"]=n.toBBOX(null,m),f[T.layout.mapId+":scale"]=document.querySelector("#print-scale").value,"grid"in T.layout&&T.layout.grid){var y=te(T.layout,parseFloat(p),u.scales);f[T.layout.mapId+":grid_interval_x="]=y,f[T.layout.mapId+":grid_interval_y="]=y}var v=[],h=[],b=[];$.each(l.layers,(function(e,t){if((t instanceof OpenLayers.Layer.WMS||t instanceof OpenLayers.Layer.WMTS)&&t.getVisibility()&&"params"in t&&"LAYERS"in t.params){var n=null;t.name in g&&(n=x(t.name));var i=null;if(n&&(i=a.layers[n]),i||(i=a.layers[t.params.LAYERS]),i||(i=a.layers[t.name]),!i)return;if(!("id"in i))return;v.push(t.params.LAYERS);var o="default";"qgisServerVersion"in a.options&&a.options.qgisServerVersion.startsWith("3.")&&(o=""),"STYLES"in t.params&&t.params.STYLES.length>0&&(o=t.params.STYLES),h.push(o),i&&"opacity"in i?b.push(parseInt(255*t.opacity*i.opacity)):b.push(parseInt(255*t.opacity))}})),v.reverse(),h.reverse(),b.reverse();var L=l.baseLayer.name;if(L in d){var z=d[L];if(z in a.layers){var O=a.layers[z];"id"in O&&"useLayerIDs"in a.options&&"True"==a.options.useLayerIDs?v.push(O.id):"shortname"in O?v.push(O.shortname):v.push(z),"qgisServerVersion"in a.options&&a.options.qgisServerVersion.startsWith("3.")?h.push(""):h.push("default"),b.push(255)}}if(t.length>0&&$.each(t,(function(e,t){var n=ae(t);if(n){var i=n[1];"none"!=i.geometryType&&"unknown"!=i.geometryType&&""!=i.geometryType||("shortname"in i&&""!=i.shortname?v.push(i.shortname):v.push(i.name),"qgisServerVersion"in a.options&&a.options.qgisServerVersion.startsWith("3.")?h.push(""):h.push("default"),b.push(255))}})),"qgisServerVersion"in a.options&&"2.14"!=a.options.qgisServerVersion&&(v.reverse(),h.reverse(),b.reverse()),f[T.layout.mapId+":LAYERS"]=v.join(","),f[T.layout.mapId+":STYLES"]=h.join(","),null!=T.layout.overviewId&&a.options.hasOverview){var S=a.options.bbox,E=new OpenLayers.Bounds(Number(S[0]),Number(S[1]),Number(S[2]),Number(S[3]));r&&lizMap.config.options.qgisProjectProjection.ref!=lizMap.config.options.projection.ref&&E.transform(l.projection,o),f[T.layout.overviewId+":extent"]=E,f[T.layout.overviewId+":LAYERS"]="Overview","qgisServerVersion"in a.options&&"2.14"!=a.options.qgisServerVersion?(v.push("Overview"),a.options.qgisServerVersion.startsWith("3.")?h.push(""):h.push("default"),b.push(255)):(v.unshift("Overview"),h.unshift("default"),b.unshift(255))}f.LAYERS=v.join(","),f.STYLES=h.join(","),f.OPACITIES=b.join(",");const C=document.querySelectorAll("#print .print-labels .print-label");if(C)for(const e of C)f[e.name]=e.value;var w=[],k=[];for(var M in a.layers){var P=a.layers[M],N=P.request_params;"request_params"in P&&null!=N&&("filtertoken"in N&&null!=N.filtertoken&&""!=N.filtertoken&&w.push(N.filtertoken),"selectiontoken"in N&&null!=N.selectiontoken&&""!=N.selectiontoken&&k.push(N.selectiontoken))}0!=w.length&&(f.FILTERTOKEN=w.join(";")),0!=k.length&&(f.SELECTIONTOKEN=k.join(";"));const R=new OpenLayers.Format.WKT,F=[],j=[];if(lizMap.mainLizmap.digitizing.featureDrawn&&lizMap.mainLizmap.digitizing.featureDrawnVisibility)for(let e=0;e<lizMap.mainLizmap.digitizing.featureDrawn.length;e++){var I=lizMap.mainLizmap.digitizing.featureDrawn[e];r&&lizMap.config.options.qgisProjectProjection.ref!=lizMap.config.options.projection.ref&&I.geometry.transform(l.projection,o),F.push(R.write(I)),j.push(lizMap.mainLizmap.digitizing.getFeatureDrawnSLD(e))}F.length>0&&(f[T.layout.mapId+":HIGHLIGHT_GEOM"]=F.join(";"),f[T.layout.mapId+":HIGHLIGHT_SYMBOL"]=j.join(";"));const A=document.getElementById("print-launch");return A.disabled=!0,A.classList.add("spinner"),$("#message .print a").click(),oe(lizDict["print.started"],"info",!0).addClass("print-in-progress"),re(c,f,(()=>{const e=document.getElementById("print-launch");e.disabled=!1,e.classList.remove("spinner"),$("#message .print-in-progress a").click()})),!1})),l.events.on({zoomend:function(){if(T.active&&O.getVisibility()){var e=J(u.scales);$("#print-scale").val(e),ee(T.layout,O,e)}}}),lizMap.events.on({minidockopened:function(e){"print"==e.id&&$("#print-template").change()},minidockclosed:function(e){"print"==e.id&&T.deactivate()}})}():$("#button-print").parent().remove(),a.tooltipLayers&&0!=a.tooltipLayers.length?function(){if(!a.tooltipLayers||0==a.tooltipLayers.length)return $("#button-tooltip-layer").parent().remove(),!1;var e=fe();if(0==e.length)return $("#button-tooltip-layer").parent().remove(),!1;var t={};for(var n in a.tooltipLayers)t[lizMap.cleanName(n)]=n;var i=[];for(const t of e){var o=t.getElementsByTagName("Name")[0].textContent;if(!(n=lizMap.getNameByTypeName(o)))if(o in a.locateByLayer)n=o;else if(o in h&&h[o]in a.locateByLayer)n=h[o];else for(var r in a.tooltipLayers)if(r.split(" ").join("_")==o){n=r;break}if(n in a.tooltipLayers&&n in a.tooltipLayers&&n in a.layers){var l=a.layers[n];i[a.tooltipLayers[n].order]='<option value="'+n+'">'+l.title+"</option>"}}for(var s=0;s<i.length;s++)$("#tooltip-layer-list").append(i[s]);if(1==$("#tooltip-layer-list").find("option").length)return $("#button-tooltip-layer").parent().remove(),!1;var p=new OpenLayers.StyleMap({default:new OpenLayers.Style({pointRadius:1,strokeColor:"blue",strokeWidth:10,strokeOpacity:0,fillOpacity:0,cursor:"pointer"}),selected:new OpenLayers.Style({pointRadius:1,strokeColor:"yellow",strokeWidth:10,strokeOpacity:0,fillOpacity:0,cursor:"pointer"}),temporary:new OpenLayers.Style({pointRadius:1,strokeColor:"red",strokeWidth:10,strokeOpacity:0,fillOpacity:0,cursor:"pointer"})}),u=new OpenLayers.Layer.Vector("tooltipLayer",{styleMap:p});lizMap.map.addLayer(u),u.setVisibility(!0);var c=new OpenLayers.Control.HighlightFeature([u],{displayPopup:!0,popupOffset:{left:45,right:0,top:5},popupTitle:"State information",popupSize:new OpenLayers.Size(200,375),style:{pointRadius:6,strokeColor:"cyan",strokeWidth:3,strokeOpacity:1,fillOpacity:.2,fillColor:"transparent"}});c.addInfoPopup=function(e){var t=$("#tooltip-layer-list").val(),a=lizMap.config.layers[t];if(t in lizMap.config.layers){var n=lizMap.config.tooltipLayers[t].fields.trim(),i=n.split(/[\s,]+/),o=[];"attributeLayers"in lizMap.config&&t in lizMap.config.attributeLayers&&"hiddenFields"in lizMap.config.attributeLayers[t]&&(o=lizMap.config.attributeLayers[t].hiddenFields.trim().split(/[\s,]+/));var r=a.alias,l='<div id="tooltipPopupContent">';for(var s in l+='<table class="lizmapPopupTable">',e.attributes)$.inArray(s,o)>-1||(""==n||$.inArray(s,i)>-1)&&(l+="<tr><th>"+r[s]+"</th><td>"+e.attributes[s]+"</td></tr>");l+="</table>",l+="</div>";var p=this.layer.map.getExtent(),m=this.layer.map.getResolution(),u=new OpenLayers.LonLat(p.left,p.top);u.lon+=($("#dock").width()+this.popupOffset.left)*m;var c=new OpenLayers.Popup.Anchored("tooltipPopup",u,null,l,{size:{w:14,h:14},offset:{x:-7,y:-7}},!1);c.autoSize=!0,c.backgroundColor="transparent",e.popup=c,lizMap.map.addPopup(c)}},lizMap.map.addControl(c),m["tooltip-layer"]=c,$("#tooltip-layer button.btn-tooltip-layer-clear").click((function(){return $("#button-tooltip-layer").click(),!1})),$("#tooltip-cancel").click((function(){return $("#tooltip-layer-list").val("").change(),!1})),$("#tooltip-layer-list").change((function(){var e=$(this).val();if(c.deactivate(),u.destroyFeatures(),""!=e){$("#tooltip-layer-list").addClass("loading").attr("disabled","");var t=x(e);t||(t=e);var n=le(t);ue(e,null,n,null,!1,null,null,(function(t,n,i,o){if(!(t in a.layers)){var r=lizMap.getNameByCleanName(e);if(!r||!(r in a.layers))return console.log('getFeatureData: "'+t+'" and "'+r+'" not found in config'),!1;t=r}var l=a.layers[t],s=a.tooltipLayers[t],p=new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0,externalProjection:l.featureCrs,internalProjection:lizMap.map.getProjection()}).read({type:"FeatureCollection",features:i});u.addFeatures(p),"displayGeom"in s&&"True"==s.displayGeom?"colorGeom"in s&&""!=s.colorGeom?c.style.strokeColor=s.colorGeom:c.style.strokeColor="cyan":c.style.strokeColor="transparent",0!=p.length&&p[0].geometry&&p[0].geometry.id.startsWith("OpenLayers_Geometry_LineString")?c.style.strokeWidth=10:c.style.strokeWidth=3,c.activate(),$("#tooltip-layer-list").removeClass("loading").removeAttr("disabled")}))}})),$("#tooltip-layer-list").removeClass("loading").removeAttr("disabled"),lizMap.events.on({minidockopened:function(e){"tooltip-layer"==e.id&&2===$("#tooltip-layer-list option").length&&$("#tooltip-layer-list").val($("#tooltip-layer-list option:nth-child(2)").val()).change()},minidockclosed:function(e){if("tooltip-layer"==e.id)return $("#tooltip-layer-list").val("").change(),!1}})}():$("#button-tooltip-layer").parent().remove(),"geolocation"in ge&&"True"==ge.geolocation&&$("#geolocation button.btn-geolocation-close").click((function(){return $("#button-geolocation").click(),!1})),"measure"in ge&&"True"==ge.measure?function(){var e=new OpenLayers.Style;e.addRules([new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash",fillColor:"white",fillOpacity:.3}}})]);var t=new OpenLayers.StyleMap({default:e}),a={length:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:t}},type:OpenLayers.Control.TYPE_TOOL}),area:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:t}},type:OpenLayers.Control.TYPE_TOOL}),perimeter:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:t}},type:OpenLayers.Control.TYPE_TOOL}),angle:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{id:"angleMeasure",persist:!0,geodesic:!0,immediate:!0,handlerOptions:{maxVertices:3,layerOptions:{styleMap:t}},type:OpenLayers.Control.TYPE_TOOL})};function n(e){var t=e.units,a=e.order,n=e.measure,i="";if("angleMeasure"===e.object.id){if(i=lizDict["measure.handle"]+" 0°",3===e.geometry.components.length){if(void 0===e.object.invert){const t=e.geometry.components[0].clone(),a=e.geometry.components[1].clone();e.geometry.components[0].move(a.x-t.x,a.y-t.y),e.geometry.components[1].move(t.x-a.x,t.y-a.y),e.object.invert=!0}else"measure"===e.type&&(e.object.invert=void 0);const t=e.geometry.components[0],a=e.geometry.components[1],n=e.geometry.components[2],o=Math.sqrt(Math.pow(a.x-t.x,2)+Math.pow(a.y-t.y,2)),r=Math.sqrt(Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2)),l=Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2));let s=180*Math.acos((r*r+o*o-l*l)/(2*r*o))/Math.PI;isNaN(s)&&(s=0),i=lizDict["measure.handle"]+" "+s.toFixed(2)+"°"}}else i+=1==a?lizDict["measure.handle"]+" "+n.toFixed(3)+" "+t:lizDict["measure.handle"]+" "+n.toFixed(3)+" "+t+"<sup>2</sup>";var o=$("#lizmap-measure-message");0==o.length?(o=oe(i)).attr("id","lizmap-measure-message"):o.html("<p>"+i+"</p>")}for(var i in a.length.events.on({activate:function(){oe(lizDict["measure.activate.length"],"info",!0).attr("id","lizmap-measure-message")},deactivate:function(){$("#lizmap-measure-message").remove()}}),a.area.events.on({activate:function(){oe(lizDict["measure.activate.area"],"info",!0).attr("id","lizmap-measure-message")},deactivate:function(){$("#lizmap-measure-message").remove()}}),a.perimeter.events.on({activate:function(){oe(lizDict["measure.activate.perimeter"],"info",!0).attr("id","lizmap-measure-message")},deactivate:function(){$("#lizmap-measure-message").remove()}}),a.angle.events.on({activate:function(){oe(lizDict["measure.activate.angle"],"info",!0).attr("id","lizmap-measure-message")},deactivate:function(){$("#lizmap-measure-message").remove()}}),a.perimeter.measure=function(e,t){var a,n;OpenLayers.Util.indexOf(e.CLASS_NAME,"LineString")>-1?(a=this.getBestLength(e),n=1):(a=this.getBestLength(e.components[0]),n=1),this.events.triggerEvent(t,{measure:a[0],units:a[1],order:n,geometry:e})},a){var o=a[i];o.events.on({measure:n,measurepartial:n}),l.addControl(o),m[i+"Measure"]=o}$("#measure-type").change((function(){var e=$(this);e.find("option").each((function(){var e=$(this).attr("value");e in a&&a[e].active&&a[e].deactivate()})),a[e.val()].activate()})),lizMap.events.on({minidockopened:function(e){"measure"==e.id&&$("#measure-type").change()},minidockclosed:function(e){if("measure"==e.id){var t="";$("#measure-type option").each((function(){var e=$(this).attr("value");e in a&&a[e].active&&(t=e)})),""!=t&&a[t].deactivate()}}}),$("#measure-stop").click((function(){$("#button-measure").click()}))}():($("#measure").parent().remove(),$("#measure-length-menu").remove(),$("#measure-area-menu").remove(),$("#measure-perimeter-menu").remove()),y.events.triggerEvent("toolbarcreated",y),function(){if(0!=$("#permalink").length){var e=new OpenLayers.Control.Permalink("permalink",null,{createParams:D});l.addControl(e);var t=new OpenLayers.Control.Permalink("permalink-embed",$("#permalink-embed").attr("href"),{createParams:D});l.addControl(t),l.events.on({changebaselayer:function(){$("#switcher-baselayer-select").val(l.baseLayer.name).change()},moveend:q,changelayer:V,changebaselayer:q}),$("#select-embed-permalink").change((function(){"p"==$(this).val()?$("#span-embed-personalized-permalink").show():$("#span-embed-personalized-permalink").hide(),q()})),$("#span-embed-personalized-permalink input").change(q),$(".btn-permalink-clear").click((function(){return $("#button-permaLink").click(),!1})),W(),$('#permalink-box ul.permalink-tabs a[data-toggle="tab"]').on("shown",(function(e){"#tab-embed-permalink"==$(e.target).attr("href")&&C()})),$("#geobookmark-form").submit((function(){var e=$('#geobookmark-form input[name="bname"]').val();if(""==e)return oe(lizDict["geobookmark.name.required"],"error",!0),!1;var t=lizUrls.geobookmark,n=JSON.parse(JSON.stringify(L));if(n.name=e,n.q="add",lizMap.lizmapLayerFilterActive){var i=lizMap.lizmapLayerFilterActive+":"+a.layers[lizMap.lizmapLayerFilterActive].filteredFeatures.join();n.filter=i}return $.post(t,n,(function(e){H(e)}),"text"),!1})),lizMap.events.on({minidockopened:function(e){"permaLink"==e.id&&q()}})}}();var $e=!1,xe=G();if("layers"in xe){for(var Ee=xe.layers,Ce=0;Ce<l.layers.length;Ce++)(ke=l.layers[Ce]).isBaseLayer||"T"==Ee[Ce]&&($e=!0,ke.setVisibility(!0));Y(xe)}if($('#switcher button.checkbox[name="layer"]').each((function(){var e=$(this),t=e.val(),a=l.getLayersByName(t)[0];a&&(e.toggleClass("checked",a.visibility),e.hasClass("checked")||!a.isVisible||$e||e.click())})),he){l.getControlsByClass("OpenLayers.Control.ArgParser")[0].configureLayers(),Ce=0;for(var we=p.length;Ce<we;Ce++){var ke=p[Ce],Me=$('#switcher button.checkbox[name="layer"][value="'+ke.name+'"]');be.layers&&ke.getVisibility()!=Me.hasClass("checked")&&$('#switcher button.checkbox[name="layer"][value="'+ke.name+'"]').click()}}$('#switcher button.checkbox.disabled[name="layer"]:not(.checked)').each((function(){var e=$(this),t=e.val(),n=t;t in g&&(n=x(t)),n in a.layers&&"True"==a.layers[n].toggled&&e.addClass("checked")})),$("#navbar div.slider").slider("value",l.getZoom()),l.events.on({zoomend:function(){$("#switcher table.tree tr.legendGraphics.initialized").each((function(){var e=$(this),t=w(e.attr("id").replace("legend-",""),!0);null!=t&&""!=t&&(e.find("div.legendGraphics img").attr("data-src",t),e.hasClass("visible")&&e.find("div.legendGraphics img").attr("src",t))})),$("#navbar div.slider").slider("value",this.getZoom())}}),lizMap.events.on({layerstylechanged:function(e){var t=e.featureType,a=w(t,!0);if(null!=a&&""!=a){var n="#switcher table.tree tr#legend-"+t+" div.legendGraphics img";$(n).attr("data-src",a),$("#switcher table.tree tr#legend-"+t).hasClass("visible")&&$(n).attr("src",a)}}}),$("#mapmenu ul").on("click","li.nav-minidock > a",(function(){var e=$(this),t=e.parent(),a=e.attr("href").substr(1),n=$("#nav-tab-"+a);if(t.hasClass("active"))$("#"+a).removeClass("active"),n.removeClass("active"),t.removeClass("active"),lizMap.events.triggerEvent("minidockclosed",{id:a});else{var i=$("#mapmenu li.nav-minidock.active");0!=i.length&&(i.removeClass("active"),lizMap.events.triggerEvent("minidockclosed",{id:i.children("a").first().attr("href").substr(1)})),n.children("a").first().click(),t.addClass("active"),lizMap.events.triggerEvent("minidockopened",{id:a}),C()}return e.blur(),!1})),"locateByLayer"in a?$("#button-locate").click():$("#button-locate").parent().hide(),0==$("#mapmenu ul li.nav-minidock.active").length&&($("#mini-dock-content > .tab-pane.active").removeClass("active"),$("#mini-dock-tabs li.active").removeClass("active")),$("#mapmenu ul").on("click","li.nav-dock > a",(function(){var e=$(this),t=e.parent(),a=e.attr("href").substr(1),n=$("#nav-tab-"+a),i="";if(t.hasClass("active"))$("#"+a).removeClass("active"),n.removeClass("active"),t.removeClass("active"),i="dockclosed";else{var o=$("#mapmenu li.nav-dock.active");0!=o.length&&(o.removeClass("active"),lizMap.events.triggerEvent("dockclosed",{id:o.children("a").first().attr("href").substr(1)})),n.show(),n.children("a").first().click(),t.addClass("active"),i="dockopened"}e.blur();var r=$("#dock");return 0==$("#dock-tabs .active").length?r.hide():r.is(":visible")||r.show(),""!=i&&lizMap.events.triggerEvent(i,{id:a}),!1})),$("#mapmenu ul").on("click","li.nav-right-dock > a",(function(){var e=$(this),t=e.parent(),a=e.attr("href").substr(1),n=$("#nav-tab-"+a),i="";if(t.hasClass("active"))$("#"+a).removeClass("active"),n.removeClass("active"),t.removeClass("active"),i="rightdockclosed";else{var o=$("#mapmenu li.nav-right-dock.active");0!=o.length&&(o.removeClass("active"),lizMap.events.triggerEvent("rightdockclosed",{id:o.children("a").first().attr("href").substr(1)})),n.show(),n.children("a").first().click(),t.addClass("active"),i="rightdockopened"}e.blur();var r=$("#right-dock");return 0==$("#right-dock-tabs .active").length?(r.hide(),$("#content").removeClass("right-dock-visible"),E()):r.is(":visible")||($("#content").addClass("right-dock-visible"),r.show(),E()),""!=i&&lizMap.events.triggerEvent(i,{id:a}),!1})),$("#menuToggle").click((function(){$(this).toggleClass("opened")})),$("#menuToggle:visible ~ #mapmenu ul").on("click","li > a",(function(){$("#menuToggle").removeClass("opened")})),$("#button-switcher").click(),E(),$('#headermenu .navbar-inner .nav a[rel="tooltip"]').tooltip(),$('#mapmenu .nav a[rel="tooltip"]').tooltip(),y.events.triggerEvent("uicreated",y)})).catch((e=>{console.error(e);const t=`\n          <p class="error-msg">${lizDict["startup.error"]}\n          <br><a href="${lizUrls.basepath}">${lizDict["startup.goToProject"]}</a></p>`;document.getElementById("header").insertAdjacentHTML("afterend",t)})).finally((()=>{$("body").css("cursor","auto"),$("#loading").dialog("close"),U&&Z(U,{x:l.size.w/2,y:l.size.h/2})}))}};return ye.events=new OpenLayers.Events(ye,null,["treecreated","mapcreated","layersadded","uicreated","dockopened","dockclosed"],!0,{includeXY:!0}),ye}(),lizMap.events.on({mapcreated:function(e){if("emptyBaselayer"in e.config.options&&"True"==e.config.options.emptyBaselayer&&((k={}).title=lizDict["baselayer.empty.title"],k.name="emptyBaselayer",e.config.layers.emptyBaselayer=k,e.baselayers.push(new OpenLayers.Layer.Vector("emptyBaselayer",{isBaseLayer:!0,maxExtent:e.map.maxExtent,maxScale:e.map.maxScale,minScale:e.map.minScale,numZoomLevels:e.map.numZoomLevels,scales:e.map.scales,projection:e.map.projection,units:e.map.projection.proj.units})),e.map.allOverlays=!1),"osmMapnik"in e.config.options&&"True"==e.config.options.osmMapnik||"osmStamenToner"in e.config.options&&"True"==e.config.options.osmStamenToner||"openTopoMap"in e.config.options&&"True"==e.config.options.openTopoMap||"osmCyclemap"in e.config.options&&"True"==e.config.options.osmCyclemap&&"OCMKey"in e.config.options||"googleStreets"in e.config.options&&"True"==e.config.options.googleStreets||"googleSatellite"in e.config.options&&"True"==e.config.options.googleSatellite||"googleHybrid"in e.config.options&&"True"==e.config.options.googleHybrid||"googleTerrain"in e.config.options&&"True"==e.config.options.googleTerrain||"bingStreets"in e.config.options&&"True"==e.config.options.bingStreets&&"bingKey"in e.config.options||"bingSatellite"in e.config.options&&"True"==e.config.options.bingSatellite&&"bingKey"in e.config.options||"bingHybrid"in e.config.options&&"True"==e.config.options.bingHybrid&&"bingKey"in e.config.options||"ignTerrain"in e.config.options&&"True"==e.config.options.ignTerrain||"ignStreets"in e.config.options&&"True"==e.config.options.ignStreets||"ignSatellite"in e.config.options&&"True"==e.config.options.ignSatellite||"ignCadastral"in e.config.options&&"True"==e.config.options.ignCadastral){var t=null;OpenLayers.Projection.defaults["EPSG:900913"].maxExtent?t=new OpenLayers.Bounds(OpenLayers.Projection.defaults["EPSG:900913"].maxExtent):OpenLayers.Projection.defaults["EPSG:3857"].maxExtent&&(t=new OpenLayers.Bounds(OpenLayers.Projection.defaults["EPSG:3857"].maxExtent));var a={zoomOffset:0,maxResolution:156543.03390625};if("resolutions"in e.config.options&&0!=e.config.options.resolutions.length){for(var n=e.config.options.resolutions,i=n[0],o=n.length,r=0,l=156543.03390625;l>i;)r+=1,l=156543.03390625/Math.pow(2,r);a.zoomOffset=r,a.maxResolution=i,a.numZoomLevels=o}if("osmMapnik"in e.config.options&&"True"==e.config.options.osmMapnik){e.map.allOverlays=!1;var s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23};0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var p=new OpenLayers.Layer.OSM("osm",["https://tile.openstreetmap.org/${z}/${x}/${y}.png"],s);p.maxExtent=t,e.config.layers.osm={name:"osm",title:"OpenStreetMap",type:"baselayer"},e.baselayers.push(p)}if("osmStamenToner"in e.config.options&&"True"==e.config.options.osmStamenToner){e.map.allOverlays=!1,s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var m=new OpenLayers.Layer.OSM("osm-toner",["https://stamen-tiles-a.a.ssl.fastly.net/toner-lite/${z}/${x}/${y}.png","https://stamen-tiles-b.a.ssl.fastly.net/toner-lite/${z}/${x}/${y}.png","https://stamen-tiles-c.a.ssl.fastly.net/toner-lite/${z}/${x}/${y}.png","https://stamen-tiles-d.a.ssl.fastly.net/toner-lite/${z}/${x}/${y}.png"],s);m.maxExtent=t,e.config.layers["osm-toner"]={name:"osm-toner",title:"OSM Stamen Toner",type:"baselayer"},e.baselayers.push(m)}if("openTopoMap"in e.config.options&&"True"==e.config.options.openTopoMap){e.map.allOverlays=!1,s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var u=new OpenLayers.Layer.OSM("opentopomap",["https://a.tile.opentopomap.org/{z}/{x}/{y}.png","https://b.tile.opentopomap.org/{z}/{x}/{y}.png","https://c.tile.opentopomap.org/{z}/{x}/{y}.png"],s);u.maxExtent=t,e.config.layers.opentopomap={name:"opentopomap",title:"OpenTopoMap",type:"baselayer"},e.baselayers.push(u)}if("osmCyclemap"in e.config.options&&"True"==e.config.options.osmCyclemap&&"OCMKey"in e.config.options){e.map.allOverlays=!1,s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var c=new OpenLayers.Layer.OSM("osm-cyclemap","https://tile.thunderforest.com/cycle/${z}/${x}/${y}.png?apiKey="+e.config.options.OCMKey,s);c.maxExtent=t,e.config.layers["osm-cycle"]={name:"osm-cycle",title:"OSM CycleMap",type:"baselayer"},e.baselayers.push(c)}try{if("googleSatellite"in e.config.options&&"True"==e.config.options.googleSatellite){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:21},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var f=new OpenLayers.Layer.Google("gsat",{type:google.maps.MapTypeId.SATELLITE,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});f.maxExtent=t,e.config.layers.gsat={name:"gsat",title:"Google Satellite",type:"baselayer"},e.baselayers.push(f),e.map.allOverlays=!1,e.map.zoomDuration=0}if("googleHybrid"in e.config.options&&"True"==e.config.options.googleHybrid){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:20},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var d=new OpenLayers.Layer.Google("ghyb",{type:google.maps.MapTypeId.HYBRID,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});d.maxExtent=t,e.config.layers.ghyb={name:"ghyb",title:"Google Hybrid",type:"baselayer"},e.baselayers.push(d),e.map.allOverlays=!1,e.map.zoomDuration=0}if("googleTerrain"in e.config.options&&"True"==e.config.options.googleTerrain){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:16},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var y=new OpenLayers.Layer.Google("gphy",{type:google.maps.MapTypeId.TERRAIN,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});y.maxExtent=t,e.config.layers.gphy={name:"gphy",title:"Google Terrain",type:"baselayer"},e.baselayers.push(y),e.map.allOverlays=!1,e.map.zoomDuration=0}if("googleStreets"in e.config.options&&"True"==e.config.options.googleStreets){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:20},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var g=new OpenLayers.Layer.Google("gmap",{numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});g.maxExtent=t,e.config.layers.gmap={name:"gmap",title:"Google Streets",type:"baselayer"},e.baselayers.push(g),e.map.allOverlays=!1,e.map.zoomDuration=0}if("bingStreets"in e.config.options&&"True"==e.config.options.bingStreets&&"bingKey"in e.config.options){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var v=new OpenLayers.Layer.Bing({key:e.config.options.bingKey,type:"Road",name:"Bing Road",numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});v.maxExtent=t,e.config.layers.bmap={name:"bmap",title:"Bing Road",type:"baselayer"},e.baselayers.push(v),e.map.allOverlays=!1}if("bingSatellite"in e.config.options&&"True"==e.config.options.bingSatellite&&"bingKey"in e.config.options){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var h=new OpenLayers.Layer.Bing({key:e.config.options.bingKey,type:"Aerial",name:"Bing Aerial",numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});h.maxExtent=t,e.config.layers.baerial={name:"baerial",title:"Bing Aerial",type:"baselayer"},e.baselayers.push(h),e.map.allOverlays=!1}if("bingHybrid"in e.config.options&&"True"==e.config.options.bingHybrid&&"bingKey"in e.config.options){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:23},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var b=new OpenLayers.Layer.Bing({key:e.config.options.bingKey,type:"AerialWithLabels",name:"Bing Hybrid",numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset});b.maxExtent=t,e.config.layers.bhybrid={name:"bhybrid",title:"Bing Hybrid",type:"baselayer"},e.baselayers.push(b),e.map.allOverlays=!1}var L='<a href="http://www.ign.fr" target="_blank"><img width="25" src="https://wxs.ign.fr/static/logos/IGN/IGN.gif" title="Institut national de l\'information géographique et forestière" alt="IGN"></a>';if("ignKey"in e.config.options){var z=e.config.options.ignKey;if("ignTerrain"in e.config.options&&"True"==e.config.options.ignTerrain){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:18},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var O=new OpenLayers.Layer.WMTS({name:"ignmap",url:"https://wxs.ign.fr/"+z+"/geoportail/wmts",layer:"GEOGRAPHICALGRIDSYSTEMS.MAPS",matrixSet:"PM",style:"normal",projection:new OpenLayers.Projection("EPSG:3857"),attribution:L,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset,zoomOffset:s.zoomOffset});O.maxExtent=t,e.config.layers.ignmap={name:"ignmap",title:"IGN Scan",type:"baselayer"},e.baselayers.push(O),e.map.allOverlays=!1}}if("ignStreets"in e.config.options&&"True"==e.config.options.ignStreets){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:18},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var S=new OpenLayers.Layer.WMTS({name:"ignplan",url:"https://wxs.ign.fr/cartes/geoportail/wmts",layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2",matrixSet:"PM",style:"normal",format:"image/png",projection:new OpenLayers.Projection("EPSG:3857"),attribution:L,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset,zoomOffset:s.zoomOffset});S.maxExtent=t,e.config.layers.ignplan={name:"ignplan",title:"IGN Plan",type:"baselayer"},e.baselayers.push(S),e.map.allOverlays=!1}if("ignSatellite"in e.config.options&&"True"==e.config.options.ignSatellite){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:22},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var T=new OpenLayers.Layer.WMTS({name:"ignphoto",url:"https://wxs.ign.fr/ortho/geoportail/wmts",layer:"ORTHOIMAGERY.ORTHOPHOTOS",matrixSet:"PM",style:"normal",projection:new OpenLayers.Projection("EPSG:3857"),attribution:L,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset,zoomOffset:s.zoomOffset});T.maxExtent=t,e.config.layers.ignphoto={name:"ignphoto",title:"IGN Photos",type:"baselayer"},e.baselayers.push(T),e.map.allOverlays=!1}if("ignCadastral"in e.config.options&&"True"==e.config.options.ignCadastral){s={zoomOffset:0,maxResolution:156543.03390625,numZoomLevels:20},0!=a.zoomOffset&&(s.zoomOffset=a.zoomOffset,s.maxResolution=a.maxResolution),a.zoomOffset+a.numZoomLevels<=s.numZoomLevels?s.numZoomLevels=a.numZoomLevels:s.numZoomLevels=s.numZoomLevels-a.zoomOffset;var $=new OpenLayers.Layer.WMTS({name:"igncadastral",url:"https://wxs.ign.fr/parcellaire/geoportail/wmts",layer:"CADASTRALPARCELS.PARCELLAIRE_EXPRESS",matrixSet:"PM",style:"normal",format:"image/png",projection:new OpenLayers.Projection("EPSG:3857"),attribution:L,numZoomLevels:s.numZoomLevels,maxResolution:s.maxResolution,minZoomLevel:s.zoomOffset,zoomOffset:s.zoomOffset});$.maxExtent=t,e.config.layers.igncadastral={name:"igncadastral",title:"IGN Cadastre",type:"baselayer"},e.baselayers.push($),e.map.allOverlays=!1}}catch(e){}}if("lizmapExternalBaselayers"in e.config){var x=OpenLayers.Util.urlAppend(lizUrls.wms,OpenLayers.Util.getParameterString(lizUrls.params));if(lizUrls.publicUrlList&&lizUrls.publicUrlList.length>1){x=[];for(var E=0,C=lizUrls.publicUrlList.length;E<C;E++)x.push(OpenLayers.Util.urlAppend(lizUrls.publicUrlList[E],OpenLayers.Util.getParameterString(lizUrls.params)))}for(var w in e.config.lizmapExternalBaselayers){var k=e.config.lizmapExternalBaselayers[w];if("repository"in k&&"project"in k){var M=e.cleanName(k.layerName),P={layers:k.layerName,version:"1.3.0",exceptions:"application/vnd.ogc.se_inimage",format:k.layerImageFormat?"image/"+k.layerImageFormat:"image/png",dpi:96};"image/jpeg"!=P.format&&(P.transparent=!0);var N=new RegExp("repository=(.+)&project=(.+)","g");if(x instanceof Array)R=jQuery.map(x,(function(e){return e.replace(N,"repository="+k.repository+"&project="+k.project)}));else var R=x.replace(N,"repository="+k.repository+"&project="+k.project);k.title=k.layerTitle,k.name=k.layerName,k.baselayer=!0,k.singleTile="False",e.config.layers[M]=k,e.baselayers.push(new OpenLayers.Layer.WMS(M,R,P,{isBaseLayer:!0,gutter:"True"==k.cached?0:5,buffer:0,singleTile:"True"==k.singleTile,ratio:1})),e.map.allOverlays=!1}}}},uicreated:function(e){var t=e.map;t.id in OpenLayers.Layer.Google.cache&&google.maps.event.addListenerOnce(OpenLayers.Layer.Google.cache[t.id].mapObject,"tilesloaded",(function(){for(var e=t.layers,a=!1,n=e.length-1;n>=0;--n)if((i=e[n])instanceof OpenLayers.Layer.Google&&!0===i.visibility&&!0===i.inRange){i.redraw(!0),a=!0;break}if(!a)for(n=e.length-1;n>=0;--n){var i;if((i=e[n])instanceof OpenLayers.Layer.Google){i.display(!1);break}}})),lizMap.checkMobile()&&$("#button-switcher").parent().hasClass("active")&&$("#button-switcher").click(),$("#dock-close").click((function(){$("#mapmenu .nav-list > li.active.nav-dock > a").click()})),$("#right-dock-close").click((function(){$("#mapmenu .nav-list > li.active.nav-right-dock > a").click()}))}}),$(document).ready((function(){$("body").css("cursor","wait"),$("#loading").dialog({modal:!0,draggable:!1,resizable:!1,closeOnEscape:!1,dialogClass:"liz-dialog-wait",minHeight:128}).parent().removeClass("ui-corner-all").children(".ui-dialog-titlebar").removeClass("ui-corner-all"),OpenLayers.DOTS_PER_INCH=96,lizMap.init(),$("#loading").css("min-height","128px")}))})();
//# sourceMappingURL=map.js.map